import{S as bg,i as gg,s as xg,e as o,t as n,k as d,w as j,c as l,a as r,h as a,d as t,m as c,x as w,g as i,G as s,y as E,q as _,o as v,B as k,b as C,U as $g,M as jg,V as wg,N as kc,p as jn,v as Eg,n as wn}from"../../chunks/vendor-hf-doc-builder.js";import{T as yc}from"../../chunks/Tip-hf-doc-builder.js";import{Y as Cc}from"../../chunks/Youtube-hf-doc-builder.js";import{I as gs}from"../../chunks/IconCopyLink-hf-doc-builder.js";import{C as M}from"../../chunks/CodeBlock-hf-doc-builder.js";import{D as vg}from"../../chunks/DocNotebookDropdown-hf-doc-builder.js";import{F as kg}from"../../chunks/FrameworkSwitchCourse-hf-doc-builder.js";function yg(R){let p,q;return p=new vg({props:{classNames:"absolute z-10 right-0 top-0",options:[{label:"Google Colab",value:"https://colab.research.google.com/github/huggingface/notebooks/blob/master/course/chapter7/section7_tf.ipynb"},{label:"Aws Studio",value:"https://studiolab.sagemaker.aws/import/github/huggingface/notebooks/blob/master/course/chapter7/section7_tf.ipynb"}]}}),{c(){j(p.$$.fragment)},l(f){w(p.$$.fragment,f)},m(f,y){E(p,f,y),q=!0},i(f){q||(_(p.$$.fragment,f),q=!0)},o(f){v(p.$$.fragment,f),q=!1},d(f){k(p,f)}}}function Cg(R){let p,q;return p=new vg({props:{classNames:"absolute z-10 right-0 top-0",options:[{label:"Google Colab",value:"https://colab.research.google.com/github/huggingface/notebooks/blob/master/course/chapter7/section7_pt.ipynb"},{label:"Aws Studio",value:"https://studiolab.sagemaker.aws/import/github/huggingface/notebooks/blob/master/course/chapter7/section7_pt.ipynb"}]}}),{c(){j(p.$$.fragment)},l(f){w(p.$$.fragment,f)},m(f,y){E(p,f,y),q=!0},i(f){q||(_(p.$$.fragment,f),q=!0)},o(f){v(p.$$.fragment,f),q=!1},d(f){k(p,f)}}}function Pg(R){let p,q,f,y,D,b,g,x,h,S,$,A,N,I;return{c(){p=o("p"),q=n("\u{1F4A1} Les mod\xE8les bas\xE9 que sur l\u2019encodeur comme BERT ont tendance \xE0 \xEAtre excellents pour extraire les r\xE9ponses \xE0 des questions factuelles comme \xAB Qui a invent\xE9 l\u2019architecture Transformer ? \xBB mais ne sont pas tr\xE8s performants lorsqu\u2019on leur pose des questions ouvertes comme \xAB Pourquoi le ciel est-il bleu ? \xBB. Dans ces cas plus difficiles, les mod\xE8les encodeurs-d\xE9codeurs comme le T5 et BART sont g\xE9n\xE9ralement utilis\xE9s pour synth\xE9tiser les informations d\u2019une mani\xE8re assez similaire au "),f=o("a"),y=n("r\xE9sum\xE9 de texte"),D=n(". Si vous \xEAtes int\xE9ress\xE9 par ce type de r\xE9ponse aux questions "),b=o("em"),g=n("g\xE9n\xE9ratives"),x=n(", nous vous recommandons de consulter notre "),h=o("a"),S=n("d\xE9mo"),$=n(" bas\xE9e sur le "),A=o("a"),N=n("jeu de donn\xE9es ELI5"),I=n("."),this.h()},l(z){p=l(z,"P",{});var P=r(p);q=a(P,"\u{1F4A1} Les mod\xE8les bas\xE9 que sur l\u2019encodeur comme BERT ont tendance \xE0 \xEAtre excellents pour extraire les r\xE9ponses \xE0 des questions factuelles comme \xAB Qui a invent\xE9 l\u2019architecture Transformer ? \xBB mais ne sont pas tr\xE8s performants lorsqu\u2019on leur pose des questions ouvertes comme \xAB Pourquoi le ciel est-il bleu ? \xBB. Dans ces cas plus difficiles, les mod\xE8les encodeurs-d\xE9codeurs comme le T5 et BART sont g\xE9n\xE9ralement utilis\xE9s pour synth\xE9tiser les informations d\u2019une mani\xE8re assez similaire au "),f=l(P,"A",{href:!0});var V=r(f);y=a(V,"r\xE9sum\xE9 de texte"),V.forEach(t),D=a(P,". Si vous \xEAtes int\xE9ress\xE9 par ce type de r\xE9ponse aux questions "),b=l(P,"EM",{});var T=r(b);g=a(T,"g\xE9n\xE9ratives"),T.forEach(t),x=a(P,", nous vous recommandons de consulter notre "),h=l(P,"A",{href:!0,rel:!0});var O=r(h);S=a(O,"d\xE9mo"),O.forEach(t),$=a(P," bas\xE9e sur le "),A=l(P,"A",{href:!0,rel:!0});var L=r(A);N=a(L,"jeu de donn\xE9es ELI5"),L.forEach(t),I=a(P,"."),P.forEach(t),this.h()},h(){C(f,"href","/course/fr/chapter7/5"),C(h,"href","https://yjernite.github.io/lfqa.html"),C(h,"rel","nofollow"),C(A,"href","https://huggingface.co/datasets/eli5"),C(A,"rel","nofollow")},m(z,P){i(z,p,P),s(p,q),s(p,f),s(f,y),s(p,D),s(p,b),s(b,g),s(p,x),s(p,h),s(h,S),s(p,$),s(p,A),s(A,N),s(p,I)},d(z){z&&t(p)}}}function Ag(R){let p,q,f,y,D,b,g,x,h,S,$,A,N,I,z,P,V;return{c(){p=o("p"),q=n("\u270F\uFE0F "),f=o("strong"),y=n("A votre tour !"),D=n(" En utilisant l\u2019architecture XLNet, le "),b=o("em"),g=n("padding"),x=n(" est appliqu\xE9 \xE0 gauche et la question et le contexte sont intervertis. Adaptez tout le code que nous venons de voir \xE0 l\u2019architecture XLNet (et ajoutez "),h=o("code"),S=n("padding=True"),$=n("). Soyez conscient que le token "),A=o("code"),N=n("[CLS]"),I=n(" peut ne pas \xEAtre \xE0 la position 0 avec le "),z=o("em"),P=n("padding"),V=n(" appliqu\xE9.")},l(T){p=l(T,"P",{});var O=r(p);q=a(O,"\u270F\uFE0F "),f=l(O,"STRONG",{});var L=r(f);y=a(L,"A votre tour !"),L.forEach(t),D=a(O," En utilisant l\u2019architecture XLNet, le "),b=l(O,"EM",{});var U=r(b);g=a(U,"padding"),U.forEach(t),x=a(O," est appliqu\xE9 \xE0 gauche et la question et le contexte sont intervertis. Adaptez tout le code que nous venons de voir \xE0 l\u2019architecture XLNet (et ajoutez "),h=l(O,"CODE",{});var Q=r(h);S=a(Q,"padding=True"),Q.forEach(t),$=a(O,"). Soyez conscient que le token "),A=l(O,"CODE",{});var W=r(A);N=a(W,"[CLS]"),W.forEach(t),I=a(O," peut ne pas \xEAtre \xE0 la position 0 avec le "),z=l(O,"EM",{});var H=r(z);P=a(H,"padding"),H.forEach(t),V=a(O," appliqu\xE9."),O.forEach(t)},m(T,O){i(T,p,O),s(p,q),s(p,f),s(f,y),s(p,D),s(p,b),s(b,g),s(p,x),s(p,h),s(h,S),s(p,$),s(p,A),s(A,N),s(p,I),s(p,z),s(z,P),s(p,V)},d(T){T&&t(p)}}}function Dg(R){let p,q,f,y,D,b,g,x,h,S,$,A,N,I,z,P;return y=new gs({}),{c(){p=o("h2"),q=o("a"),f=o("span"),j(y.$$.fragment),D=d(),b=o("span"),g=o("i"),x=n("Finetuner"),h=n(" fin du mod\xE8le avec Keras"),S=d(),$=o("p"),A=n("Le code d\u2019entra\xEEnement de cet exemple ressemblera beaucoup au code des sections pr\xE9c\xE9dentes, mais le calcul de la m\xE9trique sera un d\xE9fi unique. Puisque nous avons rembourr\xE9 tous les \xE9chantillons \xE0 la longueur maximale que nous avons d\xE9finie, il n\u2019y a pas de collateur de donn\xE9es \xE0 d\xE9finir. Ainsi le calcul de la m\xE9trique est vraiment la seule chose dont nous devons nous soucier. La partie la plus difficile sera de post-traiter les pr\xE9dictions du mod\xE8le en \xE9tendues de texte dans les exemples originaux. Une fois que nous aurons fait cela, la m\xE9trique de la biblioth\xE8que \u{1F917} "),N=o("em"),I=n("Datasets"),z=n(" fera le gros du travail pour nous."),this.h()},l(V){p=l(V,"H2",{class:!0});var T=r(p);q=l(T,"A",{id:!0,class:!0,href:!0});var O=r(q);f=l(O,"SPAN",{});var L=r(f);w(y.$$.fragment,L),L.forEach(t),O.forEach(t),D=c(T),b=l(T,"SPAN",{});var U=r(b);g=l(U,"I",{});var Q=r(g);x=a(Q,"Finetuner"),Q.forEach(t),h=a(U," fin du mod\xE8le avec Keras"),U.forEach(t),T.forEach(t),S=c(V),$=l(V,"P",{});var W=r($);A=a(W,"Le code d\u2019entra\xEEnement de cet exemple ressemblera beaucoup au code des sections pr\xE9c\xE9dentes, mais le calcul de la m\xE9trique sera un d\xE9fi unique. Puisque nous avons rembourr\xE9 tous les \xE9chantillons \xE0 la longueur maximale que nous avons d\xE9finie, il n\u2019y a pas de collateur de donn\xE9es \xE0 d\xE9finir. Ainsi le calcul de la m\xE9trique est vraiment la seule chose dont nous devons nous soucier. La partie la plus difficile sera de post-traiter les pr\xE9dictions du mod\xE8le en \xE9tendues de texte dans les exemples originaux. Une fois que nous aurons fait cela, la m\xE9trique de la biblioth\xE8que \u{1F917} "),N=l(W,"EM",{});var H=r(N);I=a(H,"Datasets"),H.forEach(t),z=a(W," fera le gros du travail pour nous."),W.forEach(t),this.h()},h(){C(q,"id","ifinetuneri-fin-du-modle-avec-keras"),C(q,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),C(q,"href","#ifinetuneri-fin-du-modle-avec-keras"),C(p,"class","relative group")},m(V,T){i(V,p,T),s(p,q),s(q,f),E(y,f,null),s(p,D),s(p,b),s(b,g),s(g,x),s(b,h),i(V,S,T),i(V,$,T),s($,A),s($,N),s(N,I),s($,z),P=!0},i(V){P||(_(y.$$.fragment,V),P=!0)},o(V){v(y.$$.fragment,V),P=!1},d(V){V&&t(p),k(y),V&&t(S),V&&t($)}}}function Sg(R){let p,q,f,y,D,b,g,x,h,S,$,A,N,I,z,P,V,T,O,L,U;return y=new gs({}),{c(){p=o("h2"),q=o("a"),f=o("span"),j(y.$$.fragment),D=d(),b=o("span"),g=o("i"),x=n("Finetuner"),h=n(" le mod\xE8le avec l'API "),S=o("code"),$=n("Trainer"),A=d(),N=o("p"),I=n("Le code d\u2019entra\xEEnement pour cet exemple ressemblera beaucoup au code des sections pr\xE9c\xE9dentes mais le calcul de la m\xE9trique avec la fonction "),z=o("code"),P=n("compute_metrics()"),V=n(" sera un d\xE9fi unique. Puisque nous avons rembourr\xE9 tous les \xE9chantillons \xE0 la longueur maximale que nous avons d\xE9finie, il n\u2019y a pas de collateur de donn\xE9es \xE0 d\xE9finir. Ainsi le calcul de la m\xE9trique est vraiment la seule chose dont nous devons nous soucier. La partie la plus difficile sera de post-traiter les pr\xE9dictions du mod\xE8le en \xE9tendues de texte dans les exemples originaux. Une fois que nous aurons fait cela, la m\xE9trique de la biblioth\xE8que \u{1F917} "),T=o("em"),O=n("Datasets"),L=n(" fera le gros du travail pour nous."),this.h()},l(Q){p=l(Q,"H2",{class:!0});var W=r(p);q=l(W,"A",{id:!0,class:!0,href:!0});var H=r(q);f=l(H,"SPAN",{});var G=r(f);w(y.$$.fragment,G),G.forEach(t),H.forEach(t),D=c(W),b=l(W,"SPAN",{});var ee=r(b);g=l(ee,"I",{});var Z=r(g);x=a(Z,"Finetuner"),Z.forEach(t),h=a(ee," le mod\xE8le avec l'API "),S=l(ee,"CODE",{});var F=r(S);$=a(F,"Trainer"),F.forEach(t),ee.forEach(t),W.forEach(t),A=c(Q),N=l(Q,"P",{});var X=r(N);I=a(X,"Le code d\u2019entra\xEEnement pour cet exemple ressemblera beaucoup au code des sections pr\xE9c\xE9dentes mais le calcul de la m\xE9trique avec la fonction "),z=l(X,"CODE",{});var le=r(z);P=a(le,"compute_metrics()"),le.forEach(t),V=a(X," sera un d\xE9fi unique. Puisque nous avons rembourr\xE9 tous les \xE9chantillons \xE0 la longueur maximale que nous avons d\xE9finie, il n\u2019y a pas de collateur de donn\xE9es \xE0 d\xE9finir. Ainsi le calcul de la m\xE9trique est vraiment la seule chose dont nous devons nous soucier. La partie la plus difficile sera de post-traiter les pr\xE9dictions du mod\xE8le en \xE9tendues de texte dans les exemples originaux. Une fois que nous aurons fait cela, la m\xE9trique de la biblioth\xE8que \u{1F917} "),T=l(X,"EM",{});var se=r(T);O=a(se,"Datasets"),se.forEach(t),L=a(X," fera le gros du travail pour nous."),X.forEach(t),this.h()},h(){C(q,"id","ifinetuneri-le-modle-avec-lapi-trainer"),C(q,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),C(q,"href","#ifinetuneri-le-modle-avec-lapi-trainer"),C(p,"class","relative group")},m(Q,W){i(Q,p,W),s(p,q),s(q,f),E(y,f,null),s(p,D),s(p,b),s(b,g),s(g,x),s(b,h),s(b,S),s(S,$),i(Q,A,W),i(Q,N,W),s(N,I),s(N,z),s(z,P),s(N,V),s(N,T),s(T,O),s(N,L),U=!0},i(Q){U||(_(y.$$.fragment,Q),U=!0)},o(Q){v(y.$$.fragment,Q),U=!1},d(Q){Q&&t(p),k(y),Q&&t(A),Q&&t(N)}}}function Mg(R){let p,q;return p=new Cc({props:{id:"VN67ZpN33Ss"}}),{c(){j(p.$$.fragment)},l(f){w(p.$$.fragment,f)},m(f,y){E(p,f,y),q=!0},i(f){q||(_(p.$$.fragment,f),q=!0)},o(f){v(p.$$.fragment,f),q=!1},d(f){k(p,f)}}}function zg(R){let p,q;return p=new Cc({props:{id:"BNy08iIWVJM"}}),{c(){j(p.$$.fragment)},l(f){w(p.$$.fragment,f)},m(f,y){E(p,f,y),q=!0},i(f){q||(_(p.$$.fragment,f),q=!0)},o(f){v(p.$$.fragment,f),q=!1},d(f){k(p,f)}}}function Ng(R){let p,q,f,y,D,b,g;return p=new M({props:{code:`

`,highlighted:`<span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> TFAutoModelForQuestionAnswering

eval_set_for_model = eval_set.remove_columns([<span class="hljs-string">&quot;example_id&quot;</span>, <span class="hljs-string">&quot;offset_mapping&quot;</span>])
eval_set_for_model.set_format(<span class="hljs-string">&quot;numpy&quot;</span>)

batch = {k: eval_set_for_model[k] <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> eval_set_for_model.column_names}
trained_model = TFAutoModelForQuestionAnswering.from_pretrained(trained_checkpoint)

outputs = trained_model(**batch)`}}),b=new M({props:{code:`start_logits = outputs.start_logits.numpy()
end_logits = outputs.end_logits.numpy()`,highlighted:`start_logits = outputs.start_logits.numpy()
end_logits = outputs.end_logits.numpy()`}}),{c(){j(p.$$.fragment),q=d(),f=o("p"),y=n("Pour faciliter l\u2019exp\xE9rimentation, nous allons convertir ces sorties en tableaux NumPy :"),D=d(),j(b.$$.fragment)},l(x){w(p.$$.fragment,x),q=c(x),f=l(x,"P",{});var h=r(f);y=a(h,"Pour faciliter l\u2019exp\xE9rimentation, nous allons convertir ces sorties en tableaux NumPy :"),h.forEach(t),D=c(x),w(b.$$.fragment,x)},m(x,h){E(p,x,h),i(x,q,h),i(x,f,h),s(f,y),i(x,D,h),E(b,x,h),g=!0},i(x){g||(_(p.$$.fragment,x),_(b.$$.fragment,x),g=!0)},o(x){v(p.$$.fragment,x),v(b.$$.fragment,x),g=!1},d(x){k(p,x),x&&t(q),x&&t(f),x&&t(D),k(b,x)}}}function Tg(R){let p,q,f,y,D,b,g,x,h,S;return p=new M({props:{code:`

`,highlighted:`<span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForQuestionAnswering

eval_set_for_model = eval_set.remove_columns([<span class="hljs-string">&quot;example_id&quot;</span>, <span class="hljs-string">&quot;offset_mapping&quot;</span>])
eval_set_for_model.set_format(<span class="hljs-string">&quot;torch&quot;</span>)

device = torch.device(<span class="hljs-string">&quot;cuda&quot;</span>) <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> torch.device(<span class="hljs-string">&quot;cpu&quot;</span>)
batch = {k: eval_set_for_model[k].to(device) <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> eval_set_for_model.column_names}
trained_model = AutoModelForQuestionAnswering.from_pretrained(trained_checkpoint).to(
    device
)

<span class="hljs-keyword">with</span> torch.no_grad():
    outputs = trained_model(**batch)`}}),h=new M({props:{code:`start_logits = outputs.start_logits.cpu().numpy()
end_logits = outputs.end_logits.cpu().numpy()`,highlighted:`start_logits = outputs.start_logits.cpu().numpy()
end_logits = outputs.end_logits.cpu().numpy()`}}),{c(){j(p.$$.fragment),q=d(),f=o("p"),y=n("Puisque "),D=o("code"),b=n("Trainer"),g=n(" nous donne les pr\xE9dictions sous forme de tableaux NumPy, nous r\xE9cup\xE9rons les logits de d\xE9but et de fin et les convertissons dans ce format :"),x=d(),j(h.$$.fragment)},l($){w(p.$$.fragment,$),q=c($),f=l($,"P",{});var A=r(f);y=a(A,"Puisque "),D=l(A,"CODE",{});var N=r(D);b=a(N,"Trainer"),N.forEach(t),g=a(A," nous donne les pr\xE9dictions sous forme de tableaux NumPy, nous r\xE9cup\xE9rons les logits de d\xE9but et de fin et les convertissons dans ce format :"),A.forEach(t),x=c($),w(h.$$.fragment,$)},m($,A){E(p,$,A),i($,q,A),i($,f,A),s(f,y),s(f,D),s(D,b),s(f,g),i($,x,A),E(h,$,A),S=!0},i($){S||(_(p.$$.fragment,$),_(h.$$.fragment,$),S=!0)},o($){v(p.$$.fragment,$),v(h.$$.fragment,$),S=!1},d($){k(p,$),$&&t(q),$&&t(f),$&&t(x),k(h,$)}}}function Lg(R){let p,q,f,y,D;return{c(){p=o("p"),q=n("Maintenant, mettons tout ce que nous venons de faire dans une fonction "),f=o("code"),y=n("compute_metrics()"),D=n(" que nous utiliserons apr\xE8s avoir entra\xEEn\xE9 notre mod\xE8le. Nous aurons besoin de passer un peu plus que juste les logits de sortie, car nous devons chercher dans le jeu de donn\xE9es des caract\xE9ristiques pour le d\xE9calage et dans le jeu de donn\xE9es des exemples pour les contextes originaux :")},l(b){p=l(b,"P",{});var g=r(p);q=a(g,"Maintenant, mettons tout ce que nous venons de faire dans une fonction "),f=l(g,"CODE",{});var x=r(f);y=a(x,"compute_metrics()"),x.forEach(t),D=a(g," que nous utiliserons apr\xE8s avoir entra\xEEn\xE9 notre mod\xE8le. Nous aurons besoin de passer un peu plus que juste les logits de sortie, car nous devons chercher dans le jeu de donn\xE9es des caract\xE9ristiques pour le d\xE9calage et dans le jeu de donn\xE9es des exemples pour les contextes originaux :"),g.forEach(t)},m(b,g){i(b,p,g),s(p,q),s(p,f),s(f,y),s(p,D)},d(b){b&&t(p)}}}function Og(R){let p,q,f,y,D,b,g,x,h,S,$,A,N,I,z,P,V,T,O,L,U,Q,W;return{c(){p=o("p"),q=n("Maintenant, mettons tout ce que nous venons de faire dans une fonction "),f=o("code"),y=n("compute_metrics()"),D=n(" que nous utiliserons dans le "),b=o("code"),g=n("Trainer"),x=n(". Normalement, cette fonction "),h=o("code"),S=n("compute_metrics()"),$=n(" re\xE7oit seulement un "),A=o("em"),N=n("tuple"),I=d(),z=o("code"),P=n("eval_preds"),V=n(" avec les logits et les \xE9tiquettes. Ici, nous aurons besoin d\u2019un peu plus, car nous devons chercher dans le jeu de donn\xE9es des caract\xE9ristiques pour le d\xE9calage et dans le jeu de donn\xE9es des exemples pour les contextes originaux. Ainsi nous ne serons pas en mesure d\u2019utiliser cette fonction pour obtenir des r\xE9sultats d\u2019\xE9valuation standards pendant l\u2019entra\xEEnement. Nous ne l\u2019utiliserons qu\u2019\xE0 la fin de l\u2019entra\xEEnement pour v\xE9rifier les r\xE9sultats."),T=d(),O=o("p"),L=n("La fonction "),U=o("code"),Q=n("compute_metrics()"),W=n(" regroupe les m\xEAmes \xE9tapes que pr\xE9c\xE9demment. Nous ajoutons juste une petite v\xE9rification au cas o\xF9 nous ne trouverions aucune r\xE9ponse valide (dans ce cas nous pr\xE9disons une cha\xEEne vide).")},l(H){p=l(H,"P",{});var G=r(p);q=a(G,"Maintenant, mettons tout ce que nous venons de faire dans une fonction "),f=l(G,"CODE",{});var ee=r(f);y=a(ee,"compute_metrics()"),ee.forEach(t),D=a(G," que nous utiliserons dans le "),b=l(G,"CODE",{});var Z=r(b);g=a(Z,"Trainer"),Z.forEach(t),x=a(G,". Normalement, cette fonction "),h=l(G,"CODE",{});var F=r(h);S=a(F,"compute_metrics()"),F.forEach(t),$=a(G," re\xE7oit seulement un "),A=l(G,"EM",{});var X=r(A);N=a(X,"tuple"),X.forEach(t),I=c(G),z=l(G,"CODE",{});var le=r(z);P=a(le,"eval_preds"),le.forEach(t),V=a(G," avec les logits et les \xE9tiquettes. Ici, nous aurons besoin d\u2019un peu plus, car nous devons chercher dans le jeu de donn\xE9es des caract\xE9ristiques pour le d\xE9calage et dans le jeu de donn\xE9es des exemples pour les contextes originaux. Ainsi nous ne serons pas en mesure d\u2019utiliser cette fonction pour obtenir des r\xE9sultats d\u2019\xE9valuation standards pendant l\u2019entra\xEEnement. Nous ne l\u2019utiliserons qu\u2019\xE0 la fin de l\u2019entra\xEEnement pour v\xE9rifier les r\xE9sultats."),G.forEach(t),T=c(H),O=l(H,"P",{});var se=r(O);L=a(se,"La fonction "),U=l(se,"CODE",{});var K=r(U);Q=a(K,"compute_metrics()"),K.forEach(t),W=a(se," regroupe les m\xEAmes \xE9tapes que pr\xE9c\xE9demment. Nous ajoutons juste une petite v\xE9rification au cas o\xF9 nous ne trouverions aucune r\xE9ponse valide (dans ce cas nous pr\xE9disons une cha\xEEne vide)."),se.forEach(t)},m(H,G){i(H,p,G),s(p,q),s(p,f),s(f,y),s(p,D),s(p,b),s(b,g),s(p,x),s(p,h),s(h,S),s(p,$),s(p,A),s(A,N),s(p,I),s(p,z),s(z,P),s(p,V),i(H,T,G),i(H,O,G),s(O,L),s(O,U),s(U,Q),s(O,W)},d(H){H&&t(p),H&&t(T),H&&t(O)}}}function Bg(R){let p,q,f,y,D,b,g,x;return g=new M({props:{code:"model = TFAutoModelForQuestionAnswering.from_pretrained(model_checkpoint)",highlighted:"model = TFAutoModelForQuestionAnswering.from_pretrained(model_checkpoint)"}}),{c(){p=o("p"),q=n("Nous sommes maintenant pr\xEAts \xE0 entra\xEEner notre mod\xE8le. Cr\xE9ons-le en utilisant la classe "),f=o("code"),y=n("TFAutoModelForQuestionAnswering"),D=n(" comme pr\xE9c\xE9demment :"),b=d(),j(g.$$.fragment)},l(h){p=l(h,"P",{});var S=r(p);q=a(S,"Nous sommes maintenant pr\xEAts \xE0 entra\xEEner notre mod\xE8le. Cr\xE9ons-le en utilisant la classe "),f=l(S,"CODE",{});var $=r(f);y=a($,"TFAutoModelForQuestionAnswering"),$.forEach(t),D=a(S," comme pr\xE9c\xE9demment :"),S.forEach(t),b=c(h),w(g.$$.fragment,h)},m(h,S){i(h,p,S),s(p,q),s(p,f),s(f,y),s(p,D),i(h,b,S),E(g,h,S),x=!0},i(h){x||(_(g.$$.fragment,h),x=!0)},o(h){v(g.$$.fragment,h),x=!1},d(h){h&&t(p),h&&t(b),k(g,h)}}}function Fg(R){let p,q,f,y,D,b,g,x;return g=new M({props:{code:"model = AutoModelForQuestionAnswering.from_pretrained(model_checkpoint)",highlighted:"model = AutoModelForQuestionAnswering.from_pretrained(model_checkpoint)"}}),{c(){p=o("p"),q=n("Nous sommes maintenant pr\xEAts \xE0 entra\xEEner notre mod\xE8le. Cr\xE9ons-le en utilisant la classe "),f=o("code"),y=n("AutoModelForQuestionAnswering"),D=n(" comme pr\xE9c\xE9demment :"),b=d(),j(g.$$.fragment)},l(h){p=l(h,"P",{});var S=r(p);q=a(S,"Nous sommes maintenant pr\xEAts \xE0 entra\xEEner notre mod\xE8le. Cr\xE9ons-le en utilisant la classe "),f=l(S,"CODE",{});var $=r(f);y=a($,"AutoModelForQuestionAnswering"),$.forEach(t),D=a(S," comme pr\xE9c\xE9demment :"),S.forEach(t),b=c(h),w(g.$$.fragment,h)},m(h,S){i(h,p,S),s(p,q),s(p,f),s(f,y),s(p,D),i(h,b,S),E(g,h,S),x=!0},i(h){x||(_(g.$$.fragment,h),x=!0)},o(h){v(g.$$.fragment,h),x=!1},d(h){h&&t(p),h&&t(b),k(g,h)}}}function Ig(R){let p,q,f,y,D,b,g,x,h,S,$,A,N,I,z,P,V,T,O,L,U,Q,W,H,G,ee,Z;return y=new M({props:{code:"",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> DefaultDataCollator

data_collator = DefaultDataCollator(return_tensors=<span class="hljs-string">&quot;tf&quot;</span>)`}}),h=new M({props:{code:`tf_train_dataset = train_dataset.to_tf_dataset(
    columns=[
        "input_ids",
        "start_positions",
        "end_positions",
        "attention_mask",
        "token_type_ids",
    ],
    collate_fn=data_collator,
    shuffle=True,
    batch_size=16,
)
tf_eval_dataset = validation_dataset.to_tf_dataset(
    columns=["input_ids", "attention_mask", "token_type_ids"],
    collate_fn=data_collator,
    shuffle=False,
    batch_size=16,
)`,highlighted:`tf_train_dataset = train_dataset.to_tf_dataset(
    columns=[
        <span class="hljs-string">&quot;input_ids&quot;</span>,
        <span class="hljs-string">&quot;start_positions&quot;</span>,
        <span class="hljs-string">&quot;end_positions&quot;</span>,
        <span class="hljs-string">&quot;attention_mask&quot;</span>,
        <span class="hljs-string">&quot;token_type_ids&quot;</span>,
    ],
    collate_fn=data_collator,
    shuffle=<span class="hljs-literal">True</span>,
    batch_size=<span class="hljs-number">16</span>,
)
tf_eval_dataset = validation_dataset.to_tf_dataset(
    columns=[<span class="hljs-string">&quot;input_ids&quot;</span>, <span class="hljs-string">&quot;attention_mask&quot;</span>, <span class="hljs-string">&quot;token_type_ids&quot;</span>],
    collate_fn=data_collator,
    shuffle=<span class="hljs-literal">False</span>,
    batch_size=<span class="hljs-number">16</span>,
)`}}),I=new M({props:{code:`
`,highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> create_optimizer
<span class="hljs-keyword">from</span> transformers.keras_callbacks <span class="hljs-keyword">import</span> PushToHubCallback
<span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf

<span class="hljs-comment"># Le nombre d&#x27;\xE9tapes d&#x27;entra\xEEnement est le nombre d&#x27;\xE9chantillons dans le jeu de donn\xE9es, divis\xE9 par la taille du batch,</span>
<span class="hljs-comment"># puis multipli\xE9 par le nombre total d&#x27;\xE9poques. Notez que le jeu de donn\xE9es tf_train_dataset est ici un tf.data.Dataset,</span>
<span class="hljs-comment"># et non le jeu de donn\xE9es original donc son len() est d\xE9j\xE0 num_samples // batch_size.</span>
num_train_epochs = <span class="hljs-number">3</span>
num_train_steps = <span class="hljs-built_in">len</span>(tf_train_dataset) * num_train_epochs
optimizer, schedule = create_optimizer(
    init_lr=<span class="hljs-number">2e-5</span>,
    num_warmup_steps=<span class="hljs-number">0</span>,
    num_train_steps=num_train_steps,
    weight_decay_rate=<span class="hljs-number">0.01</span>,
)
model.<span class="hljs-built_in">compile</span>(optimizer=optimizer)

<span class="hljs-comment"># Entra\xEEner en mixed-precision float16</span>
tf.keras.mixed_precision.set_global_policy(<span class="hljs-string">&quot;mixed_float16&quot;</span>)`}}),{c(){p=o("p"),q=n("Maintenant que c\u2019est fait, nous pouvons cr\xE9er nos jeux de donn\xE9es TensorFlow. Nous pouvons utiliser le simple collateur de donn\xE9es par d\xE9faut cette fois-ci :"),f=d(),j(y.$$.fragment),D=d(),b=o("p"),g=n("Et maintenant nous cr\xE9ons les jeux de donn\xE9es comme d\u2019habitude."),x=d(),j(h.$$.fragment),S=d(),$=o("p"),A=n("Ensuite, nous configurons nos hyperparam\xE8tres d\u2019entra\xEEnement et compilons notre mod\xE8le :"),N=d(),j(I.$$.fragment),z=d(),P=o("p"),V=n("Enfin, nous sommes pr\xEAts \xE0 entra\xEEner avec "),T=o("code"),O=n("model.fit()"),L=n(". Nous utilisons un "),U=o("code"),Q=n("PushToHubCallback"),W=n(" pour t\xE9l\xE9charger le mod\xE8le sur le "),H=o("em"),G=n("Hub"),ee=n(" apr\xE8s chaque \xE9poque.")},l(F){p=l(F,"P",{});var X=r(p);q=a(X,"Maintenant que c\u2019est fait, nous pouvons cr\xE9er nos jeux de donn\xE9es TensorFlow. Nous pouvons utiliser le simple collateur de donn\xE9es par d\xE9faut cette fois-ci :"),X.forEach(t),f=c(F),w(y.$$.fragment,F),D=c(F),b=l(F,"P",{});var le=r(b);g=a(le,"Et maintenant nous cr\xE9ons les jeux de donn\xE9es comme d\u2019habitude."),le.forEach(t),x=c(F),w(h.$$.fragment,F),S=c(F),$=l(F,"P",{});var se=r($);A=a(se,"Ensuite, nous configurons nos hyperparam\xE8tres d\u2019entra\xEEnement et compilons notre mod\xE8le :"),se.forEach(t),N=c(F),w(I.$$.fragment,F),z=c(F),P=l(F,"P",{});var K=r(P);V=a(K,"Enfin, nous sommes pr\xEAts \xE0 entra\xEEner avec "),T=l(K,"CODE",{});var re=r(T);O=a(re,"model.fit()"),re.forEach(t),L=a(K,". Nous utilisons un "),U=l(K,"CODE",{});var Ce=r(U);Q=a(Ce,"PushToHubCallback"),Ce.forEach(t),W=a(K," pour t\xE9l\xE9charger le mod\xE8le sur le "),H=l(K,"EM",{});var ye=r(H);G=a(ye,"Hub"),ye.forEach(t),ee=a(K," apr\xE8s chaque \xE9poque."),K.forEach(t)},m(F,X){i(F,p,X),s(p,q),i(F,f,X),E(y,F,X),i(F,D,X),i(F,b,X),s(b,g),i(F,x,X),E(h,F,X),i(F,S,X),i(F,$,X),s($,A),i(F,N,X),E(I,F,X),i(F,z,X),i(F,P,X),s(P,V),s(P,T),s(T,O),s(P,L),s(P,U),s(U,Q),s(P,W),s(P,H),s(H,G),s(P,ee),Z=!0},i(F){Z||(_(y.$$.fragment,F),_(h.$$.fragment,F),_(I.$$.fragment,F),Z=!0)},o(F){v(y.$$.fragment,F),v(h.$$.fragment,F),v(I.$$.fragment,F),Z=!1},d(F){F&&t(p),F&&t(f),k(y,F),F&&t(D),F&&t(b),F&&t(x),k(h,F),F&&t(S),F&&t($),F&&t(N),k(I,F),F&&t(z),F&&t(P)}}}function Vg(R){let p,q,f,y,D,b,g,x,h,S,$,A,N,I,z,P,V,T,O,L,U,Q,W,H,G,ee,Z,F,X,le,se,K,re,Ce,ye,ie,xs,Fe,ue,$s,rs;return se=new M({props:{code:"",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> TrainingArguments

args = TrainingArguments(
    <span class="hljs-string">&quot;bert-finetuned-squad&quot;</span>,
    evaluation_strategy=<span class="hljs-string">&quot;no&quot;</span>,
    save_strategy=<span class="hljs-string">&quot;epoch&quot;</span>,
    learning_rate=<span class="hljs-number">2e-5</span>,
    num_train_epochs=<span class="hljs-number">3</span>,
    weight_decay=<span class="hljs-number">0.01</span>,
    fp16=<span class="hljs-literal">True</span>,
    push_to_hub=<span class="hljs-literal">True</span>,
)`}}),{c(){p=o("p"),q=n("Une fois ceci fait, nous pouvons d\xE9finir nos "),f=o("code"),y=n("TrainingArguments"),D=n(". Comme nous l\u2019avons dit lorsque nous avons d\xE9fini notre fonction pour calculer la m\xE9trique, nous ne serons pas en mesure d\u2019avoir une boucle d\u2019\xE9valuation standard \xE0 cause de la signature de la fonction "),b=o("code"),g=n("compute_metrics()"),x=n(". Nous pourrions \xE9crire notre propre sous-classe de "),h=o("code"),S=n("Trainer"),$=n(" pour faire cela (une approche que vous pouvez trouver dans le "),A=o("a"),N=n("script d\u2019exemple de r\xE9ponse aux questions"),I=n("), mais c\u2019est un peu trop long pour cette section. A la place, nous n\u2019\xE9valuerons le mod\xE8le qu\u2019\xE0 la fin de l\u2019entra\xEEnement et nous vous montrerons comment faire une \xE9valuation cela dans le paragraphe \xAB Une boucle d\u2019entra\xEEnement personnalis\xE9e \xBB ci-dessous."),z=d(),P=o("p"),V=n("C\u2019est l\xE0 que l\u2019API "),T=o("code"),O=n("Trainer"),L=n(" montre ses limites et que la biblioth\xE8que \u{1F917} "),U=o("em"),Q=n("Accelerate"),W=n(" brille : personnaliser la classe pour un cas d\u2019utilisation sp\xE9cifique peut \xEAtre p\xE9nible, mais modifier une boucle d\u2019entra\xEEnement est facile."),H=d(),G=o("p"),ee=n("Jetons un coup d\u2019\u0153il \xE0 notre "),Z=o("code"),F=n("TrainingArguments"),X=n(" :"),le=d(),j(se.$$.fragment),K=d(),re=o("p"),Ce=n("Nous avons d\xE9j\xE0 vu la plupart d\u2019entre eux. Nous d\xE9finissons quelques hyperparam\xE8tres (comme le taux d\u2019apprentissage, le nombre d\u2019\xE9poques d\u2019entra\xEEnement, un taux de d\xE9croissance des poids) et nous indiquons que nous voulons sauvegarder le mod\xE8le \xE0 la fin de chaque \xE9poque, sauter l\u2019\xE9valuation, et t\xE9l\xE9charger nos r\xE9sultats vers le "),ye=o("em"),ie=n("Hub"),xs=n(". Nous activons \xE9galement l\u2019entra\xEEnement en pr\xE9cision mixte avec "),Fe=o("code"),ue=n("fp16=True"),$s=n(", car cela peut acc\xE9l\xE9rer l\u2019entra\xEEnement sur un GPU r\xE9cent."),this.h()},l(J){p=l(J,"P",{});var Y=r(p);q=a(Y,"Une fois ceci fait, nous pouvons d\xE9finir nos "),f=l(Y,"CODE",{});var js=r(f);y=a(js,"TrainingArguments"),js.forEach(t),D=a(Y,". Comme nous l\u2019avons dit lorsque nous avons d\xE9fini notre fonction pour calculer la m\xE9trique, nous ne serons pas en mesure d\u2019avoir une boucle d\u2019\xE9valuation standard \xE0 cause de la signature de la fonction "),b=l(Y,"CODE",{});var Bt=r(b);g=a(Bt,"compute_metrics()"),Bt.forEach(t),x=a(Y,". Nous pourrions \xE9crire notre propre sous-classe de "),h=l(Y,"CODE",{});var ws=r(h);S=a(ws,"Trainer"),ws.forEach(t),$=a(Y," pour faire cela (une approche que vous pouvez trouver dans le "),A=l(Y,"A",{href:!0,rel:!0});var Ie=r(A);N=a(Ie,"script d\u2019exemple de r\xE9ponse aux questions"),Ie.forEach(t),I=a(Y,"), mais c\u2019est un peu trop long pour cette section. A la place, nous n\u2019\xE9valuerons le mod\xE8le qu\u2019\xE0 la fin de l\u2019entra\xEEnement et nous vous montrerons comment faire une \xE9valuation cela dans le paragraphe \xAB Une boucle d\u2019entra\xEEnement personnalis\xE9e \xBB ci-dessous."),Y.forEach(t),z=c(J),P=l(J,"P",{});var Ve=r(P);V=a(Ve,"C\u2019est l\xE0 que l\u2019API "),T=l(Ve,"CODE",{});var Es=r(T);O=a(Es,"Trainer"),Es.forEach(t),L=a(Ve," montre ses limites et que la biblioth\xE8que \u{1F917} "),U=l(Ve,"EM",{});var _e=r(U);Q=a(_e,"Accelerate"),_e.forEach(t),W=a(Ve," brille : personnaliser la classe pour un cas d\u2019utilisation sp\xE9cifique peut \xEAtre p\xE9nible, mais modifier une boucle d\u2019entra\xEEnement est facile."),Ve.forEach(t),H=c(J),G=l(J,"P",{});var He=r(G);ee=a(He,"Jetons un coup d\u2019\u0153il \xE0 notre "),Z=l(He,"CODE",{});var pe=r(Z);F=a(pe,"TrainingArguments"),pe.forEach(t),X=a(He," :"),He.forEach(t),le=c(J),w(se.$$.fragment,J),K=c(J),re=l(J,"P",{});var ve=r(re);Ce=a(ve,"Nous avons d\xE9j\xE0 vu la plupart d\u2019entre eux. Nous d\xE9finissons quelques hyperparam\xE8tres (comme le taux d\u2019apprentissage, le nombre d\u2019\xE9poques d\u2019entra\xEEnement, un taux de d\xE9croissance des poids) et nous indiquons que nous voulons sauvegarder le mod\xE8le \xE0 la fin de chaque \xE9poque, sauter l\u2019\xE9valuation, et t\xE9l\xE9charger nos r\xE9sultats vers le "),ye=l(ve,"EM",{});var Ue=r(ye);ie=a(Ue,"Hub"),Ue.forEach(t),xs=a(ve,". Nous activons \xE9galement l\u2019entra\xEEnement en pr\xE9cision mixte avec "),Fe=l(ve,"CODE",{});var Re=r(Fe);ue=a(Re,"fp16=True"),Re.forEach(t),$s=a(ve,", car cela peut acc\xE9l\xE9rer l\u2019entra\xEEnement sur un GPU r\xE9cent."),ve.forEach(t),this.h()},h(){C(A,"href","https://github.com/huggingface/transformers/blob/master/examples/pytorch/question-answering/trainer_qa.py"),C(A,"rel","nofollow")},m(J,Y){i(J,p,Y),s(p,q),s(p,f),s(f,y),s(p,D),s(p,b),s(b,g),s(p,x),s(p,h),s(h,S),s(p,$),s(p,A),s(A,N),s(p,I),i(J,z,Y),i(J,P,Y),s(P,V),s(P,T),s(T,O),s(P,L),s(P,U),s(U,Q),s(P,W),i(J,H,Y),i(J,G,Y),s(G,ee),s(G,Z),s(Z,F),s(G,X),i(J,le,Y),E(se,J,Y),i(J,K,Y),i(J,re,Y),s(re,Ce),s(re,ye),s(ye,ie),s(re,xs),s(re,Fe),s(Fe,ue),s(re,$s),rs=!0},i(J){rs||(_(se.$$.fragment,J),rs=!0)},o(J){v(se.$$.fragment,J),rs=!1},d(J){J&&t(p),J&&t(z),J&&t(P),J&&t(H),J&&t(G),J&&t(le),k(se,J),J&&t(K),J&&t(re)}}}function Hg(R){let p,q;return p=new M({props:{code:`
`,highlighted:`<span class="hljs-keyword">from</span> transformers.keras_callbacks <span class="hljs-keyword">import</span> PushToHubCallback

callback = PushToHubCallback(output_dir=<span class="hljs-string">&quot;bert-finetuned-squad&quot;</span>, tokenizer=tokenizer)

<span class="hljs-comment"># Nous allons faire la validation apr\xE8s, donc pas de validation au milieu de l&#x27;entra\xEEnement.</span>
model.fit(tf_train_dataset, callbacks=[callback], epochs=num_train_epochs)`}}),{c(){j(p.$$.fragment)},l(f){w(p.$$.fragment,f)},m(f,y){E(p,f,y),q=!0},i(f){q||(_(p.$$.fragment,f),q=!0)},o(f){v(p.$$.fragment,f),q=!1},d(f){k(p,f)}}}function Ug(R){let p,q,f,y,D,b,g,x,h,S;return p=new yc({props:{$$slots:{default:[Rg]},$$scope:{ctx:R}}}),h=new M({props:{code:"",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> Trainer

trainer = Trainer(
    model=model,
    args=args,
    train_dataset=train_dataset,
    eval_dataset=validation_dataset,
    tokenizer=tokenizer,
)
trainer.train()`}}),{c(){j(p.$$.fragment),q=d(),f=o("p"),y=n("Enfin, nous passons tout \xE0 la classe "),D=o("code"),b=n("Trainer"),g=n(" et lan\xE7ons l\u2019entra\xEEnement :"),x=d(),j(h.$$.fragment)},l($){w(p.$$.fragment,$),q=c($),f=l($,"P",{});var A=r(f);y=a(A,"Enfin, nous passons tout \xE0 la classe "),D=l(A,"CODE",{});var N=r(D);b=a(N,"Trainer"),N.forEach(t),g=a(A," et lan\xE7ons l\u2019entra\xEEnement :"),A.forEach(t),x=c($),w(h.$$.fragment,$)},m($,A){E(p,$,A),i($,q,A),i($,f,A),s(f,y),s(f,D),s(D,b),s(f,g),i($,x,A),E(h,$,A),S=!0},i($){S||(_(p.$$.fragment,$),_(h.$$.fragment,$),S=!0)},o($){v(p.$$.fragment,$),v(h.$$.fragment,$),S=!1},d($){k(p,$),$&&t(q),$&&t(f),$&&t(x),k(h,$)}}}function Rg(R){let p,q,f,y,D;return{c(){p=o("p"),q=n("\u{1F4A1} Si le r\xE9pertoire de sortie que vous utilisez existe, il doit \xEAtre un clone local du d\xE9p\xF4t vers lequel vous voulez pousser (donc d\xE9finissez un nouveau nom si vous obtenez une erreur lors de la d\xE9finition de votre "),f=o("code"),y=n("Trainer"),D=n(").")},l(b){p=l(b,"P",{});var g=r(p);q=a(g,"\u{1F4A1} Si le r\xE9pertoire de sortie que vous utilisez existe, il doit \xEAtre un clone local du d\xE9p\xF4t vers lequel vous voulez pousser (donc d\xE9finissez un nouveau nom si vous obtenez une erreur lors de la d\xE9finition de votre "),f=l(g,"CODE",{});var x=r(f);y=a(x,"Trainer"),x.forEach(t),D=a(g,")."),g.forEach(t)},m(b,g){i(b,p,g),s(p,q),s(p,f),s(f,y),s(p,D)},d(b){b&&t(p)}}}function Qg(R){let p,q,f,y,D,b,g,x,h,S,$,A,N,I;return N=new M({props:{code:`predictions = model.predict(tf_eval_dataset)
compute_metrics(
    predictions["start_logits"],
    predictions["end_logits"],
    validation_dataset,
    raw_datasets["validation"],
)`,highlighted:`predictions = model.predict(tf_eval_dataset)
compute_metrics(
    predictions[<span class="hljs-string">&quot;start_logits&quot;</span>],
    predictions[<span class="hljs-string">&quot;end_logits&quot;</span>],
    validation_dataset,
    raw_datasets[<span class="hljs-string">&quot;validation&quot;</span>],
)`}}),{c(){p=o("p"),q=n("Une fois l\u2019entra\xEEnement termin\xE9, nous pouvons enfin \xE9valuer notre mod\xE8le (et prier pour ne pas avoir d\xE9pens\xE9 tout ce temps de calcul pour rien). La m\xE9thode "),f=o("code"),y=n("predict()"),D=n(" de notre "),b=o("code"),g=n("model"),x=n(" se chargera d\u2019obtenir les pr\xE9dictions, et puisque nous avons fait tout le travail difficile de d\xE9finir une fonction "),h=o("code"),S=n("compute_metrics()"),$=n(" plus t\xF4t, nous pouvons obtenir nos r\xE9sultats en une seule ligne :"),A=d(),j(N.$$.fragment)},l(z){p=l(z,"P",{});var P=r(p);q=a(P,"Une fois l\u2019entra\xEEnement termin\xE9, nous pouvons enfin \xE9valuer notre mod\xE8le (et prier pour ne pas avoir d\xE9pens\xE9 tout ce temps de calcul pour rien). La m\xE9thode "),f=l(P,"CODE",{});var V=r(f);y=a(V,"predict()"),V.forEach(t),D=a(P," de notre "),b=l(P,"CODE",{});var T=r(b);g=a(T,"model"),T.forEach(t),x=a(P," se chargera d\u2019obtenir les pr\xE9dictions, et puisque nous avons fait tout le travail difficile de d\xE9finir une fonction "),h=l(P,"CODE",{});var O=r(h);S=a(O,"compute_metrics()"),O.forEach(t),$=a(P," plus t\xF4t, nous pouvons obtenir nos r\xE9sultats en une seule ligne :"),P.forEach(t),A=c(z),w(N.$$.fragment,z)},m(z,P){i(z,p,P),s(p,q),s(p,f),s(f,y),s(p,D),s(p,b),s(b,g),s(p,x),s(p,h),s(h,S),s(p,$),i(z,A,P),E(N,z,P),I=!0},i(z){I||(_(N.$$.fragment,z),I=!0)},o(z){v(N.$$.fragment,z),I=!1},d(z){z&&t(p),z&&t(A),k(N,z)}}}function Gg(R){let p,q,f,y,D,b,g,x,h,S,$,A,N,I,z,P,V;return P=new M({props:{code:`predictions, _ = trainer.predict(validation_dataset)
start_logits, end_logits = predictions
compute_metrics(start_logits, end_logits, validation_dataset, raw_datasets["validation"])`,highlighted:`predictions, _ = trainer.predict(validation_dataset)
start_logits, end_logits = predictions
compute_metrics(start_logits, end_logits, validation_dataset, raw_datasets[<span class="hljs-string">&quot;validation&quot;</span>])`}}),{c(){p=o("p"),q=n("Une fois l\u2019entra\xEEnement termin\xE9, nous pouvons enfin \xE9valuer notre mod\xE8le (et prier pour ne pas avoir d\xE9pens\xE9 tout ce temps de calcul pour rien). La m\xE9thode "),f=o("code"),y=n("predict()"),D=n(" du "),b=o("code"),g=n("Trainer"),x=n(" retournera un "),h=o("em"),S=n("tuple"),$=n(" o\xF9 les premiers \xE9l\xE9ments seront les pr\xE9dictions du mod\xE8le (ici une paire avec les logits de d\xE9but et de fin). Nous envoyons ceci \xE0 notre fonction "),A=o("code"),N=n("compute_metrics()"),I=n(" :"),z=d(),j(P.$$.fragment)},l(T){p=l(T,"P",{});var O=r(p);q=a(O,"Une fois l\u2019entra\xEEnement termin\xE9, nous pouvons enfin \xE9valuer notre mod\xE8le (et prier pour ne pas avoir d\xE9pens\xE9 tout ce temps de calcul pour rien). La m\xE9thode "),f=l(O,"CODE",{});var L=r(f);y=a(L,"predict()"),L.forEach(t),D=a(O," du "),b=l(O,"CODE",{});var U=r(b);g=a(U,"Trainer"),U.forEach(t),x=a(O," retournera un "),h=l(O,"EM",{});var Q=r(h);S=a(Q,"tuple"),Q.forEach(t),$=a(O," o\xF9 les premiers \xE9l\xE9ments seront les pr\xE9dictions du mod\xE8le (ici une paire avec les logits de d\xE9but et de fin). Nous envoyons ceci \xE0 notre fonction "),A=l(O,"CODE",{});var W=r(A);N=a(W,"compute_metrics()"),W.forEach(t),I=a(O," :"),O.forEach(t),z=c(T),w(P.$$.fragment,T)},m(T,O){i(T,p,O),s(p,q),s(p,f),s(f,y),s(p,D),s(p,b),s(b,g),s(p,x),s(p,h),s(h,S),s(p,$),s(p,A),s(A,N),s(p,I),i(T,z,O),E(P,T,O),V=!0},i(T){V||(_(P.$$.fragment,T),V=!0)},o(T){v(P.$$.fragment,T),V=!1},d(T){T&&t(p),T&&t(z),k(P,T)}}}function hg(R){let p,q,f,y,D,b,g,x,h,S,$,A,N,I,z,P,V,T,O;return g=new M({props:{code:'trainer.push_to_hub(commit_message="Training complete")',highlighted:'trainer.push_to_hub(commit_message=<span class="hljs-string">&quot;Training complete&quot;</span>)'}}),A=new M({props:{code:"'https://huggingface.co/sgugger/bert-finetuned-squad/commit/9dcee1fbc25946a6ed4bb32efb1bd71d5fa90b68'",highlighted:'<span class="hljs-string">&#x27;https://huggingface.co/sgugger/bert-finetuned-squad/commit/9dcee1fbc25946a6ed4bb32efb1bd71d5fa90b68&#x27;</span>'}}),{c(){p=o("p"),q=n("Enfin, nous utilisons la m\xE9thode "),f=o("code"),y=n("push_to_hub()"),D=n(" pour nous assurer que nous t\xE9l\xE9chargeons la derni\xE8re version du mod\xE8le :"),b=d(),j(g.$$.fragment),x=d(),h=o("p"),S=n("Cela renvoie l\u2019URL du commit qu\u2019il vient de faire, si vous voulez l\u2019inspecter :"),$=d(),j(A.$$.fragment),N=d(),I=o("p"),z=n("Le "),P=o("code"),V=n("Trainer"),T=n(" r\xE9dige \xE9galement une carte de mod\xE8le avec tous les r\xE9sultats de l\u2019\xE9valuation et la t\xE9l\xE9charge.")},l(L){p=l(L,"P",{});var U=r(p);q=a(U,"Enfin, nous utilisons la m\xE9thode "),f=l(U,"CODE",{});var Q=r(f);y=a(Q,"push_to_hub()"),Q.forEach(t),D=a(U," pour nous assurer que nous t\xE9l\xE9chargeons la derni\xE8re version du mod\xE8le :"),U.forEach(t),b=c(L),w(g.$$.fragment,L),x=c(L),h=l(L,"P",{});var W=r(h);S=a(W,"Cela renvoie l\u2019URL du commit qu\u2019il vient de faire, si vous voulez l\u2019inspecter :"),W.forEach(t),$=c(L),w(A.$$.fragment,L),N=c(L),I=l(L,"P",{});var H=r(I);z=a(H,"Le "),P=l(H,"CODE",{});var G=r(P);V=a(G,"Trainer"),G.forEach(t),T=a(H," r\xE9dige \xE9galement une carte de mod\xE8le avec tous les r\xE9sultats de l\u2019\xE9valuation et la t\xE9l\xE9charge."),H.forEach(t)},m(L,U){i(L,p,U),s(p,q),s(p,f),s(f,y),s(p,D),i(L,b,U),E(g,L,U),i(L,x,U),i(L,h,U),s(h,S),i(L,$,U),E(A,L,U),i(L,N,U),i(L,I,U),s(I,z),s(I,P),s(P,V),s(I,T),O=!0},i(L){O||(_(g.$$.fragment,L),_(A.$$.fragment,L),O=!0)},o(L){v(g.$$.fragment,L),v(A.$$.fragment,L),O=!1},d(L){L&&t(p),L&&t(b),k(g,L),L&&t(x),L&&t(h),L&&t($),k(A,L),L&&t(N),L&&t(I)}}}function Jg(R){let p,q,f,y,D;return{c(){p=o("p"),q=n("\u270F\uFE0F "),f=o("strong"),y=n("A votre tour"),D=n(" Essayez un autre mod\xE8le pour voir s\u2019il est plus performant pour cette t\xE2che !")},l(b){p=l(b,"P",{});var g=r(p);q=a(g,"\u270F\uFE0F "),f=l(g,"STRONG",{});var x=r(f);y=a(x,"A votre tour"),x.forEach(t),D=a(g," Essayez un autre mod\xE8le pour voir s\u2019il est plus performant pour cette t\xE2che !"),g.forEach(t)},m(b,g){i(b,p,g),s(p,q),s(p,f),s(f,y),s(p,D)},d(b){b&&t(p)}}}function _g(R){let p,q,f,y,D,b,g,x,h,S,$,A,N,I,z,P,V,T,O,L,U,Q,W,H,G,ee,Z,F,X,le,se,K,re,Ce,ye,ie,xs,Fe,ue,$s,rs,J,Y,js,Bt,ws,Ie,Ve,Es,_e,He,pe,ve,Ue,Re,mo,Ft,Ws,En,qe,fo,is,ho,_o,ks,Xs,ta,te,us,Qe,kn,Ks,yn,Cn,vo,It,ys,qo,Ys,bo,go,Vt,Zs,na,Cs,xo,aa,ps,oa,et,Pn,me,la,Pe,$o,An,Dn,jo,Sn,Mn,wo,ra,Ps,As,de,st,Ht,oe,Eo,tt,ko,yo,nt,Co,Po,at,Ao,Do,ot,So,Mo,Ut,lt,ia,ds,ua,Rt,pa,cs,rt,Qt,Ge,zo,Gt,it,da,ms,ca,Jt,ma,Je,Ae,Wt,Oe,fa,We,No,Xt,Kt,To,zn,we,Ds,ut,Yt,Zt,Lo,ha,ce,Ss,pt,dt,Oo,ct,Bo,_a,fs,va,Ms,Fo,be,Io,Nn,qa,zs,Tn,Ln,Vo,On,ba,mt,en,ne,Ho,sn,tn,Uo,nn,ft,ga,Xe,Ro,Bn,ht,Qo,xa,hs,$a,ae,Fn,In,Go,Vn,Hn,Jo,ja,_s,wa,_t,an,Ke,Wo,vt,Xo,Ko,qt,Yo,Zo,on,bt,Ea,gt,Ye,ka,vs,ya,xt,Ns,De,el,Un,Ca;return S=new gs({}),Z=new gs({}),_e=new M({props:{code:`
`,highlighted:`<span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> DataLoader
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> default_data_collator

train_dataset.set_format(<span class="hljs-string">&quot;torch&quot;</span>)
validation_set = validation_dataset.remove_columns([<span class="hljs-string">&quot;example_id&quot;</span>, <span class="hljs-string">&quot;offset_mapping&quot;</span>])
validation_set.set_format(<span class="hljs-string">&quot;torch&quot;</span>)

train_dataloader = DataLoader(
    train_dataset,
    shuffle=<span class="hljs-literal">True</span>,
    collate_fn=default_data_collator,
    batch_size=<span class="hljs-number">8</span>,
)
eval_dataloader = DataLoader(
    validation_set, collate_fn=default_data_collator, batch_size=<span class="hljs-number">8</span>
)`}}),Ws=new M({props:{code:"model = AutoModelForQuestionAnswering.from_pretrained(model_checkpoint)",highlighted:"model = AutoModelForQuestionAnswering.from_pretrained(model_checkpoint)"}}),Xs=new M({props:{code:"",highlighted:`<span class="hljs-keyword">from</span> torch.optim <span class="hljs-keyword">import</span> AdamW

optimizer = AdamW(model.parameters(), lr=<span class="hljs-number">2e-5</span>)`}}),me=new M({props:{code:"",highlighted:`<span class="hljs-keyword">from</span> accelerate <span class="hljs-keyword">import</span> Accelerator

accelerator = Accelerator(fp16=<span class="hljs-literal">True</span>)
model, optimizer, train_dataloader, eval_dataloader = accelerator.prepare(
    model, optimizer, train_dataloader, eval_dataloader
)`}}),Ps=new M({props:{code:`
`,highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> get_scheduler

num_train_epochs = <span class="hljs-number">3</span>
num_update_steps_per_epoch = <span class="hljs-built_in">len</span>(train_dataloader)
num_training_steps = num_train_epochs * num_update_steps_per_epoch

lr_scheduler = get_scheduler(
    <span class="hljs-string">&quot;linear&quot;</span>,
    optimizer=optimizer,
    num_warmup_steps=<span class="hljs-number">0</span>,
    num_training_steps=num_training_steps,
)`}}),lt=new M({props:{code:"",highlighted:`<span class="hljs-keyword">from</span> huggingface_hub <span class="hljs-keyword">import</span> Repository, get_full_repo_name

model_name = <span class="hljs-string">&quot;bert-finetuned-squad-accelerate&quot;</span>
repo_name = get_full_repo_name(model_name)
repo_name`}}),ds=new M({props:{code:"'sgugger/bert-finetuned-squad-accelerate'",highlighted:'<span class="hljs-string">&#x27;sgugger/bert-finetuned-squad-accelerate&#x27;</span>'}}),rt=new M({props:{code:`output_dir = "bert-finetuned-squad-accelerate"
repo = Repository(output_dir, clone_from=repo_name)`,highlighted:`output_dir = <span class="hljs-string">&quot;bert-finetuned-squad-accelerate&quot;</span>
repo = Repository(output_dir, clone_from=repo_name)`}}),Oe=new gs({}),ft=new M({props:{code:`






`,highlighted:`<span class="hljs-keyword">from</span> tqdm.auto <span class="hljs-keyword">import</span> tqdm
<span class="hljs-keyword">import</span> torch

progress_bar = tqdm(<span class="hljs-built_in">range</span>(num_training_steps))

<span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_train_epochs):
    <span class="hljs-comment"># Entra\xEEnement</span>
    model.train()
    <span class="hljs-keyword">for</span> step, batch <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(train_dataloader):
        outputs = model(**batch)
        loss = outputs.loss
        accelerator.backward(loss)

        optimizer.step()
        lr_scheduler.step()
        optimizer.zero_grad()
        progress_bar.update(<span class="hljs-number">1</span>)

    <span class="hljs-comment"># Evaluation</span>
    model.<span class="hljs-built_in">eval</span>()
    start_logits = []
    end_logits = []
    accelerator.<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Evaluation!&quot;</span>)
    <span class="hljs-keyword">for</span> batch <span class="hljs-keyword">in</span> tqdm(eval_dataloader):
        <span class="hljs-keyword">with</span> torch.no_grad():
            outputs = model(**batch)

        start_logits.append(accelerator.gather(outputs.start_logits).cpu().numpy())
        end_logits.append(accelerator.gather(outputs.end_logits).cpu().numpy())

    start_logits = np.concatenate(start_logits)
    end_logits = np.concatenate(end_logits)
    start_logits = start_logits[: <span class="hljs-built_in">len</span>(validation_dataset)]
    end_logits = end_logits[: <span class="hljs-built_in">len</span>(validation_dataset)]

    metrics = compute_metrics(
        start_logits, end_logits, validation_dataset, raw_datasets[<span class="hljs-string">&quot;validation&quot;</span>]
    )
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;epoch <span class="hljs-subst">{epoch}</span>:&quot;</span>, metrics)

    <span class="hljs-comment"># Sauvegarder et t\xE9l\xE9charger</span>
    accelerator.wait_for_everyone()
    unwrapped_model = accelerator.unwrap_model(model)
    unwrapped_model.save_pretrained(output_dir, save_function=accelerator.save)
    <span class="hljs-keyword">if</span> accelerator.is_main_process:
        tokenizer.save_pretrained(output_dir)
        repo.push_to_hub(
            commit_message=<span class="hljs-string">f&quot;Training in progress epoch <span class="hljs-subst">{epoch}</span>&quot;</span>, blocking=<span class="hljs-literal">False</span>
        )`}}),hs=new M({props:{code:`accelerator.wait_for_everyone()
unwrapped_model = accelerator.unwrap_model(model)
unwrapped_model.save_pretrained(output_dir, save_function=accelerator.save)`,highlighted:`accelerator.wait_for_everyone()
unwrapped_model = accelerator.unwrap_model(model)
unwrapped_model.save_pretrained(output_dir, save_function=accelerator.save)`}}),{c(){p=o("p"),q=n("Si vous voulez plonger un peu plus profond\xE9ment dans la boucle d\u2019entra\xEEnement, nous allons maintenant vous montrer comment faire la m\xEAme chose en utilisant \u{1F917} "),f=o("em"),y=n("Accelerate"),D=n("."),b=d(),g=o("h2"),x=o("a"),h=o("span"),j(S.$$.fragment),$=d(),A=o("span"),N=n("Une boucle d'entra\xEEnement personnalis\xE9e"),I=d(),z=o("p"),P=n("Jetons maintenant un coup d\u2019\u0153il \xE0 la boucle d\u2019entra\xEEnement compl\xE8te, afin que vous puissiez facilement personnaliser les parties dont vous avez besoin. Elle ressemblera beaucoup \xE0 la boucle d\u2019entra\xEEnement du "),V=o("a"),T=n("chapitre 3"),O=n(", \xE0 l\u2019exception de la boucle d\u2019\xE9valuation. Nous serons en mesure d\u2019\xE9valuer le mod\xE8le r\xE9guli\xE8rement puisque nous ne sommes plus contraints par la classe "),L=o("code"),U=n("Trainer"),Q=n("."),W=d(),H=o("h3"),G=o("a"),ee=o("span"),j(Z.$$.fragment),F=d(),X=o("span"),le=n("Pr\xE9parer tout pour l'entra\xEEnement"),se=d(),K=o("p"),re=n("Tout d\u2019abord, nous devons construire le "),Ce=o("code"),ye=n("DataLoader"),ie=n("s \xE0 partir de nos jeux de donn\xE9es. Nous d\xE9finissons le format de ces jeux de donn\xE9es \xE0 "),xs=o("code"),Fe=n('"torch"'),ue=n(" et supprimons les colonnes dans le jeu de validation qui ne sont pas utilis\xE9es par le mod\xE8le. Ensuite, nous pouvons utiliser le "),$s=o("code"),rs=n("default_data_collator"),J=n(" fourni par \u{1F917} "),Y=o("em"),js=n("Transformers"),Bt=n(" comme "),ws=o("code"),Ie=n("collate_fn"),Ve=n(" et m\xE9langer l\u2019ensemble d\u2019entra\xEEnement mais pas celui de validation :"),Es=d(),j(_e.$$.fragment),He=d(),pe=o("p"),ve=n("Ensuite, nous r\xE9instantifions notre mod\xE8le afin de nous assurer que nous ne poursuivons pas le "),Ue=o("em"),Re=n("finetuning"),mo=n(" pr\xE9c\xE9dent et que nous repartons du mod\xE8le BERT pr\xE9-entra\xEEn\xE9 :"),Ft=d(),j(Ws.$$.fragment),En=d(),qe=o("p"),fo=n("Ensuite, nous aurons besoin d\u2019un optimiseur. Comme d\u2019habitude, nous utilisons le classique "),is=o("code"),ho=n("AdamW"),_o=n(", qui est comme Adam mais avec une correction dans la fa\xE7on dont le taux de d\xE9croissance des poids est appliqu\xE9 :"),ks=d(),j(Xs.$$.fragment),ta=d(),te=o("p"),us=n("Une fois que nous avons tous ces objets, nous pouvons les envoyer \xE0 la m\xE9thode "),Qe=o("code"),kn=n("accelerator.prepare()"),Ks=n(". Rappelez-vous que si vous voulez entra\xEEner sur des TPUs dans un "),yn=o("em"),Cn=n("notebook"),vo=n(" Colab, vous devrez d\xE9placer tout ce code dans une fonction d\u2019entra\xEEnement, et qui ne devrait pas ex\xE9cuter une cellule qui instancie un "),It=o("code"),ys=n("Accelerator"),qo=n(". Nous pouvons forcer l\u2019entra\xEEnement en pr\xE9cision mixte en passant l\u2019argument "),Ys=o("code"),bo=n("fp16=True"),go=n(" \xE0 "),Vt=o("code"),Zs=n("Accelerator"),na=n(" (ou, si vous ex\xE9cutez le code comme un script, assurez-vous de remplir la \u{1F917} "),Cs=o("em"),xo=n("Accelerate"),aa=d(),ps=o("code"),oa=n("config"),et=n(" de mani\xE8re appropri\xE9e)."),Pn=d(),j(me.$$.fragment),la=d(),Pe=o("p"),$o=n("Comme vous devez le savoir depuis les sections pr\xE9c\xE9dentes, nous ne pouvons utiliser la longueur de "),An=o("code"),Dn=n("train_dataloader"),jo=n(" pour calculer le nombre d\u2019\xE9tapes d\u2019entra\xEEnement qu\u2019apr\xE8s qu\u2019il soit pass\xE9 par la m\xE9thode "),Sn=o("code"),Mn=n("accelerator.prepare()"),wo=n(". Nous utilisons le m\xEAme programme lin\xE9aire que dans les sections pr\xE9c\xE9dentes :"),ra=d(),j(Ps.$$.fragment),As=d(),de=o("p"),st=n("Pour pousser notre mod\xE8le vers le "),Ht=o("em"),oe=n("Hub"),Eo=n(", nous aurons besoin de cr\xE9er un objet "),tt=o("code"),ko=n("Repository"),yo=n(" dans un dossier de travail. Tout d\u2019abord, connectez-vous au "),nt=o("em"),Co=n("Hub"),Po=n(", si vous n\u2019\xEAtes pas d\xE9j\xE0 connect\xE9. Nous d\xE9terminerons le nom du d\xE9p\xF4t \xE0 partir de l\u2019identifiant du mod\xE8le que nous voulons donner \xE0 notre mod\xE8le (n\u2019h\xE9sitez pas \xE0 remplacer le "),at=o("code"),Ao=n("repo_name"),Do=n(" par votre propre choix. Il doit juste contenir votre nom d\u2019utilisateur, ce que fait la fonction "),ot=o("code"),So=n("get_full_repo_name()"),Mo=n(") :"),Ut=d(),j(lt.$$.fragment),ia=d(),j(ds.$$.fragment),ua=d(),Rt=o("p"),pa=n("Ensuite, nous pouvons cloner ce d\xE9p\xF4t dans un dossier local. S\u2019il existe d\xE9j\xE0, ce dossier local doit \xEAtre un clone du d\xE9p\xF4t avec lequel nous travaillons :"),cs=d(),j(rt.$$.fragment),Qt=d(),Ge=o("p"),zo=n("Nous pouvons maintenant t\xE9l\xE9charger tout ce que nous sauvegardons dans "),Gt=o("code"),it=n("output_dir"),da=n(" en appelant la m\xE9thode "),ms=o("code"),ca=n("repo.push_to_hub()"),Jt=n(". Cela nous aidera \xE0 t\xE9l\xE9charger les mod\xE8les interm\xE9diaires \xE0 la fin de chaque \xE9poque."),ma=d(),Je=o("h2"),Ae=o("a"),Wt=o("span"),j(Oe.$$.fragment),fa=d(),We=o("span"),No=n("Boucle d'entra\xEEnement"),Xt=d(),Kt=o("p"),To=n("Nous sommes maintenant pr\xEAts \xE0 \xE9crire la boucle d\u2019entra\xEEnement compl\xE8te. Apr\xE8s avoir d\xE9fini une barre de progression pour suivre l\u2019\xE9volution de l\u2019entra\xEEnement, la boucle comporte trois parties :"),zn=d(),we=o("ul"),Ds=o("li"),ut=n("l\u2019entra\xEEnement \xE0 proprement dit, qui est l\u2019it\xE9ration classique sur le "),Yt=o("code"),Zt=n("train_dataloader"),Lo=n(", passage en avant du mod\xE8le, puis passage en arri\xE8re et \xE9tape d\u2019optimisation."),ha=d(),ce=o("li"),Ss=n("l\u2019\xE9valuation, dans laquelle nous rassemblons toutes les valeurs pour "),pt=o("code"),dt=n("start_logits"),Oo=n(" et "),ct=o("code"),Bo=n("end_logits"),_a=n(" avant de les convertir en tableaux NumPy. Une fois la boucle d\u2019\xE9valuation termin\xE9e, nous concat\xE9nons tous les r\xE9sultats. Notez que nous devons tronquer car "),fs=o("code"),va=n("Accelerator"),Ms=n(" peut avoir ajout\xE9 quelques \xE9chantillons \xE0 la fin pour s\u2019assurer que nous avons le m\xEAme nombre d\u2019exemples dans chaque processus."),Fo=d(),be=o("li"),Io=n("sauvegarde et t\xE9l\xE9chargement, o\xF9 nous sauvegardons d\u2019abord le mod\xE8le et le "),Nn=o("em"),qa=n("tokenizer"),zs=n(", puis appelons "),Tn=o("code"),Ln=n("repo.push_to_hub()"),Vo=n(". Comme nous l\u2019avons fait auparavant, nous utilisons l\u2019argument "),On=o("code"),ba=n("blocking=False"),mt=n(" pour dire \xE0 la biblioth\xE8que \u{1F917} "),en=o("em"),ne=n("Hub"),Ho=n(" de pousser dans un processus asynchrone. De cette fa\xE7on, l\u2019entra\xEEnement continue normalement et cette (longue) instruction est ex\xE9cut\xE9e en arri\xE8re-plan."),sn=d(),tn=o("p"),Uo=n("Voici le code complet de la boucle d\u2019entra\xEEnement :"),nn=d(),j(ft.$$.fragment),ga=d(),Xe=o("p"),Ro=n("Au cas o\xF9 ce serait la premi\xE8re fois que vous verriez un mod\xE8le enregistr\xE9 avec \u{1F917} "),Bn=o("em"),ht=n("Accelerate"),Qo=n(", prenons un moment pour inspecter les trois lignes de code qui l\u2019accompagnent :"),xa=d(),j(hs.$$.fragment),$a=d(),ae=o("p"),Fn=n("La premi\xE8re ligne est explicite : elle indique \xE0 tous les processus d\u2019attendre que tout le monde soit \xE0 ce stade avant de continuer. C\u2019est pour s\u2019assurer que nous avons le m\xEAme mod\xE8le dans chaque processus avant de sauvegarder. Ensuite, nous prenons le "),In=o("code"),Go=n("unwrapped_model"),Vn=n(", qui est le mod\xE8le de base que nous avons d\xE9fini. La m\xE9thode "),Hn=o("code"),Jo=n("accelerator.prepare()"),ja=n(" modifie le mod\xE8le pour qu\u2019il fonctionne dans l\u2019entra\xEEnement distribu\xE9. Donc il n\u2019aura plus la m\xE9thode "),_s=o("code"),wa=n("save_pretrained()"),_t=n(" car la m\xE9thode "),an=o("code"),Ke=n("accelerator.unwrap_model()"),Wo=n(" annule cette \xE9tape. Enfin, nous appelons "),vt=o("code"),Xo=n("save_pretrained()"),Ko=n(" mais nous disons \xE0 cette m\xE9thode d\u2019utiliser "),qt=o("code"),Yo=n("accelerator.save()"),Zo=n(" au lieu de "),on=o("code"),bt=n("torch.save()"),Ea=n("."),gt=d(),Ye=o("p"),ka=n("Une fois ceci fait, vous devriez avoir un mod\xE8le qui produit des r\xE9sultats assez similaires \xE0 celui entra\xEEn\xE9 avec "),vs=o("code"),ya=n("Trainer"),xt=n(". Vous pouvez v\xE9rifier le mod\xE8le que nous avons entra\xEEn\xE9 en utilisant ce code \xE0 "),Ns=o("a"),De=o("em"),el=n("huggingface-course/bert-finetuned-squad-accelerate"),Un=n(". Et si vous voulez tester des modifications de la boucle d\u2019entra\xEEnement, vous pouvez les impl\xE9menter directement en modifiant le code ci-dessus !"),this.h()},l(m){p=l(m,"P",{});var B=r(p);q=a(B,"Si vous voulez plonger un peu plus profond\xE9ment dans la boucle d\u2019entra\xEEnement, nous allons maintenant vous montrer comment faire la m\xEAme chose en utilisant \u{1F917} "),f=l(B,"EM",{});var ir=r(f);y=a(ir,"Accelerate"),ir.forEach(t),D=a(B,"."),B.forEach(t),b=c(m),g=l(m,"H2",{class:!0});var Pa=r(g);x=l(Pa,"A",{id:!0,class:!0,href:!0});var sl=r(x);h=l(sl,"SPAN",{});var Ts=r(h);w(S.$$.fragment,Ts),Ts.forEach(t),sl.forEach(t),$=c(Pa),A=l(Pa,"SPAN",{});var ln=r(A);N=a(ln,"Une boucle d'entra\xEEnement personnalis\xE9e"),ln.forEach(t),Pa.forEach(t),I=c(m),z=l(m,"P",{});var Rn=r(z);P=a(Rn,"Jetons maintenant un coup d\u2019\u0153il \xE0 la boucle d\u2019entra\xEEnement compl\xE8te, afin que vous puissiez facilement personnaliser les parties dont vous avez besoin. Elle ressemblera beaucoup \xE0 la boucle d\u2019entra\xEEnement du "),V=l(Rn,"A",{href:!0});var ur=r(V);T=a(ur,"chapitre 3"),ur.forEach(t),O=a(Rn,", \xE0 l\u2019exception de la boucle d\u2019\xE9valuation. Nous serons en mesure d\u2019\xE9valuer le mod\xE8le r\xE9guli\xE8rement puisque nous ne sommes plus contraints par la classe "),L=l(Rn,"CODE",{});var rn=r(L);U=a(rn,"Trainer"),rn.forEach(t),Q=a(Rn,"."),Rn.forEach(t),W=c(m),H=l(m,"H3",{class:!0});var tl=r(H);G=l(tl,"A",{id:!0,class:!0,href:!0});var nl=r(G);ee=l(nl,"SPAN",{});var qs=r(ee);w(Z.$$.fragment,qs),qs.forEach(t),nl.forEach(t),F=c(tl),X=l(tl,"SPAN",{});var pr=r(X);le=a(pr,"Pr\xE9parer tout pour l'entra\xEEnement"),pr.forEach(t),tl.forEach(t),se=c(m),K=l(m,"P",{});var ge=r(K);re=a(ge,"Tout d\u2019abord, nous devons construire le "),Ce=l(ge,"CODE",{});var dr=r(Ce);ye=a(dr,"DataLoader"),dr.forEach(t),ie=a(ge,"s \xE0 partir de nos jeux de donn\xE9es. Nous d\xE9finissons le format de ces jeux de donn\xE9es \xE0 "),xs=l(ge,"CODE",{});var cr=r(xs);Fe=a(cr,'"torch"'),cr.forEach(t),ue=a(ge," et supprimons les colonnes dans le jeu de validation qui ne sont pas utilis\xE9es par le mod\xE8le. Ensuite, nous pouvons utiliser le "),$s=l(ge,"CODE",{});var Aa=r($s);rs=a(Aa,"default_data_collator"),Aa.forEach(t),J=a(ge," fourni par \u{1F917} "),Y=l(ge,"EM",{});var mr=r(Y);js=a(mr,"Transformers"),mr.forEach(t),Bt=a(ge," comme "),ws=l(ge,"CODE",{});var fr=r(ws);Ie=a(fr,"collate_fn"),fr.forEach(t),Ve=a(ge," et m\xE9langer l\u2019ensemble d\u2019entra\xEEnement mais pas celui de validation :"),ge.forEach(t),Es=c(m),w(_e.$$.fragment,m),He=c(m),pe=l(m,"P",{});var Qn=r(pe);ve=a(Qn,"Ensuite, nous r\xE9instantifions notre mod\xE8le afin de nous assurer que nous ne poursuivons pas le "),Ue=l(Qn,"EM",{});var $t=r(Ue);Re=a($t,"finetuning"),$t.forEach(t),mo=a(Qn," pr\xE9c\xE9dent et que nous repartons du mod\xE8le BERT pr\xE9-entra\xEEn\xE9 :"),Qn.forEach(t),Ft=c(m),w(Ws.$$.fragment,m),En=c(m),qe=l(m,"P",{});var Da=r(qe);fo=a(Da,"Ensuite, nous aurons besoin d\u2019un optimiseur. Comme d\u2019habitude, nous utilisons le classique "),is=l(Da,"CODE",{});var Sa=r(is);ho=a(Sa,"AdamW"),Sa.forEach(t),_o=a(Da,", qui est comme Adam mais avec une correction dans la fa\xE7on dont le taux de d\xE9croissance des poids est appliqu\xE9 :"),Da.forEach(t),ks=c(m),w(Xs.$$.fragment,m),ta=c(m),te=l(m,"P",{});var fe=r(te);us=a(fe,"Une fois que nous avons tous ces objets, nous pouvons les envoyer \xE0 la m\xE9thode "),Qe=l(fe,"CODE",{});var hr=r(Qe);kn=a(hr,"accelerator.prepare()"),hr.forEach(t),Ks=a(fe,". Rappelez-vous que si vous voulez entra\xEEner sur des TPUs dans un "),yn=l(fe,"EM",{});var al=r(yn);Cn=a(al,"notebook"),al.forEach(t),vo=a(fe," Colab, vous devrez d\xE9placer tout ce code dans une fonction d\u2019entra\xEEnement, et qui ne devrait pas ex\xE9cuter une cellule qui instancie un "),It=l(fe,"CODE",{});var Be=r(It);ys=a(Be,"Accelerator"),Be.forEach(t),qo=a(fe,". Nous pouvons forcer l\u2019entra\xEEnement en pr\xE9cision mixte en passant l\u2019argument "),Ys=l(fe,"CODE",{});var Gn=r(Ys);bo=a(Gn,"fp16=True"),Gn.forEach(t),go=a(fe," \xE0 "),Vt=l(fe,"CODE",{});var Ma=r(Vt);Zs=a(Ma,"Accelerator"),Ma.forEach(t),na=a(fe," (ou, si vous ex\xE9cutez le code comme un script, assurez-vous de remplir la \u{1F917} "),Cs=l(fe,"EM",{});var _r=r(Cs);xo=a(_r,"Accelerate"),_r.forEach(t),aa=c(fe),ps=l(fe,"CODE",{});var vr=r(ps);oa=a(vr,"config"),vr.forEach(t),et=a(fe," de mani\xE8re appropri\xE9e)."),fe.forEach(t),Pn=c(m),w(me.$$.fragment,m),la=c(m),Pe=l(m,"P",{});var un=r(Pe);$o=a(un,"Comme vous devez le savoir depuis les sections pr\xE9c\xE9dentes, nous ne pouvons utiliser la longueur de "),An=l(un,"CODE",{});var Jn=r(An);Dn=a(Jn,"train_dataloader"),Jn.forEach(t),jo=a(un," pour calculer le nombre d\u2019\xE9tapes d\u2019entra\xEEnement qu\u2019apr\xE8s qu\u2019il soit pass\xE9 par la m\xE9thode "),Sn=l(un,"CODE",{});var za=r(Sn);Mn=a(za,"accelerator.prepare()"),za.forEach(t),wo=a(un,". Nous utilisons le m\xEAme programme lin\xE9aire que dans les sections pr\xE9c\xE9dentes :"),un.forEach(t),ra=c(m),w(Ps.$$.fragment,m),As=c(m),de=l(m,"P",{});var Se=r(de);st=a(Se,"Pour pousser notre mod\xE8le vers le "),Ht=l(Se,"EM",{});var qr=r(Ht);oe=a(qr,"Hub"),qr.forEach(t),Eo=a(Se,", nous aurons besoin de cr\xE9er un objet "),tt=l(Se,"CODE",{});var br=r(tt);ko=a(br,"Repository"),br.forEach(t),yo=a(Se," dans un dossier de travail. Tout d\u2019abord, connectez-vous au "),nt=l(Se,"EM",{});var jt=r(nt);Co=a(jt,"Hub"),jt.forEach(t),Po=a(Se,", si vous n\u2019\xEAtes pas d\xE9j\xE0 connect\xE9. Nous d\xE9terminerons le nom du d\xE9p\xF4t \xE0 partir de l\u2019identifiant du mod\xE8le que nous voulons donner \xE0 notre mod\xE8le (n\u2019h\xE9sitez pas \xE0 remplacer le "),at=l(Se,"CODE",{});var Na=r(at);Ao=a(Na,"repo_name"),Na.forEach(t),Do=a(Se," par votre propre choix. Il doit juste contenir votre nom d\u2019utilisateur, ce que fait la fonction "),ot=l(Se,"CODE",{});var gr=r(ot);So=a(gr,"get_full_repo_name()"),gr.forEach(t),Mo=a(Se,") :"),Se.forEach(t),Ut=c(m),w(lt.$$.fragment,m),ia=c(m),w(ds.$$.fragment,m),ua=c(m),Rt=l(m,"P",{});var xr=r(Rt);pa=a(xr,"Ensuite, nous pouvons cloner ce d\xE9p\xF4t dans un dossier local. S\u2019il existe d\xE9j\xE0, ce dossier local doit \xEAtre un clone du d\xE9p\xF4t avec lequel nous travaillons :"),xr.forEach(t),cs=c(m),w(rt.$$.fragment,m),Qt=c(m),Ge=l(m,"P",{});var Ls=r(Ge);zo=a(Ls,"Nous pouvons maintenant t\xE9l\xE9charger tout ce que nous sauvegardons dans "),Gt=l(Ls,"CODE",{});var $r=r(Gt);it=a($r,"output_dir"),$r.forEach(t),da=a(Ls," en appelant la m\xE9thode "),ms=l(Ls,"CODE",{});var jr=r(ms);ca=a(jr,"repo.push_to_hub()"),jr.forEach(t),Jt=a(Ls,". Cela nous aidera \xE0 t\xE9l\xE9charger les mod\xE8les interm\xE9diaires \xE0 la fin de chaque \xE9poque."),Ls.forEach(t),ma=c(m),Je=l(m,"H2",{class:!0});var Ta=r(Je);Ae=l(Ta,"A",{id:!0,class:!0,href:!0});var bs=r(Ae);Wt=l(bs,"SPAN",{});var La=r(Wt);w(Oe.$$.fragment,La),La.forEach(t),bs.forEach(t),fa=c(Ta),We=l(Ta,"SPAN",{});var wr=r(We);No=a(wr,"Boucle d'entra\xEEnement"),wr.forEach(t),Ta.forEach(t),Xt=c(m),Kt=l(m,"P",{});var Er=r(Kt);To=a(Er,"Nous sommes maintenant pr\xEAts \xE0 \xE9crire la boucle d\u2019entra\xEEnement compl\xE8te. Apr\xE8s avoir d\xE9fini une barre de progression pour suivre l\u2019\xE9volution de l\u2019entra\xEEnement, la boucle comporte trois parties :"),Er.forEach(t),zn=c(m),we=l(m,"UL",{});var Os=r(we);Ds=l(Os,"LI",{});var Oa=r(Ds);ut=a(Oa,"l\u2019entra\xEEnement \xE0 proprement dit, qui est l\u2019it\xE9ration classique sur le "),Yt=l(Oa,"CODE",{});var kr=r(Yt);Zt=a(kr,"train_dataloader"),kr.forEach(t),Lo=a(Oa,", passage en avant du mod\xE8le, puis passage en arri\xE8re et \xE9tape d\u2019optimisation."),Oa.forEach(t),ha=c(Os),ce=l(Os,"LI",{});var Ze=r(ce);Ss=a(Ze,"l\u2019\xE9valuation, dans laquelle nous rassemblons toutes les valeurs pour "),pt=l(Ze,"CODE",{});var yr=r(pt);dt=a(yr,"start_logits"),yr.forEach(t),Oo=a(Ze," et "),ct=l(Ze,"CODE",{});var Cr=r(ct);Bo=a(Cr,"end_logits"),Cr.forEach(t),_a=a(Ze," avant de les convertir en tableaux NumPy. Une fois la boucle d\u2019\xE9valuation termin\xE9e, nous concat\xE9nons tous les r\xE9sultats. Notez que nous devons tronquer car "),fs=l(Ze,"CODE",{});var ol=r(fs);va=a(ol,"Accelerator"),ol.forEach(t),Ms=a(Ze," peut avoir ajout\xE9 quelques \xE9chantillons \xE0 la fin pour s\u2019assurer que nous avons le m\xEAme nombre d\u2019exemples dans chaque processus."),Ze.forEach(t),Fo=c(Os),be=l(Os,"LI",{});var Ee=r(be);Io=a(Ee,"sauvegarde et t\xE9l\xE9chargement, o\xF9 nous sauvegardons d\u2019abord le mod\xE8le et le "),Nn=l(Ee,"EM",{});var ll=r(Nn);qa=a(ll,"tokenizer"),ll.forEach(t),zs=a(Ee,", puis appelons "),Tn=l(Ee,"CODE",{});var pn=r(Tn);Ln=a(pn,"repo.push_to_hub()"),pn.forEach(t),Vo=a(Ee,". Comme nous l\u2019avons fait auparavant, nous utilisons l\u2019argument "),On=l(Ee,"CODE",{});var rl=r(On);ba=a(rl,"blocking=False"),rl.forEach(t),mt=a(Ee," pour dire \xE0 la biblioth\xE8que \u{1F917} "),en=l(Ee,"EM",{});var xe=r(en);ne=a(xe,"Hub"),xe.forEach(t),Ho=a(Ee," de pousser dans un processus asynchrone. De cette fa\xE7on, l\u2019entra\xEEnement continue normalement et cette (longue) instruction est ex\xE9cut\xE9e en arri\xE8re-plan."),Ee.forEach(t),Os.forEach(t),sn=c(m),tn=l(m,"P",{});var Pr=r(tn);Uo=a(Pr,"Voici le code complet de la boucle d\u2019entra\xEEnement :"),Pr.forEach(t),nn=c(m),w(ft.$$.fragment,m),ga=c(m),Xe=l(m,"P",{});var dn=r(Xe);Ro=a(dn,"Au cas o\xF9 ce serait la premi\xE8re fois que vous verriez un mod\xE8le enregistr\xE9 avec \u{1F917} "),Bn=l(dn,"EM",{});var Ar=r(Bn);ht=a(Ar,"Accelerate"),Ar.forEach(t),Qo=a(dn,", prenons un moment pour inspecter les trois lignes de code qui l\u2019accompagnent :"),dn.forEach(t),xa=c(m),w(hs.$$.fragment,m),$a=c(m),ae=l(m,"P",{});var he=r(ae);Fn=a(he,"La premi\xE8re ligne est explicite : elle indique \xE0 tous les processus d\u2019attendre que tout le monde soit \xE0 ce stade avant de continuer. C\u2019est pour s\u2019assurer que nous avons le m\xEAme mod\xE8le dans chaque processus avant de sauvegarder. Ensuite, nous prenons le "),In=l(he,"CODE",{});var Ba=r(In);Go=a(Ba,"unwrapped_model"),Ba.forEach(t),Vn=a(he,", qui est le mod\xE8le de base que nous avons d\xE9fini. La m\xE9thode "),Hn=l(he,"CODE",{});var Dr=r(Hn);Jo=a(Dr,"accelerator.prepare()"),Dr.forEach(t),ja=a(he," modifie le mod\xE8le pour qu\u2019il fonctionne dans l\u2019entra\xEEnement distribu\xE9. Donc il n\u2019aura plus la m\xE9thode "),_s=l(he,"CODE",{});var Sr=r(_s);wa=a(Sr,"save_pretrained()"),Sr.forEach(t),_t=a(he," car la m\xE9thode "),an=l(he,"CODE",{});var Fa=r(an);Ke=a(Fa,"accelerator.unwrap_model()"),Fa.forEach(t),Wo=a(he," annule cette \xE9tape. Enfin, nous appelons "),vt=l(he,"CODE",{});var Mr=r(vt);Xo=a(Mr,"save_pretrained()"),Mr.forEach(t),Ko=a(he," mais nous disons \xE0 cette m\xE9thode d\u2019utiliser "),qt=l(he,"CODE",{});var zr=r(qt);Yo=a(zr,"accelerator.save()"),zr.forEach(t),Zo=a(he," au lieu de "),on=l(he,"CODE",{});var Ia=r(on);bt=a(Ia,"torch.save()"),Ia.forEach(t),Ea=a(he,"."),he.forEach(t),gt=c(m),Ye=l(m,"P",{});var cn=r(Ye);ka=a(cn,"Une fois ceci fait, vous devriez avoir un mod\xE8le qui produit des r\xE9sultats assez similaires \xE0 celui entra\xEEn\xE9 avec "),vs=l(cn,"CODE",{});var Nr=r(vs);ya=a(Nr,"Trainer"),Nr.forEach(t),xt=a(cn,". Vous pouvez v\xE9rifier le mod\xE8le que nous avons entra\xEEn\xE9 en utilisant ce code \xE0 "),Ns=l(cn,"A",{href:!0,rel:!0});var Va=r(Ns);De=l(Va,"EM",{});var Tr=r(De);el=a(Tr,"huggingface-course/bert-finetuned-squad-accelerate"),Tr.forEach(t),Va.forEach(t),Un=a(cn,". Et si vous voulez tester des modifications de la boucle d\u2019entra\xEEnement, vous pouvez les impl\xE9menter directement en modifiant le code ci-dessus !"),cn.forEach(t),this.h()},h(){C(x,"id","une-boucle-dentranement-personnalise"),C(x,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),C(x,"href","#une-boucle-dentranement-personnalise"),C(g,"class","relative group"),C(V,"href","/course/fr/chapter3/4"),C(G,"id","prparer-tout-pour-lentranement"),C(G,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),C(G,"href","#prparer-tout-pour-lentranement"),C(H,"class","relative group"),C(Ae,"id","boucle-dentranement"),C(Ae,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),C(Ae,"href","#boucle-dentranement"),C(Je,"class","relative group"),C(Ns,"href","https://huggingface.co/huggingface-course/bert-finetuned-squad-accelerate"),C(Ns,"rel","nofollow")},m(m,B){i(m,p,B),s(p,q),s(p,f),s(f,y),s(p,D),i(m,b,B),i(m,g,B),s(g,x),s(x,h),E(S,h,null),s(g,$),s(g,A),s(A,N),i(m,I,B),i(m,z,B),s(z,P),s(z,V),s(V,T),s(z,O),s(z,L),s(L,U),s(z,Q),i(m,W,B),i(m,H,B),s(H,G),s(G,ee),E(Z,ee,null),s(H,F),s(H,X),s(X,le),i(m,se,B),i(m,K,B),s(K,re),s(K,Ce),s(Ce,ye),s(K,ie),s(K,xs),s(xs,Fe),s(K,ue),s(K,$s),s($s,rs),s(K,J),s(K,Y),s(Y,js),s(K,Bt),s(K,ws),s(ws,Ie),s(K,Ve),i(m,Es,B),E(_e,m,B),i(m,He,B),i(m,pe,B),s(pe,ve),s(pe,Ue),s(Ue,Re),s(pe,mo),i(m,Ft,B),E(Ws,m,B),i(m,En,B),i(m,qe,B),s(qe,fo),s(qe,is),s(is,ho),s(qe,_o),i(m,ks,B),E(Xs,m,B),i(m,ta,B),i(m,te,B),s(te,us),s(te,Qe),s(Qe,kn),s(te,Ks),s(te,yn),s(yn,Cn),s(te,vo),s(te,It),s(It,ys),s(te,qo),s(te,Ys),s(Ys,bo),s(te,go),s(te,Vt),s(Vt,Zs),s(te,na),s(te,Cs),s(Cs,xo),s(te,aa),s(te,ps),s(ps,oa),s(te,et),i(m,Pn,B),E(me,m,B),i(m,la,B),i(m,Pe,B),s(Pe,$o),s(Pe,An),s(An,Dn),s(Pe,jo),s(Pe,Sn),s(Sn,Mn),s(Pe,wo),i(m,ra,B),E(Ps,m,B),i(m,As,B),i(m,de,B),s(de,st),s(de,Ht),s(Ht,oe),s(de,Eo),s(de,tt),s(tt,ko),s(de,yo),s(de,nt),s(nt,Co),s(de,Po),s(de,at),s(at,Ao),s(de,Do),s(de,ot),s(ot,So),s(de,Mo),i(m,Ut,B),E(lt,m,B),i(m,ia,B),E(ds,m,B),i(m,ua,B),i(m,Rt,B),s(Rt,pa),i(m,cs,B),E(rt,m,B),i(m,Qt,B),i(m,Ge,B),s(Ge,zo),s(Ge,Gt),s(Gt,it),s(Ge,da),s(Ge,ms),s(ms,ca),s(Ge,Jt),i(m,ma,B),i(m,Je,B),s(Je,Ae),s(Ae,Wt),E(Oe,Wt,null),s(Je,fa),s(Je,We),s(We,No),i(m,Xt,B),i(m,Kt,B),s(Kt,To),i(m,zn,B),i(m,we,B),s(we,Ds),s(Ds,ut),s(Ds,Yt),s(Yt,Zt),s(Ds,Lo),s(we,ha),s(we,ce),s(ce,Ss),s(ce,pt),s(pt,dt),s(ce,Oo),s(ce,ct),s(ct,Bo),s(ce,_a),s(ce,fs),s(fs,va),s(ce,Ms),s(we,Fo),s(we,be),s(be,Io),s(be,Nn),s(Nn,qa),s(be,zs),s(be,Tn),s(Tn,Ln),s(be,Vo),s(be,On),s(On,ba),s(be,mt),s(be,en),s(en,ne),s(be,Ho),i(m,sn,B),i(m,tn,B),s(tn,Uo),i(m,nn,B),E(ft,m,B),i(m,ga,B),i(m,Xe,B),s(Xe,Ro),s(Xe,Bn),s(Bn,ht),s(Xe,Qo),i(m,xa,B),E(hs,m,B),i(m,$a,B),i(m,ae,B),s(ae,Fn),s(ae,In),s(In,Go),s(ae,Vn),s(ae,Hn),s(Hn,Jo),s(ae,ja),s(ae,_s),s(_s,wa),s(ae,_t),s(ae,an),s(an,Ke),s(ae,Wo),s(ae,vt),s(vt,Xo),s(ae,Ko),s(ae,qt),s(qt,Yo),s(ae,Zo),s(ae,on),s(on,bt),s(ae,Ea),i(m,gt,B),i(m,Ye,B),s(Ye,ka),s(Ye,vs),s(vs,ya),s(Ye,xt),s(Ye,Ns),s(Ns,De),s(De,el),s(Ye,Un),Ca=!0},i(m){Ca||(_(S.$$.fragment,m),_(Z.$$.fragment,m),_(_e.$$.fragment,m),_(Ws.$$.fragment,m),_(Xs.$$.fragment,m),_(me.$$.fragment,m),_(Ps.$$.fragment,m),_(lt.$$.fragment,m),_(ds.$$.fragment,m),_(rt.$$.fragment,m),_(Oe.$$.fragment,m),_(ft.$$.fragment,m),_(hs.$$.fragment,m),Ca=!0)},o(m){v(S.$$.fragment,m),v(Z.$$.fragment,m),v(_e.$$.fragment,m),v(Ws.$$.fragment,m),v(Xs.$$.fragment,m),v(me.$$.fragment,m),v(Ps.$$.fragment,m),v(lt.$$.fragment,m),v(ds.$$.fragment,m),v(rt.$$.fragment,m),v(Oe.$$.fragment,m),v(ft.$$.fragment,m),v(hs.$$.fragment,m),Ca=!1},d(m){m&&t(p),m&&t(b),m&&t(g),k(S),m&&t(I),m&&t(z),m&&t(W),m&&t(H),k(Z),m&&t(se),m&&t(K),m&&t(Es),k(_e,m),m&&t(He),m&&t(pe),m&&t(Ft),k(Ws,m),m&&t(En),m&&t(qe),m&&t(ks),k(Xs,m),m&&t(ta),m&&t(te),m&&t(Pn),k(me,m),m&&t(la),m&&t(Pe),m&&t(ra),k(Ps,m),m&&t(As),m&&t(de),m&&t(Ut),k(lt,m),m&&t(ia),k(ds,m),m&&t(ua),m&&t(Rt),m&&t(cs),k(rt,m),m&&t(Qt),m&&t(Ge),m&&t(ma),m&&t(Je),k(Oe),m&&t(Xt),m&&t(Kt),m&&t(zn),m&&t(we),m&&t(sn),m&&t(tn),m&&t(nn),k(ft,m),m&&t(ga),m&&t(Xe),m&&t(xa),k(hs,m),m&&t($a),m&&t(ae),m&&t(gt),m&&t(Ye)}}}function Wg(R){let p,q,f,y,D,b,g,x,h,S,$,A,N,I,z,P,V,T,O,L,U,Q,W,H,G,ee,Z,F,X,le,se,K,re,Ce,ye,ie,xs,Fe,ue,$s,rs,J,Y,js,Bt,ws,Ie,Ve,Es,_e,He,pe,ve,Ue,Re,mo,Ft,Ws,En,qe,fo,is,ho,_o,ks,Xs,ta,te,us,Qe,kn,Ks,yn,Cn,vo,It,ys,qo,Ys,bo,go,Vt,Zs,na,Cs,xo,aa,ps,oa,et,Pn,me,la,Pe,$o,An,Dn,jo,Sn,Mn,wo,ra,Ps,As,de,st,Ht,oe,Eo,tt,ko,yo,nt,Co,Po,at,Ao,Do,ot,So,Mo,Ut,lt,ia,ds,ua,Rt,pa,cs,rt,Qt,Ge,zo,Gt,it,da,ms,ca,Jt,ma,Je,Ae,Wt,Oe,fa,We,No,Xt,Kt,To,zn,we,Ds,ut,Yt,Zt,Lo,ha,ce,Ss,pt,dt,Oo,ct,Bo,_a,fs,va,Ms,Fo,be,Io,Nn,qa,zs,Tn,Ln,Vo,On,ba,mt,en,ne,Ho,sn,tn,Uo,nn,ft,ga,Xe,Ro,Bn,ht,Qo,xa,hs,$a,ae,Fn,In,Go,Vn,Hn,Jo,ja,_s,wa,_t,an,Ke,Wo,vt,Xo,Ko,qt,Yo,Zo,on,bt,Ea,gt,Ye,ka,vs,ya,xt,Ns,De,el,Un,Ca,m,B,ir,Pa,sl,Ts,ln,Rn,ur,rn,tl,nl,qs,pr,ge,dr,cr,Aa,mr,fr,Qn,$t,Da,Sa,fe,hr,al,Be,Gn,Ma,_r,vr,un,Jn,za,Se,qr,br,jt,Na,gr,xr,Ls,$r,jr,Ta,bs,La,wr,Er,Os,Oa,kr,Ze,yr,Cr,ol,Ee,ll,pn,rl,xe,Pr,dn,Ar,he,Ba,Dr,Sr,Fa,Mr,zr,Ia,cn,Nr,Va,Tr,Pc,hp,Me,Ac,Di,Dc,Sc,Si,Mc,zc,Lr,Nc,Tc,Mi,Lc,Oc,zi,Bc,Fc,_p,il,vp,ul,qp,ze,Ic,Ni,Vc,Hc,Ti,Uc,Rc,Li,Qc,Gc,Oi,Jc,Wc,Bi,Xc,Kc,bp,pl,gp,dl,xp,Or,Yc,$p,cl,jp,ml,wp,Br,Zc,Ep,Fr,em,kp,Ha,Ir,Fi,sm,tm,nm,es,Ii,am,om,Vi,lm,rm,Hi,im,um,Ui,pm,dm,Ri,cm,mm,yp,Ne,fm,Qi,hm,_m,Gi,vm,qm,Ji,bm,gm,Wi,xm,$m,Xi,jm,wm,Cp,Te,Em,Ki,km,ym,Yi,Cm,Pm,Zi,Am,Dm,eu,Sm,Mm,su,zm,Nm,Pp,fl,Ap,hl,Dp,mn,Tm,tu,Lm,Om,nu,Bm,Fm,Sp,_l,Mp,vl,zp,Ua,Im,au,Vm,Hm,Np,ql,Tp,bl,Lp,Vr,Um,Op,Ra,Bp,Hr,Rm,Fp,gl,Ip,Ur,Qm,Vp,fn,Gm,ou,Jm,Wm,lu,Xm,Km,Hp,xl,Up,$l,Rp,Rr,Ym,Qp,Wn,Qa,ru,jl,Zm,iu,ef,Gp,Ga,sf,uu,tf,nf,Jp,ke,af,pu,of,lf,du,rf,uf,cu,pf,df,mu,cf,mf,fu,ff,hf,hu,_f,vf,Wp,wl,Xp,Qr,qf,Kp,El,Yp,kl,Zp,Gr,bf,ed,Jr,gf,sd,wt,Et,Wr,Xn,Ja,_u,yl,xf,vu,$f,td,kt,yt,Xr,hn,jf,qu,wf,Ef,Kr,kf,yf,nd,Bs,Cl,Cf,bu,Pf,Af,Df,gu,Sf,Mf,Pl,zf,xu,Nf,Tf,Lf,Kn,Of,$u,Bf,Ff,ju,If,Vf,ad,ss,Hf,wu,Uf,Rf,Eu,Qf,Gf,ku,Jf,Wf,od,qg='<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>log</mi><mo>\u2061</mo><mo stretchy="false">(</mo><mi>a</mi><mi>b</mi><mo stretchy="false">)</mo><mo>=</mo><mi>log</mi><mo>\u2061</mo><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo>+</mo><mi>log</mi><mo>\u2061</mo><mo stretchy="false">(</mo><mi>b</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\\log(ab) = \\log(a) + \\log(b)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord mathnormal">ab</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mclose">)</span></span></span></span>',ld,rd,Fs,Xf,yu,Kf,Yf,Cu,Zf,eh,Pu,sh,th,id,Al,ud,Wa,nh,Au,ah,oh,pd,Dl,dd,Xa,lh,Du,rh,ih,cd,Ct,Pt,Yr,ts,uh,Su,ph,dh,Mu,ch,mh,zu,fh,hh,Nu,_h,vh,md,Sl,fd,Ka,qh,Tu,bh,gh,hd,_n,Lu,xh,$h,Ou,jh,wh,Ml,Eh,Bu,kh,yh,_d,Zr,Ch,vd,zl,qd,Ya,Ph,Fu,Ah,Dh,bd,Nl,gd,ei,Sh,xd,Tl,$d,si,Mh,jd,Ll,wd,Ol,Ed,ti,zh,kd,Bl,yd,Fl,Cd,vn,Nh,Il,Th,Lh,Iu,Oh,Bh,Pd,ni,Vl,Ad,ai,Fh,Dd,Hl,Sd,Ul,Md,Za,Ih,Vu,Vh,Hh,zd,Yn,eo,Hu,Rl,Uh,oi,Uu,Rh,Qh,Nd,At,Dt,li,so,Gh,Ru,Jh,Wh,Td,Is,Xh,Qu,Kh,Yh,Gu,Zh,e_,Ju,s_,t_,Ld,Ql,Od,to,n_,Wu,a_,o_,Bd,Gl,Fd,St,Mt,ri,ns,l_,Xu,r_,i_,Ku,u_,p_,Yu,d_,c_,Zu,m_,f_,Id,zt,Nt,ii,qn,h_,ep,__,v_,sp,q_,b_,Vd,Tt,Lt,ui,Jl,Hd,pi,g_,Ud,di,Vs,x_,tp,$_,j_,np,w_,E_,ap,k_,y_,Rd,no,Qd,ci,Zn,ao,op,Wl,C_,mi,P_,lp,A_,Gd,as,D_,rp,S_,M_,ip,z_,N_,up,T_,L_,pp,O_,B_,Jd,Xl,Wd,Kl,Xd,fi,F_,Kd;f=new kg({props:{fw:R[0]}}),x=new gs({});const Q_=[Cg,yg],Yl=[];function G_(e,u){return e[0]==="pt"?0:1}N=G_(R),I=Yl[N]=Q_[N](R),Q=new Cc({props:{id:"ajPx5LwJD-I"}}),_e=new yc({props:{$$slots:{default:[Pg]},$$scope:{ctx:R}}}),Re=new gs({}),Ks=new gs({}),Zs=new M({props:{code:"",highlighted:`<span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_dataset

raw_datasets = load_dataset(<span class="hljs-string">&quot;squad&quot;</span>)`}}),ps=new M({props:{code:"raw_datasets",highlighted:"raw_datasets"}}),et=new M({props:{code:`DatasetDict({
    train: Dataset({
        features: ['id', 'title', 'context', 'question', 'answers'],
        num_rows: 87599
    })
    validation: Dataset({
        features: ['id', 'title', 'context', 'question', 'answers'],
        num_rows: 10570
    })
})`,highlighted:`DatasetDict({
    train: Dataset({
        features: [<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;title&#x27;</span>, <span class="hljs-string">&#x27;context&#x27;</span>, <span class="hljs-string">&#x27;question&#x27;</span>, <span class="hljs-string">&#x27;answers&#x27;</span>],
        num_rows: <span class="hljs-number">87599</span>
    })
    validation: Dataset({
        features: [<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;title&#x27;</span>, <span class="hljs-string">&#x27;context&#x27;</span>, <span class="hljs-string">&#x27;question&#x27;</span>, <span class="hljs-string">&#x27;answers&#x27;</span>],
        num_rows: <span class="hljs-number">10570</span>
    })
})`}}),As=new M({props:{code:`print("Context: ", raw_datasets["train"][0]["context"])
print("Question: ", raw_datasets["train"][0]["question"])
print("Answer: ", raw_datasets["train"][0]["answers"])`,highlighted:`<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Context: &quot;</span>, raw_datasets[<span class="hljs-string">&quot;train&quot;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&quot;context&quot;</span>])
<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Question: &quot;</span>, raw_datasets[<span class="hljs-string">&quot;train&quot;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&quot;question&quot;</span>])
<span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Answer: &quot;</span>, raw_datasets[<span class="hljs-string">&quot;train&quot;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&quot;answers&quot;</span>])`}}),st=new M({props:{code:`Context: 'Architecturally, the school has a Catholic character. Atop the Main Building\\'s gold dome is a golden statue of the Virgin Mary. Immediately in front of the Main Building and facing it, is a copper statue of Christ with arms upraised with the legend "Venite Ad Me Omnes". Next to the Main Building is the Basilica of the Sacred Heart. Immediately behind the basilica is the Grotto, a Marian place of prayer and reflection. It is a replica of the grotto at Lourdes, France where the Virgin Mary reputedly appeared to Saint Bernadette Soubirous in 1858. At the end of the main drive (and in a direct line that connects through 3 statues and the Gold Dome), is a simple, modern stone statue of Mary.'
# Sur le plan architectural, l'\xE9cole a un caract\xE8re catholique. Au sommet du d\xF4me dor\xE9 du b\xE2timent principal se trouve une statue dor\xE9e de la Vierge Marie. Imm\xE9diatement devant le b\xE2timent principal et face \xE0 lui, se trouve une statue en cuivre du Christ, les bras lev\xE9s, avec la l\xE9gende "Venite Ad Me Omnes". \xC0 c\xF4t\xE9 du b\xE2timent principal se trouve la basilique du Sacr\xE9-C\u0153ur. Imm\xE9diatement derri\xE8re la basilique se trouve la Grotte, un lieu marial de pri\xE8re et de r\xE9flexion. Il s'agit d'une r\xE9plique de la grotte de Lourdes, en France, o\xF9 la Vierge Marie serait apparue \xE0 Sainte Bernadette Soubirous en 1858. Au bout de l'all\xE9e principale (et dans une ligne directe qui passe par 3 statues et le D\xF4me d'or), se trouve une statue de pierre simple et moderne de Marie'.
Question: 'To whom did the Virgin Mary allegedly appear in 1858 in Lourdes France?' 
# A qui la Vierge Marie serait-elle apparue en 1858 \xE0 Lourdes, en France ?
Answer: {'text': ['Saint Bernadette Soubirous'], 'answer_start': [515]}`,highlighted:`Context: <span class="hljs-string">&#x27;Architecturally, the school has a Catholic character. Atop the Main Building\\&#x27;s gold dome is a golden statue of the Virgin Mary. Immediately in front of the Main Building and facing it, is a copper statue of Christ with arms upraised with the legend &quot;Venite Ad Me Omnes&quot;. Next to the Main Building is the Basilica of the Sacred Heart. Immediately behind the basilica is the Grotto, a Marian place of prayer and reflection. It is a replica of the grotto at Lourdes, France where the Virgin Mary reputedly appeared to Saint Bernadette Soubirous in 1858. At the end of the main drive (and in a direct line that connects through 3 statues and the Gold Dome), is a simple, modern stone statue of Mary.&#x27;</span>
<span class="hljs-comment"># Sur le plan architectural, l&#x27;\xE9cole a un caract\xE8re catholique. Au sommet du d\xF4me dor\xE9 du b\xE2timent principal se trouve une statue dor\xE9e de la Vierge Marie. Imm\xE9diatement devant le b\xE2timent principal et face \xE0 lui, se trouve une statue en cuivre du Christ, les bras lev\xE9s, avec la l\xE9gende &quot;Venite Ad Me Omnes&quot;. \xC0 c\xF4t\xE9 du b\xE2timent principal se trouve la basilique du Sacr\xE9-C\u0153ur. Imm\xE9diatement derri\xE8re la basilique se trouve la Grotte, un lieu marial de pri\xE8re et de r\xE9flexion. Il s&#x27;agit d&#x27;une r\xE9plique de la grotte de Lourdes, en France, o\xF9 la Vierge Marie serait apparue \xE0 Sainte Bernadette Soubirous en 1858. Au bout de l&#x27;all\xE9e principale (et dans une ligne directe qui passe par 3 statues et le D\xF4me d&#x27;or), se trouve une statue de pierre simple et moderne de Marie&#x27;.</span>
Question: <span class="hljs-string">&#x27;To whom did the Virgin Mary allegedly appear in 1858 in Lourdes France?&#x27;</span> 
<span class="hljs-comment"># A qui la Vierge Marie serait-elle apparue en 1858 \xE0 Lourdes, en France ?</span>
Answer: {<span class="hljs-string">&#x27;text&#x27;</span>: [<span class="hljs-string">&#x27;Saint Bernadette Soubirous&#x27;</span>], <span class="hljs-string">&#x27;answer_start&#x27;</span>: [<span class="hljs-number">515</span>]}`}}),it=new M({props:{code:'raw_datasets["train"].filter(lambda x: len(x["answers"]["text"]) != 1)',highlighted:'raw_datasets[<span class="hljs-string">&quot;train&quot;</span>].<span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> x: <span class="hljs-built_in">len</span>(x[<span class="hljs-string">&quot;answers&quot;</span>][<span class="hljs-string">&quot;text&quot;</span>]) != <span class="hljs-number">1</span>)'}}),ms=new M({props:{code:`Dataset({
    features: ['id', 'title', 'context', 'question', 'answers'],
    num_rows: 0
})`,highlighted:`Dataset({
    features: [<span class="hljs-string">&#x27;id&#x27;</span>, <span class="hljs-string">&#x27;title&#x27;</span>, <span class="hljs-string">&#x27;context&#x27;</span>, <span class="hljs-string">&#x27;question&#x27;</span>, <span class="hljs-string">&#x27;answers&#x27;</span>],
    num_rows: <span class="hljs-number">0</span>
})`}}),Ae=new M({props:{code:`print(raw_datasets["validation"][0]["answers"])
print(raw_datasets["validation"][2]["answers"])`,highlighted:`<span class="hljs-built_in">print</span>(raw_datasets[<span class="hljs-string">&quot;validation&quot;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&quot;answers&quot;</span>])
<span class="hljs-built_in">print</span>(raw_datasets[<span class="hljs-string">&quot;validation&quot;</span>][<span class="hljs-number">2</span>][<span class="hljs-string">&quot;answers&quot;</span>])`}}),Oe=new M({props:{code:`{'text': ['Denver Broncos', 'Denver Broncos', 'Denver Broncos'], 'answer_start': [177, 177, 177]}
{'text': ['Santa Clara, California', "Levi's Stadium", "Levi's Stadium in the San Francisco Bay Area at Santa Clara, California."], 'answer_start': [403, 355, 355]}`,highlighted:`{<span class="hljs-string">&#x27;text&#x27;</span>: [<span class="hljs-string">&#x27;Denver Broncos&#x27;</span>, <span class="hljs-string">&#x27;Denver Broncos&#x27;</span>, <span class="hljs-string">&#x27;Denver Broncos&#x27;</span>], <span class="hljs-string">&#x27;answer_start&#x27;</span>: [<span class="hljs-number">177</span>, <span class="hljs-number">177</span>, <span class="hljs-number">177</span>]}
{<span class="hljs-string">&#x27;text&#x27;</span>: [<span class="hljs-string">&#x27;Santa Clara, California&#x27;</span>, <span class="hljs-string">&quot;Levi&#x27;s Stadium&quot;</span>, <span class="hljs-string">&quot;Levi&#x27;s Stadium in the San Francisco Bay Area at Santa Clara, California.&quot;</span>], <span class="hljs-string">&#x27;answer_start&#x27;</span>: [<span class="hljs-number">403</span>, <span class="hljs-number">355</span>, <span class="hljs-number">355</span>]}`}}),we=new M({props:{code:`print(raw_datasets["validation"][2]["context"])
print(raw_datasets["validation"][2]["question"])`,highlighted:`<span class="hljs-built_in">print</span>(raw_datasets[<span class="hljs-string">&quot;validation&quot;</span>][<span class="hljs-number">2</span>][<span class="hljs-string">&quot;context&quot;</span>])
<span class="hljs-built_in">print</span>(raw_datasets[<span class="hljs-string">&quot;validation&quot;</span>][<span class="hljs-number">2</span>][<span class="hljs-string">&quot;question&quot;</span>])`}}),ut=new M({props:{code:`'Super Bowl 50 was an American football game to determine the champion of the National Football League (NFL) for the 2015 season. The American Football Conference (AFC) champion Denver Broncos defeated the National Football Conference (NFC) champion Carolina Panthers 24\u201310 to earn their third Super Bowl title. The game was played on February 7, 2016, at Levi\\'s Stadium in the San Francisco Bay Area at Santa Clara, California. As this was the 50th Super Bowl, the league emphasized the "golden anniversary" with various gold-themed initiatives, as well as temporarily suspending the tradition of naming each Super Bowl game with Roman numerals (under which the game would have been known as "Super Bowl L"), so that the logo could prominently feature the Arabic numerals 50.'
# Le Super Bowl 50 \xE9tait un match de football am\xE9ricain visant \xE0 d\xE9terminer le champion de la National Football League (NFL) pour la saison 2015. Les Denver Broncos, champions de la Conf\xE9rence de football am\xE9ricain (AFC), ont battu les Carolina Panthers, champions de la Conf\xE9rence nationale de football (NFC), 24 \xE0 10, pour remporter leur troisi\xE8me titre de Super Bowl. Le match s'est d\xE9roul\xE9 le 7 f\xE9vrier 2016 au Levi\\'s Stadium, dans la baie de San Francisco, \xE0 Santa Clara, en Californie. Comme il s'agissait du 50e Super Bowl, la ligue a mis l'accent sur l'" anniversaire dor\xE9 " avec diverses initiatives sur le th\xE8me de l'or, ainsi qu'en suspendant temporairement la tradition de nommer chaque match du Super Bowl avec des chiffres romains (en vertu de laquelle le match aurait \xE9t\xE9 appel\xE9 " Super Bowl L "), afin que le logo puisse mettre en \xE9vidence les chiffres arabes 50.''
'Where did Super Bowl 50 take place?' 
# O\xF9 a eu lieu le Super Bowl 50 ?`,highlighted:`<span class="hljs-string">&#x27;Super Bowl 50 was an American football game to determine the champion of the National Football League (NFL) for the 2015 season. The American Football Conference (AFC) champion Denver Broncos defeated the National Football Conference (NFC) champion Carolina Panthers 24\u201310 to earn their third Super Bowl title. The game was played on February 7, 2016, at Levi\\&#x27;s Stadium in the San Francisco Bay Area at Santa Clara, California. As this was the 50th Super Bowl, the league emphasized the &quot;golden anniversary&quot; with various gold-themed initiatives, as well as temporarily suspending the tradition of naming each Super Bowl game with Roman numerals (under which the game would have been known as &quot;Super Bowl L&quot;), so that the logo could prominently feature the Arabic numerals 50.&#x27;</span>
<span class="hljs-comment"># Le Super Bowl 50 \xE9tait un match de football am\xE9ricain visant \xE0 d\xE9terminer le champion de la National Football League (NFL) pour la saison 2015. Les Denver Broncos, champions de la Conf\xE9rence de football am\xE9ricain (AFC), ont battu les Carolina Panthers, champions de la Conf\xE9rence nationale de football (NFC), 24 \xE0 10, pour remporter leur troisi\xE8me titre de Super Bowl. Le match s&#x27;est d\xE9roul\xE9 le 7 f\xE9vrier 2016 au Levi\\&#x27;s Stadium, dans la baie de San Francisco, \xE0 Santa Clara, en Californie. Comme il s&#x27;agissait du 50e Super Bowl, la ligue a mis l&#x27;accent sur l&#x27;&quot; anniversaire dor\xE9 &quot; avec diverses initiatives sur le th\xE8me de l&#x27;or, ainsi qu&#x27;en suspendant temporairement la tradition de nommer chaque match du Super Bowl avec des chiffres romains (en vertu de laquelle le match aurait \xE9t\xE9 appel\xE9 &quot; Super Bowl L &quot;), afin que le logo puisse mettre en \xE9vidence les chiffres arabes 50.&#x27;&#x27;</span>
<span class="hljs-string">&#x27;Where did Super Bowl 50 take place?&#x27;</span> 
<span class="hljs-comment"># O\xF9 a eu lieu le Super Bowl 50 ?</span>`}}),dt=new gs({}),fs=new Cc({props:{id:"qgaM0weJHpA"}}),mt=new M({props:{code:"",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer

model_checkpoint = <span class="hljs-string">&quot;bert-base-cased&quot;</span>
tokenizer = AutoTokenizer.from_pretrained(model_checkpoint)`}}),_s=new M({props:{code:"tokenizer.is_fast",highlighted:"tokenizer.is_fast"}}),_t=new M({props:{code:"True",highlighted:'<span class="hljs-literal">True</span>'}}),bt=new M({props:{code:"[CLS] question [SEP] context [SEP]",highlighted:'<span class="hljs-selector-attr">[CLS]</span> question <span class="hljs-selector-attr">[SEP]</span> context <span class="hljs-selector-attr">[SEP]</span>'}}),vs=new M({props:{code:"",highlighted:`context = raw_datasets[<span class="hljs-string">&quot;train&quot;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&quot;context&quot;</span>]
question = raw_datasets[<span class="hljs-string">&quot;train&quot;</span>][<span class="hljs-number">0</span>][<span class="hljs-string">&quot;question&quot;</span>]

inputs = tokenizer(question, context)
tokenizer.decode(inputs[<span class="hljs-string">&quot;input_ids&quot;</span>])`}}),xt=new M({props:{code:"",highlighted:`<span class="hljs-string">&#x27;[CLS] To whom did the Virgin Mary allegedly appear in 1858 in Lourdes France? [SEP] Architecturally, &#x27;</span>
<span class="hljs-string">&#x27;the school has a Catholic character. Atop the Main Building\\&#x27;s gold dome is a golden statue of the Virgin &#x27;</span>
<span class="hljs-string">&#x27;Mary. Immediately in front of the Main Building and facing it, is a copper statue of Christ with arms &#x27;</span>
<span class="hljs-string">&#x27;upraised with the legend &quot; Venite Ad Me Omnes &quot;. Next to the Main Building is the Basilica of the Sacred &#x27;</span>
<span class="hljs-string">&#x27;Heart. Immediately behind the basilica is the Grotto, a Marian place of prayer and reflection. It is a &#x27;</span>
<span class="hljs-string">&#x27;replica of the grotto at Lourdes, France where the Virgin Mary reputedly appeared to Saint Bernadette &#x27;</span>
<span class="hljs-string">&#x27;Soubirous in 1858. At the end of the main drive ( and in a direct line that connects through 3 statues &#x27;</span>
<span class="hljs-string">&#x27;and the Gold Dome ), is a simple, modern stone statue of Mary. [SEP]&#x27;</span>

<span class="hljs-string">&#x27;[CLS] A qui la Vierge Marie serait-elle apparue en 1858 \xE0 Lourdes en France ? [SEP] Architecturalement, &#x27;</span>
<span class="hljs-string">&#x27;l \xE9cole a un caract\xE8re catholique. Au sommet du d\xF4me dor\xE9 du b\xE2timent principal se trouve une statue dor\xE9e de la Vierge &#x27;</span>
<span class="hljs-string">&#x27;Marie. Imm\xE9diatement devant le b\xE2timent principal et face \xE0 lui, se trouve une statue en cuivre du Christ, les bras &#x27;</span>
<span class="hljs-string">&#x27;lev\xE9s avec la l\xE9gende &quot; Venite Ad Me Omnes &quot;. A c\xF4t\xE9 du b\xE2timent principal se trouve la basilique du Sacr\xE9 &#x27;</span>
<span class="hljs-string">&#x27;C\u0153ur. Imm\xE9diatement derri\xE8re la basilique se trouve la Grotte, un lieu marial de pri\xE8re et de r\xE9flexion. Il s&#x27;</span>agit d<span class="hljs-string">&#x27;une &#x27;</span>
<span class="hljs-string">&#x27;r\xE9plique de la grotte de Lourdes, en France, o\xF9 la Vierge Marie serait apparue \xE0 Sainte Bernadette &#x27;</span>
<span class="hljs-string">&#x27;Soubirous en 1858. Au bout de l&#x27;</span><span class="hljs-built_in">all</span>\xE9e principale ( et en ligne directe qui passe par <span class="hljs-number">3</span> statues <span class="hljs-string">&#x27;
&#x27;</span>et le D\xF4me d<span class="hljs-string">&#x27;or), se trouve une statue de Marie en pierre, simple et moderne. [SEP]&#x27;</span>`}}),Ee=new M({props:{code:"",highlighted:`inputs = tokenizer(
    question,
    context,
    max_length=<span class="hljs-number">100</span>,
    truncation=<span class="hljs-string">&quot;only_second&quot;</span>,
    stride=<span class="hljs-number">50</span>,
    return_overflowing_tokens=<span class="hljs-literal">True</span>,
)

<span class="hljs-keyword">for</span> ids <span class="hljs-keyword">in</span> inputs[<span class="hljs-string">&quot;input_ids&quot;</span>]:
    <span class="hljs-built_in">print</span>(tokenizer.decode(ids))`}}),pn=new M({props:{code:`

`,highlighted:`<span class="hljs-string">&#x27;[CLS] To whom did the Virgin Mary allegedly appear in 1858 in Lourdes France? [SEP] Architecturally, the school has a Catholic character. Atop the Main Building\\&#x27;s gold dome is a golden statue of the Virgin Mary. Immediately in front of the Main Building and facing it, is a copper statue of Christ with arms upraised with the legend &quot; Venite Ad Me Omnes &quot;. Next to the Main Building is the Basilica of the Sacred Heart. Immediately behind the basi [SEP]&#x27;</span>
<span class="hljs-string">&#x27;[CLS] A qui la Vierge Marie serait-elle apparue en 1858 \xE0 Lourdes en France ? [SEP] Sur le plan architectural, l \xE9cole a un caract\xE8re catholique. Au sommet du d\xF4me dor\xE9 du b\xE2timent principal se trouve une statue dor\xE9e de la Vierge Marie. Imm\xE9diatement devant le b\xE2timent principal et face \xE0 lui, se trouve une statue en cuivre du Christ, les bras lev\xE9s, avec la l\xE9gende &quot; Venite Ad Me Omnes &quot;. \xC0 c\xF4t\xE9 du b\xE2timent principal se trouve la basilique du Sacr\xE9-C\u0153ur. Imm\xE9diatement derri\xE8re la basi [SEP]&#x27;</span>

<span class="hljs-string">&#x27;[CLS] To whom did the Virgin Mary allegedly appear in 1858 in Lourdes France? [SEP] the Main Building and facing it, is a copper statue of Christ with arms upraised with the legend &quot; Venite Ad Me Omnes &quot;. Next to the Main Building is the Basilica of the Sacred Heart. Immediately behind the basilica is the Grotto, a Marian place of prayer and reflection. It is a replica of the grotto at Lourdes, France where the Virgin [SEP]&#x27;</span>
<span class="hljs-string">&#x27;[CLS] A qui la Vierge Marie serait-elle apparue en 1858 \xE0 Lourdes en France ? [SEP] le b\xE2timent principal et face \xE0 lui, une statue en cuivre du Christ aux bras lev\xE9s avec la l\xE9gende &quot; Venite Ad Me Omnes &quot;. \xC0 c\xF4t\xE9 du b\xE2timent principal se trouve la basilique du Sacr\xE9-C\u0153ur. Imm\xE9diatement derri\xE8re la basilique se trouve la Grotte, un lieu marial de pri\xE8re et de r\xE9flexion. Il s agit d&#x27;</span>une r\xE9plique de la grotte de Lourdes, en France, o\xF9 la Vierge [SEP]<span class="hljs-string">&#x27;

&#x27;</span>[CLS] To whom did the Virgin Mary allegedly appear <span class="hljs-keyword">in</span> <span class="hljs-number">1858</span> <span class="hljs-keyword">in</span> Lourdes France? [SEP] Next to the Main Building <span class="hljs-keyword">is</span> the Basilica of the Sacred Heart. Immediately behind the basilica <span class="hljs-keyword">is</span> the Grotto, a Marian place of prayer <span class="hljs-keyword">and</span> reflection. It <span class="hljs-keyword">is</span> a replica of the grotto at Lourdes, France where the Virgin Mary reputedly appeared to Saint Bernadette Soubirous <span class="hljs-keyword">in</span> <span class="hljs-number">1858.</span> At the end of the main drive ( <span class="hljs-keyword">and</span> <span class="hljs-keyword">in</span> a direct line that connects through <span class="hljs-number">3</span> [SEP]<span class="hljs-string">&#x27;
&#x27;</span>[CLS] A qui la Vierge Marie serait-elle apparue en <span class="hljs-number">1858</span> \xE0 Lourdes en France ? [SEP] A c\xF4t\xE9 du b\xE2timent principal se trouve la basilique du Sacr\xE9-C\u0153ur. Imm\xE9diatement derri\xE8re la basilique se trouve la Grotte, un lieu marial de pri\xE8re et de r\xE9flexion. Il s agit d une r\xE9plique de la grotte de Lourdes, en France, o\xF9 la Vierge Marie serait apparue \xE0 Sainte Bernadette Soubirous en <span class="hljs-number">1858.</span> Au bout de l <span class="hljs-built_in">all</span>\xE9e principale ( et dans une ligne directe qui relie par <span class="hljs-number">3</span> [SEP]<span class="hljs-string">&#x27;

&#x27;</span>[CLS] To whom did the Virgin Mary allegedly appear <span class="hljs-keyword">in</span> <span class="hljs-number">1858</span> <span class="hljs-keyword">in</span> Lourdes France? [SEP]. It <span class="hljs-keyword">is</span> a replica of the grotto at Lourdes, France where the Virgin Mary reputedly appeared to Saint Bernadette Soubirous <span class="hljs-keyword">in</span> <span class="hljs-number">1858.</span> At the end of the main drive ( <span class="hljs-keyword">and</span> <span class="hljs-keyword">in</span> a direct line that connects through <span class="hljs-number">3</span> statues <span class="hljs-keyword">and</span> the Gold Dome ), <span class="hljs-keyword">is</span> a simple, modern stone statue of Mary. [SEP]<span class="hljs-string">&#x27;
&#x27;</span>[CLS] A qui la Vierge Marie est-elle pr\xE9tendument apparue en <span class="hljs-number">1858</span> \xE0 Lourdes France ? [SEP]. Il s agit d une r\xE9plique de la grotte de Lourdes, en France, o\xF9 la Vierge Marie serait apparue \xE0 Sainte Bernadette Soubirous en <span class="hljs-number">1858.</span> Au bout de l <span class="hljs-built_in">all</span>\xE9e principale (et dans une ligne directe qui passe par <span class="hljs-number">3</span> statues et le D\xF4me d <span class="hljs-keyword">or</span>), se trouve une simple statue de pierre moderne de Marie. [SEP]<span class="hljs-string">&#x27;</span>`}}),il=new M({props:{code:`inputs = tokenizer(
    question,
    context,
    max_length=100,
    truncation="only_second",
    stride=50,
    return_overflowing_tokens=True,
    return_offsets_mapping=True,
)
inputs.keys()`,highlighted:`inputs = tokenizer(
    question,
    context,
    max_length=<span class="hljs-number">100</span>,
    truncation=<span class="hljs-string">&quot;only_second&quot;</span>,
    stride=<span class="hljs-number">50</span>,
    return_overflowing_tokens=<span class="hljs-literal">True</span>,
    return_offsets_mapping=<span class="hljs-literal">True</span>,
)
inputs.keys()`}}),ul=new M({props:{code:"dict_keys(['input_ids', 'token_type_ids', 'attention_mask', 'offset_mapping', 'overflow_to_sample_mapping'])",highlighted:'dict_keys([<span class="hljs-string">&#x27;input_ids&#x27;</span>, <span class="hljs-string">&#x27;token_type_ids&#x27;</span>, <span class="hljs-string">&#x27;attention_mask&#x27;</span>, <span class="hljs-string">&#x27;offset_mapping&#x27;</span>, <span class="hljs-string">&#x27;overflow_to_sample_mapping&#x27;</span>])'}}),pl=new M({props:{code:'inputs["overflow_to_sample_mapping"]',highlighted:'inputs[<span class="hljs-string">&quot;overflow_to_sample_mapping&quot;</span>]'}}),dl=new M({props:{code:"[0, 0, 0, 0]",highlighted:'[<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]'}}),cl=new M({props:{code:"",highlighted:`inputs = tokenizer(
    raw_datasets[<span class="hljs-string">&quot;train&quot;</span>][<span class="hljs-number">2</span>:<span class="hljs-number">6</span>][<span class="hljs-string">&quot;question&quot;</span>],
    raw_datasets[<span class="hljs-string">&quot;train&quot;</span>][<span class="hljs-number">2</span>:<span class="hljs-number">6</span>][<span class="hljs-string">&quot;context&quot;</span>],
    max_length=<span class="hljs-number">100</span>,
    truncation=<span class="hljs-string">&quot;only_second&quot;</span>,
    stride=<span class="hljs-number">50</span>,
    return_overflowing_tokens=<span class="hljs-literal">True</span>,
    return_offsets_mapping=<span class="hljs-literal">True</span>,
)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;The 4 examples gave <span class="hljs-subst">{<span class="hljs-built_in">len</span>(inputs[<span class="hljs-string">&#x27;input_ids&#x27;</span>])}</span> features.&quot;</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Here is where each comes from: <span class="hljs-subst">{inputs[<span class="hljs-string">&#x27;overflow_to_sample_mapping&#x27;</span>]}</span>.&quot;</span>)`}}),ml=new M({props:{code:`'The 4 examples gave 19 features.'
'Here is where each comes from: [0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3].'`,highlighted:`<span class="hljs-string">&#x27;The 4 examples gave 19 features.&#x27;</span>
<span class="hljs-string">&#x27;Here is where each comes from: [0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3].&#x27;</span>`}}),fl=new M({props:{code:`



`,highlighted:`answers = raw_datasets[<span class="hljs-string">&quot;train&quot;</span>][<span class="hljs-number">2</span>:<span class="hljs-number">6</span>][<span class="hljs-string">&quot;answers&quot;</span>]
start_positions = []
end_positions = []

<span class="hljs-keyword">for</span> i, offset <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(inputs[<span class="hljs-string">&quot;offset_mapping&quot;</span>]):
    sample_idx = inputs[<span class="hljs-string">&quot;overflow_to_sample_mapping&quot;</span>][i]
    answer = answers[sample_idx]
    start_char = answer[<span class="hljs-string">&quot;answer_start&quot;</span>][<span class="hljs-number">0</span>]
    end_char = answer[<span class="hljs-string">&quot;answer_start&quot;</span>][<span class="hljs-number">0</span>] + <span class="hljs-built_in">len</span>(answer[<span class="hljs-string">&quot;text&quot;</span>][<span class="hljs-number">0</span>])
    sequence_ids = inputs.sequence_ids(i)

    <span class="hljs-comment"># Trouver le d\xE9but et la fin du contexte</span>
    idx = <span class="hljs-number">0</span>
    <span class="hljs-keyword">while</span> sequence_ids[idx] != <span class="hljs-number">1</span>:
        idx += <span class="hljs-number">1</span>
    context_start = idx
    <span class="hljs-keyword">while</span> sequence_ids[idx] == <span class="hljs-number">1</span>:
        idx += <span class="hljs-number">1</span>
    context_end = idx - <span class="hljs-number">1</span>

    <span class="hljs-comment"># Si la r\xE9ponse n&#x27;est pas enti\xE8rement dans le contexte, l&#x27;\xE9tiquette est (0, 0)</span>
    <span class="hljs-keyword">if</span> offset[context_start][<span class="hljs-number">0</span>] &gt; start_char <span class="hljs-keyword">or</span> offset[context_end][<span class="hljs-number">1</span>] &lt; end_char:
        start_positions.append(<span class="hljs-number">0</span>)
        end_positions.append(<span class="hljs-number">0</span>)
    <span class="hljs-keyword">else</span>:
        <span class="hljs-comment"># Sinon, ce sont les positions de d\xE9but et de fin du token</span>
        idx = context_start
        <span class="hljs-keyword">while</span> idx &lt;= context_end <span class="hljs-keyword">and</span> offset[idx][<span class="hljs-number">0</span>] &lt;= start_char:
            idx += <span class="hljs-number">1</span>
        start_positions.append(idx - <span class="hljs-number">1</span>)

        idx = context_end
        <span class="hljs-keyword">while</span> idx &gt;= context_start <span class="hljs-keyword">and</span> offset[idx][<span class="hljs-number">1</span>] &gt;= end_char:
            idx -= <span class="hljs-number">1</span>
        end_positions.append(idx + <span class="hljs-number">1</span>)

start_positions, end_positions`}}),hl=new M({props:{code:`([83, 51, 19, 0, 0, 64, 27, 0, 34, 0, 0, 0, 67, 34, 0, 0, 0, 0, 0],
 [85, 53, 21, 0, 0, 70, 33, 0, 40, 0, 0, 0, 68, 35, 0, 0, 0, 0, 0])`,highlighted:`([<span class="hljs-number">83</span>, <span class="hljs-number">51</span>, <span class="hljs-number">19</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">64</span>, <span class="hljs-number">27</span>, <span class="hljs-number">0</span>, <span class="hljs-number">34</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">67</span>, <span class="hljs-number">34</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>],
 [<span class="hljs-number">85</span>, <span class="hljs-number">53</span>, <span class="hljs-number">21</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">70</span>, <span class="hljs-number">33</span>, <span class="hljs-number">0</span>, <span class="hljs-number">40</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">68</span>, <span class="hljs-number">35</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>])`}}),_l=new M({props:{code:`
`,highlighted:`idx = <span class="hljs-number">0</span>
sample_idx = inputs[<span class="hljs-string">&quot;overflow_to_sample_mapping&quot;</span>][idx]
answer = answers[sample_idx][<span class="hljs-string">&quot;text&quot;</span>][<span class="hljs-number">0</span>]

start = start_positions[idx]
end = end_positions[idx]
labeled_answer = tokenizer.decode(inputs[<span class="hljs-string">&quot;input_ids&quot;</span>][idx][start : end + <span class="hljs-number">1</span>])

<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Theoretical answer: <span class="hljs-subst">{answer}</span>, labels give: <span class="hljs-subst">{labeled_answer}</span>&quot;</span>)`}}),vl=new M({props:{code:"'Theoretical answer: the Main Building, labels give: the Main Building'",highlighted:'<span class="hljs-string">&#x27;Theoretical answer: the Main Building, labels give: the Main Building&#x27;</span>'}}),ql=new M({props:{code:"",highlighted:`idx = <span class="hljs-number">4</span>
sample_idx = inputs[<span class="hljs-string">&quot;overflow_to_sample_mapping&quot;</span>][idx]
answer = answers[sample_idx][<span class="hljs-string">&quot;text&quot;</span>][<span class="hljs-number">0</span>]

decoded_example = tokenizer.decode(inputs[<span class="hljs-string">&quot;input_ids&quot;</span>][idx])
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Theoretical answer: <span class="hljs-subst">{answer}</span>, decoded example: <span class="hljs-subst">{decoded_example}</span>&quot;</span>)`}}),bl=new M({props:{code:`'Theoretical answer: a Marian place of prayer and reflection, decoded example: [CLS] What is the Grotto at Notre Dame? [SEP] Architecturally, the school has a Catholic character. Atop the Main Building\\'s gold dome is a golden statue of the Virgin Mary. Immediately in front of the Main Building and facing it, is a copper statue of Christ with arms upraised with the legend " Venite Ad Me Omnes ". Next to the Main Building is the Basilica of the Sacred Heart. Immediately behind the basilica is the Grot [SEP]'`,highlighted:'<span class="hljs-string">&#x27;Theoretical answer: a Marian place of prayer and reflection, decoded example: [CLS] What is the Grotto at Notre Dame? [SEP] Architecturally, the school has a Catholic character. Atop the Main Building\\&#x27;s gold dome is a golden statue of the Virgin Mary. Immediately in front of the Main Building and facing it, is a copper statue of Christ with arms upraised with the legend &quot; Venite Ad Me Omnes &quot;. Next to the Main Building is the Basilica of the Sacred Heart. Immediately behind the basilica is the Grot [SEP]&#x27;</span>'}}),Ra=new yc({props:{$$slots:{default:[Ag]},$$scope:{ctx:R}}}),gl=new M({props:{code:`






`,highlighted:`max_length = <span class="hljs-number">384</span>
stride = <span class="hljs-number">128</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">preprocess_training_examples</span>(<span class="hljs-params">examples</span>):
    questions = [q.strip() <span class="hljs-keyword">for</span> q <span class="hljs-keyword">in</span> examples[<span class="hljs-string">&quot;question&quot;</span>]]
    inputs = tokenizer(
        questions,
        examples[<span class="hljs-string">&quot;context&quot;</span>],
        max_length=max_length,
        truncation=<span class="hljs-string">&quot;only_second&quot;</span>,
        stride=stride,
        return_overflowing_tokens=<span class="hljs-literal">True</span>,
        return_offsets_mapping=<span class="hljs-literal">True</span>,
        padding=<span class="hljs-string">&quot;max_length&quot;</span>,
    )

    offset_mapping = inputs.pop(<span class="hljs-string">&quot;offset_mapping&quot;</span>)
    sample_map = inputs.pop(<span class="hljs-string">&quot;overflow_to_sample_mapping&quot;</span>)
    answers = examples[<span class="hljs-string">&quot;answers&quot;</span>]
    start_positions = []
    end_positions = []

    <span class="hljs-keyword">for</span> i, offset <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(offset_mapping):
        sample_idx = sample_map[i]
        answer = answers[sample_idx]
        start_char = answer[<span class="hljs-string">&quot;answer_start&quot;</span>][<span class="hljs-number">0</span>]
        end_char = answer[<span class="hljs-string">&quot;answer_start&quot;</span>][<span class="hljs-number">0</span>] + <span class="hljs-built_in">len</span>(answer[<span class="hljs-string">&quot;text&quot;</span>][<span class="hljs-number">0</span>])
        sequence_ids = inputs.sequence_ids(i)

        <span class="hljs-comment"># Trouver le d\xE9but et la fin du contexte</span>
        idx = <span class="hljs-number">0</span>
        <span class="hljs-keyword">while</span> sequence_ids[idx] != <span class="hljs-number">1</span>:
            idx += <span class="hljs-number">1</span>
        context_start = idx
        <span class="hljs-keyword">while</span> sequence_ids[idx] == <span class="hljs-number">1</span>:
            idx += <span class="hljs-number">1</span>
        context_end = idx - <span class="hljs-number">1</span>

        <span class="hljs-comment"># Si la r\xE9ponse n&#x27;est pas enti\xE8rement dans le contexte, l&#x27;\xE9tiquette est (0, 0)</span>
        <span class="hljs-keyword">if</span> offset[context_start][<span class="hljs-number">0</span>] &gt; start_char <span class="hljs-keyword">or</span> offset[context_end][<span class="hljs-number">1</span>] &lt; end_char:
            start_positions.append(<span class="hljs-number">0</span>)
            end_positions.append(<span class="hljs-number">0</span>)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># Sinon, ce sont les positions de d\xE9but et de fin du token</span>
            idx = context_start
            <span class="hljs-keyword">while</span> idx &lt;= context_end <span class="hljs-keyword">and</span> offset[idx][<span class="hljs-number">0</span>] &lt;= start_char:
                idx += <span class="hljs-number">1</span>
            start_positions.append(idx - <span class="hljs-number">1</span>)

            idx = context_end
            <span class="hljs-keyword">while</span> idx &gt;= context_start <span class="hljs-keyword">and</span> offset[idx][<span class="hljs-number">1</span>] &gt;= end_char:
                idx -= <span class="hljs-number">1</span>
            end_positions.append(idx + <span class="hljs-number">1</span>)

    inputs[<span class="hljs-string">&quot;start_positions&quot;</span>] = start_positions
    inputs[<span class="hljs-string">&quot;end_positions&quot;</span>] = end_positions
    <span class="hljs-keyword">return</span> inputs`}}),xl=new M({props:{code:`train_dataset = raw_datasets["train"].map(
    preprocess_training_examples,
    batched=True,
    remove_columns=raw_datasets["train"].column_names,
)
len(raw_datasets["train"]), len(train_dataset)`,highlighted:`train_dataset = raw_datasets[<span class="hljs-string">&quot;train&quot;</span>].<span class="hljs-built_in">map</span>(
    preprocess_training_examples,
    batched=<span class="hljs-literal">True</span>,
    remove_columns=raw_datasets[<span class="hljs-string">&quot;train&quot;</span>].column_names,
)
<span class="hljs-built_in">len</span>(raw_datasets[<span class="hljs-string">&quot;train&quot;</span>]), <span class="hljs-built_in">len</span>(train_dataset)`}}),$l=new M({props:{code:"(87599, 88729)",highlighted:'(<span class="hljs-number">87599</span>, <span class="hljs-number">88729</span>)'}}),jl=new gs({}),wl=new M({props:{code:`


`,highlighted:`<span class="hljs-keyword">def</span> <span class="hljs-title function_">preprocess_validation_examples</span>(<span class="hljs-params">examples</span>):
    questions = [q.strip() <span class="hljs-keyword">for</span> q <span class="hljs-keyword">in</span> examples[<span class="hljs-string">&quot;question&quot;</span>]]
    inputs = tokenizer(
        questions,
        examples[<span class="hljs-string">&quot;context&quot;</span>],
        max_length=max_length,
        truncation=<span class="hljs-string">&quot;only_second&quot;</span>,
        stride=stride,
        return_overflowing_tokens=<span class="hljs-literal">True</span>,
        return_offsets_mapping=<span class="hljs-literal">True</span>,
        padding=<span class="hljs-string">&quot;max_length&quot;</span>,
    )

    sample_map = inputs.pop(<span class="hljs-string">&quot;overflow_to_sample_mapping&quot;</span>)
    example_ids = []

    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(inputs[<span class="hljs-string">&quot;input_ids&quot;</span>])):
        sample_idx = sample_map[i]
        example_ids.append(examples[<span class="hljs-string">&quot;id&quot;</span>][sample_idx])

        sequence_ids = inputs.sequence_ids(i)
        offset = inputs[<span class="hljs-string">&quot;offset_mapping&quot;</span>][i]
        inputs[<span class="hljs-string">&quot;offset_mapping&quot;</span>][i] = [
            o <span class="hljs-keyword">if</span> sequence_ids[k] == <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">for</span> k, o <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(offset)
        ]

    inputs[<span class="hljs-string">&quot;example_id&quot;</span>] = example_ids
    <span class="hljs-keyword">return</span> inputs`}}),El=new M({props:{code:`validation_dataset = raw_datasets["validation"].map(
    preprocess_validation_examples,
    batched=True,
    remove_columns=raw_datasets["validation"].column_names,
)
len(raw_datasets["validation"]), len(validation_dataset)`,highlighted:`validation_dataset = raw_datasets[<span class="hljs-string">&quot;validation&quot;</span>].<span class="hljs-built_in">map</span>(
    preprocess_validation_examples,
    batched=<span class="hljs-literal">True</span>,
    remove_columns=raw_datasets[<span class="hljs-string">&quot;validation&quot;</span>].column_names,
)
<span class="hljs-built_in">len</span>(raw_datasets[<span class="hljs-string">&quot;validation&quot;</span>]), <span class="hljs-built_in">len</span>(validation_dataset)`}}),kl=new M({props:{code:"(10570, 10822)",highlighted:'(<span class="hljs-number">10570</span>, <span class="hljs-number">10822</span>)'}});const J_=[Sg,Dg],Zl=[];function W_(e,u){return e[0]==="pt"?0:1}wt=W_(R),Et=Zl[wt]=J_[wt](R),yl=new gs({});const X_=[zg,Mg],er=[];function K_(e,u){return e[0]==="pt"?0:1}kt=K_(R),yt=er[kt]=X_[kt](R),Al=new M({props:{code:"",highlighted:`small_eval_set = raw_datasets[<span class="hljs-string">&quot;validation&quot;</span>].select(<span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>))
trained_checkpoint = <span class="hljs-string">&quot;distilbert-base-cased-distilled-squad&quot;</span>

tokenizer = AutoTokenizer.from_pretrained(trained_checkpoint)
eval_set = small_eval_set.<span class="hljs-built_in">map</span>(
    preprocess_validation_examples,
    batched=<span class="hljs-literal">True</span>,
    remove_columns=raw_datasets[<span class="hljs-string">&quot;validation&quot;</span>].column_names,
)`}}),Dl=new M({props:{code:"tokenizer = AutoTokenizer.from_pretrained(model_checkpoint)",highlighted:"tokenizer = AutoTokenizer.from_pretrained(model_checkpoint)"}});const Y_=[Tg,Ng],sr=[];function Z_(e,u){return e[0]==="pt"?0:1}Ct=Z_(R),Pt=sr[Ct]=Y_[Ct](R),Sl=new M({props:{code:"",highlighted:`<span class="hljs-keyword">import</span> collections

example_to_features = collections.defaultdict(<span class="hljs-built_in">list</span>)
<span class="hljs-keyword">for</span> idx, feature <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(eval_set):
    example_to_features[feature[<span class="hljs-string">&quot;example_id&quot;</span>]].append(idx)`}}),zl=new M({props:{code:`




`,highlighted:`<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

n_best = <span class="hljs-number">20</span>
max_answer_length = <span class="hljs-number">30</span>
predicted_answers = []

<span class="hljs-keyword">for</span> example <span class="hljs-keyword">in</span> small_eval_set:
    example_id = example[<span class="hljs-string">&quot;id&quot;</span>]
    context = example[<span class="hljs-string">&quot;context&quot;</span>]
    answers = []

    <span class="hljs-keyword">for</span> feature_index <span class="hljs-keyword">in</span> example_to_features[example_id]:
        start_logit = start_logits[feature_index]
        end_logit = end_logits[feature_index]
        offsets = eval_set[<span class="hljs-string">&quot;offset_mapping&quot;</span>][feature_index]

        start_indexes = np.argsort(start_logit)[-<span class="hljs-number">1</span> : -n_best - <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>].tolist()
        end_indexes = np.argsort(end_logit)[-<span class="hljs-number">1</span> : -n_best - <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>].tolist()
        <span class="hljs-keyword">for</span> start_index <span class="hljs-keyword">in</span> start_indexes:
            <span class="hljs-keyword">for</span> end_index <span class="hljs-keyword">in</span> end_indexes:
                <span class="hljs-comment"># Ignore les r\xE9ponses qui ne sont pas enti\xE8rement dans le contexte</span>
                <span class="hljs-keyword">if</span> offsets[start_index] <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">or</span> offsets[end_index] <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
                    <span class="hljs-keyword">continue</span>
                <span class="hljs-comment"># Ignore les r\xE9ponses dont la longueur est soit &lt; 0 soit &gt; max_answer_length</span>
                <span class="hljs-keyword">if</span> (
                    end_index &lt; start_index
                    <span class="hljs-keyword">or</span> end_index - start_index + <span class="hljs-number">1</span> &gt; max_answer_length
                ):
                    <span class="hljs-keyword">continue</span>

                answers.append(
                    {
                        <span class="hljs-string">&quot;text&quot;</span>: context[offsets[start_index][<span class="hljs-number">0</span>] : offsets[end_index][<span class="hljs-number">1</span>]],
                        <span class="hljs-string">&quot;logit_score&quot;</span>: start_logit[start_index] + end_logit[end_index],
                    }
                )

    best_answer = <span class="hljs-built_in">max</span>(answers, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-string">&quot;logit_score&quot;</span>])
    predicted_answers.append({<span class="hljs-string">&quot;id&quot;</span>: example_id, <span class="hljs-string">&quot;prediction_text&quot;</span>: best_answer[<span class="hljs-string">&quot;text&quot;</span>]})`}}),Nl=new M({props:{code:"",highlighted:`<span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_metric

metric = load_metric(<span class="hljs-string">&quot;squad&quot;</span>)`}}),Tl=new M({props:{code:`theoretical_answers = [
    {"id": ex["id"], "answers": ex["answers"]} for ex in small_eval_set
]`,highlighted:`theoretical_answers = [
    {<span class="hljs-string">&quot;id&quot;</span>: ex[<span class="hljs-string">&quot;id&quot;</span>], <span class="hljs-string">&quot;answers&quot;</span>: ex[<span class="hljs-string">&quot;answers&quot;</span>]} <span class="hljs-keyword">for</span> ex <span class="hljs-keyword">in</span> small_eval_set
]`}}),Ll=new M({props:{code:`print(predicted_answers[0])
print(theoretical_answers[0])`,highlighted:`<span class="hljs-built_in">print</span>(predicted_answers[<span class="hljs-number">0</span>])
<span class="hljs-built_in">print</span>(theoretical_answers[<span class="hljs-number">0</span>])`}}),Ol=new M({props:{code:`{'id': '56be4db0acb8001400a502ec', 'prediction_text': 'Denver Broncos'}
{'id': '56be4db0acb8001400a502ec', 'answers': {'text': ['Denver Broncos', 'Denver Broncos', 'Denver Broncos'], 'answer_start': [177, 177, 177]}}`,highlighted:`{<span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-string">&#x27;56be4db0acb8001400a502ec&#x27;</span>, <span class="hljs-string">&#x27;prediction_text&#x27;</span>: <span class="hljs-string">&#x27;Denver Broncos&#x27;</span>}
{<span class="hljs-string">&#x27;id&#x27;</span>: <span class="hljs-string">&#x27;56be4db0acb8001400a502ec&#x27;</span>, <span class="hljs-string">&#x27;answers&#x27;</span>: {<span class="hljs-string">&#x27;text&#x27;</span>: [<span class="hljs-string">&#x27;Denver Broncos&#x27;</span>, <span class="hljs-string">&#x27;Denver Broncos&#x27;</span>, <span class="hljs-string">&#x27;Denver Broncos&#x27;</span>], <span class="hljs-string">&#x27;answer_start&#x27;</span>: [<span class="hljs-number">177</span>, <span class="hljs-number">177</span>, <span class="hljs-number">177</span>]}}`}}),Bl=new M({props:{code:"metric.compute(predictions=predicted_answers, references=theoretical_answers)",highlighted:"metric.compute(predictions=predicted_answers, references=theoretical_answers)"}}),Fl=new M({props:{code:"{'exact_match': 83.0, 'f1': 88.25}",highlighted:'{<span class="hljs-string">&#x27;exact_match&#x27;</span>: <span class="hljs-number">83.0</span>, <span class="hljs-string">&#x27;f1&#x27;</span>: <span class="hljs-number">88.25</span>}'}});function ev(e,u){return e[0]==="pt"?Og:Lg}let Yd=ev(R),ea=Yd(R);Vl=new M({props:{code:`






`,highlighted:`<span class="hljs-keyword">from</span> tqdm.auto <span class="hljs-keyword">import</span> tqdm


<span class="hljs-keyword">def</span> <span class="hljs-title function_">compute_metrics</span>(<span class="hljs-params">start_logits, end_logits, features, examples</span>):
    example_to_features = collections.defaultdict(<span class="hljs-built_in">list</span>)
    <span class="hljs-keyword">for</span> idx, feature <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(features):
        example_to_features[feature[<span class="hljs-string">&quot;example_id&quot;</span>]].append(idx)

    predicted_answers = []
    <span class="hljs-keyword">for</span> example <span class="hljs-keyword">in</span> tqdm(examples):
        example_id = example[<span class="hljs-string">&quot;id&quot;</span>]
        context = example[<span class="hljs-string">&quot;context&quot;</span>]
        answers = []

        <span class="hljs-comment"># Parcourir en boucle toutes les fonctionnalit\xE9s associ\xE9es \xE0 cet exemple</span>
        <span class="hljs-keyword">for</span> feature_index <span class="hljs-keyword">in</span> example_to_features[example_id]:
            start_logit = start_logits[feature_index]
            end_logit = end_logits[feature_index]
            offsets = features[feature_index][<span class="hljs-string">&quot;offset_mapping&quot;</span>]

            start_indexes = np.argsort(start_logit)[-<span class="hljs-number">1</span> : -n_best - <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>].tolist()
            end_indexes = np.argsort(end_logit)[-<span class="hljs-number">1</span> : -n_best - <span class="hljs-number">1</span> : -<span class="hljs-number">1</span>].tolist()
            <span class="hljs-keyword">for</span> start_index <span class="hljs-keyword">in</span> start_indexes:
                <span class="hljs-keyword">for</span> end_index <span class="hljs-keyword">in</span> end_indexes:
                    <span class="hljs-comment"># Ignore les r\xE9ponses qui ne sont pas enti\xE8rement dans le contexte</span>
                    <span class="hljs-keyword">if</span> offsets[start_index] <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">or</span> offsets[end_index] <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
                        <span class="hljs-keyword">continue</span>
                    <span class="hljs-comment"># Ignore les r\xE9ponses dont la longueur est soit &lt; 0, soit &gt; max_answer_length</span>
                    <span class="hljs-keyword">if</span> (
                        end_index &lt; start_index
                        <span class="hljs-keyword">or</span> end_index - start_index + <span class="hljs-number">1</span> &gt; max_answer_length
                    ):
                        <span class="hljs-keyword">continue</span>

                    answer = {
                        <span class="hljs-string">&quot;text&quot;</span>: context[offsets[start_index][<span class="hljs-number">0</span>] : offsets[end_index][<span class="hljs-number">1</span>]],
                        <span class="hljs-string">&quot;logit_score&quot;</span>: start_logit[start_index] + end_logit[end_index],
                    }
                    answers.append(answer)

        <span class="hljs-comment"># S\xE9lectionne la r\xE9ponse avec le meilleur score</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(answers) &gt; <span class="hljs-number">0</span>:
            best_answer = <span class="hljs-built_in">max</span>(answers, key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-string">&quot;logit_score&quot;</span>])
            predicted_answers.append(
                {<span class="hljs-string">&quot;id&quot;</span>: example_id, <span class="hljs-string">&quot;prediction_text&quot;</span>: best_answer[<span class="hljs-string">&quot;text&quot;</span>]}
            )
        <span class="hljs-keyword">else</span>:
            predicted_answers.append({<span class="hljs-string">&quot;id&quot;</span>: example_id, <span class="hljs-string">&quot;prediction_text&quot;</span>: <span class="hljs-string">&quot;&quot;</span>})

    theoretical_answers = [{<span class="hljs-string">&quot;id&quot;</span>: ex[<span class="hljs-string">&quot;id&quot;</span>], <span class="hljs-string">&quot;answers&quot;</span>: ex[<span class="hljs-string">&quot;answers&quot;</span>]} <span class="hljs-keyword">for</span> ex <span class="hljs-keyword">in</span> examples]
    <span class="hljs-keyword">return</span> metric.compute(predictions=predicted_answers, references=theoretical_answers)`}}),Hl=new M({props:{code:"compute_metrics(start_logits, end_logits, eval_set, small_eval_set)",highlighted:"compute_metrics(start_logits, end_logits, eval_set, small_eval_set)"}}),Ul=new M({props:{code:"{'exact_match': 83.0, 'f1': 88.25}",highlighted:'{<span class="hljs-string">&#x27;exact_match&#x27;</span>: <span class="hljs-number">83.0</span>, <span class="hljs-string">&#x27;f1&#x27;</span>: <span class="hljs-number">88.25</span>}'}}),Rl=new gs({});const sv=[Fg,Bg],tr=[];function tv(e,u){return e[0]==="pt"?0:1}At=tv(R),Dt=tr[At]=sv[At](R),Ql=new M({props:{code:"",highlighted:`<span class="hljs-keyword">from</span> huggingface_hub <span class="hljs-keyword">import</span> notebook_login

notebook_login()`}}),Gl=new M({props:{code:"huggingface-cli login",highlighted:"huggingface-cli login"}});const nv=[Vg,Ig],nr=[];function av(e,u){return e[0]==="pt"?0:1}St=av(R),Mt=nr[St]=nv[St](R);const ov=[Ug,Hg],ar=[];function lv(e,u){return e[0]==="pt"?0:1}zt=lv(R),Nt=ar[zt]=ov[zt](R);const rv=[Gg,Qg],or=[];function iv(e,u){return e[0]==="pt"?0:1}Tt=iv(R),Lt=or[Tt]=rv[Tt](R),Jl=new M({props:{code:"{'exact_match': 81.18259224219489, 'f1': 88.67381321905516}",highlighted:'{<span class="hljs-string">&#x27;exact_match&#x27;</span>: <span class="hljs-number">81.18259224219489</span>, <span class="hljs-string">&#x27;f1&#x27;</span>: <span class="hljs-number">88.67381321905516</span>}'}});let $e=R[0]==="pt"&&hg();no=new yc({props:{$$slots:{default:[Jg]},$$scope:{ctx:R}}});let je=R[0]==="pt"&&_g();return Wl=new gs({}),Xl=new M({props:{code:`
`,highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> pipeline

<span class="hljs-comment"># Remplacez par votre propre checkpoint</span>
model_checkpoint = <span class="hljs-string">&quot;huggingface-course/bert-finetuned-squad&quot;</span>
question_answerer = pipeline(<span class="hljs-string">&quot;question-answering&quot;</span>, model=model_checkpoint)

context = <span class="hljs-string">&quot;&quot;&quot;
\u{1F917} Transformers is backed by the three most popular deep learning libraries \u2014 Jax, PyTorch and TensorFlow \u2014 with a seamless integration
between them. It&#x27;s straightforward to train your models with one before loading them for inference with the other.
&quot;&quot;&quot;</span>
question = <span class="hljs-string">&quot;Which deep learning libraries back \u{1F917} Transformers?&quot;</span>
question_answerer(question=question, context=context)`}}),Kl=new M({props:{code:`{'score': 0.9979003071784973,
 'start': 78,
 'end': 105,
 'answer': 'Jax, PyTorch and TensorFlow'}`,highlighted:`{<span class="hljs-string">&#x27;score&#x27;</span>: <span class="hljs-number">0.9979003071784973</span>,
 <span class="hljs-string">&#x27;start&#x27;</span>: <span class="hljs-number">78</span>,
 <span class="hljs-string">&#x27;end&#x27;</span>: <span class="hljs-number">105</span>,
 <span class="hljs-string">&#x27;answer&#x27;</span>: <span class="hljs-string">&#x27;Jax, PyTorch and TensorFlow&#x27;</span>}`}}),{c(){p=o("meta"),q=d(),j(f.$$.fragment),y=d(),D=o("h1"),b=o("a"),g=o("span"),j(x.$$.fragment),h=d(),S=o("span"),$=n("R\xE9ponse aux questions"),A=d(),I.c(),z=d(),P=o("p"),V=n("Il est temps de s\u2019int\xE9resser \xE0 la r\xE9ponse aux questions ! Cette t\xE2che peut prendre plusieurs formes mais celle sur laquelle nous allons nous concentrer dans cette section est appel\xE9e r\xE9ponse aux questions "),T=o("em"),O=n("extractives"),L=n(". Il s\u2019agit de poser des questions sur un document et d\u2019identifier les r\xE9ponses sous forme de \xAB d\u2019\xE9tendue de texte \xBB dans le document lui-m\xEAme."),U=d(),j(Q.$$.fragment),W=d(),H=o("p"),G=n("Nous allons "),ee=o("em"),Z=n("finetuner"),F=n(" un mod\xE8le BERT sur le "),X=o("a"),le=n("jeu de donn\xE9es SQuAD"),se=n(", qui consiste en des questions pos\xE9es par des "),K=o("em"),re=n("crowdworkers"),Ce=n(" sur un ensemble d\u2019articles de Wikipedia. Cela nous donnera un mod\xE8le capable de calculer des pr\xE9dictions comme celui-ci :"),ye=d(),ie=o("iframe"),Fe=d(),ue=o("iframe"),rs=d(),J=o("p"),Y=n("Il s\u2019agit d\u2019une pr\xE9sentation du mod\xE8le qui a \xE9t\xE9 entra\xEEn\xE9 \xE0 l\u2019aide du code pr\xE9sent\xE9 dans cette section et qui a ensuit\xE9 \xE9t\xE9 t\xE9l\xE9charg\xE9 sur le "),js=o("em"),Bt=n("Hub"),ws=n(". Vous pouvez le trouver "),Ie=o("a"),Ve=n("ici"),Es=d(),j(_e.$$.fragment),He=d(),pe=o("h2"),ve=o("a"),Ue=o("span"),j(Re.$$.fragment),mo=d(),Ft=o("span"),Ws=n("Pr\xE9paration des donn\xE9es"),En=d(),qe=o("p"),fo=n("Le jeu de donn\xE9es le plus utilis\xE9 comme r\xE9f\xE9rence acad\xE9mique pour la r\xE9ponse extractive aux questions est "),is=o("a"),ho=n("SQuAD"),_o=n(". C\u2019est donc celui que nous utiliserons ici. Il existe \xE9galement une version plus difficile "),ks=o("a"),Xs=n("SQuAD v2"),ta=n(", qui comprend des questions sans r\xE9ponse. Tant que votre propre jeu de donn\xE9es contient une colonne pour les contextes, une colonne pour les questions et une colonne pour les r\xE9ponses, vous devriez \xEAtre en mesure d\u2019adapter les \xE9tapes ci-dessous."),te=d(),us=o("h3"),Qe=o("a"),kn=o("span"),j(Ks.$$.fragment),yn=d(),Cn=o("span"),vo=n("Le jeu de donn\xE9es SQuAD"),It=d(),ys=o("p"),qo=n("Comme d\u2019habitude, nous pouvons t\xE9l\xE9charger et mettre en cache le jeu de donn\xE9es en une seule \xE9tape gr\xE2ce \xE0 "),Ys=o("code"),bo=n("load_dataset()"),go=n(" :"),Vt=d(),j(Zs.$$.fragment),na=d(),Cs=o("p"),xo=n("Nous pouvons jeter un coup d\u2019\u0153il \xE0 cet objet pour en savoir plus sur le jeu de donn\xE9es SQuAD :"),aa=d(),j(ps.$$.fragment),oa=d(),j(et.$$.fragment),Pn=d(),me=o("p"),la=n("On dirait que nous avons tout ce dont nous avons besoin avec les champs "),Pe=o("code"),$o=n("context"),An=n(", "),Dn=o("code"),jo=n("question"),Sn=n(" et "),Mn=o("code"),wo=n("answers"),ra=n(". Affichons-les pour le premier \xE9l\xE9ment de notre ensemble d\u2019entra\xEEnement :"),Ps=d(),j(As.$$.fragment),de=d(),j(st.$$.fragment),Ht=d(),oe=o("p"),Eo=n("Les champs "),tt=o("code"),ko=n("context"),yo=n(" et "),nt=o("code"),Co=n("question"),Po=n(" sont tr\xE8s simples \xE0 utiliser. Le champ "),at=o("code"),Ao=n("answers"),Do=n(" est un peu plus d\xE9licat car il compile un dictionnaire avec deux champs qui sont tous deux des listes. C\u2019est le format qui sera attendu par la m\xE9trique "),ot=o("code"),So=n("squad"),Mo=n(" lors de l\u2019\xE9valuation. Si vous utilisez vos propres donn\xE9es, vous n\u2019avez pas n\xE9cessairement besoin de vous soucier de mettre les r\xE9ponses dans le m\xEAme format. Le champ "),Ut=o("code"),lt=n("text"),ia=n(" est assez \xE9vident et le champ "),ds=o("code"),ua=n("answer_start"),Rt=n(" contient l\u2019indice du caract\xE8re de d\xE9part de chaque r\xE9ponse dans le contexte."),pa=d(),cs=o("p"),rt=n("Pendant l\u2019entra\xEEnement, il n\u2019y a qu\u2019une seule r\xE9ponse possible. Nous pouvons v\xE9rifier cela en utilisant la m\xE9thode "),Qt=o("code"),Ge=n("Dataset.filter()"),zo=n(" :"),Gt=d(),j(it.$$.fragment),da=d(),j(ms.$$.fragment),ca=d(),Jt=o("p"),ma=n("Pour l\u2019\xE9valuation, cependant, il existe plusieurs r\xE9ponses possibles pour chaque \xE9chantillon, qui peuvent \xEAtre identiques ou diff\xE9rentes :"),Je=d(),j(Ae.$$.fragment),Wt=d(),j(Oe.$$.fragment),fa=d(),We=o("p"),No=n("Nous ne nous plongerons pas dans le script d\u2019\xE9valuation car tout sera envelopp\xE9 pour nous par une m\xE9trique de \u{1F917} "),Xt=o("em"),Kt=n("Datasets"),To=n(". La version courte est que certaines des questions ont plusieurs r\xE9ponses possibles, et ce script va comparer une r\xE9ponse pr\xE9dite \xE0 toutes les r\xE9ponses acceptables et prendre le meilleur score. Par exemple, si nous regardons l\u2019\xE9chantillon de l\u2019indice 2 :"),zn=d(),j(we.$$.fragment),Ds=d(),j(ut.$$.fragment),Yt=d(),Zt=o("p"),Lo=n("nous pouvons voir que la r\xE9ponse peut effectivement \xEAtre l\u2019une des trois possibilit\xE9s que nous avons vues pr\xE9c\xE9demment."),ha=d(),ce=o("h3"),Ss=o("a"),pt=o("span"),j(dt.$$.fragment),Oo=d(),ct=o("span"),Bo=n("Traitement des donn\xE9es d'entra\xEEnement"),_a=d(),j(fs.$$.fragment),va=d(),Ms=o("p"),Fo=n("Commen\xE7ons par le pr\xE9traitement des donn\xE9es d\u2019entra\xEEnement. La partie la plus difficile est de g\xE9n\xE9rer des \xE9tiquettes pour la r\xE9ponse \xE0 la question, c\u2019est-\xE0-dire les positions de d\xE9but et de fin des "),be=o("em"),Io=n("tokens"),Nn=n(" correspondant \xE0 la r\xE9ponse dans le contexte."),qa=d(),zs=o("p"),Tn=n("Mais ne nous emballons pas. Tout d\u2019abord, \xE0 l\u2019aide d\u2019un "),Ln=o("em"),Vo=n("tokenizer"),On=n(", nous devons convertir le texte d\u2019entr\xE9e en identifiants que le mod\xE8le peut comprendre :"),ba=d(),j(mt.$$.fragment),en=d(),ne=o("p"),Ho=n("Comme mentionn\xE9 pr\xE9c\xE9demment, nous allons "),sn=o("em"),tn=n("finetuner"),Uo=n(" un mod\xE8le BERT, mais vous pouvez utiliser n\u2019importe quel autre type de mod\xE8le tant qu\u2019il a un "),nn=o("em"),ft=n("tokenizer"),ga=n(" rapide impl\xE9ment\xE9. Vous pouvez voir toutes les architectures qui sont livr\xE9es avec un "),Xe=o("em"),Ro=n("tokenizer"),Bn=n(" rapide dans "),ht=o("a"),Qo=n("ce tableau"),xa=n(", et pour v\xE9rifier que l\u2019objet "),hs=o("code"),$a=n("tokenizer"),ae=n(" que vous utilisez est bien soutenu par \u{1F917} "),Fn=o("em"),In=n("Tokenizers"),Go=n(" vous pouvez regarder son attribut "),Vn=o("code"),Hn=n("is_fast"),Jo=n(" :"),ja=d(),j(_s.$$.fragment),wa=d(),j(_t.$$.fragment),an=d(),Ke=o("p"),Wo=n("Nous pouvons transmettre \xE0 notre "),vt=o("em"),Xo=n("tokenizer"),Ko=n(" la question et le contexte ensemble. Il ins\xE9rera correctement les "),qt=o("em"),Yo=n("tokens"),Zo=n(" sp\xE9ciaux pour former une phrase comme celle-ci :"),on=d(),j(bt.$$.fragment),Ea=d(),gt=o("p"),Ye=n("V\xE9rifions \xE0 nouveau :"),ka=d(),j(vs.$$.fragment),ya=d(),j(xt.$$.fragment),Ns=d(),De=o("p"),el=n("Les \xE9tiquettes sont l\u2019index des "),Un=o("em"),Ca=n("tokens"),m=n(" de d\xE9but et de fin de la r\xE9ponse. Le mod\xE8le sera charg\xE9 de pr\xE9dire dans l\u2019entr\xE9e un logit de d\xE9but et de fin par "),B=o("em"),ir=n("token"),Pa=n(", les \xE9tiquettes th\xE9oriques \xE9tant les suivantes :"),sl=d(),Ts=o("div"),ln=o("img"),ur=d(),rn=o("img"),nl=d(),qs=o("p"),pr=n("Dans ce cas, le contexte n\u2019est pas trop long, mais certains des exemples du jeu de donn\xE9es ont des contextes tr\xE8s longs qui d\xE9passeront la longueur maximale que nous avons fix\xE9e (qui est de 384 dans ce cas). Comme nous l\u2019avons vu dans le "),ge=o("a"),dr=n("chapitre 6"),cr=n(" lorsque nous avons explor\xE9 le pipeline de "),Aa=o("code"),mr=n("question-answering"),fr=n(", nous allons traiter les contextes longs en cr\xE9ant plusieurs caract\xE9ristiques d\u2019entra\xEEnement \xE0 partir d\u2019un \xE9chantillon de notre jeu de donn\xE9es et avec une fen\xEAtre glissante entre eux."),Qn=d(),$t=o("p"),Da=n("Pour voir comment cela fonctionne sur notre exemple, nous pouvons limiter la longueur \xE0 100 et utiliser une fen\xEAtre glissante de 50 "),Sa=o("em"),fe=n("tokens"),hr=n(". Pour rappel, nous utilisons :"),al=d(),Be=o("ul"),Gn=o("li"),Ma=o("code"),_r=n("max_length"),vr=n(" pour d\xE9finir la longueur maximale (ici 100)"),un=d(),Jn=o("li"),za=o("code"),Se=n('truncation="only_second"'),qr=n(" pour tronquer le contexte (qui est en deuxi\xE8me position) quand la question avec son contexte est trop longue"),br=d(),jt=o("li"),Na=o("code"),gr=n("stride"),xr=n(" pour fixer le nombre de "),Ls=o("em"),$r=n("tokens"),jr=n(" se chevauchant entre deux morceaux successifs (ici 50)"),Ta=d(),bs=o("li"),La=o("code"),wr=n("return_overflowing_tokens=True"),Er=n(" pour indiquer au "),Os=o("em"),Oa=n("tokenizer"),kr=n(" que l\u2019on veut les "),Ze=o("em"),yr=n("tokens"),Cr=n(" qui d\xE9bordent"),ol=d(),j(Ee.$$.fragment),ll=d(),j(pn.$$.fragment),rl=d(),xe=o("p"),Pr=n("Comme nous pouvons le voir, notre exemple a \xE9t\xE9 divis\xE9 en quatre entr\xE9es, chacune d\u2019entre elles contenant la question et une partie du contexte. Notez que la r\xE9ponse \xE0 la question (\xAB Bernadette Soubirous \xBB) n\u2019appara\xEEt que dans la troisi\xE8me et la derni\xE8re entr\xE9e. Donc en traitant les longs contextes de cette fa\xE7on, nous allons cr\xE9er quelques exemples d\u2019entra\xEEnement o\xF9 la r\xE9ponse n\u2019est pas incluse dans le contexte. Pour ces exemples, les \xE9tiquettes seront "),dn=o("code"),Ar=n("start_position = end_position = 0"),he=n(" (donc nous pr\xE9disons le "),Ba=o("em"),Dr=n("token"),Sr=d(),Fa=o("code"),Mr=n("[CLS]"),zr=n("). Nous d\xE9finirons \xE9galement ces \xE9tiquettes dans le cas malheureux o\xF9 la r\xE9ponse a \xE9t\xE9 tronqu\xE9e de sorte que nous n\u2019avons que le d\xE9but (ou la fin) de celle-ci. Pour les exemples o\xF9 la r\xE9ponse est enti\xE8rement dans le contexte, les \xE9tiquettes seront l\u2019index du "),Ia=o("em"),cn=n("token"),Nr=n(" o\xF9 la r\xE9ponse commence et l\u2019index du "),Va=o("em"),Tr=n("token"),Pc=n(" o\xF9 la r\xE9ponse se termine."),hp=d(),Me=o("p"),Ac=n("Le jeu de donn\xE9es nous fournit le caract\xE8re de d\xE9but de la r\xE9ponse dans le contexte, et en ajoutant la longueur de la r\xE9ponse, nous pouvons trouver le caract\xE8re de fin dans le contexte. Pour faire correspondre ces indices aux "),Di=o("em"),Dc=n("tokens"),Sc=n(", nous devrons utiliser les correspondances "),Si=o("em"),Mc=n("offset"),zc=n(" que nous avons \xE9tudi\xE9s au "),Lr=o("a"),Nc=n("chapitre 6"),Tc=n(". Nous pouvons faire en sorte que notre "),Mi=o("em"),Lc=n("tokenizer"),Oc=n(" renvoie ces index en passant "),zi=o("code"),Bc=n("return_offsets_mapping=True"),Fc=n(" :"),_p=d(),j(il.$$.fragment),vp=d(),j(ul.$$.fragment),qp=d(),ze=o("p"),Ic=n("Comme nous pouvons le voir, nous r\xE9cup\xE9rons les identifiants d\u2019entr\xE9e, les "),Ni=o("em"),Vc=n("tokens"),Hc=n(" de type identifiant, le masque d\u2019attention, ainsi que la correspondance "),Ti=o("em"),Uc=n("offset"),Rc=n(" dont nous avions besoin et une cl\xE9 suppl\xE9mentaire, "),Li=o("code"),Qc=n("overflow_to_sample_mapping"),Gc=n(". La valeur correspondante nous sera utile lorsque nous tokeniserons plusieurs textes en m\xEAme temps (ce que nous devrions faire pour b\xE9n\xE9ficier du fait que notre "),Oi=o("em"),Jc=n("tokenizer"),Wc=n(" est en Rust). Puisqu\u2019un \xE9chantillon peut donner plusieurs caract\xE9ristiques, il fait correspondre chaque caract\xE9ristique \xE0 l\u2019exemple d\u2019o\xF9 elle provient. Parce qu\u2019ici nous avons seulement tokenis\xE9 un exemple, nous obtenons une liste de "),Bi=o("code"),Xc=n("0"),Kc=n(" :"),bp=d(),j(pl.$$.fragment),gp=d(),j(dl.$$.fragment),xp=d(),Or=o("p"),Yc=n("Mais si nous tokenisons davantage d\u2019exemples, cela deviendra plus utile :"),$p=d(),j(cl.$$.fragment),jp=d(),j(ml.$$.fragment),wp=d(),Br=o("p"),Zc=n("Comme nous pouvons le voir, les trois premiers exemples (aux indices 2, 3 et 4 de l\u2019ensemble d\u2019entra\xEEnement) ont chacun donn\xE9 quatre caract\xE9ristiques et le dernier exemple (\xE0 l\u2019indice 5 de l\u2019ensemble d\u2019entra\xEEnement) a donn\xE9 7 caract\xE9ristiques."),Ep=d(),Fr=o("p"),em=n("Ces informations seront utiles pour associer chaque caract\xE9ristique obtenue \xE0 son \xE9tiquette correspondante. Comme mentionn\xE9 pr\xE9c\xE9demment, ces \xE9tiquettes sont :"),kp=d(),Ha=o("ul"),Ir=o("li"),Fi=o("code"),sm=n("(0, 0)"),tm=n(" si la r\xE9ponse n\u2019est pas dans l\u2019espace correspondant du contexte."),nm=d(),es=o("li"),Ii=o("code"),am=n("(start_position, end_position)"),om=n(" si la r\xE9ponse est dans l\u2019espace correspondant du contexte, avec "),Vi=o("code"),lm=n("start_position"),rm=n(" \xE9tant l\u2019index du "),Hi=o("em"),im=n("token"),um=n(" (dans les identifiants d\u2019entr\xE9e) au d\xE9but de la r\xE9ponse et "),Ui=o("code"),pm=n("end_position"),dm=n(" \xE9tant l\u2019index du "),Ri=o("em"),cm=n("token"),mm=n(" (dans les identifiants d\u2019entr\xE9e) o\xF9 la r\xE9ponse se termine."),yp=d(),Ne=o("p"),fm=n("Pour d\xE9terminer ce qui est le cas et, le cas \xE9ch\xE9ant, les positions des "),Qi=o("em"),hm=n("tokens"),_m=n(", nous trouvons d\u2019abord les indices qui commencent et finissent le contexte dans les identifiants d\u2019entr\xE9e. Nous pourrions utiliser les "),Gi=o("em"),vm=n("tokens"),qm=n(" de type identifiants pour le faire, mais puisque ceux-ci n\u2019existent pas n\xE9cessairement pour tous les mod\xE8les (DistilBERT ne les requiert pas par exemple), nous allons plut\xF4t utiliser la m\xE9thode "),Ji=o("code"),bm=n("sequence_ids()"),gm=n(" du "),Wi=o("code"),xm=n("BatchEncoding"),$m=n(" que notre "),Xi=o("em"),jm=n("tokenizer"),wm=n(" retourne."),Cp=d(),Te=o("p"),Em=n("Une fois que nous avons ces indices de "),Ki=o("em"),km=n("tokens"),ym=n(", nous regardons les "),Yi=o("em"),Cm=n("offsets"),Pm=n(" correspondants, qui sont des "),Zi=o("em"),Am=n("tuples"),Dm=n(" de deux entiers repr\xE9sentant l\u2019\xE9tendue des caract\xE8res dans le contexte original. Nous pouvons ainsi d\xE9tecter si le morceau de contexte dans cette fonctionnalit\xE9 commence apr\xE8s la r\xE9ponse ou se termine avant que la r\xE9ponse ne commence (dans ce cas, l\u2019\xE9tiquette est "),eu=o("code"),Sm=n("(0, 0)"),Mm=n("). Si ce n\u2019est pas le cas, nous bouclons pour trouver le premier et le dernier "),su=o("em"),zm=n("token"),Nm=n(" de la r\xE9ponse :"),Pp=d(),j(fl.$$.fragment),Ap=d(),j(hl.$$.fragment),Dp=d(),mn=o("p"),Tm=n("Jetons un coup d\u2019\u0153il  \xE0 quelques r\xE9sultats pour v\xE9rifier que notre approche est correcte. Pour la premi\xE8re caract\xE9ristique, nous trouvons "),tu=o("code"),Lm=n("(83, 85)"),Om=n(" comme \xE9tiquettes. Comparons alors la r\xE9ponse th\xE9orique avec l\u2019\xE9tendue d\xE9cod\xE9e des "),nu=o("em"),Bm=n("tokens"),Fm=n(" de 83 \xE0 85 (inclus) :"),Sp=d(),j(_l.$$.fragment),Mp=d(),j(vl.$$.fragment),zp=d(),Ua=o("p"),Im=n("Cela correspond ! Maintenant v\xE9rifions l\u2019index 4, o\xF9 nous avons mis les \xE9tiquettes \xE0 "),au=o("code"),Vm=n("(0, 0)"),Hm=n(", signifiant que la r\xE9ponse n\u2019est pas dans le morceau de contexte de cette caract\xE9ristique :"),Np=d(),j(ql.$$.fragment),Tp=d(),j(bl.$$.fragment),Lp=d(),Vr=o("p"),Um=n("En effet, nous ne voyons pas la r\xE9ponse dans le contexte."),Op=d(),j(Ra.$$.fragment),Bp=d(),Hr=o("p"),Rm=n("Maintenant que nous avons vu \xE9tape par \xE9tape comment pr\xE9traiter nos donn\xE9es d\u2019entra\xEEnement, nous pouvons les regrouper dans une fonction que nous appliquerons \xE0 l\u2019ensemble des donn\xE9es d\u2019entra\xEEnement. Nous allons rembourrer chaque caract\xE9ristique \xE0 la longueur maximale que nous avons d\xE9finie, car la plupart des contextes seront longs (et les \xE9chantillons correspondants seront divis\xE9s en plusieurs caract\xE9ristiques). Il n\u2019y a donc pas de r\xE9el avantage \xE0 appliquer un rembourrage dynamique ici :"),Fp=d(),j(gl.$$.fragment),Ip=d(),Ur=o("p"),Qm=n("Notez que nous avons d\xE9fini deux constantes pour d\xE9terminer la longueur maximale utilis\xE9e ainsi que la longueur de la fen\xEAtre glissante, et que nous avons ajout\xE9 un petit nettoyage avant la tok\xE9nisation : certaines des questions dans SQuAD ont des espaces suppl\xE9mentaires au d\xE9but et \xE0 la fin qui n\u2019ajoutent rien (et prennent de la place lors de la tok\xE9nisation si vous utilisez un mod\xE8le comme RoBERTa), donc nous avons supprim\xE9 ces espaces suppl\xE9mentaires."),Vp=d(),fn=o("p"),Gm=n("Pour appliquer cette fonction \xE0 l\u2019ensemble de l\u2019entra\xEEnement, nous utilisons la m\xE9thode "),ou=o("code"),Jm=n("Dataset.map()"),Wm=n(" avec le flag "),lu=o("code"),Xm=n("batched=True"),Km=n(". C\u2019est n\xE9cessaire ici car nous changeons la longueur du jeu de donn\xE9es (puisqu\u2019un exemple peut donner plusieurs caract\xE9ristiques d\u2019entra\xEEnement) :"),Hp=d(),j(xl.$$.fragment),Up=d(),j($l.$$.fragment),Rp=d(),Rr=o("p"),Ym=n("Comme nous pouvons le voir, le pr\xE9traitement a ajout\xE9 environ 1 000 caract\xE9ristiques. Notre ensemble d\u2019entra\xEEnement est maintenant pr\xEAt \xE0 \xEAtre utilis\xE9. Passons au pr\xE9traitement de l\u2019ensemble de validation !"),Qp=d(),Wn=o("h3"),Qa=o("a"),ru=o("span"),j(jl.$$.fragment),Zm=d(),iu=o("span"),ef=n("Traitement des donn\xE9es de validation"),Gp=d(),Ga=o("p"),sf=n("Le pr\xE9traitement des donn\xE9es de validation sera l\xE9g\xE8rement plus facile car nous n\u2019avons pas besoin de g\xE9n\xE9rer des \xE9tiquettes (sauf si nous voulons calculer une perte de validation, mais elle ne nous aidera pas vraiment \xE0 comprendre la qualit\xE9 du mod\xE8le). Le r\xE9el plaisir sera d\u2019interpr\xE9ter les pr\xE9dictions du mod\xE8le dans des \xE9tendues du contexte original. Pour cela, il nous suffit de stocker les correspondances d\u2019"),uu=o("em"),tf=n("offset"),nf=n(" et un moyen de faire correspondre chaque caract\xE9ristique cr\xE9\xE9e \xE0 l\u2019exemple original dont elle provient. Puisqu\u2019il y a une colonne identifiant dans le jeu de donn\xE9es original, nous l\u2019utiliserons."),Jp=d(),ke=o("p"),af=n("La seule chose que nous allons ajouter ici est un petit nettoyage des correspondances d\u2019"),pu=o("em"),of=n("offset"),lf=n(". Elles contiendront les "),du=o("em"),rf=n("offsets"),uf=n(" pour la question et le contexte, mais une fois que nous serons \xE0 la phase de post-traitement, nous n\u2019aurons aucun moyen de savoir quelle partie des identifiants d\u2019entr\xE9e correspondait au contexte et quelle partie \xE9tait la question (la m\xE9thode "),cu=o("code"),pf=n("sequence_ids()"),df=n(" que nous avons utilis\xE9e n\u2019est disponible que pour la sortie du "),mu=o("em"),cf=n("tokenizer"),mf=n("). Donc, nous allons mettre les "),fu=o("em"),ff=n("offsets"),hf=n(" correspondant \xE0 la question \xE0 "),hu=o("code"),_f=n("None"),vf=n(" :"),Wp=d(),j(wl.$$.fragment),Xp=d(),Qr=o("p"),qf=n("Nous pouvons appliquer cette fonction sur l\u2019ensemble de validation comme pr\xE9c\xE9demment :"),Kp=d(),j(El.$$.fragment),Yp=d(),j(kl.$$.fragment),Zp=d(),Gr=o("p"),bf=n("Dans ce cas, nous n\u2019avons ajout\xE9 que quelques centaines d\u2019\xE9chantillons, il semble donc que les contextes dans l\u2019ensemble de validation soient un peu plus courts."),ed=d(),Jr=o("p"),gf=n("Maintenant que nous avons pr\xE9trait\xE9 toutes les donn\xE9es, nous pouvons passer \xE0 l\u2019entra\xEEnement."),sd=d(),Et.c(),Wr=d(),Xn=o("h3"),Ja=o("a"),_u=o("span"),j(yl.$$.fragment),xf=d(),vu=o("span"),$f=n("Post-traitement"),td=d(),yt.c(),Xr=d(),hn=o("p"),jf=n("Le mod\xE8le produira des logits pour les positions de d\xE9but et de fin de la r\xE9ponse dans les identifiants d\u2019entr\xE9e, comme nous l\u2019avons vu lors de notre exploration du pipeline de "),qu=o("code"),wf=n("question-answering"),Ef=d(),Kr=o("a"),kf=n("au chapitre 6"),yf=n(". L\u2019\xE9tape de post-traitement sera similaire \xE0 ce que nous avons fait \xE0 ce chapitre l\xE0. Voici un rapide rappel des actions que nous avons prises :"),nd=d(),Bs=o("ul"),Cl=o("li"),Cf=n("nous avons masqu\xE9 les logits de d\xE9but et de fin correspondant aux "),bu=o("em"),Pf=n("tokens"),Af=n(" en dehors du contexte,"),Df=d(),gu=o("li"),Sf=n("nous avons ensuite converti les logits de d\xE9but et de fin en probabilit\xE9s en utilisant une fonction SoftMax,"),Mf=d(),Pl=o("li"),zf=n("nous avons attribu\xE9 un score \xE0 chaque paire "),xu=o("code"),Nf=n("(start_token, end_token)"),Tf=n(" en prenant le produit des deux probabilit\xE9s correspondantes,"),Lf=d(),Kn=o("li"),Of=n("nous avons cherch\xE9 la paire avec le score maximum qui donnait une r\xE9ponse valide (par exemple, un "),$u=o("code"),Bf=n("start_token"),Ff=n(" inf\xE9rieur au "),ju=o("code"),If=n("end_token"),Vf=n(")."),ad=d(),ss=o("p"),Hf=n("Ici, nous allons modifier l\xE9g\xE8rement ce processus car nous n\u2019avons pas besoin de calculer les scores r\xE9els (juste la r\xE9ponse pr\xE9dite). Cela signifie que nous pouvons sauter l\u2019\xE9tape de la SoftMax. Pour aller plus vite, nous ne donnerons pas non plus un score \xE0 toutes les paires "),wu=o("code"),Uf=n("(start_token, end_token)"),Rf=n(" possibles, mais seulement celles correspondant aux "),Eu=o("code"),Qf=n("n_best"),Gf=n(" logits les plus \xE9lev\xE9s (avec "),ku=o("code"),Jf=n("n_best=20"),Wf=n("). Puisque nous sautons la SoftMax, les scores seront des scores logi, et seront obtenus en prenant la somme des logits de d\xE9but et de fin (au lieu du produit, \xE0 cause de la r\xE8gle "),od=new $g,ld=n(")."),rd=d(),Fs=o("p"),Xf=n("Pour d\xE9montrer tout cela, nous aurons besoin d\u2019un certain type de pr\xE9dictions. Puisque nous n\u2019avons pas encore entra\xEEn\xE9 notre mod\xE8le, nous allons utiliser le mod\xE8le par d\xE9faut du pipeline de "),yu=o("code"),Kf=n("question-answering"),Yf=n(" pour g\xE9n\xE9rer quelques pr\xE9dictions sur une petite partie de l\u2019ensemble de validation. Nous pouvons utiliser la m\xEAme fonction de traitement que pr\xE9c\xE9demment car elle repose sur la constante globale "),Cu=o("code"),Zf=n("tokenizer"),eh=n(", nous devons juste changer cet objet par le "),Pu=o("em"),sh=n("tokenizer"),th=n(" du mod\xE8le que nous voulons utiliser temporairement :"),id=d(),j(Al.$$.fragment),ud=d(),Wa=o("p"),nh=n("Maintenant que le pr\xE9traitement est termin\xE9, nous changeons le "),Au=o("em"),ah=n("tokenizer"),oh=n(" pour celui que nous avons choisi \xE0 l\u2019origine :"),pd=d(),j(Dl.$$.fragment),dd=d(),Xa=o("p"),lh=n("Nous supprimons ensuite les colonnes de notre "),Du=o("code"),rh=n("eval_set"),ih=n(" qui ne sont pas attendues par le mod\xE8le. Nous construisons un batch avec tout de ce petit ensemble de validation et le passons au mod\xE8le. Si un GPU est disponible, nous l\u2019utilisons pour aller plus vite :"),cd=d(),Pt.c(),Yr=d(),ts=o("p"),uh=n("Maintenant, nous devons trouver la r\xE9ponse pr\xE9dite pour chaque exemple dans notre "),Su=o("code"),ph=n("small_eval_set"),dh=n(". Un exemple peut avoir \xE9t\xE9 divis\xE9 en plusieurs caract\xE9ristiques dans "),Mu=o("code"),ch=n("eval_set"),mh=n(", donc la premi\xE8re \xE9tape est de faire correspondre chaque exemple dans "),zu=o("code"),fh=n("small_eval_set"),hh=n(" aux caract\xE9ristiques correspondantes dans "),Nu=o("code"),_h=n("eval_set"),vh=n(" :"),md=d(),j(Sl.$$.fragment),fd=d(),Ka=o("p"),qh=n("Avec cela, nous pouvons vraiment nous mettre au travail en bouclant tous les exemples et, pour chaque exemple, toutes les caract\xE9ristiques associ\xE9es. Comme nous l\u2019avons dit pr\xE9c\xE9demment, nous allons regarder les scores logit pour les "),Tu=o("code"),bh=n("n_best"),gh=n(" logits de d\xE9but et logits de fin, en excluant les positions qui donnent :"),hd=d(),_n=o("ul"),Lu=o("li"),xh=n("une r\xE9ponse qui ne serait pas dans le contexte"),$h=d(),Ou=o("li"),jh=n("une r\xE9ponse avec une longueur n\xE9gative"),wh=d(),Ml=o("li"),Eh=n("une r\xE9ponse qui est trop longue (nous limitons les possibilit\xE9s \xE0 "),Bu=o("code"),kh=n("max_answer_length=30"),yh=n(")"),_d=d(),Zr=o("p"),Ch=n("Une fois que nous avons toutes les r\xE9ponses possibles not\xE9es pour un exemple, nous choisissons simplement celle qui a le meilleur score logit :"),vd=d(),j(zl.$$.fragment),qd=d(),Ya=o("p"),Ph=n("Le format final des r\xE9ponses pr\xE9dites est celui qui sera attendu par la m\xE9trique que nous allons utiliser. Comme d\u2019habitude, nous pouvons la charger \xE0 l\u2019aide de la biblioth\xE8que \u{1F917} "),Fu=o("em"),Ah=n("Datasets"),Dh=n(" :"),bd=d(),j(Nl.$$.fragment),gd=d(),ei=o("p"),Sh=n("Cette m\xE9trique attend les r\xE9ponses pr\xE9dites dans le format que nous avons vu ci-dessus (une liste de dictionnaires avec une cl\xE9 pour l\u2019identifiant de l\u2019exemple et une cl\xE9 pour le texte pr\xE9dit) et les r\xE9ponses th\xE9oriques dans le format ci-dessous (une liste de dictionnaires avec une cl\xE9 pour l\u2019identifiant de l\u2019exemple et une cl\xE9 pour les r\xE9ponses possibles) :"),xd=d(),j(Tl.$$.fragment),$d=d(),si=o("p"),Mh=n("Nous pouvons maintenant v\xE9rifier que nous obtenons des r\xE9sultats raisonnables en examinant le premier \xE9l\xE9ment des deux listes :"),jd=d(),j(Ll.$$.fragment),wd=d(),j(Ol.$$.fragment),Ed=d(),ti=o("p"),zh=n("Pas trop mal ! Voyons maintenant le score que la m\xE9trique nous donne :"),kd=d(),j(Bl.$$.fragment),yd=d(),j(Fl.$$.fragment),Cd=d(),vn=o("p"),Nh=n("Encore une fois, c\u2019est plut\xF4t bon si l\u2019on consid\xE8re que, d\u2019apr\xE8s "),Il=o("a"),Th=n("le papier"),Lh=n(" de DistilBERT, "),Iu=o("em"),Oh=n("finetun\xE9"),Bh=n(" sur SQuAD, ce mod\xE8le obtient 79,1 et 86,9 pour ces scores sur l\u2019ensemble du jeu de donn\xE9es."),Pd=d(),ea.c(),ni=d(),j(Vl.$$.fragment),Ad=d(),ai=o("p"),Fh=n("Nous pouvons v\xE9rifier que cela fonctionne sur nos pr\xE9dictions :"),Dd=d(),j(Hl.$$.fragment),Sd=d(),j(Ul.$$.fragment),Md=d(),Za=o("p"),Ih=n("C\u2019est bien ! Maintenant, utilisons ceci pour "),Vu=o("em"),Vh=n("finetuner"),Hh=n(" notre mod\xE8le."),zd=d(),Yn=o("h3"),eo=o("a"),Hu=o("span"),j(Rl.$$.fragment),Uh=d(),oi=o("span"),Uu=o("i"),Rh=n("Finetuning"),Qh=n(" du mod\xE8le"),Nd=d(),Dt.c(),li=d(),so=o("p"),Gh=n("Comme d\u2019habitude, nous recevons un avertissement indiquant que certains poids ne sont pas utilis\xE9s (ceux de la t\xEAte de pr\xE9-entra\xEEnement) et que d\u2019autres sont initialis\xE9s de mani\xE8re al\xE9atoire (ceux de la t\xEAte de r\xE9ponse aux questions). Vous devriez \xEAtre habitu\xE9 \xE0 cela maintenant, mais cela signifie que ce mod\xE8le n\u2019est pas encore pr\xEAt \xE0 \xEAtre utilis\xE9 et qu\u2019il a besoin d\u2019\xEAtre "),Ru=o("em"),Jh=n("finetun\xE9"),Wh=n(". Une bonne chose que nous soyons sur le point de le faire !"),Td=d(),Is=o("p"),Xh=n("Pour pouvoir pousser notre mod\xE8le vers le "),Qu=o("em"),Kh=n("Hub"),Yh=n(", nous devons nous connecter \xE0 Hugging Face. Si vous ex\xE9cutez ce code dans un "),Gu=o("em"),Zh=n("notebook"),e_=n(", vous pouvez le faire avec la fonction utilitaire suivante, qui affiche un "),Ju=o("em"),s_=n("widget"),t_=n(" o\xF9 vous pouvez entrer vos identifiants de connexion :"),Ld=d(),j(Ql.$$.fragment),Od=d(),to=o("p"),n_=n("Si vous ne travaillez pas dans un "),Wu=o("em"),a_=n("notebook"),o_=n(", tapez simplement la ligne suivante dans votre terminal :"),Bd=d(),j(Gl.$$.fragment),Fd=d(),Mt.c(),ri=d(),ns=o("p"),l_=n("Par d\xE9faut, le d\xE9p\xF4t utilis\xE9 sera dans votre espace et nomm\xE9 apr\xE8s le r\xE9pertoire de sortie que vous avez d\xE9fini. Donc dans notre cas il sera dans "),Xu=o("code"),r_=n('"sgugger/bert-finetuned-squad"'),i_=n(". Nous pouvons passer outre en passant un "),Ku=o("code"),u_=n("hub_model_id"),p_=n(", par exemple, pour pousser le mod\xE8le dans l\u2019organisation "),Yu=o("code"),d_=n("huggingface_course"),c_=n(" nous avons utilis\xE9 "),Zu=o("code"),m_=n('hub_model_id= "huggingface_course/bert-finetuned-squad"'),f_=n(" (qui est le mod\xE8le que nous avons li\xE9 au d\xE9but de cette section)."),Id=d(),Nt.c(),ii=d(),qn=o("p"),h_=n("Notez que pendant l\u2019entra\xEEnement, chaque fois que le mod\xE8le est sauvegard\xE9 (ici, \xE0 chaque \xE9poque), il est t\xE9l\xE9charg\xE9 sur le "),ep=o("em"),__=n("Hub"),v_=n(" en arri\xE8re-plan. Ainsi, vous pourrez reprendre votre entra\xEEnement sur une autre machine si n\xE9cessaire. L\u2019ensemble de l\u2019entra\xEEnement prend un certain temps (un peu plus d\u2019une heure sur une Titan RTX), vous pouvez donc prendre un caf\xE9 ou relire les parties du cours qui vous ont sembl\xE9 plus difficiles pendant qu\u2019il se d\xE9roule. Notez \xE9galement que d\xE8s que la premi\xE8re \xE9poque est termin\xE9e, vous verrez des poids t\xE9l\xE9charg\xE9s sur le "),sp=o("em"),q_=n("Hub"),b_=n(" et vous pourrez commencer \xE0 jouer avec votre mod\xE8le sur sa page."),Vd=d(),Lt.c(),ui=d(),j(Jl.$$.fragment),Hd=d(),pi=o("p"),g_=n("Super ! \xC0 titre de comparaison, les scores indiqu\xE9s dans l\u2019article de BERT pour ce t\xE2che sont de 80,8 et 88,5. Donc nous sommes exactement l\xE0 o\xF9 nous devrions \xEAtre."),Ud=d(),$e&&$e.c(),di=d(),Vs=o("p"),x_=n("\xC0 ce stade, vous pouvez utiliser le "),tp=o("em"),$_=n("widget"),j_=n(" d\u2019inf\xE9rence sur le "),np=o("em"),w_=n("Hub"),E_=n(" du mod\xE8le pour tester le mod\xE8le et le partager avec vos amis, votre famille et vos animaux pr\xE9f\xE9r\xE9s. Vous avez r\xE9ussi \xE0 "),ap=o("em"),k_=n("finetuner"),y_=n(" un mod\xE8le sur une t\xE2che de r\xE9ponse \xE0 une question. F\xE9licitations !"),Rd=d(),j(no.$$.fragment),Qd=d(),je&&je.c(),ci=d(),Zn=o("h3"),ao=o("a"),op=o("span"),j(Wl.$$.fragment),C_=d(),mi=o("span"),P_=n("Utilisation du mod\xE8le "),lp=o("i"),A_=n("finetun\xE9"),Gd=d(),as=o("p"),D_=n("Nous vous avons d\xE9j\xE0 montr\xE9 comment vous pouvez utiliser le mod\xE8le que nous avons "),rp=o("em"),S_=n("finetun\xE9"),M_=n(" sur le "),ip=o("em"),z_=n("Hub"),N_=n(" avec le "),up=o("em"),T_=n("widget"),L_=n(" d\u2019inf\xE9rence. Pour l\u2019utiliser localement dans un "),pp=o("code"),O_=n("pipeline"),B_=n(", il suffit de sp\xE9cifier l\u2019identifiant du mod\xE8le :"),Jd=d(),j(Xl.$$.fragment),Wd=d(),j(Kl.$$.fragment),Xd=d(),fi=o("p"),F_=n("Super ! Notre mod\xE8le fonctionne aussi bien que le mod\xE8le par d\xE9faut pour ce pipeline !"),this.h()},l(e){const u=jg('[data-svelte="svelte-1phssyn"]',document.head);p=l(u,"META",{name:!0,content:!0}),u.forEach(t),q=c(e),w(f.$$.fragment,e),y=c(e),D=l(e,"H1",{class:!0});var lr=r(D);b=l(lr,"A",{id:!0,class:!0,href:!0});var hi=r(b);g=l(hi,"SPAN",{});var dp=r(g);w(x.$$.fragment,dp),dp.forEach(t),hi.forEach(t),h=c(lr),S=l(lr,"SPAN",{});var cp=r(S);$=a(cp,"R\xE9ponse aux questions"),cp.forEach(t),lr.forEach(t),A=c(e),I.l(e),z=c(e),P=l(e,"P",{});var oo=r(P);V=a(oo,"Il est temps de s\u2019int\xE9resser \xE0 la r\xE9ponse aux questions ! Cette t\xE2che peut prendre plusieurs formes mais celle sur laquelle nous allons nous concentrer dans cette section est appel\xE9e r\xE9ponse aux questions "),T=l(oo,"EM",{});var _i=r(T);O=a(_i,"extractives"),_i.forEach(t),L=a(oo,". Il s\u2019agit de poser des questions sur un document et d\u2019identifier les r\xE9ponses sous forme de \xAB d\u2019\xE9tendue de texte \xBB dans le document lui-m\xEAme."),oo.forEach(t),U=c(e),w(Q.$$.fragment,e),W=c(e),H=l(e,"P",{});var Hs=r(H);G=a(Hs,"Nous allons "),ee=l(Hs,"EM",{});var vi=r(ee);Z=a(vi,"finetuner"),vi.forEach(t),F=a(Hs," un mod\xE8le BERT sur le "),X=l(Hs,"A",{href:!0,rel:!0});var qi=r(X);le=a(qi,"jeu de donn\xE9es SQuAD"),qi.forEach(t),se=a(Hs,", qui consiste en des questions pos\xE9es par des "),K=l(Hs,"EM",{});var bi=r(K);re=a(bi,"crowdworkers"),bi.forEach(t),Ce=a(Hs," sur un ensemble d\u2019articles de Wikipedia. Cela nous donnera un mod\xE8le capable de calculer des pr\xE9dictions comme celui-ci :"),Hs.forEach(t),ye=c(e),ie=l(e,"IFRAME",{src:!0,frameborder:!0,height:!0,title:!0,class:!0,allow:!0,sandbox:!0}),r(ie).forEach(t),Fe=c(e),ue=l(e,"IFRAME",{src:!0,frameborder:!0,height:!0,title:!0,class:!0,allow:!0,sandbox:!0}),r(ue).forEach(t),rs=c(e),J=l(e,"P",{});var sa=r(J);Y=a(sa,"Il s\u2019agit d\u2019une pr\xE9sentation du mod\xE8le qui a \xE9t\xE9 entra\xEEn\xE9 \xE0 l\u2019aide du code pr\xE9sent\xE9 dans cette section et qui a ensuit\xE9 \xE9t\xE9 t\xE9l\xE9charg\xE9 sur le "),js=l(sa,"EM",{});var mp=r(js);Bt=a(mp,"Hub"),mp.forEach(t),ws=a(sa,". Vous pouvez le trouver "),Ie=l(sa,"A",{href:!0,rel:!0});var uv=r(Ie);Ve=a(uv,"ici"),uv.forEach(t),sa.forEach(t),Es=c(e),w(_e.$$.fragment,e),He=c(e),pe=l(e,"H2",{class:!0});var Zd=r(pe);ve=l(Zd,"A",{id:!0,class:!0,href:!0});var pv=r(ve);Ue=l(pv,"SPAN",{});var dv=r(Ue);w(Re.$$.fragment,dv),dv.forEach(t),pv.forEach(t),mo=c(Zd),Ft=l(Zd,"SPAN",{});var cv=r(Ft);Ws=a(cv,"Pr\xE9paration des donn\xE9es"),cv.forEach(t),Zd.forEach(t),En=c(e),qe=l(e,"P",{});var gi=r(qe);fo=a(gi,"Le jeu de donn\xE9es le plus utilis\xE9 comme r\xE9f\xE9rence acad\xE9mique pour la r\xE9ponse extractive aux questions est "),is=l(gi,"A",{href:!0,rel:!0});var mv=r(is);ho=a(mv,"SQuAD"),mv.forEach(t),_o=a(gi,". C\u2019est donc celui que nous utiliserons ici. Il existe \xE9galement une version plus difficile "),ks=l(gi,"A",{href:!0,rel:!0});var fv=r(ks);Xs=a(fv,"SQuAD v2"),fv.forEach(t),ta=a(gi,", qui comprend des questions sans r\xE9ponse. Tant que votre propre jeu de donn\xE9es contient une colonne pour les contextes, une colonne pour les questions et une colonne pour les r\xE9ponses, vous devriez \xEAtre en mesure d\u2019adapter les \xE9tapes ci-dessous."),gi.forEach(t),te=c(e),us=l(e,"H3",{class:!0});var ec=r(us);Qe=l(ec,"A",{id:!0,class:!0,href:!0});var hv=r(Qe);kn=l(hv,"SPAN",{});var _v=r(kn);w(Ks.$$.fragment,_v),_v.forEach(t),hv.forEach(t),yn=c(ec),Cn=l(ec,"SPAN",{});var vv=r(Cn);vo=a(vv,"Le jeu de donn\xE9es SQuAD"),vv.forEach(t),ec.forEach(t),It=c(e),ys=l(e,"P",{});var sc=r(ys);qo=a(sc,"Comme d\u2019habitude, nous pouvons t\xE9l\xE9charger et mettre en cache le jeu de donn\xE9es en une seule \xE9tape gr\xE2ce \xE0 "),Ys=l(sc,"CODE",{});var qv=r(Ys);bo=a(qv,"load_dataset()"),qv.forEach(t),go=a(sc," :"),sc.forEach(t),Vt=c(e),w(Zs.$$.fragment,e),na=c(e),Cs=l(e,"P",{});var bv=r(Cs);xo=a(bv,"Nous pouvons jeter un coup d\u2019\u0153il \xE0 cet objet pour en savoir plus sur le jeu de donn\xE9es SQuAD :"),bv.forEach(t),aa=c(e),w(ps.$$.fragment,e),oa=c(e),w(et.$$.fragment,e),Pn=c(e),me=l(e,"P",{});var lo=r(me);la=a(lo,"On dirait que nous avons tout ce dont nous avons besoin avec les champs "),Pe=l(lo,"CODE",{});var gv=r(Pe);$o=a(gv,"context"),gv.forEach(t),An=a(lo,", "),Dn=l(lo,"CODE",{});var xv=r(Dn);jo=a(xv,"question"),xv.forEach(t),Sn=a(lo," et "),Mn=l(lo,"CODE",{});var $v=r(Mn);wo=a($v,"answers"),$v.forEach(t),ra=a(lo,". Affichons-les pour le premier \xE9l\xE9ment de notre ensemble d\u2019entra\xEEnement :"),lo.forEach(t),Ps=c(e),w(As.$$.fragment,e),de=c(e),w(st.$$.fragment,e),Ht=c(e),oe=l(e,"P",{});var os=r(oe);Eo=a(os,"Les champs "),tt=l(os,"CODE",{});var jv=r(tt);ko=a(jv,"context"),jv.forEach(t),yo=a(os," et "),nt=l(os,"CODE",{});var wv=r(nt);Co=a(wv,"question"),wv.forEach(t),Po=a(os," sont tr\xE8s simples \xE0 utiliser. Le champ "),at=l(os,"CODE",{});var Ev=r(at);Ao=a(Ev,"answers"),Ev.forEach(t),Do=a(os," est un peu plus d\xE9licat car il compile un dictionnaire avec deux champs qui sont tous deux des listes. C\u2019est le format qui sera attendu par la m\xE9trique "),ot=l(os,"CODE",{});var kv=r(ot);So=a(kv,"squad"),kv.forEach(t),Mo=a(os," lors de l\u2019\xE9valuation. Si vous utilisez vos propres donn\xE9es, vous n\u2019avez pas n\xE9cessairement besoin de vous soucier de mettre les r\xE9ponses dans le m\xEAme format. Le champ "),Ut=l(os,"CODE",{});var yv=r(Ut);lt=a(yv,"text"),yv.forEach(t),ia=a(os," est assez \xE9vident et le champ "),ds=l(os,"CODE",{});var Cv=r(ds);ua=a(Cv,"answer_start"),Cv.forEach(t),Rt=a(os," contient l\u2019indice du caract\xE8re de d\xE9part de chaque r\xE9ponse dans le contexte."),os.forEach(t),pa=c(e),cs=l(e,"P",{});var tc=r(cs);rt=a(tc,"Pendant l\u2019entra\xEEnement, il n\u2019y a qu\u2019une seule r\xE9ponse possible. Nous pouvons v\xE9rifier cela en utilisant la m\xE9thode "),Qt=l(tc,"CODE",{});var Pv=r(Qt);Ge=a(Pv,"Dataset.filter()"),Pv.forEach(t),zo=a(tc," :"),tc.forEach(t),Gt=c(e),w(it.$$.fragment,e),da=c(e),w(ms.$$.fragment,e),ca=c(e),Jt=l(e,"P",{});var Av=r(Jt);ma=a(Av,"Pour l\u2019\xE9valuation, cependant, il existe plusieurs r\xE9ponses possibles pour chaque \xE9chantillon, qui peuvent \xEAtre identiques ou diff\xE9rentes :"),Av.forEach(t),Je=c(e),w(Ae.$$.fragment,e),Wt=c(e),w(Oe.$$.fragment,e),fa=c(e),We=l(e,"P",{});var nc=r(We);No=a(nc,"Nous ne nous plongerons pas dans le script d\u2019\xE9valuation car tout sera envelopp\xE9 pour nous par une m\xE9trique de \u{1F917} "),Xt=l(nc,"EM",{});var Dv=r(Xt);Kt=a(Dv,"Datasets"),Dv.forEach(t),To=a(nc,". La version courte est que certaines des questions ont plusieurs r\xE9ponses possibles, et ce script va comparer une r\xE9ponse pr\xE9dite \xE0 toutes les r\xE9ponses acceptables et prendre le meilleur score. Par exemple, si nous regardons l\u2019\xE9chantillon de l\u2019indice 2 :"),nc.forEach(t),zn=c(e),w(we.$$.fragment,e),Ds=c(e),w(ut.$$.fragment,e),Yt=c(e),Zt=l(e,"P",{});var Sv=r(Zt);Lo=a(Sv,"nous pouvons voir que la r\xE9ponse peut effectivement \xEAtre l\u2019une des trois possibilit\xE9s que nous avons vues pr\xE9c\xE9demment."),Sv.forEach(t),ha=c(e),ce=l(e,"H3",{class:!0});var ac=r(ce);Ss=l(ac,"A",{id:!0,class:!0,href:!0});var Mv=r(Ss);pt=l(Mv,"SPAN",{});var zv=r(pt);w(dt.$$.fragment,zv),zv.forEach(t),Mv.forEach(t),Oo=c(ac),ct=l(ac,"SPAN",{});var Nv=r(ct);Bo=a(Nv,"Traitement des donn\xE9es d'entra\xEEnement"),Nv.forEach(t),ac.forEach(t),_a=c(e),w(fs.$$.fragment,e),va=c(e),Ms=l(e,"P",{});var oc=r(Ms);Fo=a(oc,"Commen\xE7ons par le pr\xE9traitement des donn\xE9es d\u2019entra\xEEnement. La partie la plus difficile est de g\xE9n\xE9rer des \xE9tiquettes pour la r\xE9ponse \xE0 la question, c\u2019est-\xE0-dire les positions de d\xE9but et de fin des "),be=l(oc,"EM",{});var Tv=r(be);Io=a(Tv,"tokens"),Tv.forEach(t),Nn=a(oc," correspondant \xE0 la r\xE9ponse dans le contexte."),oc.forEach(t),qa=c(e),zs=l(e,"P",{});var lc=r(zs);Tn=a(lc,"Mais ne nous emballons pas. Tout d\u2019abord, \xE0 l\u2019aide d\u2019un "),Ln=l(lc,"EM",{});var Lv=r(Ln);Vo=a(Lv,"tokenizer"),Lv.forEach(t),On=a(lc,", nous devons convertir le texte d\u2019entr\xE9e en identifiants que le mod\xE8le peut comprendre :"),lc.forEach(t),ba=c(e),w(mt.$$.fragment,e),en=c(e),ne=l(e,"P",{});var Le=r(ne);Ho=a(Le,"Comme mentionn\xE9 pr\xE9c\xE9demment, nous allons "),sn=l(Le,"EM",{});var Ov=r(sn);tn=a(Ov,"finetuner"),Ov.forEach(t),Uo=a(Le," un mod\xE8le BERT, mais vous pouvez utiliser n\u2019importe quel autre type de mod\xE8le tant qu\u2019il a un "),nn=l(Le,"EM",{});var Bv=r(nn);ft=a(Bv,"tokenizer"),Bv.forEach(t),ga=a(Le," rapide impl\xE9ment\xE9. Vous pouvez voir toutes les architectures qui sont livr\xE9es avec un "),Xe=l(Le,"EM",{});var Fv=r(Xe);Ro=a(Fv,"tokenizer"),Fv.forEach(t),Bn=a(Le," rapide dans "),ht=l(Le,"A",{href:!0,rel:!0});var Iv=r(ht);Qo=a(Iv,"ce tableau"),Iv.forEach(t),xa=a(Le,", et pour v\xE9rifier que l\u2019objet "),hs=l(Le,"CODE",{});var Vv=r(hs);$a=a(Vv,"tokenizer"),Vv.forEach(t),ae=a(Le," que vous utilisez est bien soutenu par \u{1F917} "),Fn=l(Le,"EM",{});var Hv=r(Fn);In=a(Hv,"Tokenizers"),Hv.forEach(t),Go=a(Le," vous pouvez regarder son attribut "),Vn=l(Le,"CODE",{});var Uv=r(Vn);Hn=a(Uv,"is_fast"),Uv.forEach(t),Jo=a(Le," :"),Le.forEach(t),ja=c(e),w(_s.$$.fragment,e),wa=c(e),w(_t.$$.fragment,e),an=c(e),Ke=l(e,"P",{});var xi=r(Ke);Wo=a(xi,"Nous pouvons transmettre \xE0 notre "),vt=l(xi,"EM",{});var Rv=r(vt);Xo=a(Rv,"tokenizer"),Rv.forEach(t),Ko=a(xi," la question et le contexte ensemble. Il ins\xE9rera correctement les "),qt=l(xi,"EM",{});var Qv=r(qt);Yo=a(Qv,"tokens"),Qv.forEach(t),Zo=a(xi," sp\xE9ciaux pour former une phrase comme celle-ci :"),xi.forEach(t),on=c(e),w(bt.$$.fragment,e),Ea=c(e),gt=l(e,"P",{});var Gv=r(gt);Ye=a(Gv,"V\xE9rifions \xE0 nouveau :"),Gv.forEach(t),ka=c(e),w(vs.$$.fragment,e),ya=c(e),w(xt.$$.fragment,e),Ns=c(e),De=l(e,"P",{});var $i=r(De);el=a($i,"Les \xE9tiquettes sont l\u2019index des "),Un=l($i,"EM",{});var Jv=r(Un);Ca=a(Jv,"tokens"),Jv.forEach(t),m=a($i," de d\xE9but et de fin de la r\xE9ponse. Le mod\xE8le sera charg\xE9 de pr\xE9dire dans l\u2019entr\xE9e un logit de d\xE9but et de fin par "),B=l($i,"EM",{});var Wv=r(B);ir=a(Wv,"token"),Wv.forEach(t),Pa=a($i,", les \xE9tiquettes th\xE9oriques \xE9tant les suivantes :"),$i.forEach(t),sl=c(e),Ts=l(e,"DIV",{class:!0});var rc=r(Ts);ln=l(rc,"IMG",{class:!0,src:!0,alt:!0}),ur=c(rc),rn=l(rc,"IMG",{class:!0,src:!0,alt:!0}),rc.forEach(t),nl=c(e),qs=l(e,"P",{});var ji=r(qs);pr=a(ji,"Dans ce cas, le contexte n\u2019est pas trop long, mais certains des exemples du jeu de donn\xE9es ont des contextes tr\xE8s longs qui d\xE9passeront la longueur maximale que nous avons fix\xE9e (qui est de 384 dans ce cas). Comme nous l\u2019avons vu dans le "),ge=l(ji,"A",{href:!0});var Xv=r(ge);dr=a(Xv,"chapitre 6"),Xv.forEach(t),cr=a(ji," lorsque nous avons explor\xE9 le pipeline de "),Aa=l(ji,"CODE",{});var Kv=r(Aa);mr=a(Kv,"question-answering"),Kv.forEach(t),fr=a(ji,", nous allons traiter les contextes longs en cr\xE9ant plusieurs caract\xE9ristiques d\u2019entra\xEEnement \xE0 partir d\u2019un \xE9chantillon de notre jeu de donn\xE9es et avec une fen\xEAtre glissante entre eux."),ji.forEach(t),Qn=c(e),$t=l(e,"P",{});var ic=r($t);Da=a(ic,"Pour voir comment cela fonctionne sur notre exemple, nous pouvons limiter la longueur \xE0 100 et utiliser une fen\xEAtre glissante de 50 "),Sa=l(ic,"EM",{});var Yv=r(Sa);fe=a(Yv,"tokens"),Yv.forEach(t),hr=a(ic,". Pour rappel, nous utilisons :"),ic.forEach(t),al=c(e),Be=l(e,"UL",{});var ro=r(Be);Gn=l(ro,"LI",{});var I_=r(Gn);Ma=l(I_,"CODE",{});var Zv=r(Ma);_r=a(Zv,"max_length"),Zv.forEach(t),vr=a(I_," pour d\xE9finir la longueur maximale (ici 100)"),I_.forEach(t),un=c(ro),Jn=l(ro,"LI",{});var V_=r(Jn);za=l(V_,"CODE",{});var eq=r(za);Se=a(eq,'truncation="only_second"'),eq.forEach(t),qr=a(V_," pour tronquer le contexte (qui est en deuxi\xE8me position) quand la question avec son contexte est trop longue"),V_.forEach(t),br=c(ro),jt=l(ro,"LI",{});var fp=r(jt);Na=l(fp,"CODE",{});var sq=r(Na);gr=a(sq,"stride"),sq.forEach(t),xr=a(fp," pour fixer le nombre de "),Ls=l(fp,"EM",{});var tq=r(Ls);$r=a(tq,"tokens"),tq.forEach(t),jr=a(fp," se chevauchant entre deux morceaux successifs (ici 50)"),fp.forEach(t),Ta=c(ro),bs=l(ro,"LI",{});var rr=r(bs);La=l(rr,"CODE",{});var nq=r(La);wr=a(nq,"return_overflowing_tokens=True"),nq.forEach(t),Er=a(rr," pour indiquer au "),Os=l(rr,"EM",{});var aq=r(Os);Oa=a(aq,"tokenizer"),aq.forEach(t),kr=a(rr," que l\u2019on veut les "),Ze=l(rr,"EM",{});var oq=r(Ze);yr=a(oq,"tokens"),oq.forEach(t),Cr=a(rr," qui d\xE9bordent"),rr.forEach(t),ro.forEach(t),ol=c(e),w(Ee.$$.fragment,e),ll=c(e),w(pn.$$.fragment,e),rl=c(e),xe=l(e,"P",{});var Us=r(xe);Pr=a(Us,"Comme nous pouvons le voir, notre exemple a \xE9t\xE9 divis\xE9 en quatre entr\xE9es, chacune d\u2019entre elles contenant la question et une partie du contexte. Notez que la r\xE9ponse \xE0 la question (\xAB Bernadette Soubirous \xBB) n\u2019appara\xEEt que dans la troisi\xE8me et la derni\xE8re entr\xE9e. Donc en traitant les longs contextes de cette fa\xE7on, nous allons cr\xE9er quelques exemples d\u2019entra\xEEnement o\xF9 la r\xE9ponse n\u2019est pas incluse dans le contexte. Pour ces exemples, les \xE9tiquettes seront "),dn=l(Us,"CODE",{});var lq=r(dn);Ar=a(lq,"start_position = end_position = 0"),lq.forEach(t),he=a(Us," (donc nous pr\xE9disons le "),Ba=l(Us,"EM",{});var rq=r(Ba);Dr=a(rq,"token"),rq.forEach(t),Sr=c(Us),Fa=l(Us,"CODE",{});var iq=r(Fa);Mr=a(iq,"[CLS]"),iq.forEach(t),zr=a(Us,"). Nous d\xE9finirons \xE9galement ces \xE9tiquettes dans le cas malheureux o\xF9 la r\xE9ponse a \xE9t\xE9 tronqu\xE9e de sorte que nous n\u2019avons que le d\xE9but (ou la fin) de celle-ci. Pour les exemples o\xF9 la r\xE9ponse est enti\xE8rement dans le contexte, les \xE9tiquettes seront l\u2019index du "),Ia=l(Us,"EM",{});var uq=r(Ia);cn=a(uq,"token"),uq.forEach(t),Nr=a(Us," o\xF9 la r\xE9ponse commence et l\u2019index du "),Va=l(Us,"EM",{});var pq=r(Va);Tr=a(pq,"token"),pq.forEach(t),Pc=a(Us," o\xF9 la r\xE9ponse se termine."),Us.forEach(t),hp=c(e),Me=l(e,"P",{});var Rs=r(Me);Ac=a(Rs,"Le jeu de donn\xE9es nous fournit le caract\xE8re de d\xE9but de la r\xE9ponse dans le contexte, et en ajoutant la longueur de la r\xE9ponse, nous pouvons trouver le caract\xE8re de fin dans le contexte. Pour faire correspondre ces indices aux "),Di=l(Rs,"EM",{});var dq=r(Di);Dc=a(dq,"tokens"),dq.forEach(t),Sc=a(Rs,", nous devrons utiliser les correspondances "),Si=l(Rs,"EM",{});var cq=r(Si);Mc=a(cq,"offset"),cq.forEach(t),zc=a(Rs," que nous avons \xE9tudi\xE9s au "),Lr=l(Rs,"A",{href:!0});var mq=r(Lr);Nc=a(mq,"chapitre 6"),mq.forEach(t),Tc=a(Rs,". Nous pouvons faire en sorte que notre "),Mi=l(Rs,"EM",{});var fq=r(Mi);Lc=a(fq,"tokenizer"),fq.forEach(t),Oc=a(Rs," renvoie ces index en passant "),zi=l(Rs,"CODE",{});var hq=r(zi);Bc=a(hq,"return_offsets_mapping=True"),hq.forEach(t),Fc=a(Rs," :"),Rs.forEach(t),_p=c(e),w(il.$$.fragment,e),vp=c(e),w(ul.$$.fragment,e),qp=c(e),ze=l(e,"P",{});var Qs=r(ze);Ic=a(Qs,"Comme nous pouvons le voir, nous r\xE9cup\xE9rons les identifiants d\u2019entr\xE9e, les "),Ni=l(Qs,"EM",{});var _q=r(Ni);Vc=a(_q,"tokens"),_q.forEach(t),Hc=a(Qs," de type identifiant, le masque d\u2019attention, ainsi que la correspondance "),Ti=l(Qs,"EM",{});var vq=r(Ti);Uc=a(vq,"offset"),vq.forEach(t),Rc=a(Qs," dont nous avions besoin et une cl\xE9 suppl\xE9mentaire, "),Li=l(Qs,"CODE",{});var qq=r(Li);Qc=a(qq,"overflow_to_sample_mapping"),qq.forEach(t),Gc=a(Qs,". La valeur correspondante nous sera utile lorsque nous tokeniserons plusieurs textes en m\xEAme temps (ce que nous devrions faire pour b\xE9n\xE9ficier du fait que notre "),Oi=l(Qs,"EM",{});var bq=r(Oi);Jc=a(bq,"tokenizer"),bq.forEach(t),Wc=a(Qs," est en Rust). Puisqu\u2019un \xE9chantillon peut donner plusieurs caract\xE9ristiques, il fait correspondre chaque caract\xE9ristique \xE0 l\u2019exemple d\u2019o\xF9 elle provient. Parce qu\u2019ici nous avons seulement tokenis\xE9 un exemple, nous obtenons une liste de "),Bi=l(Qs,"CODE",{});var gq=r(Bi);Xc=a(gq,"0"),gq.forEach(t),Kc=a(Qs," :"),Qs.forEach(t),bp=c(e),w(pl.$$.fragment,e),gp=c(e),w(dl.$$.fragment,e),xp=c(e),Or=l(e,"P",{});var xq=r(Or);Yc=a(xq,"Mais si nous tokenisons davantage d\u2019exemples, cela deviendra plus utile :"),xq.forEach(t),$p=c(e),w(cl.$$.fragment,e),jp=c(e),w(ml.$$.fragment,e),wp=c(e),Br=l(e,"P",{});var $q=r(Br);Zc=a($q,"Comme nous pouvons le voir, les trois premiers exemples (aux indices 2, 3 et 4 de l\u2019ensemble d\u2019entra\xEEnement) ont chacun donn\xE9 quatre caract\xE9ristiques et le dernier exemple (\xE0 l\u2019indice 5 de l\u2019ensemble d\u2019entra\xEEnement) a donn\xE9 7 caract\xE9ristiques."),$q.forEach(t),Ep=c(e),Fr=l(e,"P",{});var jq=r(Fr);em=a(jq,"Ces informations seront utiles pour associer chaque caract\xE9ristique obtenue \xE0 son \xE9tiquette correspondante. Comme mentionn\xE9 pr\xE9c\xE9demment, ces \xE9tiquettes sont :"),jq.forEach(t),kp=c(e),Ha=l(e,"UL",{});var uc=r(Ha);Ir=l(uc,"LI",{});var H_=r(Ir);Fi=l(H_,"CODE",{});var wq=r(Fi);sm=a(wq,"(0, 0)"),wq.forEach(t),tm=a(H_," si la r\xE9ponse n\u2019est pas dans l\u2019espace correspondant du contexte."),H_.forEach(t),nm=c(uc),es=l(uc,"LI",{});var Ot=r(es);Ii=l(Ot,"CODE",{});var Eq=r(Ii);am=a(Eq,"(start_position, end_position)"),Eq.forEach(t),om=a(Ot," si la r\xE9ponse est dans l\u2019espace correspondant du contexte, avec "),Vi=l(Ot,"CODE",{});var kq=r(Vi);lm=a(kq,"start_position"),kq.forEach(t),rm=a(Ot," \xE9tant l\u2019index du "),Hi=l(Ot,"EM",{});var yq=r(Hi);im=a(yq,"token"),yq.forEach(t),um=a(Ot," (dans les identifiants d\u2019entr\xE9e) au d\xE9but de la r\xE9ponse et "),Ui=l(Ot,"CODE",{});var Cq=r(Ui);pm=a(Cq,"end_position"),Cq.forEach(t),dm=a(Ot," \xE9tant l\u2019index du "),Ri=l(Ot,"EM",{});var Pq=r(Ri);cm=a(Pq,"token"),Pq.forEach(t),mm=a(Ot," (dans les identifiants d\u2019entr\xE9e) o\xF9 la r\xE9ponse se termine."),Ot.forEach(t),uc.forEach(t),yp=c(e),Ne=l(e,"P",{});var Gs=r(Ne);fm=a(Gs,"Pour d\xE9terminer ce qui est le cas et, le cas \xE9ch\xE9ant, les positions des "),Qi=l(Gs,"EM",{});var Aq=r(Qi);hm=a(Aq,"tokens"),Aq.forEach(t),_m=a(Gs,", nous trouvons d\u2019abord les indices qui commencent et finissent le contexte dans les identifiants d\u2019entr\xE9e. Nous pourrions utiliser les "),Gi=l(Gs,"EM",{});var Dq=r(Gi);vm=a(Dq,"tokens"),Dq.forEach(t),qm=a(Gs," de type identifiants pour le faire, mais puisque ceux-ci n\u2019existent pas n\xE9cessairement pour tous les mod\xE8les (DistilBERT ne les requiert pas par exemple), nous allons plut\xF4t utiliser la m\xE9thode "),Ji=l(Gs,"CODE",{});var Sq=r(Ji);bm=a(Sq,"sequence_ids()"),Sq.forEach(t),gm=a(Gs," du "),Wi=l(Gs,"CODE",{});var Mq=r(Wi);xm=a(Mq,"BatchEncoding"),Mq.forEach(t),$m=a(Gs," que notre "),Xi=l(Gs,"EM",{});var zq=r(Xi);jm=a(zq,"tokenizer"),zq.forEach(t),wm=a(Gs," retourne."),Gs.forEach(t),Cp=c(e),Te=l(e,"P",{});var Js=r(Te);Em=a(Js,"Une fois que nous avons ces indices de "),Ki=l(Js,"EM",{});var Nq=r(Ki);km=a(Nq,"tokens"),Nq.forEach(t),ym=a(Js,", nous regardons les "),Yi=l(Js,"EM",{});var Tq=r(Yi);Cm=a(Tq,"offsets"),Tq.forEach(t),Pm=a(Js," correspondants, qui sont des "),Zi=l(Js,"EM",{});var Lq=r(Zi);Am=a(Lq,"tuples"),Lq.forEach(t),Dm=a(Js," de deux entiers repr\xE9sentant l\u2019\xE9tendue des caract\xE8res dans le contexte original. Nous pouvons ainsi d\xE9tecter si le morceau de contexte dans cette fonctionnalit\xE9 commence apr\xE8s la r\xE9ponse ou se termine avant que la r\xE9ponse ne commence (dans ce cas, l\u2019\xE9tiquette est "),eu=l(Js,"CODE",{});var Oq=r(eu);Sm=a(Oq,"(0, 0)"),Oq.forEach(t),Mm=a(Js,"). Si ce n\u2019est pas le cas, nous bouclons pour trouver le premier et le dernier "),su=l(Js,"EM",{});var Bq=r(su);zm=a(Bq,"token"),Bq.forEach(t),Nm=a(Js," de la r\xE9ponse :"),Js.forEach(t),Pp=c(e),w(fl.$$.fragment,e),Ap=c(e),w(hl.$$.fragment,e),Dp=c(e),mn=l(e,"P",{});var wi=r(mn);Tm=a(wi,"Jetons un coup d\u2019\u0153il  \xE0 quelques r\xE9sultats pour v\xE9rifier que notre approche est correcte. Pour la premi\xE8re caract\xE9ristique, nous trouvons "),tu=l(wi,"CODE",{});var Fq=r(tu);Lm=a(Fq,"(83, 85)"),Fq.forEach(t),Om=a(wi," comme \xE9tiquettes. Comparons alors la r\xE9ponse th\xE9orique avec l\u2019\xE9tendue d\xE9cod\xE9e des "),nu=l(wi,"EM",{});var Iq=r(nu);Bm=a(Iq,"tokens"),Iq.forEach(t),Fm=a(wi," de 83 \xE0 85 (inclus) :"),wi.forEach(t),Sp=c(e),w(_l.$$.fragment,e),Mp=c(e),w(vl.$$.fragment,e),zp=c(e),Ua=l(e,"P",{});var pc=r(Ua);Im=a(pc,"Cela correspond ! Maintenant v\xE9rifions l\u2019index 4, o\xF9 nous avons mis les \xE9tiquettes \xE0 "),au=l(pc,"CODE",{});var Vq=r(au);Vm=a(Vq,"(0, 0)"),Vq.forEach(t),Hm=a(pc,", signifiant que la r\xE9ponse n\u2019est pas dans le morceau de contexte de cette caract\xE9ristique :"),pc.forEach(t),Np=c(e),w(ql.$$.fragment,e),Tp=c(e),w(bl.$$.fragment,e),Lp=c(e),Vr=l(e,"P",{});var Hq=r(Vr);Um=a(Hq,"En effet, nous ne voyons pas la r\xE9ponse dans le contexte."),Hq.forEach(t),Op=c(e),w(Ra.$$.fragment,e),Bp=c(e),Hr=l(e,"P",{});var Uq=r(Hr);Rm=a(Uq,"Maintenant que nous avons vu \xE9tape par \xE9tape comment pr\xE9traiter nos donn\xE9es d\u2019entra\xEEnement, nous pouvons les regrouper dans une fonction que nous appliquerons \xE0 l\u2019ensemble des donn\xE9es d\u2019entra\xEEnement. Nous allons rembourrer chaque caract\xE9ristique \xE0 la longueur maximale que nous avons d\xE9finie, car la plupart des contextes seront longs (et les \xE9chantillons correspondants seront divis\xE9s en plusieurs caract\xE9ristiques). Il n\u2019y a donc pas de r\xE9el avantage \xE0 appliquer un rembourrage dynamique ici :"),Uq.forEach(t),Fp=c(e),w(gl.$$.fragment,e),Ip=c(e),Ur=l(e,"P",{});var Rq=r(Ur);Qm=a(Rq,"Notez que nous avons d\xE9fini deux constantes pour d\xE9terminer la longueur maximale utilis\xE9e ainsi que la longueur de la fen\xEAtre glissante, et que nous avons ajout\xE9 un petit nettoyage avant la tok\xE9nisation : certaines des questions dans SQuAD ont des espaces suppl\xE9mentaires au d\xE9but et \xE0 la fin qui n\u2019ajoutent rien (et prennent de la place lors de la tok\xE9nisation si vous utilisez un mod\xE8le comme RoBERTa), donc nous avons supprim\xE9 ces espaces suppl\xE9mentaires."),Rq.forEach(t),Vp=c(e),fn=l(e,"P",{});var Ei=r(fn);Gm=a(Ei,"Pour appliquer cette fonction \xE0 l\u2019ensemble de l\u2019entra\xEEnement, nous utilisons la m\xE9thode "),ou=l(Ei,"CODE",{});var Qq=r(ou);Jm=a(Qq,"Dataset.map()"),Qq.forEach(t),Wm=a(Ei," avec le flag "),lu=l(Ei,"CODE",{});var Gq=r(lu);Xm=a(Gq,"batched=True"),Gq.forEach(t),Km=a(Ei,". C\u2019est n\xE9cessaire ici car nous changeons la longueur du jeu de donn\xE9es (puisqu\u2019un exemple peut donner plusieurs caract\xE9ristiques d\u2019entra\xEEnement) :"),Ei.forEach(t),Hp=c(e),w(xl.$$.fragment,e),Up=c(e),w($l.$$.fragment,e),Rp=c(e),Rr=l(e,"P",{});var Jq=r(Rr);Ym=a(Jq,"Comme nous pouvons le voir, le pr\xE9traitement a ajout\xE9 environ 1 000 caract\xE9ristiques. Notre ensemble d\u2019entra\xEEnement est maintenant pr\xEAt \xE0 \xEAtre utilis\xE9. Passons au pr\xE9traitement de l\u2019ensemble de validation !"),Jq.forEach(t),Qp=c(e),Wn=l(e,"H3",{class:!0});var dc=r(Wn);Qa=l(dc,"A",{id:!0,class:!0,href:!0});var Wq=r(Qa);ru=l(Wq,"SPAN",{});var Xq=r(ru);w(jl.$$.fragment,Xq),Xq.forEach(t),Wq.forEach(t),Zm=c(dc),iu=l(dc,"SPAN",{});var Kq=r(iu);ef=a(Kq,"Traitement des donn\xE9es de validation"),Kq.forEach(t),dc.forEach(t),Gp=c(e),Ga=l(e,"P",{});var cc=r(Ga);sf=a(cc,"Le pr\xE9traitement des donn\xE9es de validation sera l\xE9g\xE8rement plus facile car nous n\u2019avons pas besoin de g\xE9n\xE9rer des \xE9tiquettes (sauf si nous voulons calculer une perte de validation, mais elle ne nous aidera pas vraiment \xE0 comprendre la qualit\xE9 du mod\xE8le). Le r\xE9el plaisir sera d\u2019interpr\xE9ter les pr\xE9dictions du mod\xE8le dans des \xE9tendues du contexte original. Pour cela, il nous suffit de stocker les correspondances d\u2019"),uu=l(cc,"EM",{});var Yq=r(uu);tf=a(Yq,"offset"),Yq.forEach(t),nf=a(cc," et un moyen de faire correspondre chaque caract\xE9ristique cr\xE9\xE9e \xE0 l\u2019exemple original dont elle provient. Puisqu\u2019il y a une colonne identifiant dans le jeu de donn\xE9es original, nous l\u2019utiliserons."),cc.forEach(t),Jp=c(e),ke=l(e,"P",{});var ls=r(ke);af=a(ls,"La seule chose que nous allons ajouter ici est un petit nettoyage des correspondances d\u2019"),pu=l(ls,"EM",{});var Zq=r(pu);of=a(Zq,"offset"),Zq.forEach(t),lf=a(ls,". Elles contiendront les "),du=l(ls,"EM",{});var eb=r(du);rf=a(eb,"offsets"),eb.forEach(t),uf=a(ls," pour la question et le contexte, mais une fois que nous serons \xE0 la phase de post-traitement, nous n\u2019aurons aucun moyen de savoir quelle partie des identifiants d\u2019entr\xE9e correspondait au contexte et quelle partie \xE9tait la question (la m\xE9thode "),cu=l(ls,"CODE",{});var sb=r(cu);pf=a(sb,"sequence_ids()"),sb.forEach(t),df=a(ls," que nous avons utilis\xE9e n\u2019est disponible que pour la sortie du "),mu=l(ls,"EM",{});var tb=r(mu);cf=a(tb,"tokenizer"),tb.forEach(t),mf=a(ls,"). Donc, nous allons mettre les "),fu=l(ls,"EM",{});var nb=r(fu);ff=a(nb,"offsets"),nb.forEach(t),hf=a(ls," correspondant \xE0 la question \xE0 "),hu=l(ls,"CODE",{});var ab=r(hu);_f=a(ab,"None"),ab.forEach(t),vf=a(ls," :"),ls.forEach(t),Wp=c(e),w(wl.$$.fragment,e),Xp=c(e),Qr=l(e,"P",{});var ob=r(Qr);qf=a(ob,"Nous pouvons appliquer cette fonction sur l\u2019ensemble de validation comme pr\xE9c\xE9demment :"),ob.forEach(t),Kp=c(e),w(El.$$.fragment,e),Yp=c(e),w(kl.$$.fragment,e),Zp=c(e),Gr=l(e,"P",{});var lb=r(Gr);bf=a(lb,"Dans ce cas, nous n\u2019avons ajout\xE9 que quelques centaines d\u2019\xE9chantillons, il semble donc que les contextes dans l\u2019ensemble de validation soient un peu plus courts."),lb.forEach(t),ed=c(e),Jr=l(e,"P",{});var rb=r(Jr);gf=a(rb,"Maintenant que nous avons pr\xE9trait\xE9 toutes les donn\xE9es, nous pouvons passer \xE0 l\u2019entra\xEEnement."),rb.forEach(t),sd=c(e),Et.l(e),Wr=c(e),Xn=l(e,"H3",{class:!0});var mc=r(Xn);Ja=l(mc,"A",{id:!0,class:!0,href:!0});var ib=r(Ja);_u=l(ib,"SPAN",{});var ub=r(_u);w(yl.$$.fragment,ub),ub.forEach(t),ib.forEach(t),xf=c(mc),vu=l(mc,"SPAN",{});var pb=r(vu);$f=a(pb,"Post-traitement"),pb.forEach(t),mc.forEach(t),td=c(e),yt.l(e),Xr=c(e),hn=l(e,"P",{});var ki=r(hn);jf=a(ki,"Le mod\xE8le produira des logits pour les positions de d\xE9but et de fin de la r\xE9ponse dans les identifiants d\u2019entr\xE9e, comme nous l\u2019avons vu lors de notre exploration du pipeline de "),qu=l(ki,"CODE",{});var db=r(qu);wf=a(db,"question-answering"),db.forEach(t),Ef=c(ki),Kr=l(ki,"A",{href:!0});var cb=r(Kr);kf=a(cb,"au chapitre 6"),cb.forEach(t),yf=a(ki,". L\u2019\xE9tape de post-traitement sera similaire \xE0 ce que nous avons fait \xE0 ce chapitre l\xE0. Voici un rapide rappel des actions que nous avons prises :"),ki.forEach(t),nd=c(e),Bs=l(e,"UL",{});var io=r(Bs);Cl=l(io,"LI",{});var fc=r(Cl);Cf=a(fc,"nous avons masqu\xE9 les logits de d\xE9but et de fin correspondant aux "),bu=l(fc,"EM",{});var mb=r(bu);Pf=a(mb,"tokens"),mb.forEach(t),Af=a(fc," en dehors du contexte,"),fc.forEach(t),Df=c(io),gu=l(io,"LI",{});var fb=r(gu);Sf=a(fb,"nous avons ensuite converti les logits de d\xE9but et de fin en probabilit\xE9s en utilisant une fonction SoftMax,"),fb.forEach(t),Mf=c(io),Pl=l(io,"LI",{});var hc=r(Pl);zf=a(hc,"nous avons attribu\xE9 un score \xE0 chaque paire "),xu=l(hc,"CODE",{});var hb=r(xu);Nf=a(hb,"(start_token, end_token)"),hb.forEach(t),Tf=a(hc," en prenant le produit des deux probabilit\xE9s correspondantes,"),hc.forEach(t),Lf=c(io),Kn=l(io,"LI",{});var yi=r(Kn);Of=a(yi,"nous avons cherch\xE9 la paire avec le score maximum qui donnait une r\xE9ponse valide (par exemple, un "),$u=l(yi,"CODE",{});var _b=r($u);Bf=a(_b,"start_token"),_b.forEach(t),Ff=a(yi," inf\xE9rieur au "),ju=l(yi,"CODE",{});var vb=r(ju);If=a(vb,"end_token"),vb.forEach(t),Vf=a(yi,")."),yi.forEach(t),io.forEach(t),ad=c(e),ss=l(e,"P",{});var bn=r(ss);Hf=a(bn,"Ici, nous allons modifier l\xE9g\xE8rement ce processus car nous n\u2019avons pas besoin de calculer les scores r\xE9els (juste la r\xE9ponse pr\xE9dite). Cela signifie que nous pouvons sauter l\u2019\xE9tape de la SoftMax. Pour aller plus vite, nous ne donnerons pas non plus un score \xE0 toutes les paires "),wu=l(bn,"CODE",{});var qb=r(wu);Uf=a(qb,"(start_token, end_token)"),qb.forEach(t),Rf=a(bn," possibles, mais seulement celles correspondant aux "),Eu=l(bn,"CODE",{});var bb=r(Eu);Qf=a(bb,"n_best"),bb.forEach(t),Gf=a(bn," logits les plus \xE9lev\xE9s (avec "),ku=l(bn,"CODE",{});var gb=r(ku);Jf=a(gb,"n_best=20"),gb.forEach(t),Wf=a(bn,"). Puisque nous sautons la SoftMax, les scores seront des scores logi, et seront obtenus en prenant la somme des logits de d\xE9but et de fin (au lieu du produit, \xE0 cause de la r\xE8gle "),od=wg(bn),ld=a(bn,")."),bn.forEach(t),rd=c(e),Fs=l(e,"P",{});var uo=r(Fs);Xf=a(uo,"Pour d\xE9montrer tout cela, nous aurons besoin d\u2019un certain type de pr\xE9dictions. Puisque nous n\u2019avons pas encore entra\xEEn\xE9 notre mod\xE8le, nous allons utiliser le mod\xE8le par d\xE9faut du pipeline de "),yu=l(uo,"CODE",{});var xb=r(yu);Kf=a(xb,"question-answering"),xb.forEach(t),Yf=a(uo," pour g\xE9n\xE9rer quelques pr\xE9dictions sur une petite partie de l\u2019ensemble de validation. Nous pouvons utiliser la m\xEAme fonction de traitement que pr\xE9c\xE9demment car elle repose sur la constante globale "),Cu=l(uo,"CODE",{});var $b=r(Cu);Zf=a($b,"tokenizer"),$b.forEach(t),eh=a(uo,", nous devons juste changer cet objet par le "),Pu=l(uo,"EM",{});var jb=r(Pu);sh=a(jb,"tokenizer"),jb.forEach(t),th=a(uo," du mod\xE8le que nous voulons utiliser temporairement :"),uo.forEach(t),id=c(e),w(Al.$$.fragment,e),ud=c(e),Wa=l(e,"P",{});var _c=r(Wa);nh=a(_c,"Maintenant que le pr\xE9traitement est termin\xE9, nous changeons le "),Au=l(_c,"EM",{});var wb=r(Au);ah=a(wb,"tokenizer"),wb.forEach(t),oh=a(_c," pour celui que nous avons choisi \xE0 l\u2019origine :"),_c.forEach(t),pd=c(e),w(Dl.$$.fragment,e),dd=c(e),Xa=l(e,"P",{});var vc=r(Xa);lh=a(vc,"Nous supprimons ensuite les colonnes de notre "),Du=l(vc,"CODE",{});var Eb=r(Du);rh=a(Eb,"eval_set"),Eb.forEach(t),ih=a(vc," qui ne sont pas attendues par le mod\xE8le. Nous construisons un batch avec tout de ce petit ensemble de validation et le passons au mod\xE8le. Si un GPU est disponible, nous l\u2019utilisons pour aller plus vite :"),vc.forEach(t),cd=c(e),Pt.l(e),Yr=c(e),ts=l(e,"P",{});var gn=r(ts);uh=a(gn,"Maintenant, nous devons trouver la r\xE9ponse pr\xE9dite pour chaque exemple dans notre "),Su=l(gn,"CODE",{});var kb=r(Su);ph=a(kb,"small_eval_set"),kb.forEach(t),dh=a(gn,". Un exemple peut avoir \xE9t\xE9 divis\xE9 en plusieurs caract\xE9ristiques dans "),Mu=l(gn,"CODE",{});var yb=r(Mu);ch=a(yb,"eval_set"),yb.forEach(t),mh=a(gn,", donc la premi\xE8re \xE9tape est de faire correspondre chaque exemple dans "),zu=l(gn,"CODE",{});var Cb=r(zu);fh=a(Cb,"small_eval_set"),Cb.forEach(t),hh=a(gn," aux caract\xE9ristiques correspondantes dans "),Nu=l(gn,"CODE",{});var Pb=r(Nu);_h=a(Pb,"eval_set"),Pb.forEach(t),vh=a(gn," :"),gn.forEach(t),md=c(e),w(Sl.$$.fragment,e),fd=c(e),Ka=l(e,"P",{});var qc=r(Ka);qh=a(qc,"Avec cela, nous pouvons vraiment nous mettre au travail en bouclant tous les exemples et, pour chaque exemple, toutes les caract\xE9ristiques associ\xE9es. Comme nous l\u2019avons dit pr\xE9c\xE9demment, nous allons regarder les scores logit pour les "),Tu=l(qc,"CODE",{});var Ab=r(Tu);bh=a(Ab,"n_best"),Ab.forEach(t),gh=a(qc," logits de d\xE9but et logits de fin, en excluant les positions qui donnent :"),qc.forEach(t),hd=c(e),_n=l(e,"UL",{});var Ci=r(_n);Lu=l(Ci,"LI",{});var Db=r(Lu);xh=a(Db,"une r\xE9ponse qui ne serait pas dans le contexte"),Db.forEach(t),$h=c(Ci),Ou=l(Ci,"LI",{});var Sb=r(Ou);jh=a(Sb,"une r\xE9ponse avec une longueur n\xE9gative"),Sb.forEach(t),wh=c(Ci),Ml=l(Ci,"LI",{});var bc=r(Ml);Eh=a(bc,"une r\xE9ponse qui est trop longue (nous limitons les possibilit\xE9s \xE0 "),Bu=l(bc,"CODE",{});var Mb=r(Bu);kh=a(Mb,"max_answer_length=30"),Mb.forEach(t),yh=a(bc,")"),bc.forEach(t),Ci.forEach(t),_d=c(e),Zr=l(e,"P",{});var zb=r(Zr);Ch=a(zb,"Une fois que nous avons toutes les r\xE9ponses possibles not\xE9es pour un exemple, nous choisissons simplement celle qui a le meilleur score logit :"),zb.forEach(t),vd=c(e),w(zl.$$.fragment,e),qd=c(e),Ya=l(e,"P",{});var gc=r(Ya);Ph=a(gc,"Le format final des r\xE9ponses pr\xE9dites est celui qui sera attendu par la m\xE9trique que nous allons utiliser. Comme d\u2019habitude, nous pouvons la charger \xE0 l\u2019aide de la biblioth\xE8que \u{1F917} "),Fu=l(gc,"EM",{});var Nb=r(Fu);Ah=a(Nb,"Datasets"),Nb.forEach(t),Dh=a(gc," :"),gc.forEach(t),bd=c(e),w(Nl.$$.fragment,e),gd=c(e),ei=l(e,"P",{});var Tb=r(ei);Sh=a(Tb,"Cette m\xE9trique attend les r\xE9ponses pr\xE9dites dans le format que nous avons vu ci-dessus (une liste de dictionnaires avec une cl\xE9 pour l\u2019identifiant de l\u2019exemple et une cl\xE9 pour le texte pr\xE9dit) et les r\xE9ponses th\xE9oriques dans le format ci-dessous (une liste de dictionnaires avec une cl\xE9 pour l\u2019identifiant de l\u2019exemple et une cl\xE9 pour les r\xE9ponses possibles) :"),Tb.forEach(t),xd=c(e),w(Tl.$$.fragment,e),$d=c(e),si=l(e,"P",{});var Lb=r(si);Mh=a(Lb,"Nous pouvons maintenant v\xE9rifier que nous obtenons des r\xE9sultats raisonnables en examinant le premier \xE9l\xE9ment des deux listes :"),Lb.forEach(t),jd=c(e),w(Ll.$$.fragment,e),wd=c(e),w(Ol.$$.fragment,e),Ed=c(e),ti=l(e,"P",{});var Ob=r(ti);zh=a(Ob,"Pas trop mal ! Voyons maintenant le score que la m\xE9trique nous donne :"),Ob.forEach(t),kd=c(e),w(Bl.$$.fragment,e),yd=c(e),w(Fl.$$.fragment,e),Cd=c(e),vn=l(e,"P",{});var Pi=r(vn);Nh=a(Pi,"Encore une fois, c\u2019est plut\xF4t bon si l\u2019on consid\xE8re que, d\u2019apr\xE8s "),Il=l(Pi,"A",{href:!0,rel:!0});var Bb=r(Il);Th=a(Bb,"le papier"),Bb.forEach(t),Lh=a(Pi," de DistilBERT, "),Iu=l(Pi,"EM",{});var Fb=r(Iu);Oh=a(Fb,"finetun\xE9"),Fb.forEach(t),Bh=a(Pi," sur SQuAD, ce mod\xE8le obtient 79,1 et 86,9 pour ces scores sur l\u2019ensemble du jeu de donn\xE9es."),Pi.forEach(t),Pd=c(e),ea.l(e),ni=c(e),w(Vl.$$.fragment,e),Ad=c(e),ai=l(e,"P",{});var Ib=r(ai);Fh=a(Ib,"Nous pouvons v\xE9rifier que cela fonctionne sur nos pr\xE9dictions :"),Ib.forEach(t),Dd=c(e),w(Hl.$$.fragment,e),Sd=c(e),w(Ul.$$.fragment,e),Md=c(e),Za=l(e,"P",{});var xc=r(Za);Ih=a(xc,"C\u2019est bien ! Maintenant, utilisons ceci pour "),Vu=l(xc,"EM",{});var Vb=r(Vu);Vh=a(Vb,"finetuner"),Vb.forEach(t),Hh=a(xc," notre mod\xE8le."),xc.forEach(t),zd=c(e),Yn=l(e,"H3",{class:!0});var $c=r(Yn);eo=l($c,"A",{id:!0,class:!0,href:!0});var Hb=r(eo);Hu=l(Hb,"SPAN",{});var Ub=r(Hu);w(Rl.$$.fragment,Ub),Ub.forEach(t),Hb.forEach(t),Uh=c($c),oi=l($c,"SPAN",{});var U_=r(oi);Uu=l(U_,"I",{});var Rb=r(Uu);Rh=a(Rb,"Finetuning"),Rb.forEach(t),Qh=a(U_," du mod\xE8le"),U_.forEach(t),$c.forEach(t),Nd=c(e),Dt.l(e),li=c(e),so=l(e,"P",{});var jc=r(so);Gh=a(jc,"Comme d\u2019habitude, nous recevons un avertissement indiquant que certains poids ne sont pas utilis\xE9s (ceux de la t\xEAte de pr\xE9-entra\xEEnement) et que d\u2019autres sont initialis\xE9s de mani\xE8re al\xE9atoire (ceux de la t\xEAte de r\xE9ponse aux questions). Vous devriez \xEAtre habitu\xE9 \xE0 cela maintenant, mais cela signifie que ce mod\xE8le n\u2019est pas encore pr\xEAt \xE0 \xEAtre utilis\xE9 et qu\u2019il a besoin d\u2019\xEAtre "),Ru=l(jc,"EM",{});var Qb=r(Ru);Jh=a(Qb,"finetun\xE9"),Qb.forEach(t),Wh=a(jc,". Une bonne chose que nous soyons sur le point de le faire !"),jc.forEach(t),Td=c(e),Is=l(e,"P",{});var po=r(Is);Xh=a(po,"Pour pouvoir pousser notre mod\xE8le vers le "),Qu=l(po,"EM",{});var Gb=r(Qu);Kh=a(Gb,"Hub"),Gb.forEach(t),Yh=a(po,", nous devons nous connecter \xE0 Hugging Face. Si vous ex\xE9cutez ce code dans un "),Gu=l(po,"EM",{});var Jb=r(Gu);Zh=a(Jb,"notebook"),Jb.forEach(t),e_=a(po,", vous pouvez le faire avec la fonction utilitaire suivante, qui affiche un "),Ju=l(po,"EM",{});var Wb=r(Ju);s_=a(Wb,"widget"),Wb.forEach(t),t_=a(po," o\xF9 vous pouvez entrer vos identifiants de connexion :"),po.forEach(t),Ld=c(e),w(Ql.$$.fragment,e),Od=c(e),to=l(e,"P",{});var wc=r(to);n_=a(wc,"Si vous ne travaillez pas dans un "),Wu=l(wc,"EM",{});var Xb=r(Wu);a_=a(Xb,"notebook"),Xb.forEach(t),o_=a(wc,", tapez simplement la ligne suivante dans votre terminal :"),wc.forEach(t),Bd=c(e),w(Gl.$$.fragment,e),Fd=c(e),Mt.l(e),ri=c(e),ns=l(e,"P",{});var xn=r(ns);l_=a(xn,"Par d\xE9faut, le d\xE9p\xF4t utilis\xE9 sera dans votre espace et nomm\xE9 apr\xE8s le r\xE9pertoire de sortie que vous avez d\xE9fini. Donc dans notre cas il sera dans "),Xu=l(xn,"CODE",{});var Kb=r(Xu);r_=a(Kb,'"sgugger/bert-finetuned-squad"'),Kb.forEach(t),i_=a(xn,". Nous pouvons passer outre en passant un "),Ku=l(xn,"CODE",{});var Yb=r(Ku);u_=a(Yb,"hub_model_id"),Yb.forEach(t),p_=a(xn,", par exemple, pour pousser le mod\xE8le dans l\u2019organisation "),Yu=l(xn,"CODE",{});var Zb=r(Yu);d_=a(Zb,"huggingface_course"),Zb.forEach(t),c_=a(xn," nous avons utilis\xE9 "),Zu=l(xn,"CODE",{});var eg=r(Zu);m_=a(eg,'hub_model_id= "huggingface_course/bert-finetuned-squad"'),eg.forEach(t),f_=a(xn," (qui est le mod\xE8le que nous avons li\xE9 au d\xE9but de cette section)."),xn.forEach(t),Id=c(e),Nt.l(e),ii=c(e),qn=l(e,"P",{});var Ai=r(qn);h_=a(Ai,"Notez que pendant l\u2019entra\xEEnement, chaque fois que le mod\xE8le est sauvegard\xE9 (ici, \xE0 chaque \xE9poque), il est t\xE9l\xE9charg\xE9 sur le "),ep=l(Ai,"EM",{});var sg=r(ep);__=a(sg,"Hub"),sg.forEach(t),v_=a(Ai," en arri\xE8re-plan. Ainsi, vous pourrez reprendre votre entra\xEEnement sur une autre machine si n\xE9cessaire. L\u2019ensemble de l\u2019entra\xEEnement prend un certain temps (un peu plus d\u2019une heure sur une Titan RTX), vous pouvez donc prendre un caf\xE9 ou relire les parties du cours qui vous ont sembl\xE9 plus difficiles pendant qu\u2019il se d\xE9roule. Notez \xE9galement que d\xE8s que la premi\xE8re \xE9poque est termin\xE9e, vous verrez des poids t\xE9l\xE9charg\xE9s sur le "),sp=l(Ai,"EM",{});var tg=r(sp);q_=a(tg,"Hub"),tg.forEach(t),b_=a(Ai," et vous pourrez commencer \xE0 jouer avec votre mod\xE8le sur sa page."),Ai.forEach(t),Vd=c(e),Lt.l(e),ui=c(e),w(Jl.$$.fragment,e),Hd=c(e),pi=l(e,"P",{});var ng=r(pi);g_=a(ng,"Super ! \xC0 titre de comparaison, les scores indiqu\xE9s dans l\u2019article de BERT pour ce t\xE2che sont de 80,8 et 88,5. Donc nous sommes exactement l\xE0 o\xF9 nous devrions \xEAtre."),ng.forEach(t),Ud=c(e),$e&&$e.l(e),di=c(e),Vs=l(e,"P",{});var co=r(Vs);x_=a(co,"\xC0 ce stade, vous pouvez utiliser le "),tp=l(co,"EM",{});var ag=r(tp);$_=a(ag,"widget"),ag.forEach(t),j_=a(co," d\u2019inf\xE9rence sur le "),np=l(co,"EM",{});var og=r(np);w_=a(og,"Hub"),og.forEach(t),E_=a(co," du mod\xE8le pour tester le mod\xE8le et le partager avec vos amis, votre famille et vos animaux pr\xE9f\xE9r\xE9s. Vous avez r\xE9ussi \xE0 "),ap=l(co,"EM",{});var lg=r(ap);k_=a(lg,"finetuner"),lg.forEach(t),y_=a(co," un mod\xE8le sur une t\xE2che de r\xE9ponse \xE0 une question. F\xE9licitations !"),co.forEach(t),Rd=c(e),w(no.$$.fragment,e),Qd=c(e),je&&je.l(e),ci=c(e),Zn=l(e,"H3",{class:!0});var Ec=r(Zn);ao=l(Ec,"A",{id:!0,class:!0,href:!0});var rg=r(ao);op=l(rg,"SPAN",{});var ig=r(op);w(Wl.$$.fragment,ig),ig.forEach(t),rg.forEach(t),C_=c(Ec),mi=l(Ec,"SPAN",{});var R_=r(mi);P_=a(R_,"Utilisation du mod\xE8le "),lp=l(R_,"I",{});var ug=r(lp);A_=a(ug,"finetun\xE9"),ug.forEach(t),R_.forEach(t),Ec.forEach(t),Gd=c(e),as=l(e,"P",{});var $n=r(as);D_=a($n,"Nous vous avons d\xE9j\xE0 montr\xE9 comment vous pouvez utiliser le mod\xE8le que nous avons "),rp=l($n,"EM",{});var pg=r(rp);S_=a(pg,"finetun\xE9"),pg.forEach(t),M_=a($n," sur le "),ip=l($n,"EM",{});var dg=r(ip);z_=a(dg,"Hub"),dg.forEach(t),N_=a($n," avec le "),up=l($n,"EM",{});var cg=r(up);T_=a(cg,"widget"),cg.forEach(t),L_=a($n," d\u2019inf\xE9rence. Pour l\u2019utiliser localement dans un "),pp=l($n,"CODE",{});var mg=r(pp);O_=a(mg,"pipeline"),mg.forEach(t),B_=a($n,", il suffit de sp\xE9cifier l\u2019identifiant du mod\xE8le :"),$n.forEach(t),Jd=c(e),w(Xl.$$.fragment,e),Wd=c(e),w(Kl.$$.fragment,e),Xd=c(e),fi=l(e,"P",{});var fg=r(fi);F_=a(fg,"Super ! Notre mod\xE8le fonctionne aussi bien que le mod\xE8le par d\xE9faut pour ce pipeline !"),fg.forEach(t),this.h()},h(){C(p,"name","hf:doc:metadata"),C(p,"content",JSON.stringify(Xg)),C(b,"id","rponse-aux-questions"),C(b,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),C(b,"href","#rponse-aux-questions"),C(D,"class","relative group"),C(X,"href","https://rajpurkar.github.io/SQuAD-explorer/"),C(X,"rel","nofollow"),kc(ie.src,xs="https://hf.space/gradioiframe/course-demos/bert-finetuned-squad/+")||C(ie,"src",xs),C(ie,"frameborder","0"),C(ie,"height","450"),C(ie,"title","Gradio app"),C(ie,"class","block dark:hidden container p-0 flex-grow space-iframe"),C(ie,"allow","accelerometer; ambient-light-sensor; autoplay; battery; camera; document-domain; encrypted-media; fullscreen; geolocation; gyroscope; layout-animations; legacy-image-formats; magnetometer; microphone; midi; oversized-images; payment; picture-in-picture; publickey-credentials-get; sync-xhr; usb; vr ; wake-lock; xr-spatial-tracking"),C(ie,"sandbox","allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-downloads"),kc(ue.src,$s="https://hf.space/gradioiframe/course-demos/bert-finetuned-squad-darkmode/+")||C(ue,"src",$s),C(ue,"frameborder","0"),C(ue,"height","450"),C(ue,"title","Gradio app"),C(ue,"class","hidden dark:block container p-0 flex-grow space-iframe"),C(ue,"allow","accelerometer; ambient-light-sensor; autoplay; battery; camera; document-domain; encrypted-media; fullscreen; geolocation; gyroscope; layout-animations; legacy-image-formats; magnetometer; microphone; midi; oversized-images; payment; picture-in-picture; publickey-credentials-get; sync-xhr; usb; vr ; wake-lock; xr-spatial-tracking"),C(ue,"sandbox","allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-downloads"),C(Ie,"href","https://huggingface.co/huggingface-course/bert-finetuned-squad?context=%F0%9F%A4%97+Transformers+is+backed+by+the+three+most+popular+deep+learning+libraries+%E2%80%94+Jax%2C+PyTorch+and+TensorFlow+%E2%80%94+with+a+seamless+integration+between+them.+It%27s+straightforward+to+train+your+models+with+one+before+loading+them+for+inference+with+the+other.&question=Which+deep+learning+libraries+back+%F0%9F%A4%97+Transformers%3F"),C(Ie,"rel","nofollow"),C(ve,"id","prparation-des-donnes"),C(ve,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),C(ve,"href","#prparation-des-donnes"),C(pe,"class","relative group"),C(is,"href","https://rajpurkar.github.io/SQuAD-explorer/"),C(is,"rel","nofollow"),C(ks,"href","https://huggingface.co/datasets/squad_v2"),C(ks,"rel","nofollow"),C(Qe,"id","le-jeu-de-donnes-squad"),C(Qe,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),C(Qe,"href","#le-jeu-de-donnes-squad"),C(us,"class","relative group"),C(Ss,"id","traitement-des-donnes-dentranement"),C(Ss,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),C(Ss,"href","#traitement-des-donnes-dentranement"),C(ce,"class","relative group"),C(ht,"href","https://huggingface.co/transformers/#supported-frameworks"),C(ht,"rel","nofollow"),C(ln,"class","block dark:hidden"),kc(ln.src,Rn="https://huggingface.co/datasets/huggingface-course/documentation-images/resolve/main/en/chapter7/qa_labels.svg")||C(ln,"src",Rn),C(ln,"alt","One-hot encoded labels for question answering."),C(rn,"class","hidden dark:block"),kc(rn.src,tl="https://huggingface.co/datasets/huggingface-course/documentation-images/resolve/main/en/chapter7/qa_labels-dark.svg")||C(rn,"src",tl),C(rn,"alt","One-hot encoded labels for question answering."),C(Ts,"class","flex justify-center"),C(ge,"href","/course/fr/chapter6/4"),C(Lr,"href","/course/fr/chapter6/4"),C(Qa,"id","traitement-des-donnes-de-validation"),C(Qa,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),C(Qa,"href","#traitement-des-donnes-de-validation"),C(Wn,"class","relative group"),C(Ja,"id","posttraitement"),C(Ja,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),C(Ja,"href","#posttraitement"),C(Xn,"class","relative group"),C(Kr,"href","/course/fr/chapter6/3b"),od.a=ld,C(Il,"href","https://arxiv.org/abs/1910.01108v2"),C(Il,"rel","nofollow"),C(eo,"id","ifinetuningi-du-modle"),C(eo,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),C(eo,"href","#ifinetuningi-du-modle"),C(Yn,"class","relative group"),C(ao,"id","utilisation-du-modle-ifinetuni"),C(ao,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),C(ao,"href","#utilisation-du-modle-ifinetuni"),C(Zn,"class","relative group")},m(e,u){s(document.head,p),i(e,q,u),E(f,e,u),i(e,y,u),i(e,D,u),s(D,b),s(b,g),E(x,g,null),s(D,h),s(D,S),s(S,$),i(e,A,u),Yl[N].m(e,u),i(e,z,u),i(e,P,u),s(P,V),s(P,T),s(T,O),s(P,L),i(e,U,u),E(Q,e,u),i(e,W,u),i(e,H,u),s(H,G),s(H,ee),s(ee,Z),s(H,F),s(H,X),s(X,le),s(H,se),s(H,K),s(K,re),s(H,Ce),i(e,ye,u),i(e,ie,u),i(e,Fe,u),i(e,ue,u),i(e,rs,u),i(e,J,u),s(J,Y),s(J,js),s(js,Bt),s(J,ws),s(J,Ie),s(Ie,Ve),i(e,Es,u),E(_e,e,u),i(e,He,u),i(e,pe,u),s(pe,ve),s(ve,Ue),E(Re,Ue,null),s(pe,mo),s(pe,Ft),s(Ft,Ws),i(e,En,u),i(e,qe,u),s(qe,fo),s(qe,is),s(is,ho),s(qe,_o),s(qe,ks),s(ks,Xs),s(qe,ta),i(e,te,u),i(e,us,u),s(us,Qe),s(Qe,kn),E(Ks,kn,null),s(us,yn),s(us,Cn),s(Cn,vo),i(e,It,u),i(e,ys,u),s(ys,qo),s(ys,Ys),s(Ys,bo),s(ys,go),i(e,Vt,u),E(Zs,e,u),i(e,na,u),i(e,Cs,u),s(Cs,xo),i(e,aa,u),E(ps,e,u),i(e,oa,u),E(et,e,u),i(e,Pn,u),i(e,me,u),s(me,la),s(me,Pe),s(Pe,$o),s(me,An),s(me,Dn),s(Dn,jo),s(me,Sn),s(me,Mn),s(Mn,wo),s(me,ra),i(e,Ps,u),E(As,e,u),i(e,de,u),E(st,e,u),i(e,Ht,u),i(e,oe,u),s(oe,Eo),s(oe,tt),s(tt,ko),s(oe,yo),s(oe,nt),s(nt,Co),s(oe,Po),s(oe,at),s(at,Ao),s(oe,Do),s(oe,ot),s(ot,So),s(oe,Mo),s(oe,Ut),s(Ut,lt),s(oe,ia),s(oe,ds),s(ds,ua),s(oe,Rt),i(e,pa,u),i(e,cs,u),s(cs,rt),s(cs,Qt),s(Qt,Ge),s(cs,zo),i(e,Gt,u),E(it,e,u),i(e,da,u),E(ms,e,u),i(e,ca,u),i(e,Jt,u),s(Jt,ma),i(e,Je,u),E(Ae,e,u),i(e,Wt,u),E(Oe,e,u),i(e,fa,u),i(e,We,u),s(We,No),s(We,Xt),s(Xt,Kt),s(We,To),i(e,zn,u),E(we,e,u),i(e,Ds,u),E(ut,e,u),i(e,Yt,u),i(e,Zt,u),s(Zt,Lo),i(e,ha,u),i(e,ce,u),s(ce,Ss),s(Ss,pt),E(dt,pt,null),s(ce,Oo),s(ce,ct),s(ct,Bo),i(e,_a,u),E(fs,e,u),i(e,va,u),i(e,Ms,u),s(Ms,Fo),s(Ms,be),s(be,Io),s(Ms,Nn),i(e,qa,u),i(e,zs,u),s(zs,Tn),s(zs,Ln),s(Ln,Vo),s(zs,On),i(e,ba,u),E(mt,e,u),i(e,en,u),i(e,ne,u),s(ne,Ho),s(ne,sn),s(sn,tn),s(ne,Uo),s(ne,nn),s(nn,ft),s(ne,ga),s(ne,Xe),s(Xe,Ro),s(ne,Bn),s(ne,ht),s(ht,Qo),s(ne,xa),s(ne,hs),s(hs,$a),s(ne,ae),s(ne,Fn),s(Fn,In),s(ne,Go),s(ne,Vn),s(Vn,Hn),s(ne,Jo),i(e,ja,u),E(_s,e,u),i(e,wa,u),E(_t,e,u),i(e,an,u),i(e,Ke,u),s(Ke,Wo),s(Ke,vt),s(vt,Xo),s(Ke,Ko),s(Ke,qt),s(qt,Yo),s(Ke,Zo),i(e,on,u),E(bt,e,u),i(e,Ea,u),i(e,gt,u),s(gt,Ye),i(e,ka,u),E(vs,e,u),i(e,ya,u),E(xt,e,u),i(e,Ns,u),i(e,De,u),s(De,el),s(De,Un),s(Un,Ca),s(De,m),s(De,B),s(B,ir),s(De,Pa),i(e,sl,u),i(e,Ts,u),s(Ts,ln),s(Ts,ur),s(Ts,rn),i(e,nl,u),i(e,qs,u),s(qs,pr),s(qs,ge),s(ge,dr),s(qs,cr),s(qs,Aa),s(Aa,mr),s(qs,fr),i(e,Qn,u),i(e,$t,u),s($t,Da),s($t,Sa),s(Sa,fe),s($t,hr),i(e,al,u),i(e,Be,u),s(Be,Gn),s(Gn,Ma),s(Ma,_r),s(Gn,vr),s(Be,un),s(Be,Jn),s(Jn,za),s(za,Se),s(Jn,qr),s(Be,br),s(Be,jt),s(jt,Na),s(Na,gr),s(jt,xr),s(jt,Ls),s(Ls,$r),s(jt,jr),s(Be,Ta),s(Be,bs),s(bs,La),s(La,wr),s(bs,Er),s(bs,Os),s(Os,Oa),s(bs,kr),s(bs,Ze),s(Ze,yr),s(bs,Cr),i(e,ol,u),E(Ee,e,u),i(e,ll,u),E(pn,e,u),i(e,rl,u),i(e,xe,u),s(xe,Pr),s(xe,dn),s(dn,Ar),s(xe,he),s(xe,Ba),s(Ba,Dr),s(xe,Sr),s(xe,Fa),s(Fa,Mr),s(xe,zr),s(xe,Ia),s(Ia,cn),s(xe,Nr),s(xe,Va),s(Va,Tr),s(xe,Pc),i(e,hp,u),i(e,Me,u),s(Me,Ac),s(Me,Di),s(Di,Dc),s(Me,Sc),s(Me,Si),s(Si,Mc),s(Me,zc),s(Me,Lr),s(Lr,Nc),s(Me,Tc),s(Me,Mi),s(Mi,Lc),s(Me,Oc),s(Me,zi),s(zi,Bc),s(Me,Fc),i(e,_p,u),E(il,e,u),i(e,vp,u),E(ul,e,u),i(e,qp,u),i(e,ze,u),s(ze,Ic),s(ze,Ni),s(Ni,Vc),s(ze,Hc),s(ze,Ti),s(Ti,Uc),s(ze,Rc),s(ze,Li),s(Li,Qc),s(ze,Gc),s(ze,Oi),s(Oi,Jc),s(ze,Wc),s(ze,Bi),s(Bi,Xc),s(ze,Kc),i(e,bp,u),E(pl,e,u),i(e,gp,u),E(dl,e,u),i(e,xp,u),i(e,Or,u),s(Or,Yc),i(e,$p,u),E(cl,e,u),i(e,jp,u),E(ml,e,u),i(e,wp,u),i(e,Br,u),s(Br,Zc),i(e,Ep,u),i(e,Fr,u),s(Fr,em),i(e,kp,u),i(e,Ha,u),s(Ha,Ir),s(Ir,Fi),s(Fi,sm),s(Ir,tm),s(Ha,nm),s(Ha,es),s(es,Ii),s(Ii,am),s(es,om),s(es,Vi),s(Vi,lm),s(es,rm),s(es,Hi),s(Hi,im),s(es,um),s(es,Ui),s(Ui,pm),s(es,dm),s(es,Ri),s(Ri,cm),s(es,mm),i(e,yp,u),i(e,Ne,u),s(Ne,fm),s(Ne,Qi),s(Qi,hm),s(Ne,_m),s(Ne,Gi),s(Gi,vm),s(Ne,qm),s(Ne,Ji),s(Ji,bm),s(Ne,gm),s(Ne,Wi),s(Wi,xm),s(Ne,$m),s(Ne,Xi),s(Xi,jm),s(Ne,wm),i(e,Cp,u),i(e,Te,u),s(Te,Em),s(Te,Ki),s(Ki,km),s(Te,ym),s(Te,Yi),s(Yi,Cm),s(Te,Pm),s(Te,Zi),s(Zi,Am),s(Te,Dm),s(Te,eu),s(eu,Sm),s(Te,Mm),s(Te,su),s(su,zm),s(Te,Nm),i(e,Pp,u),E(fl,e,u),i(e,Ap,u),E(hl,e,u),i(e,Dp,u),i(e,mn,u),s(mn,Tm),s(mn,tu),s(tu,Lm),s(mn,Om),s(mn,nu),s(nu,Bm),s(mn,Fm),i(e,Sp,u),E(_l,e,u),i(e,Mp,u),E(vl,e,u),i(e,zp,u),i(e,Ua,u),s(Ua,Im),s(Ua,au),s(au,Vm),s(Ua,Hm),i(e,Np,u),E(ql,e,u),i(e,Tp,u),E(bl,e,u),i(e,Lp,u),i(e,Vr,u),s(Vr,Um),i(e,Op,u),E(Ra,e,u),i(e,Bp,u),i(e,Hr,u),s(Hr,Rm),i(e,Fp,u),E(gl,e,u),i(e,Ip,u),i(e,Ur,u),s(Ur,Qm),i(e,Vp,u),i(e,fn,u),s(fn,Gm),s(fn,ou),s(ou,Jm),s(fn,Wm),s(fn,lu),s(lu,Xm),s(fn,Km),i(e,Hp,u),E(xl,e,u),i(e,Up,u),E($l,e,u),i(e,Rp,u),i(e,Rr,u),s(Rr,Ym),i(e,Qp,u),i(e,Wn,u),s(Wn,Qa),s(Qa,ru),E(jl,ru,null),s(Wn,Zm),s(Wn,iu),s(iu,ef),i(e,Gp,u),i(e,Ga,u),s(Ga,sf),s(Ga,uu),s(uu,tf),s(Ga,nf),i(e,Jp,u),i(e,ke,u),s(ke,af),s(ke,pu),s(pu,of),s(ke,lf),s(ke,du),s(du,rf),s(ke,uf),s(ke,cu),s(cu,pf),s(ke,df),s(ke,mu),s(mu,cf),s(ke,mf),s(ke,fu),s(fu,ff),s(ke,hf),s(ke,hu),s(hu,_f),s(ke,vf),i(e,Wp,u),E(wl,e,u),i(e,Xp,u),i(e,Qr,u),s(Qr,qf),i(e,Kp,u),E(El,e,u),i(e,Yp,u),E(kl,e,u),i(e,Zp,u),i(e,Gr,u),s(Gr,bf),i(e,ed,u),i(e,Jr,u),s(Jr,gf),i(e,sd,u),Zl[wt].m(e,u),i(e,Wr,u),i(e,Xn,u),s(Xn,Ja),s(Ja,_u),E(yl,_u,null),s(Xn,xf),s(Xn,vu),s(vu,$f),i(e,td,u),er[kt].m(e,u),i(e,Xr,u),i(e,hn,u),s(hn,jf),s(hn,qu),s(qu,wf),s(hn,Ef),s(hn,Kr),s(Kr,kf),s(hn,yf),i(e,nd,u),i(e,Bs,u),s(Bs,Cl),s(Cl,Cf),s(Cl,bu),s(bu,Pf),s(Cl,Af),s(Bs,Df),s(Bs,gu),s(gu,Sf),s(Bs,Mf),s(Bs,Pl),s(Pl,zf),s(Pl,xu),s(xu,Nf),s(Pl,Tf),s(Bs,Lf),s(Bs,Kn),s(Kn,Of),s(Kn,$u),s($u,Bf),s(Kn,Ff),s(Kn,ju),s(ju,If),s(Kn,Vf),i(e,ad,u),i(e,ss,u),s(ss,Hf),s(ss,wu),s(wu,Uf),s(ss,Rf),s(ss,Eu),s(Eu,Qf),s(ss,Gf),s(ss,ku),s(ku,Jf),s(ss,Wf),od.m(qg,ss),s(ss,ld),i(e,rd,u),i(e,Fs,u),s(Fs,Xf),s(Fs,yu),s(yu,Kf),s(Fs,Yf),s(Fs,Cu),s(Cu,Zf),s(Fs,eh),s(Fs,Pu),s(Pu,sh),s(Fs,th),i(e,id,u),E(Al,e,u),i(e,ud,u),i(e,Wa,u),s(Wa,nh),s(Wa,Au),s(Au,ah),s(Wa,oh),i(e,pd,u),E(Dl,e,u),i(e,dd,u),i(e,Xa,u),s(Xa,lh),s(Xa,Du),s(Du,rh),s(Xa,ih),i(e,cd,u),sr[Ct].m(e,u),i(e,Yr,u),i(e,ts,u),s(ts,uh),s(ts,Su),s(Su,ph),s(ts,dh),s(ts,Mu),s(Mu,ch),s(ts,mh),s(ts,zu),s(zu,fh),s(ts,hh),s(ts,Nu),s(Nu,_h),s(ts,vh),i(e,md,u),E(Sl,e,u),i(e,fd,u),i(e,Ka,u),s(Ka,qh),s(Ka,Tu),s(Tu,bh),s(Ka,gh),i(e,hd,u),i(e,_n,u),s(_n,Lu),s(Lu,xh),s(_n,$h),s(_n,Ou),s(Ou,jh),s(_n,wh),s(_n,Ml),s(Ml,Eh),s(Ml,Bu),s(Bu,kh),s(Ml,yh),i(e,_d,u),i(e,Zr,u),s(Zr,Ch),i(e,vd,u),E(zl,e,u),i(e,qd,u),i(e,Ya,u),s(Ya,Ph),s(Ya,Fu),s(Fu,Ah),s(Ya,Dh),i(e,bd,u),E(Nl,e,u),i(e,gd,u),i(e,ei,u),s(ei,Sh),i(e,xd,u),E(Tl,e,u),i(e,$d,u),i(e,si,u),s(si,Mh),i(e,jd,u),E(Ll,e,u),i(e,wd,u),E(Ol,e,u),i(e,Ed,u),i(e,ti,u),s(ti,zh),i(e,kd,u),E(Bl,e,u),i(e,yd,u),E(Fl,e,u),i(e,Cd,u),i(e,vn,u),s(vn,Nh),s(vn,Il),s(Il,Th),s(vn,Lh),s(vn,Iu),s(Iu,Oh),s(vn,Bh),i(e,Pd,u),ea.m(e,u),i(e,ni,u),E(Vl,e,u),i(e,Ad,u),i(e,ai,u),s(ai,Fh),i(e,Dd,u),E(Hl,e,u),i(e,Sd,u),E(Ul,e,u),i(e,Md,u),i(e,Za,u),s(Za,Ih),s(Za,Vu),s(Vu,Vh),s(Za,Hh),i(e,zd,u),i(e,Yn,u),s(Yn,eo),s(eo,Hu),E(Rl,Hu,null),s(Yn,Uh),s(Yn,oi),s(oi,Uu),s(Uu,Rh),s(oi,Qh),i(e,Nd,u),tr[At].m(e,u),i(e,li,u),i(e,so,u),s(so,Gh),s(so,Ru),s(Ru,Jh),s(so,Wh),i(e,Td,u),i(e,Is,u),s(Is,Xh),s(Is,Qu),s(Qu,Kh),s(Is,Yh),s(Is,Gu),s(Gu,Zh),s(Is,e_),s(Is,Ju),s(Ju,s_),s(Is,t_),i(e,Ld,u),E(Ql,e,u),i(e,Od,u),i(e,to,u),s(to,n_),s(to,Wu),s(Wu,a_),s(to,o_),i(e,Bd,u),E(Gl,e,u),i(e,Fd,u),nr[St].m(e,u),i(e,ri,u),i(e,ns,u),s(ns,l_),s(ns,Xu),s(Xu,r_),s(ns,i_),s(ns,Ku),s(Ku,u_),s(ns,p_),s(ns,Yu),s(Yu,d_),s(ns,c_),s(ns,Zu),s(Zu,m_),s(ns,f_),i(e,Id,u),ar[zt].m(e,u),i(e,ii,u),i(e,qn,u),s(qn,h_),s(qn,ep),s(ep,__),s(qn,v_),s(qn,sp),s(sp,q_),s(qn,b_),i(e,Vd,u),or[Tt].m(e,u),i(e,ui,u),E(Jl,e,u),i(e,Hd,u),i(e,pi,u),s(pi,g_),i(e,Ud,u),$e&&$e.m(e,u),i(e,di,u),i(e,Vs,u),s(Vs,x_),s(Vs,tp),s(tp,$_),s(Vs,j_),s(Vs,np),s(np,w_),s(Vs,E_),s(Vs,ap),s(ap,k_),s(Vs,y_),i(e,Rd,u),E(no,e,u),i(e,Qd,u),je&&je.m(e,u),i(e,ci,u),i(e,Zn,u),s(Zn,ao),s(ao,op),E(Wl,op,null),s(Zn,C_),s(Zn,mi),s(mi,P_),s(mi,lp),s(lp,A_),i(e,Gd,u),i(e,as,u),s(as,D_),s(as,rp),s(rp,S_),s(as,M_),s(as,ip),s(ip,z_),s(as,N_),s(as,up),s(up,T_),s(as,L_),s(as,pp),s(pp,O_),s(as,B_),i(e,Jd,u),E(Xl,e,u),i(e,Wd,u),E(Kl,e,u),i(e,Xd,u),i(e,fi,u),s(fi,F_),Kd=!0},p(e,[u]){const lr={};u&1&&(lr.fw=e[0]),f.$set(lr);let hi=N;N=G_(e),N!==hi&&(wn(),v(Yl[hi],1,1,()=>{Yl[hi]=null}),jn(),I=Yl[N],I||(I=Yl[N]=Q_[N](e),I.c()),_(I,1),I.m(z.parentNode,z));const dp={};u&2&&(dp.$$scope={dirty:u,ctx:e}),_e.$set(dp);const cp={};u&2&&(cp.$$scope={dirty:u,ctx:e}),Ra.$set(cp);let oo=wt;wt=W_(e),wt!==oo&&(wn(),v(Zl[oo],1,1,()=>{Zl[oo]=null}),jn(),Et=Zl[wt],Et||(Et=Zl[wt]=J_[wt](e),Et.c()),_(Et,1),Et.m(Wr.parentNode,Wr));let _i=kt;kt=K_(e),kt!==_i&&(wn(),v(er[_i],1,1,()=>{er[_i]=null}),jn(),yt=er[kt],yt||(yt=er[kt]=X_[kt](e),yt.c()),_(yt,1),yt.m(Xr.parentNode,Xr));let Hs=Ct;Ct=Z_(e),Ct!==Hs&&(wn(),v(sr[Hs],1,1,()=>{sr[Hs]=null}),jn(),Pt=sr[Ct],Pt||(Pt=sr[Ct]=Y_[Ct](e),Pt.c()),_(Pt,1),Pt.m(Yr.parentNode,Yr)),Yd!==(Yd=ev(e))&&(ea.d(1),ea=Yd(e),ea&&(ea.c(),ea.m(ni.parentNode,ni)));let vi=At;At=tv(e),At!==vi&&(wn(),v(tr[vi],1,1,()=>{tr[vi]=null}),jn(),Dt=tr[At],Dt||(Dt=tr[At]=sv[At](e),Dt.c()),_(Dt,1),Dt.m(li.parentNode,li));let qi=St;St=av(e),St!==qi&&(wn(),v(nr[qi],1,1,()=>{nr[qi]=null}),jn(),Mt=nr[St],Mt||(Mt=nr[St]=nv[St](e),Mt.c()),_(Mt,1),Mt.m(ri.parentNode,ri));let bi=zt;zt=lv(e),zt!==bi&&(wn(),v(ar[bi],1,1,()=>{ar[bi]=null}),jn(),Nt=ar[zt],Nt||(Nt=ar[zt]=ov[zt](e),Nt.c()),_(Nt,1),Nt.m(ii.parentNode,ii));let sa=Tt;Tt=iv(e),Tt!==sa&&(wn(),v(or[sa],1,1,()=>{or[sa]=null}),jn(),Lt=or[Tt],Lt||(Lt=or[Tt]=rv[Tt](e),Lt.c()),_(Lt,1),Lt.m(ui.parentNode,ui)),e[0]==="pt"?$e?u&1&&_($e,1):($e=hg(),$e.c(),_($e,1),$e.m(di.parentNode,di)):$e&&(wn(),v($e,1,1,()=>{$e=null}),jn());const mp={};u&2&&(mp.$$scope={dirty:u,ctx:e}),no.$set(mp),e[0]==="pt"?je?u&1&&_(je,1):(je=_g(),je.c(),_(je,1),je.m(ci.parentNode,ci)):je&&(wn(),v(je,1,1,()=>{je=null}),jn())},i(e){Kd||(_(f.$$.fragment,e),_(x.$$.fragment,e),_(I),_(Q.$$.fragment,e),_(_e.$$.fragment,e),_(Re.$$.fragment,e),_(Ks.$$.fragment,e),_(Zs.$$.fragment,e),_(ps.$$.fragment,e),_(et.$$.fragment,e),_(As.$$.fragment,e),_(st.$$.fragment,e),_(it.$$.fragment,e),_(ms.$$.fragment,e),_(Ae.$$.fragment,e),_(Oe.$$.fragment,e),_(we.$$.fragment,e),_(ut.$$.fragment,e),_(dt.$$.fragment,e),_(fs.$$.fragment,e),_(mt.$$.fragment,e),_(_s.$$.fragment,e),_(_t.$$.fragment,e),_(bt.$$.fragment,e),_(vs.$$.fragment,e),_(xt.$$.fragment,e),_(Ee.$$.fragment,e),_(pn.$$.fragment,e),_(il.$$.fragment,e),_(ul.$$.fragment,e),_(pl.$$.fragment,e),_(dl.$$.fragment,e),_(cl.$$.fragment,e),_(ml.$$.fragment,e),_(fl.$$.fragment,e),_(hl.$$.fragment,e),_(_l.$$.fragment,e),_(vl.$$.fragment,e),_(ql.$$.fragment,e),_(bl.$$.fragment,e),_(Ra.$$.fragment,e),_(gl.$$.fragment,e),_(xl.$$.fragment,e),_($l.$$.fragment,e),_(jl.$$.fragment,e),_(wl.$$.fragment,e),_(El.$$.fragment,e),_(kl.$$.fragment,e),_(Et),_(yl.$$.fragment,e),_(yt),_(Al.$$.fragment,e),_(Dl.$$.fragment,e),_(Pt),_(Sl.$$.fragment,e),_(zl.$$.fragment,e),_(Nl.$$.fragment,e),_(Tl.$$.fragment,e),_(Ll.$$.fragment,e),_(Ol.$$.fragment,e),_(Bl.$$.fragment,e),_(Fl.$$.fragment,e),_(Vl.$$.fragment,e),_(Hl.$$.fragment,e),_(Ul.$$.fragment,e),_(Rl.$$.fragment,e),_(Dt),_(Ql.$$.fragment,e),_(Gl.$$.fragment,e),_(Mt),_(Nt),_(Lt),_(Jl.$$.fragment,e),_($e),_(no.$$.fragment,e),_(je),_(Wl.$$.fragment,e),_(Xl.$$.fragment,e),_(Kl.$$.fragment,e),Kd=!0)},o(e){v(f.$$.fragment,e),v(x.$$.fragment,e),v(I),v(Q.$$.fragment,e),v(_e.$$.fragment,e),v(Re.$$.fragment,e),v(Ks.$$.fragment,e),v(Zs.$$.fragment,e),v(ps.$$.fragment,e),v(et.$$.fragment,e),v(As.$$.fragment,e),v(st.$$.fragment,e),v(it.$$.fragment,e),v(ms.$$.fragment,e),v(Ae.$$.fragment,e),v(Oe.$$.fragment,e),v(we.$$.fragment,e),v(ut.$$.fragment,e),v(dt.$$.fragment,e),v(fs.$$.fragment,e),v(mt.$$.fragment,e),v(_s.$$.fragment,e),v(_t.$$.fragment,e),v(bt.$$.fragment,e),v(vs.$$.fragment,e),v(xt.$$.fragment,e),v(Ee.$$.fragment,e),v(pn.$$.fragment,e),v(il.$$.fragment,e),v(ul.$$.fragment,e),v(pl.$$.fragment,e),v(dl.$$.fragment,e),v(cl.$$.fragment,e),v(ml.$$.fragment,e),v(fl.$$.fragment,e),v(hl.$$.fragment,e),v(_l.$$.fragment,e),v(vl.$$.fragment,e),v(ql.$$.fragment,e),v(bl.$$.fragment,e),v(Ra.$$.fragment,e),v(gl.$$.fragment,e),v(xl.$$.fragment,e),v($l.$$.fragment,e),v(jl.$$.fragment,e),v(wl.$$.fragment,e),v(El.$$.fragment,e),v(kl.$$.fragment,e),v(Et),v(yl.$$.fragment,e),v(yt),v(Al.$$.fragment,e),v(Dl.$$.fragment,e),v(Pt),v(Sl.$$.fragment,e),v(zl.$$.fragment,e),v(Nl.$$.fragment,e),v(Tl.$$.fragment,e),v(Ll.$$.fragment,e),v(Ol.$$.fragment,e),v(Bl.$$.fragment,e),v(Fl.$$.fragment,e),v(Vl.$$.fragment,e),v(Hl.$$.fragment,e),v(Ul.$$.fragment,e),v(Rl.$$.fragment,e),v(Dt),v(Ql.$$.fragment,e),v(Gl.$$.fragment,e),v(Mt),v(Nt),v(Lt),v(Jl.$$.fragment,e),v($e),v(no.$$.fragment,e),v(je),v(Wl.$$.fragment,e),v(Xl.$$.fragment,e),v(Kl.$$.fragment,e),Kd=!1},d(e){t(p),e&&t(q),k(f,e),e&&t(y),e&&t(D),k(x),e&&t(A),Yl[N].d(e),e&&t(z),e&&t(P),e&&t(U),k(Q,e),e&&t(W),e&&t(H),e&&t(ye),e&&t(ie),e&&t(Fe),e&&t(ue),e&&t(rs),e&&t(J),e&&t(Es),k(_e,e),e&&t(He),e&&t(pe),k(Re),e&&t(En),e&&t(qe),e&&t(te),e&&t(us),k(Ks),e&&t(It),e&&t(ys),e&&t(Vt),k(Zs,e),e&&t(na),e&&t(Cs),e&&t(aa),k(ps,e),e&&t(oa),k(et,e),e&&t(Pn),e&&t(me),e&&t(Ps),k(As,e),e&&t(de),k(st,e),e&&t(Ht),e&&t(oe),e&&t(pa),e&&t(cs),e&&t(Gt),k(it,e),e&&t(da),k(ms,e),e&&t(ca),e&&t(Jt),e&&t(Je),k(Ae,e),e&&t(Wt),k(Oe,e),e&&t(fa),e&&t(We),e&&t(zn),k(we,e),e&&t(Ds),k(ut,e),e&&t(Yt),e&&t(Zt),e&&t(ha),e&&t(ce),k(dt),e&&t(_a),k(fs,e),e&&t(va),e&&t(Ms),e&&t(qa),e&&t(zs),e&&t(ba),k(mt,e),e&&t(en),e&&t(ne),e&&t(ja),k(_s,e),e&&t(wa),k(_t,e),e&&t(an),e&&t(Ke),e&&t(on),k(bt,e),e&&t(Ea),e&&t(gt),e&&t(ka),k(vs,e),e&&t(ya),k(xt,e),e&&t(Ns),e&&t(De),e&&t(sl),e&&t(Ts),e&&t(nl),e&&t(qs),e&&t(Qn),e&&t($t),e&&t(al),e&&t(Be),e&&t(ol),k(Ee,e),e&&t(ll),k(pn,e),e&&t(rl),e&&t(xe),e&&t(hp),e&&t(Me),e&&t(_p),k(il,e),e&&t(vp),k(ul,e),e&&t(qp),e&&t(ze),e&&t(bp),k(pl,e),e&&t(gp),k(dl,e),e&&t(xp),e&&t(Or),e&&t($p),k(cl,e),e&&t(jp),k(ml,e),e&&t(wp),e&&t(Br),e&&t(Ep),e&&t(Fr),e&&t(kp),e&&t(Ha),e&&t(yp),e&&t(Ne),e&&t(Cp),e&&t(Te),e&&t(Pp),k(fl,e),e&&t(Ap),k(hl,e),e&&t(Dp),e&&t(mn),e&&t(Sp),k(_l,e),e&&t(Mp),k(vl,e),e&&t(zp),e&&t(Ua),e&&t(Np),k(ql,e),e&&t(Tp),k(bl,e),e&&t(Lp),e&&t(Vr),e&&t(Op),k(Ra,e),e&&t(Bp),e&&t(Hr),e&&t(Fp),k(gl,e),e&&t(Ip),e&&t(Ur),e&&t(Vp),e&&t(fn),e&&t(Hp),k(xl,e),e&&t(Up),k($l,e),e&&t(Rp),e&&t(Rr),e&&t(Qp),e&&t(Wn),k(jl),e&&t(Gp),e&&t(Ga),e&&t(Jp),e&&t(ke),e&&t(Wp),k(wl,e),e&&t(Xp),e&&t(Qr),e&&t(Kp),k(El,e),e&&t(Yp),k(kl,e),e&&t(Zp),e&&t(Gr),e&&t(ed),e&&t(Jr),e&&t(sd),Zl[wt].d(e),e&&t(Wr),e&&t(Xn),k(yl),e&&t(td),er[kt].d(e),e&&t(Xr),e&&t(hn),e&&t(nd),e&&t(Bs),e&&t(ad),e&&t(ss),e&&t(rd),e&&t(Fs),e&&t(id),k(Al,e),e&&t(ud),e&&t(Wa),e&&t(pd),k(Dl,e),e&&t(dd),e&&t(Xa),e&&t(cd),sr[Ct].d(e),e&&t(Yr),e&&t(ts),e&&t(md),k(Sl,e),e&&t(fd),e&&t(Ka),e&&t(hd),e&&t(_n),e&&t(_d),e&&t(Zr),e&&t(vd),k(zl,e),e&&t(qd),e&&t(Ya),e&&t(bd),k(Nl,e),e&&t(gd),e&&t(ei),e&&t(xd),k(Tl,e),e&&t($d),e&&t(si),e&&t(jd),k(Ll,e),e&&t(wd),k(Ol,e),e&&t(Ed),e&&t(ti),e&&t(kd),k(Bl,e),e&&t(yd),k(Fl,e),e&&t(Cd),e&&t(vn),e&&t(Pd),ea.d(e),e&&t(ni),k(Vl,e),e&&t(Ad),e&&t(ai),e&&t(Dd),k(Hl,e),e&&t(Sd),k(Ul,e),e&&t(Md),e&&t(Za),e&&t(zd),e&&t(Yn),k(Rl),e&&t(Nd),tr[At].d(e),e&&t(li),e&&t(so),e&&t(Td),e&&t(Is),e&&t(Ld),k(Ql,e),e&&t(Od),e&&t(to),e&&t(Bd),k(Gl,e),e&&t(Fd),nr[St].d(e),e&&t(ri),e&&t(ns),e&&t(Id),ar[zt].d(e),e&&t(ii),e&&t(qn),e&&t(Vd),or[Tt].d(e),e&&t(ui),k(Jl,e),e&&t(Hd),e&&t(pi),e&&t(Ud),$e&&$e.d(e),e&&t(di),e&&t(Vs),e&&t(Rd),k(no,e),e&&t(Qd),je&&je.d(e),e&&t(ci),e&&t(Zn),k(Wl),e&&t(Gd),e&&t(as),e&&t(Jd),k(Xl,e),e&&t(Wd),k(Kl,e),e&&t(Xd),e&&t(fi)}}}const Xg={local:"rponse-aux-questions",sections:[{local:"prparation-des-donnes",sections:[{local:"le-jeu-de-donnes-squad",title:"Le jeu de donn\xE9es SQuAD"},{local:"traitement-des-donnes-dentranement",title:"Traitement des donn\xE9es d'entra\xEEnement"},{local:"traitement-des-donnes-de-validation",title:"Traitement des donn\xE9es de validation"}],title:"Pr\xE9paration des donn\xE9es"},{local:"ifinetuneri-le-modle-avec-lapi-trainer",title:"<i>Finetuner</i> le mod\xE8le avec l'API `Trainer`"},{local:"ifinetuneri-fin-du-modle-avec-keras",sections:[{local:"posttraitement",title:"Post-traitement"},{local:"ifinetuningi-du-modle",title:"<i>Finetuning</i> du mod\xE8le"}],title:"<i>Finetuner</i> fin du mod\xE8le avec Keras"},{local:"une-boucle-dentranement-personnalise",sections:[{local:"prparer-tout-pour-lentranement",title:"Pr\xE9parer tout pour l'entra\xEEnement"}],title:"Une boucle d'entra\xEEnement personnalis\xE9e"},{local:"boucle-dentranement",sections:[{local:"utilisation-du-modle-ifinetuni",title:"Utilisation du mod\xE8le <i>finetun\xE9</i>"}],title:"Boucle d'entra\xEEnement"}],title:"R\xE9ponse aux questions"};function Kg(R,p,q){let f="pt";return Eg(()=>{const y=new URLSearchParams(window.location.search);q(0,f=y.get("fw")||"pt")}),[f]}class o1 extends bg{constructor(p){super();gg(this,p,Kg,Wg,xg,{})}}export{o1 as default,Xg as metadata};
