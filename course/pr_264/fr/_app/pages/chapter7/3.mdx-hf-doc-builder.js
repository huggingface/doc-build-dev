import{S as Vv,i as Wv,s as Jv,e as l,t as a,c as o,a as r,h as n,d as t,g as p,G as s,k as m,w as E,m as f,x as j,y as w,q as g,o as b,B as x,b as y,M as Yv,N as Xr,p as Ht,v as Qv,n as Ut}from"../../chunks/vendor-hf-doc-builder.js";import{T as Sa}from"../../chunks/Tip-hf-doc-builder.js";import{Y as ap}from"../../chunks/Youtube-hf-doc-builder.js";import{I as Oa}from"../../chunks/IconCopyLink-hf-doc-builder.js";import{C as T}from"../../chunks/CodeBlock-hf-doc-builder.js";import{D as Gv}from"../../chunks/DocNotebookDropdown-hf-doc-builder.js";import{F as Xv}from"../../chunks/FrameworkSwitchCourse-hf-doc-builder.js";function Zv(I){let i,h;return i=new Gv({props:{classNames:"absolute z-10 right-0 top-0",options:[{label:"Google Colab",value:"https://colab.research.google.com/github/huggingface/notebooks/blob/master/course/chapter7/section3_tf.ipynb"},{label:"Aws Studio",value:"https://studiolab.sagemaker.aws/import/github/huggingface/notebooks/blob/master/course/chapter7/section3_tf.ipynb"}]}}),{c(){E(i.$$.fragment)},l(d){j(i.$$.fragment,d)},m(d,k){w(i,d,k),h=!0},i(d){h||(g(i.$$.fragment,d),h=!0)},o(d){b(i.$$.fragment,d),h=!1},d(d){x(i,d)}}}function eg(I){let i,h;return i=new Gv({props:{classNames:"absolute z-10 right-0 top-0",options:[{label:"Google Colab",value:"https://colab.research.google.com/github/huggingface/notebooks/blob/master/course/chapter7/section3_pt.ipynb"},{label:"Aws Studio",value:"https://studiolab.sagemaker.aws/import/github/huggingface/notebooks/blob/master/course/chapter7/section3_pt.ipynb"}]}}),{c(){E(i.$$.fragment)},l(d){j(i.$$.fragment,d)},m(d,k){w(i,d,k),h=!0},i(d){h||(g(i.$$.fragment,d),h=!0)},o(d){b(i.$$.fragment,d),h=!1},d(d){x(i,d)}}}function sg(I){let i,h,d,k,A;return{c(){i=l("p"),h=a("\u{1F64B} Si les termes \xAB mod\xE9lisation du langage masqu\xE9 \xBB et \xAB mod\xE8le pr\xE9-entra\xEEn\xE9 \xBB ne vous sont pas familiers, consultez le "),d=l("a"),k=a("chapitre 1"),A=a(", o\xF9 nous expliquons tous ces concepts fondamentaux, vid\xE9os \xE0 l\u2019appui !"),this.h()},l($){i=o($,"P",{});var q=r(i);h=n(q,"\u{1F64B} Si les termes \xAB mod\xE9lisation du langage masqu\xE9 \xBB et \xAB mod\xE8le pr\xE9-entra\xEEn\xE9 \xBB ne vous sont pas familiers, consultez le "),d=o(q,"A",{href:!0});var z=r(d);k=n(z,"chapitre 1"),z.forEach(t),A=n(q,", o\xF9 nous expliquons tous ces concepts fondamentaux, vid\xE9os \xE0 l\u2019appui !"),q.forEach(t),this.h()},h(){y(d,"href","/course/fr/chapiter1")},m($,q){p($,i,q),s(i,h),s(i,d),s(d,k),s(i,A)},d($){$&&t(i)}}}function tg(I){let i,h,d,k,A,$,q,z,_,M,O,C,L,H,P,D,U,R;return q=new T({props:{code:"",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> TFAutoModelForMaskedLM

model_checkpoint = <span class="hljs-string">&quot;distilbert-base-uncased&quot;</span>
model = TFAutoModelForMaskedLM.from_pretrained(model_checkpoint)`}}),P=new T({props:{code:`model(model.dummy_inputs)  # Construire le mod\xE8le
model.summary()`,highlighted:`model(model.dummy_inputs)  <span class="hljs-comment"># Construire le mod\xE8le</span>
model.summary()`}}),U=new T({props:{code:`Model: "tf_distil_bert_for_masked_lm"
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
distilbert (TFDistilBertMain multiple                  66362880  
_________________________________________________________________
vocab_transform (Dense)      multiple                  590592    
_________________________________________________________________
vocab_layer_norm (LayerNorma multiple                  1536      
_________________________________________________________________
vocab_projector (TFDistilBer multiple                  23866170  
=================================================================
Total params: 66,985,530
Trainable params: 66,985,530
Non-trainable params: 0
_________________________________________________________________`,highlighted:`Model: <span class="hljs-string">&quot;tf_distil_bert_for_masked_lm&quot;</span>
_________________________________________________________________
Layer (<span class="hljs-built_in">type</span>)                 Output Shape              Param <span class="hljs-comment">#   </span>
=================================================================
distilbert (TFDistilBertMain multiple                  <span class="hljs-number">66362880</span>  
_________________________________________________________________
vocab_transform (Dense)      multiple                  <span class="hljs-number">590592</span>    
_________________________________________________________________
vocab_layer_norm (LayerNorma multiple                  <span class="hljs-number">1536</span>      
_________________________________________________________________
vocab_projector (TFDistilBer multiple                  <span class="hljs-number">23866170</span>  
=================================================================
Total params: <span class="hljs-number">66</span>,<span class="hljs-number">985</span>,<span class="hljs-number">530</span>
Trainable params: <span class="hljs-number">66</span>,<span class="hljs-number">985</span>,<span class="hljs-number">530</span>
Non-trainable params: <span class="hljs-number">0</span>
_________________________________________________________________`}}),{c(){i=l("p"),h=a("Allons-y et t\xE9l\xE9chargeons DistilBERT en utilisant la classe "),d=l("code"),k=a("AutoModelForMaskedLM"),A=a(" :"),$=m(),E(q.$$.fragment),z=m(),_=l("p"),M=a("Nous pouvons voir combien de param\xE8tres ce mod\xE8le poss\xE8de en appelant la m\xE9thode "),O=l("code"),C=a("summary()"),L=a(" :"),H=m(),E(P.$$.fragment),D=m(),E(U.$$.fragment)},l(v){i=o(v,"P",{});var S=r(i);h=n(S,"Allons-y et t\xE9l\xE9chargeons DistilBERT en utilisant la classe "),d=o(S,"CODE",{});var W=r(d);k=n(W,"AutoModelForMaskedLM"),W.forEach(t),A=n(S," :"),S.forEach(t),$=f(v),j(q.$$.fragment,v),z=f(v),_=o(v,"P",{});var G=r(_);M=n(G,"Nous pouvons voir combien de param\xE8tres ce mod\xE8le poss\xE8de en appelant la m\xE9thode "),O=o(G,"CODE",{});var J=r(O);C=n(J,"summary()"),J.forEach(t),L=n(G," :"),G.forEach(t),H=f(v),j(P.$$.fragment,v),D=f(v),j(U.$$.fragment,v)},m(v,S){p(v,i,S),s(i,h),s(i,d),s(d,k),s(i,A),p(v,$,S),w(q,v,S),p(v,z,S),p(v,_,S),s(_,M),s(_,O),s(O,C),s(_,L),p(v,H,S),w(P,v,S),p(v,D,S),w(U,v,S),R=!0},i(v){R||(g(q.$$.fragment,v),g(P.$$.fragment,v),g(U.$$.fragment,v),R=!0)},o(v){b(q.$$.fragment,v),b(P.$$.fragment,v),b(U.$$.fragment,v),R=!1},d(v){v&&t(i),v&&t($),x(q,v),v&&t(z),v&&t(_),v&&t(H),x(P,v),v&&t(D),x(U,v)}}}function ag(I){let i,h,d,k,A,$,q,z,_,M,O,C,L,H,P,D,U,R;return q=new T({props:{code:"",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoModelForMaskedLM

model_checkpoint = <span class="hljs-string">&quot;distilbert-base-uncased&quot;</span>
model = AutoModelForMaskedLM.from_pretrained(model_checkpoint)`}}),P=new T({props:{code:`distilbert_num_parameters = model.num_parameters() / 1_000_000
print(f"'>>> DistilBERT nombre de param\xE8tres : {round(distilbert_num_parameters)}M'")
print(f"'>>> BERT nombre de param\xE8tres : 110M'")`,highlighted:`distilbert_num_parameters = model.num_parameters() / <span class="hljs-number">1_000_000</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;&#x27;&gt;&gt;&gt; DistilBERT nombre de param\xE8tres : <span class="hljs-subst">{<span class="hljs-built_in">round</span>(distilbert_num_parameters)}</span>M&#x27;&quot;</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;&#x27;&gt;&gt;&gt; BERT nombre de param\xE8tres : 110M&#x27;&quot;</span>)`}}),U=new T({props:{code:`'>>> DistilBERT  nombre de param\xE8tres : 67M'
'>>> BERT nombre de param\xE8tres : 110M'`,highlighted:`<span class="hljs-string">&#x27;&gt;&gt;&gt; DistilBERT  nombre de param\xE8tres : 67M&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; BERT nombre de param\xE8tres : 110M&#x27;</span>`}}),{c(){i=l("p"),h=a("Allons-y et t\xE9l\xE9chargeons DistilBERT en utilisant la classe "),d=l("code"),k=a("AutoModelForMaskedLM"),A=a(" :"),$=m(),E(q.$$.fragment),z=m(),_=l("p"),M=a("Nous pouvons voir combien de param\xE8tres ce mod\xE8le poss\xE8de en appelant la m\xE9thode "),O=l("code"),C=a("num_parameters()"),L=a(" :"),H=m(),E(P.$$.fragment),D=m(),E(U.$$.fragment)},l(v){i=o(v,"P",{});var S=r(i);h=n(S,"Allons-y et t\xE9l\xE9chargeons DistilBERT en utilisant la classe "),d=o(S,"CODE",{});var W=r(d);k=n(W,"AutoModelForMaskedLM"),W.forEach(t),A=n(S," :"),S.forEach(t),$=f(v),j(q.$$.fragment,v),z=f(v),_=o(v,"P",{});var G=r(_);M=n(G,"Nous pouvons voir combien de param\xE8tres ce mod\xE8le poss\xE8de en appelant la m\xE9thode "),O=o(G,"CODE",{});var J=r(O);C=n(J,"num_parameters()"),J.forEach(t),L=n(G," :"),G.forEach(t),H=f(v),j(P.$$.fragment,v),D=f(v),j(U.$$.fragment,v)},m(v,S){p(v,i,S),s(i,h),s(i,d),s(d,k),s(i,A),p(v,$,S),w(q,v,S),p(v,z,S),p(v,_,S),s(_,M),s(_,O),s(O,C),s(_,L),p(v,H,S),w(P,v,S),p(v,D,S),w(U,v,S),R=!0},i(v){R||(g(q.$$.fragment,v),g(P.$$.fragment,v),g(U.$$.fragment,v),R=!0)},o(v){b(q.$$.fragment,v),b(P.$$.fragment,v),b(U.$$.fragment,v),R=!1},d(v){v&&t(i),v&&t($),x(q,v),v&&t(z),v&&t(_),v&&t(H),x(P,v),v&&t(D),x(U,v)}}}function ng(I){let i,h;return i=new T({props:{code:`
`,highlighted:`<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf

inputs = tokenizer(text, return_tensors=<span class="hljs-string">&quot;np&quot;</span>)
token_logits = model(**inputs).logits
<span class="hljs-comment"># Trouve l&#x27;emplacement de [MASK] et extrait ses logits</span>
mask_token_index = np.argwhere(inputs[<span class="hljs-string">&quot;input_ids&quot;</span>] == tokenizer.mask_token_id)[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>]
mask_token_logits = token_logits[<span class="hljs-number">0</span>, mask_token_index, :]
<span class="hljs-comment"># On choisit les candidats [MASK] avec les logits les plus \xE9lev\xE9s</span>
<span class="hljs-comment"># Nous annulons le tableau avant argsort pour obtenir le plus grand, et non le plus petit, logits</span>
top_5_tokens = np.argsort(-mask_token_logits)[:<span class="hljs-number">5</span>].tolist()

<span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> top_5_tokens:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;&gt;&gt;&gt; <span class="hljs-subst">{text.replace(tokenizer.mask_token, tokenizer.decode([token]))}</span>&quot;</span>)`}}),{c(){E(i.$$.fragment)},l(d){j(i.$$.fragment,d)},m(d,k){w(i,d,k),h=!0},i(d){h||(g(i.$$.fragment,d),h=!0)},o(d){b(i.$$.fragment,d),h=!1},d(d){x(i,d)}}}function lg(I){let i,h;return i=new T({props:{code:`
`,highlighted:`<span class="hljs-keyword">import</span> torch

inputs = tokenizer(text, return_tensors=<span class="hljs-string">&quot;pt&quot;</span>)
token_logits = model(**inputs).logits
<span class="hljs-comment"># Trouve l&#x27;emplacement de [MASK] et extrait ses logits</span>
mask_token_index = torch.where(inputs[<span class="hljs-string">&quot;input_ids&quot;</span>] == tokenizer.mask_token_id)[<span class="hljs-number">1</span>]
mask_token_logits = token_logits[<span class="hljs-number">0</span>, mask_token_index, :]
<span class="hljs-comment"># Choisissez les candidats [MASK] avec les logits les plus \xE9lev\xE9s</span>
top_5_tokens = torch.topk(mask_token_logits, <span class="hljs-number">5</span>, dim=<span class="hljs-number">1</span>).indices[<span class="hljs-number">0</span>].tolist()

<span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> top_5_tokens:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;&#x27;&gt;&gt;&gt; <span class="hljs-subst">{text.replace(tokenizer.mask_token, tokenizer.decode([token]))}</span>&#x27;&quot;</span>)`}}),{c(){E(i.$$.fragment)},l(d){j(i.$$.fragment,d)},m(d,k){w(i,d,k),h=!0},i(d){h||(g(i.$$.fragment,d),h=!0)},o(d){b(i.$$.fragment,d),h=!1},d(d){x(i,d)}}}function og(I){let i,h,d,k,A,$,q,z,_,M,O,C,L,H,P,D,U,R,v,S,W,G,J,ee,re,te;return{c(){i=l("p"),h=a("\u270F\uFE0F "),d=l("strong"),k=a("Essayez !"),A=a(" Cr\xE9ez un \xE9chantillon al\xE9atoire de la r\xE9partition "),$=l("code"),q=a("unsupervised"),z=a(" et v\xE9rifiez que les \xE9tiquettes ne sont ni "),_=l("code"),M=a("0"),O=a(" ni "),C=l("code"),L=a("1"),H=a(". Pendant que vous y \xEAtes, vous pouvez aussi v\xE9rifier que les \xE9tiquettes dans les \xE9chantillons "),P=l("code"),D=a("train"),U=a(" et "),R=l("code"),v=a("test"),S=a(" sont bien "),W=l("code"),G=a("0"),J=a(" ou "),ee=l("code"),re=a("1"),te=a(". C\u2019est un contr\xF4le utile que tout praticien en NLP devrait effectuer au d\xE9but d\u2019un nouveau projet !")},l(V){i=o(V,"P",{});var B=r(i);h=n(B,"\u270F\uFE0F "),d=o(B,"STRONG",{});var ie=r(d);k=n(ie,"Essayez !"),ie.forEach(t),A=n(B," Cr\xE9ez un \xE9chantillon al\xE9atoire de la r\xE9partition "),$=o(B,"CODE",{});var Q=r($);q=n(Q,"unsupervised"),Q.forEach(t),z=n(B," et v\xE9rifiez que les \xE9tiquettes ne sont ni "),_=o(B,"CODE",{});var se=r(_);M=n(se,"0"),se.forEach(t),O=n(B," ni "),C=o(B,"CODE",{});var ue=r(C);L=n(ue,"1"),ue.forEach(t),H=n(B,". Pendant que vous y \xEAtes, vous pouvez aussi v\xE9rifier que les \xE9tiquettes dans les \xE9chantillons "),P=o(B,"CODE",{});var Z=r(P);D=n(Z,"train"),Z.forEach(t),U=n(B," et "),R=o(B,"CODE",{});var ge=r(R);v=n(ge,"test"),ge.forEach(t),S=n(B," sont bien "),W=o(B,"CODE",{});var ne=r(W);G=n(ne,"0"),ne.forEach(t),J=n(B," ou "),ee=o(B,"CODE",{});var de=r(ee);re=n(de,"1"),de.forEach(t),te=n(B,". C\u2019est un contr\xF4le utile que tout praticien en NLP devrait effectuer au d\xE9but d\u2019un nouveau projet !"),B.forEach(t)},m(V,B){p(V,i,B),s(i,h),s(i,d),s(d,k),s(i,A),s(i,$),s($,q),s(i,z),s(i,_),s(_,M),s(i,O),s(i,C),s(C,L),s(i,H),s(i,P),s(P,D),s(i,U),s(i,R),s(R,v),s(i,S),s(i,W),s(W,G),s(i,J),s(i,ee),s(ee,re),s(i,te)},d(V){V&&t(i)}}}function rg(I){let i,h,d,k,A,$,q,z,_,M,O,C,L,H,P,D,U,R,v,S,W,G,J,ee,re,te;return{c(){i=l("p"),h=a("\u270F\uFE0F "),d=l("strong"),k=a("Essayez !"),A=a(" Certains "),$=l("em"),q=a("transformers"),z=a(", comme "),_=l("a"),M=a("BigBird"),O=a(" et "),C=l("a"),L=a("Longformer"),H=a(", ont une longueur de contexte beaucoup plus longue que BERT et les autres premiers "),P=l("em"),D=a("transformers"),U=a(". Instanciez le "),R=l("em"),v=a("tokenizer"),S=a(" pour l\u2019un de ces "),W=l("em"),G=a("checkpoints"),J=a(" et v\xE9rifiez que le "),ee=l("code"),re=a("model_max_length"),te=a(" correspond \xE0 ce qui est indiqu\xE9 sur sa carte."),this.h()},l(V){i=o(V,"P",{});var B=r(i);h=n(B,"\u270F\uFE0F "),d=o(B,"STRONG",{});var ie=r(d);k=n(ie,"Essayez !"),ie.forEach(t),A=n(B," Certains "),$=o(B,"EM",{});var Q=r($);q=n(Q,"transformers"),Q.forEach(t),z=n(B,", comme "),_=o(B,"A",{href:!0,rel:!0});var se=r(_);M=n(se,"BigBird"),se.forEach(t),O=n(B," et "),C=o(B,"A",{href:!0});var ue=r(C);L=n(ue,"Longformer"),ue.forEach(t),H=n(B,", ont une longueur de contexte beaucoup plus longue que BERT et les autres premiers "),P=o(B,"EM",{});var Z=r(P);D=n(Z,"transformers"),Z.forEach(t),U=n(B,". Instanciez le "),R=o(B,"EM",{});var ge=r(R);v=n(ge,"tokenizer"),ge.forEach(t),S=n(B," pour l\u2019un de ces "),W=o(B,"EM",{});var ne=r(W);G=n(ne,"checkpoints"),ne.forEach(t),J=n(B," et v\xE9rifiez que le "),ee=o(B,"CODE",{});var de=r(ee);re=n(de,"model_max_length"),de.forEach(t),te=n(B," correspond \xE0 ce qui est indiqu\xE9 sur sa carte."),B.forEach(t),this.h()},h(){y(_,"href","https://huggingface.co/google/bigbird-roberta-base"),y(_,"rel","nofollow"),y(C,"href","hf.co/allenai/longformer-base-4096")},m(V,B){p(V,i,B),s(i,h),s(i,d),s(d,k),s(i,A),s(i,$),s($,q),s(i,z),s(i,_),s(_,M),s(i,O),s(i,C),s(C,L),s(i,H),s(i,P),s(P,D),s(i,U),s(i,R),s(R,v),s(i,S),s(i,W),s(W,G),s(i,J),s(i,ee),s(ee,re),s(i,te)},d(V){V&&t(i)}}}function ig(I){let i,h;return{c(){i=l("p"),h=a("Notez que l\u2019utilisation d\u2019une petite taille peut \xEAtre pr\xE9judiciable dans les sc\xE9narios du monde r\xE9el. Vous devez donc utiliser une taille qui correspond au cas d\u2019utilisation auquel vous appliquerez votre mod\xE8le.")},l(d){i=o(d,"P",{});var k=r(i);h=n(k,"Notez que l\u2019utilisation d\u2019une petite taille peut \xEAtre pr\xE9judiciable dans les sc\xE9narios du monde r\xE9el. Vous devez donc utiliser une taille qui correspond au cas d\u2019utilisation auquel vous appliquerez votre mod\xE8le."),k.forEach(t)},m(d,k){p(d,i,k),s(i,h)},d(d){d&&t(i)}}}function ug(I){let i,h,d,k,A,$,q,z,_,M,O,C,L,H;return{c(){i=l("p"),h=a("\u270F\uFE0F "),d=l("strong"),k=a("Essayez"),A=a(" Ex\xE9cutez le code ci-dessus plusieurs fois pour voir le masquage al\xE9atoire se produire sous vos yeux ! Remplacez aussi la m\xE9thode "),$=l("code"),q=a("tokenizer.decode()"),z=a(" par "),_=l("code"),M=a("tokenizer.convert_ids_to_tokens()"),O=a(" pour voir que parfois un seul "),C=l("em"),L=a("token"),H=a(" d\u2019un mot donn\xE9 est masqu\xE9 et pas les autres.")},l(P){i=o(P,"P",{});var D=r(i);h=n(D,"\u270F\uFE0F "),d=o(D,"STRONG",{});var U=r(d);k=n(U,"Essayez"),U.forEach(t),A=n(D," Ex\xE9cutez le code ci-dessus plusieurs fois pour voir le masquage al\xE9atoire se produire sous vos yeux ! Remplacez aussi la m\xE9thode "),$=o(D,"CODE",{});var R=r($);q=n(R,"tokenizer.decode()"),R.forEach(t),z=n(D," par "),_=o(D,"CODE",{});var v=r(_);M=n(v,"tokenizer.convert_ids_to_tokens()"),v.forEach(t),O=n(D," pour voir que parfois un seul "),C=o(D,"EM",{});var S=r(C);L=n(S,"token"),S.forEach(t),H=n(D," d\u2019un mot donn\xE9 est masqu\xE9 et pas les autres."),D.forEach(t)},m(P,D){p(P,i,D),s(i,h),s(i,d),s(d,k),s(i,A),s(i,$),s($,q),s(i,z),s(i,_),s(_,M),s(i,O),s(i,C),s(C,L),s(i,H)},d(P){P&&t(i)}}}function Iv(I){let i,h,d,k,A,$,q,z,_,M,O;return{c(){i=l("p"),h=a("Un effet secondaire du masquage al\xE9atoire est que nos m\xE9triques d\u2019\xE9valuation ne seront pas d\xE9terministes lorsque nous utilisons la fonction "),d=l("code"),k=a("Trainer"),A=a(" puisque nous utilisons le m\xEAme collateur de donn\xE9es pour les \xE9chantillons d\u2019entra\xEEnement et de test. Nous verrons plus tard, lorsque nous examinerons le "),$=l("em"),q=a("finetuning"),z=a(" avec \u{1F917} "),_=l("em"),M=a("Accelerate"),O=a(", comment nous pouvons utiliser la flexibilit\xE9 d\u2019une boucle d\u2019\xE9valuation personnalis\xE9e pour geler le caract\xE8re al\xE9atoire.")},l(C){i=o(C,"P",{});var L=r(i);h=n(L,"Un effet secondaire du masquage al\xE9atoire est que nos m\xE9triques d\u2019\xE9valuation ne seront pas d\xE9terministes lorsque nous utilisons la fonction "),d=o(L,"CODE",{});var H=r(d);k=n(H,"Trainer"),H.forEach(t),A=n(L," puisque nous utilisons le m\xEAme collateur de donn\xE9es pour les \xE9chantillons d\u2019entra\xEEnement et de test. Nous verrons plus tard, lorsque nous examinerons le "),$=o(L,"EM",{});var P=r($);q=n(P,"finetuning"),P.forEach(t),z=n(L," avec \u{1F917} "),_=o(L,"EM",{});var D=r(_);M=n(D,"Accelerate"),D.forEach(t),O=n(L,", comment nous pouvons utiliser la flexibilit\xE9 d\u2019une boucle d\u2019\xE9valuation personnalis\xE9e pour geler le caract\xE8re al\xE9atoire."),L.forEach(t)},m(C,L){p(C,i,L),s(i,h),s(i,d),s(d,k),s(i,A),s(i,$),s($,q),s(i,z),s(i,_),s(_,M),s(i,O)},d(C){C&&t(i)}}}function pg(I){let i,h;return i=new T({props:{code:`





`,highlighted:`<span class="hljs-keyword">import</span> collections
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-keyword">from</span> transformers.data <span class="hljs-keyword">import</span> tf_default_data_collator

wwm_probability = <span class="hljs-number">0.2</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">whole_word_masking_data_collator</span>(<span class="hljs-params">features</span>):
    <span class="hljs-keyword">for</span> feature <span class="hljs-keyword">in</span> features:
        word_ids = feature.pop(<span class="hljs-string">&quot;word_ids&quot;</span>)

        <span class="hljs-comment"># Cr\xE9ation d&#x27;une correspondance entre les mots et les indices des tokens correspondants</span>
        mapping = collections.defaultdict(<span class="hljs-built_in">list</span>)
        current_word_index = -<span class="hljs-number">1</span>
        current_word = <span class="hljs-literal">None</span>
        <span class="hljs-keyword">for</span> idx, word_id <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(word_ids):
            <span class="hljs-keyword">if</span> word_id <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
                <span class="hljs-keyword">if</span> word_id != current_word:
                    current_word = word_id
                    current_word_index += <span class="hljs-number">1</span>
                mapping[current_word_index].append(idx)

        <span class="hljs-comment"># Masquer des mots de fa\xE7on al\xE9atoire</span>
        mask = np.random.binomial(<span class="hljs-number">1</span>, wwm_probability, (<span class="hljs-built_in">len</span>(mapping),))
        input_ids = feature[<span class="hljs-string">&quot;input_ids&quot;</span>]
        labels = feature[<span class="hljs-string">&quot;labels&quot;</span>]
        new_labels = [-<span class="hljs-number">100</span>] * <span class="hljs-built_in">len</span>(labels)
        <span class="hljs-keyword">for</span> word_id <span class="hljs-keyword">in</span> np.where(mask)[<span class="hljs-number">0</span>]:
            word_id = word_id.item()
            <span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> mapping[word_id]:
                new_labels[idx] = labels[idx]
                input_ids[idx] = tokenizer.mask_token_id

    <span class="hljs-keyword">return</span> tf_default_data_collator(features)`}}),{c(){E(i.$$.fragment)},l(d){j(i.$$.fragment,d)},m(d,k){w(i,d,k),h=!0},i(d){h||(g(i.$$.fragment,d),h=!0)},o(d){b(i.$$.fragment,d),h=!1},d(d){x(i,d)}}}function dg(I){let i,h;return i=new T({props:{code:`





`,highlighted:`<span class="hljs-keyword">import</span> collections
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> default_data_collator

wwm_probability = <span class="hljs-number">0.2</span>


<span class="hljs-keyword">def</span> <span class="hljs-title function_">whole_word_masking_data_collator</span>(<span class="hljs-params">features</span>):
    <span class="hljs-keyword">for</span> feature <span class="hljs-keyword">in</span> features:
        word_ids = feature.pop(<span class="hljs-string">&quot;word_ids&quot;</span>)

        <span class="hljs-comment"># Cr\xE9ation d&#x27;une correspondance entre les mots et les indices des tokens correspondants</span>
        mapping = collections.defaultdict(<span class="hljs-built_in">list</span>)
        current_word_index = -<span class="hljs-number">1</span>
        current_word = <span class="hljs-literal">None</span>
        <span class="hljs-keyword">for</span> idx, word_id <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(word_ids):
            <span class="hljs-keyword">if</span> word_id <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
                <span class="hljs-keyword">if</span> word_id != current_word:
                    current_word = word_id
                    current_word_index += <span class="hljs-number">1</span>
                mapping[current_word_index].append(idx)

        <span class="hljs-comment"># Masquer des mots de fa\xE7on al\xE9atoire</span>
        mask = np.random.binomial(<span class="hljs-number">1</span>, wwm_probability, (<span class="hljs-built_in">len</span>(mapping),))
        input_ids = feature[<span class="hljs-string">&quot;input_ids&quot;</span>]
        labels = feature[<span class="hljs-string">&quot;labels&quot;</span>]
        new_labels = [-<span class="hljs-number">100</span>] * <span class="hljs-built_in">len</span>(labels)
        <span class="hljs-keyword">for</span> word_id <span class="hljs-keyword">in</span> np.where(mask)[<span class="hljs-number">0</span>]:
            word_id = word_id.item()
            <span class="hljs-keyword">for</span> idx <span class="hljs-keyword">in</span> mapping[word_id]:
                new_labels[idx] = labels[idx]
                input_ids[idx] = tokenizer.mask_token_id

    <span class="hljs-keyword">return</span> default_data_collator(features)`}}),{c(){E(i.$$.fragment)},l(d){j(i.$$.fragment,d)},m(d,k){w(i,d,k),h=!0},i(d){h||(g(i.$$.fragment,d),h=!0)},o(d){b(i.$$.fragment,d),h=!1},d(d){x(i,d)}}}function cg(I){let i,h,d,k,A,$,q,z,_,M,O,C,L,H;return{c(){i=l("p"),h=a("\u270F\uFE0F "),d=l("strong"),k=a("Essayez"),A=a(" Ex\xE9cutez le code ci-dessus plusieurs fois pour voir le masquage al\xE9atoire se produire sous vos yeux ! Remplacez aussi la m\xE9thode "),$=l("code"),q=a("tokenizer.decode()"),z=a(" par "),_=l("code"),M=a("tokenizer.convert_ids_to_tokens()"),O=a(" pour voir que les "),C=l("em"),L=a("tokens"),H=a(" d\u2019un mot donn\xE9 sont toujours masqu\xE9s ensemble.")},l(P){i=o(P,"P",{});var D=r(i);h=n(D,"\u270F\uFE0F "),d=o(D,"STRONG",{});var U=r(d);k=n(U,"Essayez"),U.forEach(t),A=n(D," Ex\xE9cutez le code ci-dessus plusieurs fois pour voir le masquage al\xE9atoire se produire sous vos yeux ! Remplacez aussi la m\xE9thode "),$=o(D,"CODE",{});var R=r($);q=n(R,"tokenizer.decode()"),R.forEach(t),z=n(D," par "),_=o(D,"CODE",{});var v=r(_);M=n(v,"tokenizer.convert_ids_to_tokens()"),v.forEach(t),O=n(D," pour voir que les "),C=o(D,"EM",{});var S=r(C);L=n(S,"tokens"),S.forEach(t),H=n(D," d\u2019un mot donn\xE9 sont toujours masqu\xE9s ensemble."),D.forEach(t)},m(P,D){p(P,i,D),s(i,h),s(i,d),s(d,k),s(i,A),s(i,$),s($,q),s(i,z),s(i,_),s(_,M),s(i,O),s(i,C),s(C,L),s(i,H)},d(P){P&&t(i)}}}function mg(I){let i,h,d,k,A,$,q,z,_,M,O,C,L,H,P,D,U,R,v,S,W,G,J,ee,re,te,V,B,ie,Q,se,ue,Z,ge,ne,de,rs,be,qe,is,Ve,$e,us,We,xe,Se,Je,X,pe,ye,ce,ps,ze,ke,Xe,le,Ze,Ee,je,K,ae,Be,me,es,Ye,Me,Oe,Ke;return q=new T({props:{code:`
`,highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> TrainingArguments

batch_size = <span class="hljs-number">64</span>
<span class="hljs-comment"># Montrer la perte d&#x27;entra\xEEnement \xE0 chaque \xE9poque</span>
logging_steps = <span class="hljs-built_in">len</span>(downsampled_dataset[<span class="hljs-string">&quot;train&quot;</span>]) // batch_size
model_name = model_checkpoint.split(<span class="hljs-string">&quot;/&quot;</span>)[-<span class="hljs-number">1</span>]

training_args = TrainingArguments(
    output_dir=<span class="hljs-string">f&quot;<span class="hljs-subst">{model_name}</span>-finetuned-imdb&quot;</span>,
    overwrite_output_dir=<span class="hljs-literal">True</span>,
    evaluation_strategy=<span class="hljs-string">&quot;epoch&quot;</span>,
    learning_rate=<span class="hljs-number">2e-5</span>,
    weight_decay=<span class="hljs-number">0.01</span>,
    per_device_train_batch_size=batch_size,
    per_device_eval_batch_size=batch_size,
    push_to_hub=<span class="hljs-literal">True</span>,
    fp16=<span class="hljs-literal">True</span>,
    logging_steps=logging_steps,
)`}}),Ee=new T({props:{code:"",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> Trainer

trainer = Trainer(
    model=model,
    args=training_args,
    train_dataset=downsampled_dataset[<span class="hljs-string">&quot;train&quot;</span>],
    eval_dataset=downsampled_dataset[<span class="hljs-string">&quot;test&quot;</span>],
    data_collator=data_collator,
)`}}),{c(){i=l("p"),h=a("Une fois que nous sommes connect\xE9s, nous pouvons sp\xE9cifier les arguments pour le "),d=l("code"),k=a("Trainer"),A=a(" :"),$=m(),E(q.$$.fragment),z=m(),_=l("p"),M=a("Ici, nous avons modifi\xE9 quelques options par d\xE9faut, y compris "),O=l("code"),C=a("logging_steps"),L=a(" pour s\u2019assurer que nous suivons la perte d\u2019entra\xEEnement \xE0 chaque \xE9poque. Nous avons \xE9galement utilis\xE9 "),H=l("code"),P=a("fp16=True"),D=a(" pour activer l\u2019entra\xEEnement en pr\xE9cision mixte, ce qui nous donne un autre gain de vitesse. Par d\xE9faut, "),U=l("code"),R=a("Trainer"),v=a(" va supprimer toutes les colonnes qui ne font pas partie de la m\xE9thode "),S=l("code"),W=a("forward()"),G=a(" du mod\xE8le. Cela signifie que si vous utilisez le collateur de masquage de mots entiers, vous devrez \xE9galement d\xE9finir "),J=l("code"),ee=a("remove_unused_columns=False"),re=a(" pour vous assurer que nous ne perdons pas la colonne "),te=l("code"),V=a("word_ids"),B=a(" pendant l\u2019entra\xEEnement."),ie=m(),Q=l("p"),se=a("Notez que vous pouvez sp\xE9cifier le nom du d\xE9p\xF4t vers lequel vous voulez pousser avec l\u2019argument "),ue=l("code"),Z=a("hub_model_id"),ge=a(" (en particulier, vous devrez utiliser cet argument pour pousser vers une organisation). Par exemple, lorsque nous avons pouss\xE9 le mod\xE8le vers l\u2019organisation "),ne=l("a"),de=l("code"),rs=a("huggingface-course"),be=a(", nous avons ajout\xE9 "),qe=l("code"),is=a('hub_model_id="huggingface-course/distilbert-finetuned-imdb"'),Ve=m(),$e=l("code"),us=a("TrainingArguments"),We=a(". Par d\xE9faut, le d\xE9p\xF4t utilis\xE9 sera dans votre espace de noms et nomm\xE9 apr\xE8s le r\xE9pertoire de sortie que vous avez d\xE9fini, donc dans notre cas ce sera "),xe=l("code"),Se=a('"lewtun/distilbert-finetuned-imdb"'),Je=a("."),X=m(),pe=l("p"),ye=a("Nous avons maintenant tous les ingr\xE9dients pour instancier le "),ce=l("code"),ps=a("Trainer"),ze=a(". Ici, nous utilisons juste le collateur standard "),ke=l("code"),Xe=a("data_collator"),le=a(", mais vous pouvez essayer le collateur de masquage de mots entiers et comparer les r\xE9sultats comme exercice :"),Ze=m(),E(Ee.$$.fragment),je=m(),K=l("p"),ae=a("Nous sommes maintenant pr\xEAts \xE0 ex\xE9cuter "),Be=l("code"),me=a("trainer.train()"),es=a(". Mais avant, regardons bri\xE8vement la "),Ye=l("em"),Me=a("perplexit\xE9"),Oe=a(" qui est une m\xE9trique commune pour \xE9valuer la performance des mod\xE8les de langage."),this.h()},l(N){i=o(N,"P",{});var Y=r(i);h=n(Y,"Une fois que nous sommes connect\xE9s, nous pouvons sp\xE9cifier les arguments pour le "),d=o(Y,"CODE",{});var Ks=r(d);k=n(Ks,"Trainer"),Ks.forEach(t),A=n(Y," :"),Y.forEach(t),$=f(N),j(q.$$.fragment,N),z=f(N),_=o(N,"P",{});var oe=r(_);M=n(oe,"Ici, nous avons modifi\xE9 quelques options par d\xE9faut, y compris "),O=o(oe,"CODE",{});var Ce=r(O);C=n(Ce,"logging_steps"),Ce.forEach(t),L=n(oe," pour s\u2019assurer que nous suivons la perte d\u2019entra\xEEnement \xE0 chaque \xE9poque. Nous avons \xE9galement utilis\xE9 "),H=o(oe,"CODE",{});var Ps=r(H);P=n(Ps,"fp16=True"),Ps.forEach(t),D=n(oe," pour activer l\u2019entra\xEEnement en pr\xE9cision mixte, ce qui nous donne un autre gain de vitesse. Par d\xE9faut, "),U=o(oe,"CODE",{});var Fe=r(U);R=n(Fe,"Trainer"),Fe.forEach(t),v=n(oe," va supprimer toutes les colonnes qui ne font pas partie de la m\xE9thode "),S=o(oe,"CODE",{});var Qe=r(S);W=n(Qe,"forward()"),Qe.forEach(t),G=n(oe," du mod\xE8le. Cela signifie que si vous utilisez le collateur de masquage de mots entiers, vous devrez \xE9galement d\xE9finir "),J=o(oe,"CODE",{});var Ie=r(J);ee=n(Ie,"remove_unused_columns=False"),Ie.forEach(t),re=n(oe," pour vous assurer que nous ne perdons pas la colonne "),te=o(oe,"CODE",{});var De=r(te);V=n(De,"word_ids"),De.forEach(t),B=n(oe," pendant l\u2019entra\xEEnement."),oe.forEach(t),ie=f(N),Q=o(N,"P",{});var _e=r(Q);se=n(_e,"Notez que vous pouvez sp\xE9cifier le nom du d\xE9p\xF4t vers lequel vous voulez pousser avec l\u2019argument "),ue=o(_e,"CODE",{});var Fs=r(ue);Z=n(Fs,"hub_model_id"),Fs.forEach(t),ge=n(_e," (en particulier, vous devrez utiliser cet argument pour pousser vers une organisation). Par exemple, lorsque nous avons pouss\xE9 le mod\xE8le vers l\u2019organisation "),ne=o(_e,"A",{href:!0,rel:!0});var nt=r(ne);de=o(nt,"CODE",{});var Pe=r(de);rs=n(Pe,"huggingface-course"),Pe.forEach(t),nt.forEach(t),be=n(_e,", nous avons ajout\xE9 "),qe=o(_e,"CODE",{});var yt=r(qe);is=n(yt,'hub_model_id="huggingface-course/distilbert-finetuned-imdb"'),yt.forEach(t),Ve=f(_e),$e=o(_e,"CODE",{});var ds=r($e);us=n(ds,"TrainingArguments"),ds.forEach(t),We=n(_e,". Par d\xE9faut, le d\xE9p\xF4t utilis\xE9 sera dans votre espace de noms et nomm\xE9 apr\xE8s le r\xE9pertoire de sortie que vous avez d\xE9fini, donc dans notre cas ce sera "),xe=o(_e,"CODE",{});var we=r(xe);Se=n(we,'"lewtun/distilbert-finetuned-imdb"'),we.forEach(t),Je=n(_e,"."),_e.forEach(t),X=f(N),pe=o(N,"P",{});var He=r(pe);ye=n(He,"Nous avons maintenant tous les ingr\xE9dients pour instancier le "),ce=o(He,"CODE",{});var lt=r(ce);ps=n(lt,"Trainer"),lt.forEach(t),ze=n(He,". Ici, nous utilisons juste le collateur standard "),ke=o(He,"CODE",{});var cs=r(ke);Xe=n(cs,"data_collator"),cs.forEach(t),le=n(He,", mais vous pouvez essayer le collateur de masquage de mots entiers et comparer les r\xE9sultats comme exercice :"),He.forEach(t),Ze=f(N),j(Ee.$$.fragment,N),je=f(N),K=o(N,"P",{});var gs=r(K);ae=n(gs,"Nous sommes maintenant pr\xEAts \xE0 ex\xE9cuter "),Be=o(gs,"CODE",{});var ot=r(Be);me=n(ot,"trainer.train()"),ot.forEach(t),es=n(gs,". Mais avant, regardons bri\xE8vement la "),Ye=o(gs,"EM",{});var ms=r(Ye);Me=n(ms,"perplexit\xE9"),ms.forEach(t),Oe=n(gs," qui est une m\xE9trique commune pour \xE9valuer la performance des mod\xE8les de langage."),gs.forEach(t),this.h()},h(){y(ne,"href","https://huggingface.co/huggingface-course"),y(ne,"rel","nofollow")},m(N,Y){p(N,i,Y),s(i,h),s(i,d),s(d,k),s(i,A),p(N,$,Y),w(q,N,Y),p(N,z,Y),p(N,_,Y),s(_,M),s(_,O),s(O,C),s(_,L),s(_,H),s(H,P),s(_,D),s(_,U),s(U,R),s(_,v),s(_,S),s(S,W),s(_,G),s(_,J),s(J,ee),s(_,re),s(_,te),s(te,V),s(_,B),p(N,ie,Y),p(N,Q,Y),s(Q,se),s(Q,ue),s(ue,Z),s(Q,ge),s(Q,ne),s(ne,de),s(de,rs),s(Q,be),s(Q,qe),s(qe,is),s(Q,Ve),s(Q,$e),s($e,us),s(Q,We),s(Q,xe),s(xe,Se),s(Q,Je),p(N,X,Y),p(N,pe,Y),s(pe,ye),s(pe,ce),s(ce,ps),s(pe,ze),s(pe,ke),s(ke,Xe),s(pe,le),p(N,Ze,Y),w(Ee,N,Y),p(N,je,Y),p(N,K,Y),s(K,ae),s(K,Be),s(Be,me),s(K,es),s(K,Ye),s(Ye,Me),s(K,Oe),Ke=!0},i(N){Ke||(g(q.$$.fragment,N),g(Ee.$$.fragment,N),Ke=!0)},o(N){b(q.$$.fragment,N),b(Ee.$$.fragment,N),Ke=!1},d(N){N&&t(i),N&&t($),x(q,N),N&&t(z),N&&t(_),N&&t(ie),N&&t(Q),N&&t(X),N&&t(pe),N&&t(Ze),x(Ee,N),N&&t(je),N&&t(K)}}}function fg(I){let i,h,d,k,A,$,q,z,_,M,O,C,L,H,P,D,U,R,v,S,W,G,J,ee,re,te,V,B,ie,Q,se,ue,Z,ge,ne,de,rs,be,qe,is,Ve,$e,us,We,xe,Se,Je,X,pe,ye,ce,ps,ze,ke,Xe,le,Ze,Ee,je;return q=new T({props:{code:"",highlighted:`tf_train_dataset = downsampled_dataset[<span class="hljs-string">&quot;train&quot;</span>].to_tf_dataset(
    columns=[<span class="hljs-string">&quot;input_ids&quot;</span>, <span class="hljs-string">&quot;attention_mask&quot;</span>, <span class="hljs-string">&quot;labels&quot;</span>],
    collate_fn=data_collator,
    shuffle=<span class="hljs-literal">True</span>,
    batch_size=<span class="hljs-number">32</span>,
)

tf_eval_dataset = downsampled_dataset[<span class="hljs-string">&quot;test&quot;</span>].to_tf_dataset(
    columns=[<span class="hljs-string">&quot;input_ids&quot;</span>, <span class="hljs-string">&quot;attention_mask&quot;</span>, <span class="hljs-string">&quot;labels&quot;</span>],
    collate_fn=data_collator,
    shuffle=<span class="hljs-literal">False</span>,
    batch_size=<span class="hljs-number">32</span>,
)`}}),pe=new T({props:{code:`

`,highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> create_optimizer
<span class="hljs-keyword">from</span> transformers.keras_callbacks <span class="hljs-keyword">import</span> PushToHubCallback
<span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf

num_train_steps = <span class="hljs-built_in">len</span>(tf_train_dataset)
optimizer, schedule = create_optimizer(
    init_lr=<span class="hljs-number">2e-5</span>,
    num_warmup_steps=<span class="hljs-number">1_000</span>,
    num_train_steps=num_train_steps,
    weight_decay_rate=<span class="hljs-number">0.01</span>,
)
model.<span class="hljs-built_in">compile</span>(optimizer=optimizer)

<span class="hljs-comment"># Entra\xEEner en mixed-precision float16</span>
tf.keras.mixed_precision.set_global_policy(<span class="hljs-string">&quot;mixed_float16&quot;</span>)

callback = PushToHubCallback(
    output_dir=<span class="hljs-string">f&quot;<span class="hljs-subst">{model_name}</span>-finetuned-imdb&quot;</span>, tokenizer=tokenizer
)`}}),{c(){i=l("p"),h=a("Une fois que nous sommes connect\xE9s, nous pouvons cr\xE9er nos jeux de donn\xE9es "),d=l("code"),k=a("tf.data"),A=a(". Nous n\u2019utiliserons ici que le collecteur de donn\xE9es standard, mais vous pouvez \xE9galement essayer le collecteur de masquage de mots entiers et comparer les r\xE9sultats \xE0 titre d\u2019exercice :"),$=m(),E(q.$$.fragment),z=m(),_=l("p"),M=a("Ensuite, nous configurons nos hyperparam\xE8tres d\u2019entra\xEEnement et compilons notre mod\xE8le. Nous utilisons la fonction "),O=l("code"),C=a("create_optimizer()"),L=a(" de la biblioth\xE8que \u{1F917} "),H=l("em"),P=a("Transformers"),D=a(", qui nous donne un optimiseur "),U=l("code"),R=a("AdamW"),v=a(" avec une d\xE9croissance lin\xE9aire du taux d\u2019apprentissage. Nous utilisons \xE9galement la perte int\xE9gr\xE9e au mod\xE8le, qui est la perte par d\xE9faut lorsqu\u2019aucune perte n\u2019est sp\xE9cifi\xE9e comme argument de "),S=l("code"),W=a("compile()"),G=a(", et nous d\xE9finissons la pr\xE9cision d\u2019entra\xEEnement \xE0 "),J=l("code"),ee=a('"mixed_float16"'),re=a(". Notez que si vous utilisez un GPU Colab ou un autre GPU qui n\u2019a pas le support acc\xE9l\xE9r\xE9 en float16, vous devriez probablement commenter cette ligne."),te=m(),V=l("p"),B=a("De plus, nous mettons en place un "),ie=l("code"),Q=a("PushToHubCallback"),se=a(" qui sauvegardera le mod\xE8le sur le "),ue=l("em"),Z=a("Hub"),ge=a(" apr\xE8s chaque \xE9poque. Vous pouvez sp\xE9cifier le nom du d\xE9p\xF4t vers lequel vous voulez pousser avec l\u2019argument "),ne=l("code"),de=a("hub_model_id"),rs=a(" (en particulier, vous devrez utiliser cet argument pour pousser vers une organisation). Par exemple, pour pousser le mod\xE8le vers l\u2019organisation "),be=l("a"),qe=l("code"),is=a("huggingface-course"),Ve=a(", nous avons ajout\xE9 "),$e=l("code"),us=a('hub_model_id="huggingface-course/distilbert-finetuned-imdb"'),We=a(". Par d\xE9faut, le d\xE9p\xF4t utilis\xE9 sera dans votre espace de noms et nomm\xE9 apr\xE8s le r\xE9pertoire de sortie que vous avez d\xE9fini, donc dans notre cas, ce sera "),xe=l("code"),Se=a('"lewtun/distilbert-finetuned-imdb"'),Je=a("."),X=m(),E(pe.$$.fragment),ye=m(),ce=l("p"),ps=a("Nous sommes maintenant pr\xEAts \xE0 ex\xE9cuter "),ze=l("code"),ke=a("model.fit()"),Xe=a(". Mais avant, regardons bri\xE8vement la "),le=l("em"),Ze=a("perplexit\xE9"),Ee=a(" qui est une m\xE9trique commune pour \xE9valuer la performance des mod\xE8les de langage."),this.h()},l(K){i=o(K,"P",{});var ae=r(i);h=n(ae,"Une fois que nous sommes connect\xE9s, nous pouvons cr\xE9er nos jeux de donn\xE9es "),d=o(ae,"CODE",{});var Be=r(d);k=n(Be,"tf.data"),Be.forEach(t),A=n(ae,". Nous n\u2019utiliserons ici que le collecteur de donn\xE9es standard, mais vous pouvez \xE9galement essayer le collecteur de masquage de mots entiers et comparer les r\xE9sultats \xE0 titre d\u2019exercice :"),ae.forEach(t),$=f(K),j(q.$$.fragment,K),z=f(K),_=o(K,"P",{});var me=r(_);M=n(me,"Ensuite, nous configurons nos hyperparam\xE8tres d\u2019entra\xEEnement et compilons notre mod\xE8le. Nous utilisons la fonction "),O=o(me,"CODE",{});var es=r(O);C=n(es,"create_optimizer()"),es.forEach(t),L=n(me," de la biblioth\xE8que \u{1F917} "),H=o(me,"EM",{});var Ye=r(H);P=n(Ye,"Transformers"),Ye.forEach(t),D=n(me,", qui nous donne un optimiseur "),U=o(me,"CODE",{});var Me=r(U);R=n(Me,"AdamW"),Me.forEach(t),v=n(me," avec une d\xE9croissance lin\xE9aire du taux d\u2019apprentissage. Nous utilisons \xE9galement la perte int\xE9gr\xE9e au mod\xE8le, qui est la perte par d\xE9faut lorsqu\u2019aucune perte n\u2019est sp\xE9cifi\xE9e comme argument de "),S=o(me,"CODE",{});var Oe=r(S);W=n(Oe,"compile()"),Oe.forEach(t),G=n(me,", et nous d\xE9finissons la pr\xE9cision d\u2019entra\xEEnement \xE0 "),J=o(me,"CODE",{});var Ke=r(J);ee=n(Ke,'"mixed_float16"'),Ke.forEach(t),re=n(me,". Notez que si vous utilisez un GPU Colab ou un autre GPU qui n\u2019a pas le support acc\xE9l\xE9r\xE9 en float16, vous devriez probablement commenter cette ligne."),me.forEach(t),te=f(K),V=o(K,"P",{});var N=r(V);B=n(N,"De plus, nous mettons en place un "),ie=o(N,"CODE",{});var Y=r(ie);Q=n(Y,"PushToHubCallback"),Y.forEach(t),se=n(N," qui sauvegardera le mod\xE8le sur le "),ue=o(N,"EM",{});var Ks=r(ue);Z=n(Ks,"Hub"),Ks.forEach(t),ge=n(N," apr\xE8s chaque \xE9poque. Vous pouvez sp\xE9cifier le nom du d\xE9p\xF4t vers lequel vous voulez pousser avec l\u2019argument "),ne=o(N,"CODE",{});var oe=r(ne);de=n(oe,"hub_model_id"),oe.forEach(t),rs=n(N," (en particulier, vous devrez utiliser cet argument pour pousser vers une organisation). Par exemple, pour pousser le mod\xE8le vers l\u2019organisation "),be=o(N,"A",{href:!0,rel:!0});var Ce=r(be);qe=o(Ce,"CODE",{});var Ps=r(qe);is=n(Ps,"huggingface-course"),Ps.forEach(t),Ce.forEach(t),Ve=n(N,", nous avons ajout\xE9 "),$e=o(N,"CODE",{});var Fe=r($e);us=n(Fe,'hub_model_id="huggingface-course/distilbert-finetuned-imdb"'),Fe.forEach(t),We=n(N,". Par d\xE9faut, le d\xE9p\xF4t utilis\xE9 sera dans votre espace de noms et nomm\xE9 apr\xE8s le r\xE9pertoire de sortie que vous avez d\xE9fini, donc dans notre cas, ce sera "),xe=o(N,"CODE",{});var Qe=r(xe);Se=n(Qe,'"lewtun/distilbert-finetuned-imdb"'),Qe.forEach(t),Je=n(N,"."),N.forEach(t),X=f(K),j(pe.$$.fragment,K),ye=f(K),ce=o(K,"P",{});var Ie=r(ce);ps=n(Ie,"Nous sommes maintenant pr\xEAts \xE0 ex\xE9cuter "),ze=o(Ie,"CODE",{});var De=r(ze);ke=n(De,"model.fit()"),De.forEach(t),Xe=n(Ie,". Mais avant, regardons bri\xE8vement la "),le=o(Ie,"EM",{});var _e=r(le);Ze=n(_e,"perplexit\xE9"),_e.forEach(t),Ee=n(Ie," qui est une m\xE9trique commune pour \xE9valuer la performance des mod\xE8les de langage."),Ie.forEach(t),this.h()},h(){y(be,"href","https://huggingface.co/huggingface-course"),y(be,"rel","nofollow")},m(K,ae){p(K,i,ae),s(i,h),s(i,d),s(d,k),s(i,A),p(K,$,ae),w(q,K,ae),p(K,z,ae),p(K,_,ae),s(_,M),s(_,O),s(O,C),s(_,L),s(_,H),s(H,P),s(_,D),s(_,U),s(U,R),s(_,v),s(_,S),s(S,W),s(_,G),s(_,J),s(J,ee),s(_,re),p(K,te,ae),p(K,V,ae),s(V,B),s(V,ie),s(ie,Q),s(V,se),s(V,ue),s(ue,Z),s(V,ge),s(V,ne),s(ne,de),s(V,rs),s(V,be),s(be,qe),s(qe,is),s(V,Ve),s(V,$e),s($e,us),s(V,We),s(V,xe),s(xe,Se),s(V,Je),p(K,X,ae),w(pe,K,ae),p(K,ye,ae),p(K,ce,ae),s(ce,ps),s(ce,ze),s(ze,ke),s(ce,Xe),s(ce,le),s(le,Ze),s(ce,Ee),je=!0},i(K){je||(g(q.$$.fragment,K),g(pe.$$.fragment,K),je=!0)},o(K){b(q.$$.fragment,K),b(pe.$$.fragment,K),je=!1},d(K){K&&t(i),K&&t($),x(q,K),K&&t(z),K&&t(_),K&&t(te),K&&t(V),K&&t(X),x(pe,K),K&&t(ye),K&&t(ce)}}}function _g(I){let i,h,d,k,A,$,q,z;return q=new T({props:{code:"",highlighted:`<span class="hljs-keyword">import</span> math

eval_loss = model.evaluate(tf_eval_dataset)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Perplexit\xE9 : <span class="hljs-subst">{math.exp(eval_loss):<span class="hljs-number">.2</span>f}</span>&quot;</span>)`}}),{c(){i=l("p"),h=a("En supposant que notre ensemble de test se compose principalement de phrases grammaticalement correctes, une fa\xE7on de mesurer la qualit\xE9 de notre mod\xE8le de langage est de calculer les probabilit\xE9s qu\u2019il attribue au mot suivant dans toutes les phrases de l\u2019ensemble de test. Des probabilit\xE9s \xE9lev\xE9es indiquent que le mod\xE8le n\u2019est pas \xAB surpris \xBB ou \xAB perplexe \xBB vis-\xE0-vis des exemples non vus, et sugg\xE8rent qu\u2019il a appris les mod\xE8les de base de la grammaire de la langue. Il existe plusieurs d\xE9finitions math\xE9matiques de la perplexit\xE9. Celle que nous utiliserons la d\xE9finit comme l\u2019exponentielle de la perte d\u2019entropie crois\xE9e. Ainsi, nous pouvons calculer la perplexit\xE9 de notre mod\xE8le pr\xE9-entra\xEEn\xE9 en utilisant la fonction "),d=l("code"),k=a("model.evaluate()"),A=a(" pour calculer la perte d\u2019entropie crois\xE9e sur l\u2019ensemble de test, puis en prenant l\u2019exponentielle du r\xE9sultat :"),$=m(),E(q.$$.fragment)},l(_){i=o(_,"P",{});var M=r(i);h=n(M,"En supposant que notre ensemble de test se compose principalement de phrases grammaticalement correctes, une fa\xE7on de mesurer la qualit\xE9 de notre mod\xE8le de langage est de calculer les probabilit\xE9s qu\u2019il attribue au mot suivant dans toutes les phrases de l\u2019ensemble de test. Des probabilit\xE9s \xE9lev\xE9es indiquent que le mod\xE8le n\u2019est pas \xAB surpris \xBB ou \xAB perplexe \xBB vis-\xE0-vis des exemples non vus, et sugg\xE8rent qu\u2019il a appris les mod\xE8les de base de la grammaire de la langue. Il existe plusieurs d\xE9finitions math\xE9matiques de la perplexit\xE9. Celle que nous utiliserons la d\xE9finit comme l\u2019exponentielle de la perte d\u2019entropie crois\xE9e. Ainsi, nous pouvons calculer la perplexit\xE9 de notre mod\xE8le pr\xE9-entra\xEEn\xE9 en utilisant la fonction "),d=o(M,"CODE",{});var O=r(d);k=n(O,"model.evaluate()"),O.forEach(t),A=n(M," pour calculer la perte d\u2019entropie crois\xE9e sur l\u2019ensemble de test, puis en prenant l\u2019exponentielle du r\xE9sultat :"),M.forEach(t),$=f(_),j(q.$$.fragment,_)},m(_,M){p(_,i,M),s(i,h),s(i,d),s(d,k),s(i,A),p(_,$,M),w(q,_,M),z=!0},i(_){z||(g(q.$$.fragment,_),z=!0)},o(_){b(q.$$.fragment,_),z=!1},d(_){_&&t(i),_&&t($),x(q,_)}}}function hg(I){let i,h,d,k,A,$,q,z;return q=new T({props:{code:"",highlighted:`<span class="hljs-keyword">import</span> math

eval_results = trainer.evaluate()
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;&gt;&gt;&gt; Perplexity: <span class="hljs-subst">{math.exp(eval_results[<span class="hljs-string">&#x27;eval_loss&#x27;</span>]):<span class="hljs-number">.2</span>f}</span>&quot;</span>)`}}),{c(){i=l("p"),h=a("En supposant que notre ensemble de test se compose principalement de phrases grammaticalement correctes, une fa\xE7on de mesurer la qualit\xE9 de notre mod\xE8le de langage est de calculer les probabilit\xE9s qu\u2019il attribue au mot suivant dans toutes les phrases de l\u2019ensemble de test. Des probabilit\xE9s \xE9lev\xE9es indiquent que le mod\xE8le n\u2019est pas \xAB surpris \xBB ou \xAB perplexe \xBB vis-\xE0-vis des exemples non vus, et sugg\xE8rent qu\u2019il a appris les mod\xE8les de base de la grammaire de la langue. Il existe plusieurs d\xE9finitions math\xE9matiques de la perplexit\xE9. Celle que nous utiliserons la d\xE9finit comme l\u2019exponentielle de la perte d\u2019entropie crois\xE9e. Ainsi, nous pouvons calculer la perplexit\xE9 de notre mod\xE8le pr\xE9-entra\xEEn\xE9 en utilisant la fonction "),d=l("code"),k=a("Trainer.evaluate()"),A=a(" pour calculer la perte d\u2019entropie crois\xE9e sur l\u2019ensemble de test, puis en prenant l\u2019exponentielle du r\xE9sultat :"),$=m(),E(q.$$.fragment)},l(_){i=o(_,"P",{});var M=r(i);h=n(M,"En supposant que notre ensemble de test se compose principalement de phrases grammaticalement correctes, une fa\xE7on de mesurer la qualit\xE9 de notre mod\xE8le de langage est de calculer les probabilit\xE9s qu\u2019il attribue au mot suivant dans toutes les phrases de l\u2019ensemble de test. Des probabilit\xE9s \xE9lev\xE9es indiquent que le mod\xE8le n\u2019est pas \xAB surpris \xBB ou \xAB perplexe \xBB vis-\xE0-vis des exemples non vus, et sugg\xE8rent qu\u2019il a appris les mod\xE8les de base de la grammaire de la langue. Il existe plusieurs d\xE9finitions math\xE9matiques de la perplexit\xE9. Celle que nous utiliserons la d\xE9finit comme l\u2019exponentielle de la perte d\u2019entropie crois\xE9e. Ainsi, nous pouvons calculer la perplexit\xE9 de notre mod\xE8le pr\xE9-entra\xEEn\xE9 en utilisant la fonction "),d=o(M,"CODE",{});var O=r(d);k=n(O,"Trainer.evaluate()"),O.forEach(t),A=n(M," pour calculer la perte d\u2019entropie crois\xE9e sur l\u2019ensemble de test, puis en prenant l\u2019exponentielle du r\xE9sultat :"),M.forEach(t),$=f(_),j(q.$$.fragment,_)},m(_,M){p(_,i,M),s(i,h),s(i,d),s(d,k),s(i,A),p(_,$,M),w(q,_,M),z=!0},i(_){z||(g(q.$$.fragment,_),z=!0)},o(_){b(q.$$.fragment,_),z=!1},d(_){_&&t(i),_&&t($),x(q,_)}}}function vg(I){let i,h;return i=new T({props:{code:"model.fit(tf_train_dataset, validation_data=tf_eval_dataset, callbacks=[callback])",highlighted:"model.fit(tf_train_dataset, validation_data=tf_eval_dataset, callbacks=[callback])"}}),{c(){E(i.$$.fragment)},l(d){j(i.$$.fragment,d)},m(d,k){w(i,d,k),h=!0},i(d){h||(g(i.$$.fragment,d),h=!0)},o(d){b(i.$$.fragment,d),h=!1},d(d){x(i,d)}}}function gg(I){let i,h;return i=new T({props:{code:"trainer.train()",highlighted:"trainer.train()"}}),{c(){E(i.$$.fragment)},l(d){j(i.$$.fragment,d)},m(d,k){w(i,d,k),h=!0},i(d){h||(g(i.$$.fragment,d),h=!0)},o(d){b(i.$$.fragment,d),h=!1},d(d){x(i,d)}}}function bg(I){let i,h;return i=new T({props:{code:`eval_loss = model.evaluate(tf_eval_dataset)
print(f"Perplexit\xE9 : {math.exp(eval_loss):.2f}")`,highlighted:`eval_loss = model.evaluate(tf_eval_dataset)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Perplexit\xE9 : <span class="hljs-subst">{math.exp(eval_loss):<span class="hljs-number">.2</span>f}</span>&quot;</span>)`}}),{c(){E(i.$$.fragment)},l(d){j(i.$$.fragment,d)},m(d,k){w(i,d,k),h=!0},i(d){h||(g(i.$$.fragment,d),h=!0)},o(d){b(i.$$.fragment,d),h=!1},d(d){x(i,d)}}}function qg(I){let i,h;return i=new T({props:{code:`eval_results = trainer.evaluate()
print(f">>> Perplexit\xE9 : {math.exp(eval_results['eval_loss']):.2f}")`,highlighted:`eval_results = trainer.evaluate()
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;&gt;&gt;&gt; Perplexit\xE9 : <span class="hljs-subst">{math.exp(eval_results[<span class="hljs-string">&#x27;eval_loss&#x27;</span>]):<span class="hljs-number">.2</span>f}</span>&quot;</span>)`}}),{c(){E(i.$$.fragment)},l(d){j(i.$$.fragment,d)},m(d,k){w(i,d,k),h=!0},i(d){h||(g(i.$$.fragment,d),h=!0)},o(d){b(i.$$.fragment,d),h=!1},d(d){x(i,d)}}}function Hv(I){let i,h,d,k,A,$,q,z,_,M,O;return M=new T({props:{code:"trainer.push_to_hub()",highlighted:"trainer.push_to_hub()"}}),{c(){i=l("p"),h=a("Une fois l\u2019entra\xEEnement termin\xE9, nous pouvons pousser la carte de mod\xE8le avec les informations d\u2019entra\xEEnement vers le "),d=l("em"),k=a("Hub"),A=a(" (les "),$=l("em"),q=a("checkpoints"),z=a(" sont sauvegard\xE9s pendant l\u2019entra\xEEnement lui-m\xEAme) :"),_=m(),E(M.$$.fragment)},l(C){i=o(C,"P",{});var L=r(i);h=n(L,"Une fois l\u2019entra\xEEnement termin\xE9, nous pouvons pousser la carte de mod\xE8le avec les informations d\u2019entra\xEEnement vers le "),d=o(L,"EM",{});var H=r(d);k=n(H,"Hub"),H.forEach(t),A=n(L," (les "),$=o(L,"EM",{});var P=r($);q=n(P,"checkpoints"),P.forEach(t),z=n(L," sont sauvegard\xE9s pendant l\u2019entra\xEEnement lui-m\xEAme) :"),L.forEach(t),_=f(C),j(M.$$.fragment,C)},m(C,L){p(C,i,L),s(i,h),s(i,d),s(d,k),s(i,A),s(i,$),s($,q),s(i,z),p(C,_,L),w(M,C,L),O=!0},i(C){O||(g(M.$$.fragment,C),O=!0)},o(C){b(M.$$.fragment,C),O=!1},d(C){C&&t(i),C&&t(_),x(M,C)}}}function $g(I){let i,h,d,k,A;return{c(){i=l("p"),h=a("\u270F\uFE0F "),d=l("strong"),k=a("A votre tour !"),A=a(" Ex\xE9cutez l\u2019entra\xEEnement ci-dessus apr\xE8s avoir remplac\xE9 le collecteur de donn\xE9es par le collecteur de mots entiers masqu\xE9s. Obtenez-vous de meilleurs r\xE9sultats ?")},l($){i=o($,"P",{});var q=r(i);h=n(q,"\u270F\uFE0F "),d=o(q,"STRONG",{});var z=r(d);k=n(z,"A votre tour !"),z.forEach(t),A=n(q," Ex\xE9cutez l\u2019entra\xEEnement ci-dessus apr\xE8s avoir remplac\xE9 le collecteur de donn\xE9es par le collecteur de mots entiers masqu\xE9s. Obtenez-vous de meilleurs r\xE9sultats ?"),q.forEach(t)},m($,q){p($,i,q),s(i,h),s(i,d),s(d,k),s(i,A)},d($){$&&t(i)}}}function Uv(I){let i,h,d,k,A,$,q,z,_,M,O,C,L,H,P,D,U,R,v,S,W,G,J,ee,re,te,V,B,ie,Q,se,ue,Z,ge,ne,de,rs,be,qe,is,Ve,$e,us,We,xe,Se,Je,X,pe,ye,ce,ps,ze,ke,Xe,le,Ze,Ee,je,K,ae,Be,me,es,Ye,Me,Oe,Ke,N,Y,Ks,oe,Ce,Ps,Fe,Qe,Ie,De,_e,Fs,nt,Pe,yt,ds,we,He,lt,cs,gs,ot,ms,Is,As,rt,Ts,Ns,Ss,Hs,bs,Gt,Vt,ta,qs,Wt,Jt,La,aa,fs,zt,it,na,_s,ut,Os,Qn,la,ve,Ra,pt,oa,dt,Us,Gs,Ba,ra,Ls,ia,ct,Mt,Ct,Ka,Vs;return M=new Oa({}),Se=new T({props:{code:`def insert_random_mask(batch):
    features = [dict(zip(batch, t)) for t in zip(*batch.values())]
    masked_inputs = data_collator(features)
    # Cr\xE9er une nouvelle colonne "masqu\xE9e" pour chaque colonne du jeu de donn\xE9es
    return {"masked_" + k: v.numpy() for k, v in masked_inputs.items()}`,highlighted:`<span class="hljs-keyword">def</span> <span class="hljs-title function_">insert_random_mask</span>(<span class="hljs-params">batch</span>):
    features = [<span class="hljs-built_in">dict</span>(<span class="hljs-built_in">zip</span>(batch, t)) <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(*batch.values())]
    masked_inputs = data_collator(features)
    <span class="hljs-comment"># Cr\xE9er une nouvelle colonne &quot;masqu\xE9e&quot; pour chaque colonne du jeu de donn\xE9es</span>
    <span class="hljs-keyword">return</span> {<span class="hljs-string">&quot;masked_&quot;</span> + k: v.numpy() <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> masked_inputs.items()}`}}),ke=new T({props:{code:`downsampled_dataset = downsampled_dataset.remove_columns(["word_ids"])
eval_dataset = downsampled_dataset["test"].map(
    insert_random_mask,
    batched=True,
    remove_columns=downsampled_dataset["test"].column_names,
)
eval_dataset = eval_dataset.rename_columns(
    {
        "masked_input_ids": "input_ids",
        "masked_attention_mask": "attention_mask",
        "masked_labels": "labels",
    }
)`,highlighted:`downsampled_dataset = downsampled_dataset.remove_columns([<span class="hljs-string">&quot;word_ids&quot;</span>])
eval_dataset = downsampled_dataset[<span class="hljs-string">&quot;test&quot;</span>].<span class="hljs-built_in">map</span>(
    insert_random_mask,
    batched=<span class="hljs-literal">True</span>,
    remove_columns=downsampled_dataset[<span class="hljs-string">&quot;test&quot;</span>].column_names,
)
eval_dataset = eval_dataset.rename_columns(
    {
        <span class="hljs-string">&quot;masked_input_ids&quot;</span>: <span class="hljs-string">&quot;input_ids&quot;</span>,
        <span class="hljs-string">&quot;masked_attention_mask&quot;</span>: <span class="hljs-string">&quot;attention_mask&quot;</span>,
        <span class="hljs-string">&quot;masked_labels&quot;</span>: <span class="hljs-string">&quot;labels&quot;</span>,
    }
)`}}),Ke=new T({props:{code:"",highlighted:`<span class="hljs-keyword">from</span> torch.utils.data <span class="hljs-keyword">import</span> DataLoader
<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> default_data_collator

batch_size = <span class="hljs-number">64</span>
train_dataloader = DataLoader(
    downsampled_dataset[<span class="hljs-string">&quot;train&quot;</span>],
    shuffle=<span class="hljs-literal">True</span>,
    batch_size=batch_size,
    collate_fn=data_collator,
)
eval_dataloader = DataLoader(
    eval_dataset, batch_size=batch_size, collate_fn=default_data_collator
)`}}),Qe=new T({props:{code:"model = AutoModelForMaskedLM.from_pretrained(model_checkpoint)",highlighted:'model = <span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">AutoModelForMaskedLM</span>.</span></span>from<span class="hljs-constructor">_pretrained(<span class="hljs-params">model_checkpoint</span>)</span>'}}),ds=new T({props:{code:"",highlighted:`<span class="hljs-keyword">from</span> torch.optim <span class="hljs-keyword">import</span> AdamW

optimizer = AdamW(model.parameters(), lr=<span class="hljs-number">5e-5</span>)`}}),Is=new T({props:{code:"",highlighted:`<span class="hljs-keyword">from</span> accelerate <span class="hljs-keyword">import</span> Accelerator

accelerator = Accelerator()
model, optimizer, train_dataloader, eval_dataloader = accelerator.prepare(
    model, optimizer, train_dataloader, eval_dataloader
)`}}),Ss=new T({props:{code:`
`,highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> get_scheduler

num_train_epochs = <span class="hljs-number">3</span>
num_update_steps_per_epoch = <span class="hljs-built_in">len</span>(train_dataloader)
num_training_steps = num_train_epochs * num_update_steps_per_epoch

lr_scheduler = get_scheduler(
    <span class="hljs-string">&quot;linear&quot;</span>,
    optimizer=optimizer,
    num_warmup_steps=<span class="hljs-number">0</span>,
    num_training_steps=num_training_steps,
)`}}),fs=new T({props:{code:"",highlighted:`<span class="hljs-keyword">from</span> huggingface_hub <span class="hljs-keyword">import</span> get_full_repo_name

model_name = <span class="hljs-string">&quot;distilbert-base-uncased-finetuned-imdb-accelerate&quot;</span>
repo_name = get_full_repo_name(model_name)
repo_name`}}),it=new T({props:{code:"'lewtun/distilbert-base-uncased-finetuned-imdb-accelerate'",highlighted:'<span class="hljs-string">&#x27;lewtun/distilbert-base-uncased-finetuned-imdb-accelerate&#x27;</span>'}}),dt=new T({props:{code:"",highlighted:`<span class="hljs-keyword">from</span> huggingface_hub <span class="hljs-keyword">import</span> Repository

output_dir = model_name
repo = Repository(output_dir, clone_from=repo_name)`}}),Ls=new T({props:{code:`






`,highlighted:`<span class="hljs-keyword">from</span> tqdm.auto <span class="hljs-keyword">import</span> tqdm
<span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">import</span> math

progress_bar = tqdm(<span class="hljs-built_in">range</span>(num_training_steps))

<span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_train_epochs):
    <span class="hljs-comment"># Entra\xEEnement</span>
    model.train()
    <span class="hljs-keyword">for</span> batch <span class="hljs-keyword">in</span> train_dataloader:
        outputs = model(**batch)
        loss = outputs.loss
        accelerator.backward(loss)

        optimizer.step()
        lr_scheduler.step()
        optimizer.zero_grad()
        progress_bar.update(<span class="hljs-number">1</span>)

    <span class="hljs-comment"># Evaluation</span>
    model.<span class="hljs-built_in">eval</span>()
    losses = []
    <span class="hljs-keyword">for</span> step, batch <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(eval_dataloader):
        <span class="hljs-keyword">with</span> torch.no_grad():
            outputs = model(**batch)

        loss = outputs.loss
        losses.append(accelerator.gather(loss.repeat(batch_size)))

    losses = torch.cat(losses)
    losses = losses[: <span class="hljs-built_in">len</span>(eval_dataset)]
    <span class="hljs-keyword">try</span>:
        perplexity = math.exp(torch.mean(losses))
    <span class="hljs-keyword">except</span> OverflowError:
        perplexity = <span class="hljs-built_in">float</span>(<span class="hljs-string">&quot;inf&quot;</span>)

    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;&gt;&gt;&gt; Epoch <span class="hljs-subst">{epoch}</span>: Perplexity: <span class="hljs-subst">{perplexity}</span>&quot;</span>)

    <span class="hljs-comment"># Sauvegarder et t\xE9l\xE9charger</span>
    accelerator.wait_for_everyone()
    unwrapped_model = accelerator.unwrap_model(model)
    unwrapped_model.save_pretrained(output_dir, save_function=accelerator.save)
    <span class="hljs-keyword">if</span> accelerator.is_main_process:
        tokenizer.save_pretrained(output_dir)
        repo.push_to_hub(
            commit_message=<span class="hljs-string">f&quot;Training in progress epoch <span class="hljs-subst">{epoch}</span>&quot;</span>, blocking=<span class="hljs-literal">False</span>
        )`}}),ct=new T({props:{code:`Epoch 0: Perplexity: 11.397545307900472
Epoch 1: Perplexity: 10.904909330983092
Epoch 2: Perplexity: 10.729503505340409`,highlighted:`<span class="hljs-meta">&gt;&gt;&gt; </span>Epoch <span class="hljs-number">0</span>: Perplexity: <span class="hljs-number">11.397545307900472</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>Epoch <span class="hljs-number">1</span>: Perplexity: <span class="hljs-number">10.904909330983092</span>
<span class="hljs-meta">&gt;&gt;&gt; </span>Epoch <span class="hljs-number">2</span>: Perplexity: <span class="hljs-number">10.729503505340409</span>`}}),{c(){i=l("p"),h=a("Dans notre cas d\u2019utilisation, nous n\u2019avons pas eu besoin de faire quelque chose de sp\xE9cial avec la boucle d\u2019entra\xEEnement, mais dans certains cas, vous pourriez avoir besoin de mettre en \u0153uvre une logique personnalis\xE9e. Pour ces applications, vous pouvez utiliser \u{1F917} "),d=l("em"),k=a("Accelerate"),A=a(". Jetons un coup d\u2019\u0153il !"),$=m(),q=l("h2"),z=l("a"),_=l("span"),E(M.$$.fragment),O=m(),C=l("span"),L=l("i"),H=a("Finetuning"),P=a(" de DistilBERT avec \u{1F917} "),D=l("i"),U=a("Accelerate"),R=m(),v=l("p"),S=a("Comme nous l\u2019avons vu, avec "),W=l("code"),G=a("Trainer"),J=a(" le "),ee=l("em"),re=a("finetuning"),te=a(" d\u2019un mod\xE8le de langage masqu\xE9 est tr\xE8s similaire \xE0 l\u2019exemple de classification de texte du "),V=l("a"),B=a("chapitre 3"),ie=a(". En fait, la seule subtilit\xE9 est l\u2019utilisation d\u2019un collateur de donn\xE9es sp\xE9cial, et nous l\u2019avons d\xE9j\xE0 couvert plus t\xF4t dans cette section !"),Q=m(),se=l("p"),ue=a("Cependant, nous avons vu que "),Z=l("code"),ge=a("DataCollatorForLanguageModeling"),ne=a(" applique aussi un masquage al\xE9atoire \xE0 chaque \xE9valuation. Nous verrons donc quelques fluctuations dans nos scores de perplexit\xE9 \xE0 chaque entrainement. Une fa\xE7on d\u2019\xE9liminer cette source d\u2019al\xE9at est d\u2019appliquer le masquage "),de=l("em"),rs=a("une fois"),be=a(" sur l\u2019ensemble de test, puis d\u2019utiliser le collateur de donn\xE9es par d\xE9faut dans \u{1F917} "),qe=l("em"),is=a("Transformers"),Ve=a(" pour collecter les batchs pendant l\u2019\xE9valuation. Pour voir comment cela fonctionne, impl\xE9mentons une fonction simple qui applique le masquage sur un batch, similaire \xE0 notre premi\xE8re rencontre avec "),$e=l("code"),us=a("DataCollatorForLanguageModeling"),We=a(" :"),xe=m(),E(Se.$$.fragment),Je=m(),X=l("p"),pe=a("Ensuite, nous allons appliquer cette fonction \xE0 notre jeu de test et laisser tomber les colonnes non masqu\xE9es afin de les remplacer par les colonnes masqu\xE9es. Vous pouvez utiliser le masquage de mots entiers en rempla\xE7ant le "),ye=l("code"),ce=a("data_collator"),ps=a(" ci-dessus par celui qui est appropri\xE9. Dans ce cas vous devez supprimer la premi\xE8re ligne ici :"),ze=m(),E(ke.$$.fragment),Xe=m(),le=l("p"),Ze=a("Nous pouvons ensuite configurer les "),Ee=l("em"),je=a("dataloaders"),K=a(" comme d\u2019habitude, mais nous utiliserons le "),ae=l("code"),Be=a("default_data_collator"),me=a(" de \u{1F917} "),es=l("em"),Ye=a("Transformers"),Me=a(" pour le jeu d\u2019\xE9valuation :"),Oe=m(),E(Ke.$$.fragment),N=m(),Y=l("p"),Ks=a("Nous suivons les \xE9tapes standard avec \u{1F917} "),oe=l("em"),Ce=a("Accelerate"),Ps=a(". La premi\xE8re est de charger une version fra\xEEche du mod\xE8le pr\xE9-entra\xEEn\xE9 :"),Fe=m(),E(Qe.$$.fragment),Ie=m(),De=l("p"),_e=a("Ensuite, nous devons sp\xE9cifier l\u2019optimiseur. Nous utiliserons le standard "),Fs=l("code"),nt=a("AdamW"),Pe=a(" :"),yt=m(),E(ds.$$.fragment),we=m(),He=l("p"),lt=a("Avec ces objets, nous pouvons maintenant tout pr\xE9parer pour l\u2019entra\xEEnement avec l\u2019objet "),cs=l("code"),gs=a("Accelerator"),ot=a(" :"),ms=m(),E(Is.$$.fragment),As=m(),rt=l("p"),Ts=a("Maintenant que notre mod\xE8le, notre optimiseur et nos chargeurs de donn\xE9es sont configur\xE9s, nous pouvons sp\xE9cifier le planificateur du taux d\u2019apprentissage comme suit :"),Ns=m(),E(Ss.$$.fragment),Hs=m(),bs=l("p"),Gt=a("Il ne reste qu\u2019une derni\xE8re chose \xE0 faire avant de s\u2019entra\xEEner : cr\xE9er un d\xE9p\xF4t de mod\xE8les sur le "),Vt=l("em"),ta=a("Hub"),qs=a(" d\u2019Hugging Face ! Nous pouvons utiliser la biblioth\xE8que \u{1F917} "),Wt=l("em"),Jt=a("Hub"),La=a(" pour g\xE9n\xE9rer d\u2019abord le nom complet de notre d\xE9p\xF4t :"),aa=m(),E(fs.$$.fragment),zt=m(),E(it.$$.fragment),na=m(),_s=l("p"),ut=a("puis cr\xE9er et cloner le d\xE9p\xF4t en utilisant la classe "),Os=l("code"),Qn=a("Repository"),la=a(" du \u{1F917} "),ve=l("em"),Ra=a("Hub"),pt=a(" :"),oa=m(),E(dt.$$.fragment),Us=m(),Gs=l("p"),Ba=a("Une fois cela fait, il ne reste plus qu\u2019\xE0 r\xE9diger la boucle compl\xE8te d\u2019entra\xEEnement et d\u2019\xE9valuation :"),ra=m(),E(Ls.$$.fragment),ia=m(),E(ct.$$.fragment),Mt=m(),Ct=l("p"),Ka=a("Cool, nous avons \xE9t\xE9 en mesure d\u2019\xE9valuer la perplexit\xE9 \xE0 chaque \xE9poque et de garantir la reproductibilit\xE9 des entra\xEEnements multiples !"),this.h()},l(c){i=o(c,"P",{});var F=r(i);h=n(F,"Dans notre cas d\u2019utilisation, nous n\u2019avons pas eu besoin de faire quelque chose de sp\xE9cial avec la boucle d\u2019entra\xEEnement, mais dans certains cas, vous pourriez avoir besoin de mettre en \u0153uvre une logique personnalis\xE9e. Pour ces applications, vous pouvez utiliser \u{1F917} "),d=o(F,"EM",{});var Xn=r(d);k=n(Xn,"Accelerate"),Xn.forEach(t),A=n(F,". Jetons un coup d\u2019\u0153il !"),F.forEach(t),$=f(c),q=o(c,"H2",{class:!0});var Yt=r(q);z=o(Yt,"A",{id:!0,class:!0,href:!0});var $s=r(z);_=o($s,"SPAN",{});var ks=r(_);j(M.$$.fragment,ks),ks.forEach(t),$s.forEach(t),O=f(Yt),C=o(Yt,"SPAN",{});var mt=r(C);L=o(mt,"I",{});var ft=r(L);H=n(ft,"Finetuning"),ft.forEach(t),P=n(mt," de DistilBERT avec \u{1F917} "),D=o(mt,"I",{});var Zn=r(D);U=n(Zn,"Accelerate"),Zn.forEach(t),mt.forEach(t),Yt.forEach(t),R=f(c),v=o(c,"P",{});var Es=r(v);S=n(Es,"Comme nous l\u2019avons vu, avec "),W=o(Es,"CODE",{});var el=r(W);G=n(el,"Trainer"),el.forEach(t),J=n(Es," le "),ee=o(Es,"EM",{});var sl=r(ee);re=n(sl,"finetuning"),sl.forEach(t),te=n(Es," d\u2019un mod\xE8le de langage masqu\xE9 est tr\xE8s similaire \xE0 l\u2019exemple de classification de texte du "),V=o(Es,"A",{href:!0});var Fa=r(V);B=n(Fa,"chapitre 3"),Fa.forEach(t),ie=n(Es,". En fait, la seule subtilit\xE9 est l\u2019utilisation d\u2019un collateur de donn\xE9es sp\xE9cial, et nous l\u2019avons d\xE9j\xE0 couvert plus t\xF4t dans cette section !"),Es.forEach(t),Q=f(c),se=o(c,"P",{});var Ue=r(se);ue=n(Ue,"Cependant, nous avons vu que "),Z=o(Ue,"CODE",{});var Ia=r(Z);ge=n(Ia,"DataCollatorForLanguageModeling"),Ia.forEach(t),ne=n(Ue," applique aussi un masquage al\xE9atoire \xE0 chaque \xE9valuation. Nous verrons donc quelques fluctuations dans nos scores de perplexit\xE9 \xE0 chaque entrainement. Une fa\xE7on d\u2019\xE9liminer cette source d\u2019al\xE9at est d\u2019appliquer le masquage "),de=o(Ue,"EM",{});var he=r(de);rs=n(he,"une fois"),he.forEach(t),be=n(Ue," sur l\u2019ensemble de test, puis d\u2019utiliser le collateur de donn\xE9es par d\xE9faut dans \u{1F917} "),qe=o(Ue,"EM",{});var tl=r(qe);is=n(tl,"Transformers"),tl.forEach(t),Ve=n(Ue," pour collecter les batchs pendant l\u2019\xE9valuation. Pour voir comment cela fonctionne, impl\xE9mentons une fonction simple qui applique le masquage sur un batch, similaire \xE0 notre premi\xE8re rencontre avec "),$e=o(Ue,"CODE",{});var ua=r($e);us=n(ua,"DataCollatorForLanguageModeling"),ua.forEach(t),We=n(Ue," :"),Ue.forEach(t),xe=f(c),j(Se.$$.fragment,c),Je=f(c),X=o(c,"P",{});var pa=r(X);pe=n(pa,"Ensuite, nous allons appliquer cette fonction \xE0 notre jeu de test et laisser tomber les colonnes non masqu\xE9es afin de les remplacer par les colonnes masqu\xE9es. Vous pouvez utiliser le masquage de mots entiers en rempla\xE7ant le "),ye=o(pa,"CODE",{});var al=r(ye);ce=n(al,"data_collator"),al.forEach(t),ps=n(pa," ci-dessus par celui qui est appropri\xE9. Dans ce cas vous devez supprimer la premi\xE8re ligne ici :"),pa.forEach(t),ze=f(c),j(ke.$$.fragment,c),Xe=f(c),le=o(c,"P",{});var js=r(le);Ze=n(js,"Nous pouvons ensuite configurer les "),Ee=o(js,"EM",{});var nl=r(Ee);je=n(nl,"dataloaders"),nl.forEach(t),K=n(js," comme d\u2019habitude, mais nous utiliserons le "),ae=o(js,"CODE",{});var ll=r(ae);Be=n(ll,"default_data_collator"),ll.forEach(t),me=n(js," de \u{1F917} "),es=o(js,"EM",{});var Dt=r(es);Ye=n(Dt,"Transformers"),Dt.forEach(t),Me=n(js," pour le jeu d\u2019\xE9valuation :"),js.forEach(t),Oe=f(c),j(Ke.$$.fragment,c),N=f(c),Y=o(c,"P",{});var Pt=r(Y);Ks=n(Pt,"Nous suivons les \xE9tapes standard avec \u{1F917} "),oe=o(Pt,"EM",{});var ol=r(oe);Ce=n(ol,"Accelerate"),ol.forEach(t),Ps=n(Pt,". La premi\xE8re est de charger une version fra\xEEche du mod\xE8le pr\xE9-entra\xEEn\xE9 :"),Pt.forEach(t),Fe=f(c),j(Qe.$$.fragment,c),Ie=f(c),De=o(c,"P",{});var da=r(De);_e=n(da,"Ensuite, nous devons sp\xE9cifier l\u2019optimiseur. Nous utiliserons le standard "),Fs=o(da,"CODE",{});var At=r(Fs);nt=n(At,"AdamW"),At.forEach(t),Pe=n(da," :"),da.forEach(t),yt=f(c),j(ds.$$.fragment,c),we=f(c),He=o(c,"P",{});var Tt=r(He);lt=n(Tt,"Avec ces objets, nous pouvons maintenant tout pr\xE9parer pour l\u2019entra\xEEnement avec l\u2019objet "),cs=o(Tt,"CODE",{});var rl=r(cs);gs=n(rl,"Accelerator"),rl.forEach(t),ot=n(Tt," :"),Tt.forEach(t),ms=f(c),j(Is.$$.fragment,c),As=f(c),rt=o(c,"P",{});var il=r(rt);Ts=n(il,"Maintenant que notre mod\xE8le, notre optimiseur et nos chargeurs de donn\xE9es sont configur\xE9s, nous pouvons sp\xE9cifier le planificateur du taux d\u2019apprentissage comme suit :"),il.forEach(t),Ns=f(c),j(Ss.$$.fragment,c),Hs=f(c),bs=o(c,"P",{});var Ws=r(bs);Gt=n(Ws,"Il ne reste qu\u2019une derni\xE8re chose \xE0 faire avant de s\u2019entra\xEEner : cr\xE9er un d\xE9p\xF4t de mod\xE8les sur le "),Vt=o(Ws,"EM",{});var ul=r(Vt);ta=n(ul,"Hub"),ul.forEach(t),qs=n(Ws," d\u2019Hugging Face ! Nous pouvons utiliser la biblioth\xE8que \u{1F917} "),Wt=o(Ws,"EM",{});var pl=r(Wt);Jt=n(pl,"Hub"),pl.forEach(t),La=n(Ws," pour g\xE9n\xE9rer d\u2019abord le nom complet de notre d\xE9p\xF4t :"),Ws.forEach(t),aa=f(c),j(fs.$$.fragment,c),zt=f(c),j(it.$$.fragment,c),na=f(c),_s=o(c,"P",{});var Js=r(_s);ut=n(Js,"puis cr\xE9er et cloner le d\xE9p\xF4t en utilisant la classe "),Os=o(Js,"CODE",{});var dl=r(Os);Qn=n(dl,"Repository"),dl.forEach(t),la=n(Js," du \u{1F917} "),ve=o(Js,"EM",{});var cl=r(ve);Ra=n(cl,"Hub"),cl.forEach(t),pt=n(Js," :"),Js.forEach(t),oa=f(c),j(dt.$$.fragment,c),Us=f(c),Gs=o(c,"P",{});var ca=r(Gs);Ba=n(ca,"Une fois cela fait, il ne reste plus qu\u2019\xE0 r\xE9diger la boucle compl\xE8te d\u2019entra\xEEnement et d\u2019\xE9valuation :"),ca.forEach(t),ra=f(c),j(Ls.$$.fragment,c),ia=f(c),j(ct.$$.fragment,c),Mt=f(c),Ct=o(c,"P",{});var ml=r(Ct);Ka=n(ml,"Cool, nous avons \xE9t\xE9 en mesure d\u2019\xE9valuer la perplexit\xE9 \xE0 chaque \xE9poque et de garantir la reproductibilit\xE9 des entra\xEEnements multiples !"),ml.forEach(t),this.h()},h(){y(z,"id","ifinetuningi-de-distilbert-avec-iacceleratei"),y(z,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),y(z,"href","#ifinetuningi-de-distilbert-avec-iacceleratei"),y(q,"class","relative group"),y(V,"href","/course/fr/chapter3")},m(c,F){p(c,i,F),s(i,h),s(i,d),s(d,k),s(i,A),p(c,$,F),p(c,q,F),s(q,z),s(z,_),w(M,_,null),s(q,O),s(q,C),s(C,L),s(L,H),s(C,P),s(C,D),s(D,U),p(c,R,F),p(c,v,F),s(v,S),s(v,W),s(W,G),s(v,J),s(v,ee),s(ee,re),s(v,te),s(v,V),s(V,B),s(v,ie),p(c,Q,F),p(c,se,F),s(se,ue),s(se,Z),s(Z,ge),s(se,ne),s(se,de),s(de,rs),s(se,be),s(se,qe),s(qe,is),s(se,Ve),s(se,$e),s($e,us),s(se,We),p(c,xe,F),w(Se,c,F),p(c,Je,F),p(c,X,F),s(X,pe),s(X,ye),s(ye,ce),s(X,ps),p(c,ze,F),w(ke,c,F),p(c,Xe,F),p(c,le,F),s(le,Ze),s(le,Ee),s(Ee,je),s(le,K),s(le,ae),s(ae,Be),s(le,me),s(le,es),s(es,Ye),s(le,Me),p(c,Oe,F),w(Ke,c,F),p(c,N,F),p(c,Y,F),s(Y,Ks),s(Y,oe),s(oe,Ce),s(Y,Ps),p(c,Fe,F),w(Qe,c,F),p(c,Ie,F),p(c,De,F),s(De,_e),s(De,Fs),s(Fs,nt),s(De,Pe),p(c,yt,F),w(ds,c,F),p(c,we,F),p(c,He,F),s(He,lt),s(He,cs),s(cs,gs),s(He,ot),p(c,ms,F),w(Is,c,F),p(c,As,F),p(c,rt,F),s(rt,Ts),p(c,Ns,F),w(Ss,c,F),p(c,Hs,F),p(c,bs,F),s(bs,Gt),s(bs,Vt),s(Vt,ta),s(bs,qs),s(bs,Wt),s(Wt,Jt),s(bs,La),p(c,aa,F),w(fs,c,F),p(c,zt,F),w(it,c,F),p(c,na,F),p(c,_s,F),s(_s,ut),s(_s,Os),s(Os,Qn),s(_s,la),s(_s,ve),s(ve,Ra),s(_s,pt),p(c,oa,F),w(dt,c,F),p(c,Us,F),p(c,Gs,F),s(Gs,Ba),p(c,ra,F),w(Ls,c,F),p(c,ia,F),w(ct,c,F),p(c,Mt,F),p(c,Ct,F),s(Ct,Ka),Vs=!0},i(c){Vs||(g(M.$$.fragment,c),g(Se.$$.fragment,c),g(ke.$$.fragment,c),g(Ke.$$.fragment,c),g(Qe.$$.fragment,c),g(ds.$$.fragment,c),g(Is.$$.fragment,c),g(Ss.$$.fragment,c),g(fs.$$.fragment,c),g(it.$$.fragment,c),g(dt.$$.fragment,c),g(Ls.$$.fragment,c),g(ct.$$.fragment,c),Vs=!0)},o(c){b(M.$$.fragment,c),b(Se.$$.fragment,c),b(ke.$$.fragment,c),b(Ke.$$.fragment,c),b(Qe.$$.fragment,c),b(ds.$$.fragment,c),b(Is.$$.fragment,c),b(Ss.$$.fragment,c),b(fs.$$.fragment,c),b(it.$$.fragment,c),b(dt.$$.fragment,c),b(Ls.$$.fragment,c),b(ct.$$.fragment,c),Vs=!1},d(c){c&&t(i),c&&t($),c&&t(q),x(M),c&&t(R),c&&t(v),c&&t(Q),c&&t(se),c&&t(xe),x(Se,c),c&&t(Je),c&&t(X),c&&t(ze),x(ke,c),c&&t(Xe),c&&t(le),c&&t(Oe),x(Ke,c),c&&t(N),c&&t(Y),c&&t(Fe),x(Qe,c),c&&t(Ie),c&&t(De),c&&t(yt),x(ds,c),c&&t(we),c&&t(He),c&&t(ms),x(Is,c),c&&t(As),c&&t(rt),c&&t(Ns),x(Ss,c),c&&t(Hs),c&&t(bs),c&&t(aa),x(fs,c),c&&t(zt),x(it,c),c&&t(na),c&&t(_s),c&&t(oa),x(dt,c),c&&t(Us),c&&t(Gs),c&&t(ra),x(Ls,c),c&&t(ia),x(ct,c),c&&t(Mt),c&&t(Ct)}}}function kg(I){let i,h,d,k,A,$,q,z,_,M,O,C,L,H,P,D,U,R,v,S;return{c(){i=l("p"),h=a("\u270F\uFE0F "),d=l("strong"),k=a("Essayez !"),A=a(" Pour quantifier les avantages de l\u2019adaptation au domaine, "),$=l("i"),q=a("finetunez"),z=a(" un classifieur sur le jeu de donn\xE9es IMDb pour \xE0 la fois, le "),_=l("i"),M=a("checkpoint"),O=a(" de DistilBERT pr\xE9-entra\xEEn\xE9 et e "),C=l("i"),L=a("checkpoint"),H=a(" de DistilBERT "),P=l("i"),D=a("finetun\xE9"),U=a(". Si vous avez besoin d\u2019un rafra\xEEchissement sur la classification de texte, consultez le "),R=l("a"),v=a("chapitre 3"),S=a("."),this.h()},l(W){i=o(W,"P",{});var G=r(i);h=n(G,"\u270F\uFE0F "),d=o(G,"STRONG",{});var J=r(d);k=n(J,"Essayez !"),J.forEach(t),A=n(G," Pour quantifier les avantages de l\u2019adaptation au domaine, "),$=o(G,"I",{});var ee=r($);q=n(ee,"finetunez"),ee.forEach(t),z=n(G," un classifieur sur le jeu de donn\xE9es IMDb pour \xE0 la fois, le "),_=o(G,"I",{});var re=r(_);M=n(re,"checkpoint"),re.forEach(t),O=n(G," de DistilBERT pr\xE9-entra\xEEn\xE9 et e "),C=o(G,"I",{});var te=r(C);L=n(te,"checkpoint"),te.forEach(t),H=n(G," de DistilBERT "),P=o(G,"I",{});var V=r(P);D=n(V,"finetun\xE9"),V.forEach(t),U=n(G,". Si vous avez besoin d\u2019un rafra\xEEchissement sur la classification de texte, consultez le "),R=o(G,"A",{href:!0});var B=r(R);v=n(B,"chapitre 3"),B.forEach(t),S=n(G,"."),G.forEach(t),this.h()},h(){y(R,"href","/course/fr/chapter3")},m(W,G){p(W,i,G),s(i,h),s(i,d),s(d,k),s(i,A),s(i,$),s($,q),s(i,z),s(i,_),s(_,M),s(i,O),s(i,C),s(C,L),s(i,H),s(i,P),s(P,D),s(i,U),s(i,R),s(R,v),s(i,S)},d(W){W&&t(i)}}}function Eg(I){let i,h,d,k,A,$,q,z,_,M,O,C,L,H,P,D,U,R,v,S,W,G,J,ee,re,te,V,B,ie,Q,se,ue,Z,ge,ne,de,rs,be,qe,is,Ve,$e,us,We,xe,Se,Je,X,pe,ye,ce,ps,ze,ke,Xe,le,Ze,Ee,je,K,ae,Be,me,es,Ye,Me,Oe,Ke,N,Y,Ks,oe,Ce,Ps,Fe,Qe,Ie,De,_e,Fs,nt,Pe,yt,ds,we,He,lt,cs,gs,ot,ms,Is,As,rt,Ts,Ns,Ss,Hs,bs,Gt,Vt,ta,qs,Wt,Jt,La,aa,fs,zt,it,na,_s,ut,Os,Qn,la,ve,Ra,pt,oa,dt,Us,Gs,Ba,ra,Ls,ia,ct,Mt,Ct,Ka,Vs,c,F,Xn,Yt,$s,ks,mt,ft,Zn,Es,el,sl,Fa,Ue,Ia,he,tl,ua,pa,al,js,nl,ll,Dt,Pt,ol,da,At,Tt,rl,il,Ws,ul,pl,Js,dl,cl,ca,ml,np,Zr,Ha,ei,ma,lp,eo,op,rp,si,_t,ht,fl,Ua,ti,_l,ip,ai,Qt,fa,so,Ga,up,to,pp,ni,ss,dp,Va,ao,cp,mp,no,fp,_p,lo,hp,vp,oo,gp,bp,ro,qp,$p,li,Wa,oi,Ja,ri,ts,kp,io,Ep,jp,uo,wp,xp,po,yp,zp,co,Mp,Cp,mo,Dp,Pp,ii,Ya,ui,Qa,pi,Nt,Ap,fo,Tp,Np,_o,Sp,Op,di,_a,ci,ha,Lp,hl,Rp,Bp,mi,Xt,va,ho,Xa,Kp,vo,Fp,fi,Za,_i,ga,Ip,go,Hp,Up,hi,Ae,Gp,bo,Vp,Wp,qo,Jp,Yp,$o,Qp,Xp,ko,Zp,ed,vl,sd,td,Eo,ad,nd,jo,ld,od,vi,en,gi,sn,bi,Ys,rd,wo,id,ud,xo,pd,dd,yo,cd,md,qi,Qs,fd,zo,_d,hd,Mo,vd,gd,Co,bd,qd,$i,tn,ki,an,Ei,Xs,$d,Do,kd,Ed,Po,jd,wd,Ao,xd,yd,ji,ba,wi,gl,zd,xi,nn,yi,qa,zi,$a,Md,To,Cd,Dd,Mi,ln,Ci,on,Di,bl,Pd,Pi,rn,Ai,un,Ti,ws,Ad,No,Td,Nd,So,Sd,Od,Oo,Ld,Rd,Lo,Bd,Kd,Ni,pn,Si,dn,Oi,ka,Fd,Ro,Id,Hd,Li,Ea,cn,Ud,Bo,Gd,Vd,Wd,mn,Jd,Ko,Yd,Qd,Ri,ql,Xd,Bi,fn,Ki,as,Zd,Fo,ec,sc,Io,tc,ac,Ho,nc,lc,Uo,oc,rc,Go,ic,uc,Fi,St,pc,Vo,dc,cc,Wo,mc,fc,Ii,_n,Hi,hn,Ui,Te,_c,Jo,hc,vc,Yo,gc,bc,Qo,qc,$c,Xo,kc,Ec,Zo,jc,wc,er,xc,yc,sr,zc,Mc,Gi,vn,Vi,gn,Wi,$l,Cc,Ji,bn,Yi,qn,Qi,xs,Dc,tr,Pc,Ac,ar,Tc,Nc,nr,Sc,Oc,lr,Lc,Rc,Xi,Zt,ja,or,$n,Bc,kn,rr,Kc,Fc,ir,Ic,Zi,fe,Hc,ur,Uc,Gc,pr,Vc,Wc,kl,Jc,Yc,dr,Qc,Xc,cr,Zc,em,mr,sm,tm,fr,am,nm,_r,lm,om,hr,rm,im,eu,En,su,Zs,um,vr,pm,dm,gr,cm,mm,br,fm,_m,tu,jn,au,wn,nu,ys,hm,qr,vm,gm,$r,bm,qm,kr,$m,km,Er,Em,jm,lu,wa,ou,El,zs,wm,jr,xm,ym,wr,zm,Mm,xr,Cm,Dm,yr,Pm,Am,ru,vt,gt,jl,wl,Tm,iu,xn,uu,yn,pu,xa,du,Ms,Nm,zr,Sm,Om,Mr,Lm,Rm,Cr,Bm,Km,xl,Fm,Im,cu,zn,mu,Mn,fu,Cs,Hm,Dr,Um,Gm,Pr,Vm,Wm,Ar,Jm,Ym,Tr,Qm,Xm,_u,Cn,hu,ya,Zm,Nr,ef,sf,vu,Dn,gu,yl,tf,bu,bt,qt,zl,ea,za,Sr,Pn,af,Or,nf,qu,An,$u,Ml,lf,ku,$t,kt,Cl,Tn,Eu,Dl,of,ju,Et,jt,Pl,Al,rf,wu,wt,xt,Tl,Nn,xu,Nl,uf,yu,Sl,Ma,zu,Ol,sa,Ca,Lr,Sn,pf,Ll,df,Rr,cf,Mu,Ge,mf,Br,ff,_f,Kr,hf,vf,Fr,gf,bf,Ir,qf,$f,Hr,kf,Ef,Ur,jf,wf,Cu,On,Du,Rl,xf,Pu,Ln,Au,Rn,Tu,Bl,yf,Nu,Bn,Su,Ot,zf,Kl,Mf,Cf,Gr,Df,Pf,Ou,Da,Lu;d=new Xv({props:{fw:I[0]}}),z=new Oa({});const Tf=[eg,Zv],Kn=[];function Nf(e,u){return e[0]==="pt"?0:1}P=Nf(I),D=Kn[P]=Tf[P](I),ms=new ap({props:{id:"mqElG5QJWUg"}}),As=new Sa({props:{$$slots:{default:[sg]},$$scope:{ctx:I}}}),Hs=new Oa({});const Sf=[ag,tg],Fn=[];function Of(e,u){return e[0]==="pt"?0:1}$s=Of(I),ks=Fn[$s]=Sf[$s](I),Ue=new T({props:{code:'text = "This is a great [MASK]."',highlighted:'text = <span class="hljs-string">&quot;This is a great [MASK].&quot;</span>'}}),Ha=new T({props:{code:"",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> AutoTokenizer

tokenizer = AutoTokenizer.from_pretrained(model_checkpoint)`}});const Lf=[lg,ng],In=[];function Rf(e,u){return e[0]==="pt"?0:1}_t=Rf(I),ht=In[_t]=Lf[_t](I),Ua=new T({props:{code:`'>>> This is a great deal.' # C'est une bonne affaire
'>>> This is a great success.' # C'est un grand succ\xE8s
'>>> This is a great adventure.' # C'est une grande aventure
'>>> This is a great idea.' # C'est une bonne id\xE9e
'>>> This is a great feat.' # C'est un grand exploit`,highlighted:`<span class="hljs-string">&#x27;&gt;&gt;&gt; This is a great deal.&#x27;</span> <span class="hljs-comment"># C&#x27;est une bonne affaire</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; This is a great success.&#x27;</span> <span class="hljs-comment"># C&#x27;est un grand succ\xE8s</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; This is a great adventure.&#x27;</span> <span class="hljs-comment"># C&#x27;est une grande aventure</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; This is a great idea.&#x27;</span> <span class="hljs-comment"># C&#x27;est une bonne id\xE9e</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; This is a great feat.&#x27;</span> <span class="hljs-comment"># C&#x27;est un grand exploit</span>`}}),Ga=new Oa({}),Wa=new T({props:{code:"",highlighted:`<span class="hljs-keyword">from</span> datasets <span class="hljs-keyword">import</span> load_dataset

imdb_dataset = load_dataset(<span class="hljs-string">&quot;imdb&quot;</span>)
imdb_dataset`}}),Ja=new T({props:{code:`DatasetDict({
    train: Dataset({
        features: ['text', 'label'],
        num_rows: 25000
    })
    test: Dataset({
        features: ['text', 'label'],
        num_rows: 25000
    })
    unsupervised: Dataset({
        features: ['text', 'label'],
        num_rows: 50000
    })
})`,highlighted:`DatasetDict({
    train: Dataset({
        features: [<span class="hljs-string">&#x27;text&#x27;</span>, <span class="hljs-string">&#x27;label&#x27;</span>],
        num_rows: <span class="hljs-number">25000</span>
    })
    test: Dataset({
        features: [<span class="hljs-string">&#x27;text&#x27;</span>, <span class="hljs-string">&#x27;label&#x27;</span>],
        num_rows: <span class="hljs-number">25000</span>
    })
    unsupervised: Dataset({
        features: [<span class="hljs-string">&#x27;text&#x27;</span>, <span class="hljs-string">&#x27;label&#x27;</span>],
        num_rows: <span class="hljs-number">50000</span>
    })
})`}}),Ya=new T({props:{code:"",highlighted:`sample = imdb_dataset[<span class="hljs-string">&quot;train&quot;</span>].shuffle(seed=<span class="hljs-number">42</span>).select(<span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>))

<span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> sample:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\\n&#x27;&gt;&gt;&gt; Review: <span class="hljs-subst">{row[<span class="hljs-string">&#x27;text&#x27;</span>]}</span>&#x27;&quot;</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;&#x27;&gt;&gt;&gt; Label: <span class="hljs-subst">{row[<span class="hljs-string">&#x27;label&#x27;</span>]}</span>&#x27;&quot;</span>)`}}),Qa=new T({props:{code:`

`,highlighted:`
<span class="hljs-string">&#x27;&gt;&gt;&gt; Review: This is your typical Priyadarshan movie--a bunch of loony characters out on some silly mission. His signature climax has the entire cast of the film coming together and fighting each other in some crazy moshpit over hidden money. Whether it is a winning lottery ticket in Malamaal Weekly, black money in Hera Pheri, &quot;kodokoo&quot; in Phir Hera Pheri, etc., etc., the director is becoming ridiculously predictable. Don\\&#x27;t get me wrong; as clich\xE9d and preposterous his movies may be, I usually end up enjoying the comedy. However, in most his previous movies there has actually been some good humor, (Hungama and Hera Pheri being noteworthy ones). Now, the hilarity of his films is fading as he is using the same formula over and over again.&lt;br /&gt;&lt;br /&gt;Songs are good. Tanushree Datta looks awesome. Rajpal Yadav is irritating, and Tusshar is not a whole lot better. Kunal Khemu is OK, and Sharman Joshi is the best.&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; Label: 0&#x27;</span>

<span class="hljs-string">&#x27;&gt;&gt;&gt; Review: Okay, the story makes no sense, the characters lack any dimensionally, the best dialogue is ad-libs about the low quality of movie, the cinematography is dismal, and only editing saves a bit of the muddle, but Sam&quot; Peckinpah directed the film. Somehow, his direction is not enough. For those who appreciate Peckinpah and his great work, this movie is a disappointment. Even a great cast cannot redeem the time the viewer wastes with this minimal effort.&lt;br /&gt;&lt;br /&gt;The proper response to the movie is the contempt that the director San Peckinpah, James Caan, Robert Duvall, Burt Young, Bo Hopkins, Arthur Hill, and even Gig Young bring to their work. Watch the great Peckinpah films. Skip this mess.&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; Label: 0&#x27;</span>

<span class="hljs-string">&#x27;&gt;&gt;&gt; Review: I saw this movie at the theaters when I was about 6 or 7 years old. I loved it then, and have recently come to own a VHS version. &lt;br /&gt;&lt;br /&gt;My 4 and 6 year old children love this movie and have been asking again and again to watch it. &lt;br /&gt;&lt;br /&gt;I have enjoyed watching it again too. Though I have to admit it is not as good on a little TV.&lt;br /&gt;&lt;br /&gt;I do not have older children so I do not know what they would think of it. &lt;br /&gt;&lt;br /&gt;The songs are very cute. My daughter keeps singing them over and over.&lt;br /&gt;&lt;br /&gt;Hope this helps.&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; Label: 1&#x27;</span>`}}),_a=new Sa({props:{$$slots:{default:[og]},$$scope:{ctx:I}}}),Xa=new Oa({}),Za=new ap({props:{id:"8PmhEIXhBvI"}}),en=new T({props:{code:`
`,highlighted:`<span class="hljs-keyword">def</span> <span class="hljs-title function_">tokenize_function</span>(<span class="hljs-params">examples</span>):
    result = tokenizer(examples[<span class="hljs-string">&quot;text&quot;</span>])
    <span class="hljs-keyword">if</span> tokenizer.is_fast:
        result[<span class="hljs-string">&quot;word_ids&quot;</span>] = [result.word_ids(i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(result[<span class="hljs-string">&quot;input_ids&quot;</span>]))]
    <span class="hljs-keyword">return</span> result


<span class="hljs-comment"># Utilisation de batched=True pour activer le multithreading rapide !</span>
tokenized_datasets = imdb_dataset.<span class="hljs-built_in">map</span>(
    tokenize_function, batched=<span class="hljs-literal">True</span>, remove_columns=[<span class="hljs-string">&quot;text&quot;</span>, <span class="hljs-string">&quot;label&quot;</span>]
)
tokenized_datasets`}}),sn=new T({props:{code:`DatasetDict({
    train: Dataset({
        features: ['attention_mask', 'input_ids', 'word_ids'],
        num_rows: 25000
    })
    test: Dataset({
        features: ['attention_mask', 'input_ids', 'word_ids'],
        num_rows: 25000
    })
    unsupervised: Dataset({
        features: ['attention_mask', 'input_ids', 'word_ids'],
        num_rows: 50000
    })
})`,highlighted:`DatasetDict({
    train: Dataset({
        features: [<span class="hljs-string">&#x27;attention_mask&#x27;</span>, <span class="hljs-string">&#x27;input_ids&#x27;</span>, <span class="hljs-string">&#x27;word_ids&#x27;</span>],
        num_rows: <span class="hljs-number">25000</span>
    })
    test: Dataset({
        features: [<span class="hljs-string">&#x27;attention_mask&#x27;</span>, <span class="hljs-string">&#x27;input_ids&#x27;</span>, <span class="hljs-string">&#x27;word_ids&#x27;</span>],
        num_rows: <span class="hljs-number">25000</span>
    })
    unsupervised: Dataset({
        features: [<span class="hljs-string">&#x27;attention_mask&#x27;</span>, <span class="hljs-string">&#x27;input_ids&#x27;</span>, <span class="hljs-string">&#x27;word_ids&#x27;</span>],
        num_rows: <span class="hljs-number">50000</span>
    })
})`}}),tn=new T({props:{code:"tokenizer.model_max_length",highlighted:"tokenizer.model_max_length"}}),an=new T({props:{code:"512",highlighted:'<span class="hljs-number">512</span>'}}),ba=new Sa({props:{$$slots:{default:[rg]},$$scope:{ctx:I}}}),nn=new T({props:{code:"chunk_size = 128",highlighted:'chunk_size = <span class="hljs-number">128</span>'}}),qa=new Sa({props:{warning:!0,$$slots:{default:[ig]},$$scope:{ctx:I}}}),ln=new T({props:{code:"",highlighted:`<span class="hljs-comment"># Le d\xE9coupage produit une liste de listes pour chaque caract\xE9ristique</span>
tokenized_samples = tokenized_datasets[<span class="hljs-string">&quot;train&quot;</span>][:<span class="hljs-number">3</span>]

<span class="hljs-keyword">for</span> idx, sample <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(tokenized_samples[<span class="hljs-string">&quot;input_ids&quot;</span>]):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;&#x27;&gt;&gt;&gt; Review <span class="hljs-subst">{idx}</span> length: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(sample)}</span>&#x27;&quot;</span>)`}}),on=new T({props:{code:`'>>> Review 0 length: 200'
'>>> Review 1 length: 559'
'>>> Review 2 length: 192'`,highlighted:`<span class="hljs-string">&#x27;&gt;&gt;&gt; Review 0 length: 200&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; Review 1 length: 559&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; Review 2 length: 192&#x27;</span>`}}),rn=new T({props:{code:`concatenated_examples = {
    k: sum(tokenized_samples[k], []) for k in tokenized_samples.keys()
}
total_length = len(concatenated_examples["input_ids"])
print(f"'>>> Longueur des critiques concat\xE9n\xE9es : {total_length}'")`,highlighted:`concatenated_examples = {
    k: <span class="hljs-built_in">sum</span>(tokenized_samples[k], []) <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> tokenized_samples.keys()
}
total_length = <span class="hljs-built_in">len</span>(concatenated_examples[<span class="hljs-string">&quot;input_ids&quot;</span>])
<span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;&#x27;&gt;&gt;&gt; Longueur des critiques concat\xE9n\xE9es : <span class="hljs-subst">{total_length}</span>&#x27;&quot;</span>)`}}),un=new T({props:{code:"'>>> Longueur des critiques concat\xE9n\xE9es : 951'",highlighted:'<span class="hljs-string">&#x27;&gt;&gt;&gt; Longueur des critiques concat\xE9n\xE9es : 951&#x27;</span>'}}),pn=new T({props:{code:"",highlighted:`chunks = {
    k: [t[i : i + chunk_size] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, total_length, chunk_size)]
    <span class="hljs-keyword">for</span> k, t <span class="hljs-keyword">in</span> concatenated_examples.items()
}

<span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> chunks[<span class="hljs-string">&quot;input_ids&quot;</span>]:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;&#x27;&gt;&gt;&gt; Chunk length: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(chunk)}</span>&#x27;&quot;</span>)`}}),dn=new T({props:{code:`'>>> Chunk length: 128'
'>>> Chunk length: 128'
'>>> Chunk length: 128'
'>>> Chunk length: 128'
'>>> Chunk length: 128'
'>>> Chunk length: 128'
'>>> Chunk length: 128'
'>>> Chunk length: 55'`,highlighted:`<span class="hljs-string">&#x27;&gt;&gt;&gt; Chunk length: 128&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; Chunk length: 128&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; Chunk length: 128&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; Chunk length: 128&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; Chunk length: 128&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; Chunk length: 128&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; Chunk length: 128&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; Chunk length: 55&#x27;</span>`}}),fn=new T({props:{code:`def group_texts(examples):
    # Concat\xE9nation de tous les textes
    concatenated_examples = {k: sum(examples[k], []) for k in examples.keys()}
    # Calcule la longueur des textes concat\xE9n\xE9s
    total_length = len(concatenated_examples[list(examples.keys())[0]])
    # Nous laissons tomber le dernier morceau s'il est plus petit que chunk_size
    total_length = (total_length // chunk_size) * chunk_size
    # Fractionnement par chunk de max_len
    result = {
        k: [t[i : i + chunk_size] for i in range(0, total_length, chunk_size)]
        for k, t in concatenated_examples.items()
    }
    # Cr\xE9er une nouvelle colonne d'\xE9tiquettes
    result["labels"] = result["input_ids"].copy()
    return result`,highlighted:`<span class="hljs-keyword">def</span> <span class="hljs-title function_">group_texts</span>(<span class="hljs-params">examples</span>):
    <span class="hljs-comment"># Concat\xE9nation de tous les textes</span>
    concatenated_examples = {k: <span class="hljs-built_in">sum</span>(examples[k], []) <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> examples.keys()}
    <span class="hljs-comment"># Calcule la longueur des textes concat\xE9n\xE9s</span>
    total_length = <span class="hljs-built_in">len</span>(concatenated_examples[<span class="hljs-built_in">list</span>(examples.keys())[<span class="hljs-number">0</span>]])
    <span class="hljs-comment"># Nous laissons tomber le dernier morceau s&#x27;il est plus petit que chunk_size</span>
    total_length = (total_length // chunk_size) * chunk_size
    <span class="hljs-comment"># Fractionnement par chunk de max_len</span>
    result = {
        k: [t[i : i + chunk_size] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, total_length, chunk_size)]
        <span class="hljs-keyword">for</span> k, t <span class="hljs-keyword">in</span> concatenated_examples.items()
    }
    <span class="hljs-comment"># Cr\xE9er une nouvelle colonne d&#x27;\xE9tiquettes</span>
    result[<span class="hljs-string">&quot;labels&quot;</span>] = result[<span class="hljs-string">&quot;input_ids&quot;</span>].copy()
    <span class="hljs-keyword">return</span> result`}}),_n=new T({props:{code:`lm_datasets = tokenized_datasets.map(group_texts, batched=True)
lm_datasets`,highlighted:`lm_datasets = tokenized_datasets.<span class="hljs-built_in">map</span>(group_texts, batched=<span class="hljs-literal">True</span>)
lm_datasets`}}),hn=new T({props:{code:`DatasetDict({
    train: Dataset({
        features: ['attention_mask', 'input_ids', 'labels', 'word_ids'],
        num_rows: 61289
    })
    test: Dataset({
        features: ['attention_mask', 'input_ids', 'labels', 'word_ids'],
        num_rows: 59905
    })
    unsupervised: Dataset({
        features: ['attention_mask', 'input_ids', 'labels', 'word_ids'],
        num_rows: 122963
    })
})`,highlighted:`DatasetDict({
    train: Dataset({
        features: [<span class="hljs-string">&#x27;attention_mask&#x27;</span>, <span class="hljs-string">&#x27;input_ids&#x27;</span>, <span class="hljs-string">&#x27;labels&#x27;</span>, <span class="hljs-string">&#x27;word_ids&#x27;</span>],
        num_rows: <span class="hljs-number">61289</span>
    })
    test: Dataset({
        features: [<span class="hljs-string">&#x27;attention_mask&#x27;</span>, <span class="hljs-string">&#x27;input_ids&#x27;</span>, <span class="hljs-string">&#x27;labels&#x27;</span>, <span class="hljs-string">&#x27;word_ids&#x27;</span>],
        num_rows: <span class="hljs-number">59905</span>
    })
    unsupervised: Dataset({
        features: [<span class="hljs-string">&#x27;attention_mask&#x27;</span>, <span class="hljs-string">&#x27;input_ids&#x27;</span>, <span class="hljs-string">&#x27;labels&#x27;</span>, <span class="hljs-string">&#x27;word_ids&#x27;</span>],
        num_rows: <span class="hljs-number">122963</span>
    })
})`}}),vn=new T({props:{code:'tokenizer.decode(lm_datasets["train"][1]["input_ids"])',highlighted:'tokenizer.decode(lm_datasets[<span class="hljs-string">&quot;train&quot;</span>][<span class="hljs-number">1</span>][<span class="hljs-string">&quot;input_ids&quot;</span>])'}}),gn=new T({props:{code:`".... at.......... high. a classic line : inspector : i'm here to sack one of your teachers. student : welcome to bromwell high. i expect that many adults of my age think that bromwell high is far fetched. what a pity that it isn't! [SEP] [CLS] homelessness ( or houselessness as george carlin stated ) has been an issue for years but never a plan to help those on the street that were once considered human who did everything from going to school, work, or vote for the matter. most people think of the homeless"`,highlighted:'<span class="hljs-string">&quot;.... at.......... high. a classic line : inspector : i&#x27;m here to sack one of your teachers. student : welcome to bromwell high. i expect that many adults of my age think that bromwell high is far fetched. what a pity that it isn&#x27;t! [SEP] [CLS] homelessness ( or houselessness as george carlin stated ) has been an issue for years but never a plan to help those on the street that were once considered human who did everything from going to school, work, or vote for the matter. most people think of the homeless&quot;</span>'}}),bn=new T({props:{code:'tokenizer.decode(lm_datasets["train"][1]["labels"])',highlighted:'tokenizer.decode(lm_datasets[<span class="hljs-string">&quot;train&quot;</span>][<span class="hljs-number">1</span>][<span class="hljs-string">&quot;labels&quot;</span>])'}}),qn=new T({props:{code:`".... at.......... high. a classic line : inspector : i'm here to sack one of your teachers. student : welcome to bromwell high. i expect that many adults of my age think that bromwell high is far fetched. what a pity that it isn't! [SEP] [CLS] homelessness ( or houselessness as george carlin stated ) has been an issue for years but never a plan to help those on the street that were once considered human who did everything from going to school, work, or vote for the matter. most people think of the homeless"`,highlighted:'<span class="hljs-string">&quot;.... at.......... high. a classic line : inspector : i&#x27;m here to sack one of your teachers. student : welcome to bromwell high. i expect that many adults of my age think that bromwell high is far fetched. what a pity that it isn&#x27;t! [SEP] [CLS] homelessness ( or houselessness as george carlin stated ) has been an issue for years but never a plan to help those on the street that were once considered human who did everything from going to school, work, or vote for the matter. most people think of the homeless&quot;</span>'}}),$n=new Oa({}),En=new T({props:{code:"",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> DataCollatorForLanguageModeling

data_collator = DataCollatorForLanguageModeling(tokenizer=tokenizer, mlm_probability=<span class="hljs-number">0.15</span>)`}}),jn=new T({props:{code:"",highlighted:`samples = [lm_datasets[<span class="hljs-string">&quot;train&quot;</span>][i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>)]
<span class="hljs-keyword">for</span> sample <span class="hljs-keyword">in</span> samples:
    _ = sample.pop(<span class="hljs-string">&quot;word_ids&quot;</span>)

<span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> data_collator(samples)[<span class="hljs-string">&quot;input_ids&quot;</span>]:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\\n&#x27;&gt;&gt;&gt; <span class="hljs-subst">{tokenizer.decode(chunk)}</span>&#x27;&quot;</span>)`}}),wn=new T({props:{code:"",highlighted:`<span class="hljs-string">&#x27;&gt;&gt;&gt; [CLS] bromwell [MASK] is a cartoon comedy. it ran at the same [MASK] as some other [MASK] about school life, [MASK] as &quot; teachers &quot;. [MASK] [MASK] [MASK] in the teaching [MASK] lead [MASK] to believe that bromwell high\\&#x27;[MASK] satire is much closer to reality than is &quot; teachers &quot;. the scramble [MASK] [MASK] financially, the [MASK]ful students whogn [MASK] right through [MASK] pathetic teachers\\&#x27;pomp, the pettiness of the whole situation, distinction remind me of the schools i knew and their students. when i saw [MASK] episode in [MASK] a student repeatedly tried to burn down the school, [MASK] immediately recalled. [MASK]...&#x27;</span>

<span class="hljs-string">&#x27;&gt;&gt;&gt; .... at.. [MASK]... [MASK]... high. a classic line plucked inspector : i\\&#x27;[MASK] here to [MASK] one of your [MASK]. student : welcome to bromwell [MASK]. i expect that many adults of my age think that [MASK]mwell [MASK] is [MASK] fetched. what a pity that it isn\\&#x27;t! [SEP] [CLS] [MASK]ness ( or [MASK]lessness as george \u5B87in stated )\u516C been an issue for years but never [MASK] plan to help those on the street that were once considered human [MASK] did everything from going to school, [MASK], [MASK] vote for the matter. most people think [MASK] the homeless&#x27;</span>`}}),wa=new Sa({props:{$$slots:{default:[ug]},$$scope:{ctx:I}}});let hs=I[0]==="pt"&&Iv();const Bf=[dg,pg],Hn=[];function Kf(e,u){return e[0]==="pt"?0:1}vt=Kf(I),gt=Hn[vt]=Bf[vt](I),xn=new T({props:{code:"",highlighted:`samples = [lm_datasets[<span class="hljs-string">&quot;train&quot;</span>][i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>)]
batch = whole_word_masking_data_collator(samples)

<span class="hljs-keyword">for</span> chunk <span class="hljs-keyword">in</span> batch[<span class="hljs-string">&quot;input_ids&quot;</span>]:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;\\n&#x27;&gt;&gt;&gt; <span class="hljs-subst">{tokenizer.decode(chunk)}</span>&#x27;&quot;</span>)`}}),yn=new T({props:{code:"",highlighted:`<span class="hljs-string">&#x27;&gt;&gt;&gt; [CLS] bromwell high is a cartoon comedy [MASK] it ran at the same time as some other programs about school life, such as &quot; teachers &quot;. my 35 years in the teaching profession lead me to believe that bromwell high\\&#x27;s satire is much closer to reality than is &quot; teachers &quot;. the scramble to survive financially, the insightful students who can see right through their pathetic teachers\\&#x27;pomp, the pettiness of the whole situation, all remind me of the schools i knew and their students. when i saw the episode in which a student repeatedly tried to burn down the school, i immediately recalled.....&#x27;</span>

<span class="hljs-string">&#x27;&gt;&gt;&gt; .... [MASK] [MASK] [MASK] [MASK]....... high. a classic line : inspector : i\\&#x27;m here to sack one of your teachers. student : welcome to bromwell high. i expect that many adults of my age think that bromwell high is far fetched. what a pity that it isn\\&#x27;t! [SEP] [CLS] homelessness ( or houselessness as george carlin stated ) has been an issue for years but never a plan to help those on the street that were once considered human who did everything from going to school, work, or vote for the matter. most people think of the homeless&#x27;</span>`}}),xa=new Sa({props:{$$slots:{default:[cg]},$$scope:{ctx:I}}}),zn=new T({props:{code:"",highlighted:`train_size = <span class="hljs-number">10_000</span>
test_size = <span class="hljs-built_in">int</span>(<span class="hljs-number">0.1</span> * train_size)

downsampled_dataset = lm_datasets[<span class="hljs-string">&quot;train&quot;</span>].train_test_split(
    train_size=train_size, test_size=test_size, seed=<span class="hljs-number">42</span>
)
downsampled_dataset`}}),Mn=new T({props:{code:`DatasetDict({
    train: Dataset({
        features: ['attention_mask', 'input_ids', 'labels', 'word_ids'],
        num_rows: 10000
    })
    test: Dataset({
        features: ['attention_mask', 'input_ids', 'labels', 'word_ids'],
        num_rows: 1000
    })
})`,highlighted:`DatasetDict({
    train: Dataset({
        features: [<span class="hljs-string">&#x27;attention_mask&#x27;</span>, <span class="hljs-string">&#x27;input_ids&#x27;</span>, <span class="hljs-string">&#x27;labels&#x27;</span>, <span class="hljs-string">&#x27;word_ids&#x27;</span>],
        num_rows: <span class="hljs-number">10000</span>
    })
    test: Dataset({
        features: [<span class="hljs-string">&#x27;attention_mask&#x27;</span>, <span class="hljs-string">&#x27;input_ids&#x27;</span>, <span class="hljs-string">&#x27;labels&#x27;</span>, <span class="hljs-string">&#x27;word_ids&#x27;</span>],
        num_rows: <span class="hljs-number">1000</span>
    })
})`}}),Cn=new T({props:{code:"",highlighted:`<span class="hljs-keyword">from</span> huggingface_hub <span class="hljs-keyword">import</span> notebook_login

notebook_login()`}}),Dn=new T({props:{code:"huggingface-cli login",highlighted:'huggingface-<span class="hljs-keyword">cli</span> login'}});const Ff=[fg,mg],Un=[];function If(e,u){return e[0]==="tf"?0:1}bt=If(I),qt=Un[bt]=Ff[bt](I),Pn=new Oa({}),An=new ap({props:{id:"NURcDHhYe98"}});const Hf=[hg,_g],Gn=[];function Uf(e,u){return e[0]==="pt"?0:1}$t=Uf(I),kt=Gn[$t]=Hf[$t](I),Tn=new T({props:{code:"Perplexit\xE9 : 21.75",highlighted:'<span class="hljs-meta">&gt;&gt;&gt; </span>Perplexit\xE9 : <span class="hljs-number">21.75</span>'}});const Gf=[gg,vg],Vn=[];function Vf(e,u){return e[0]==="pt"?0:1}Et=Vf(I),jt=Vn[Et]=Gf[Et](I);const Wf=[qg,bg],Wn=[];function Jf(e,u){return e[0]==="pt"?0:1}wt=Jf(I),xt=Wn[wt]=Wf[wt](I),Nn=new T({props:{code:"Perplexit\xE9 : 11.32",highlighted:'<span class="hljs-meta">&gt;&gt;&gt; </span>Perplexit\xE9 : <span class="hljs-number">11.32</span>'}});let Le=I[0]==="pt"&&Hv();Ma=new Sa({props:{$$slots:{default:[$g]},$$scope:{ctx:I}}});let Re=I[0]==="pt"&&Uv();return Sn=new Oa({}),On=new T({props:{code:"",highlighted:`<span class="hljs-keyword">from</span> transformers <span class="hljs-keyword">import</span> pipeline

mask_filler = pipeline(
    <span class="hljs-string">&quot;fill-mask&quot;</span>, model=<span class="hljs-string">&quot;huggingface-course/distilbert-base-uncased-finetuned-imdb&quot;</span>
)`}}),Ln=new T({props:{code:"",highlighted:`preds = mask_filler(text)

<span class="hljs-keyword">for</span> pred <span class="hljs-keyword">in</span> preds:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;&gt;&gt;&gt; <span class="hljs-subst">{pred[<span class="hljs-string">&#x27;sequence&#x27;</span>]}</span>&quot;</span>)`}}),Rn=new T({props:{code:`'>>> this is a great movie.'
'>>> this is a great film.'
'>>> this is a great story.'
'>>> this is a great movies.'
'>>> this is a great character.'`,highlighted:`<span class="hljs-string">&#x27;&gt;&gt;&gt; this is a great movie.&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; this is a great film.&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; this is a great story.&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; this is a great movies.&#x27;</span>
<span class="hljs-string">&#x27;&gt;&gt;&gt; this is a great character.&#x27;</span>`}}),Bn=new ap({props:{id:"0Oxphw4Q9fo"}}),Da=new Sa({props:{$$slots:{default:[kg]},$$scope:{ctx:I}}}),{c(){i=l("meta"),h=m(),E(d.$$.fragment),k=m(),A=l("h1"),$=l("a"),q=l("span"),E(z.$$.fragment),_=m(),M=l("span"),O=l("i"),C=a("Finetuner"),L=a(" un mod\xE8le de langage masqu\xE9"),H=m(),D.c(),U=m(),R=l("p"),v=a("Pour de nombreuses applications de NLP impliquant des "),S=l("em"),W=a("transformers"),G=a(", vous pouvez simplement prendre un mod\xE8le pr\xE9-entra\xEEn\xE9 du "),J=l("em"),ee=a("Hub"),re=a(" et le "),te=l("em"),V=a("finetuner"),B=a(" directement sur vos donn\xE9es pour la t\xE2che \xE0 accomplir. Pour autant que le corpus utilis\xE9 pour le pr\xE9-entra\xEEnement ne soit pas trop diff\xE9rent du corpus utilis\xE9 pour le "),ie=l("em"),Q=a("finetuning"),se=a(". L\u2019apprentissage par transfert produira g\xE9n\xE9ralement de bons r\xE9sultats."),ue=m(),Z=l("p"),ge=a("Cependant, il existe quelques cas o\xF9 vous voudrez d\u2019abord "),ne=l("em"),de=a("finetuner"),rs=a(" les mod\xE8les de langue sur vos donn\xE9es, avant d\u2019entra\xEEner une t\xEAte sp\xE9cifique \xE0 la t\xE2che. Par exemple, si votre jeu de donn\xE9es contient des contrats l\xE9gaux ou des articles scientifiques, un "),be=l("em"),qe=a("transformer"),is=a(" classique comme BERT traitera g\xE9n\xE9ralement les mots sp\xE9cifiques au domaine dans votre corpus comme des "),Ve=l("em"),$e=a("tokens"),us=a(" rares et les performances r\xE9sultantes peuvent \xEAtre moins que satisfaisantes. En "),We=l("em"),xe=a("finetunant"),Se=a(" le mod\xE8le de langage sur les donn\xE9es du domaine, vous pouvez am\xE9liorer les performances de nombreuses t\xE2ches en aval, ce qui signifie que vous ne devez g\xE9n\xE9ralement effectuer cette \xE9tape qu\u2019une seule fois !"),Je=m(),X=l("p"),pe=a("Ce processus de "),ye=l("em"),ce=a("finetuning"),ps=a(" d\u2019un mod\xE8le de langage pr\xE9-entra\xEEn\xE9 sur des donn\xE9es "),ze=l("em"),ke=a("dans le domaine"),Xe=a(" est g\xE9n\xE9ralement appel\xE9 "),le=l("em"),Ze=a("adaptation au domaine"),Ee=a(". Il a \xE9t\xE9 popularis\xE9 en 2018 par "),je=l("a"),K=a("ULMFiT"),ae=a(" qui a \xE9t\xE9 l\u2019une des premi\xE8res architectures neuronales (bas\xE9es sur des LSTMs) \xE0 faire en sorte que l\u2019apprentissage par transfert fonctionne r\xE9ellement pour le NLP. Un exemple d\u2019adaptation de domaine avec ULMFiT est pr\xE9sent\xE9 dans l\u2019image ci-dessous. Dans cette section, nous ferons quelque chose de similaire mais avec un "),Be=l("em"),me=a("transformer"),es=a(" au lieu d\u2019une LSTM !"),Ye=m(),Me=l("div"),Oe=l("img"),N=m(),Y=l("img"),oe=m(),Ce=l("p"),Ps=a("\xC0 la fin de cette section, vous aurez un "),Fe=l("a"),Qe=a("mod\xE8le de langage masqu\xE9"),Ie=a(" sur le "),De=l("em"),_e=a("Hub"),Fs=a(" qui peut autocompl\xE9ter des phrases comme indiqu\xE9 ci-dessous :"),nt=m(),Pe=l("iframe"),ds=m(),we=l("iframe"),lt=m(),cs=l("p"),gs=a("Allons-y !"),ot=m(),E(ms.$$.fragment),Is=m(),E(As.$$.fragment),rt=m(),Ts=l("h2"),Ns=l("a"),Ss=l("span"),E(Hs.$$.fragment),bs=m(),Gt=l("span"),Vt=a("Choix d'un mod\xE8le pr\xE9-entra\xEEn\xE9 pour la mod\xE9lisation du langage masqu\xE9"),ta=m(),qs=l("p"),Wt=a("Pour commencer, nous allons choisir un mod\xE8le pr\xE9-entra\xEEn\xE9 appropri\xE9 pour la mod\xE9lisation du langage masqu\xE9. Comme le montre la capture d\u2019\xE9cran suivante, vous pouvez trouver une liste de candidats en appliquant le filtre \xAB "),Jt=l("em"),La=a("Fill-Mask"),aa=a(" \xBB sur le "),fs=l("a"),zt=l("em"),it=a("Hub"),na=a(" :"),_s=m(),ut=l("div"),Os=l("img"),la=m(),ve=l("p"),Ra=a("Bien que les mod\xE8les de la famille BERT et RoBERTa soient les plus t\xE9l\xE9charg\xE9s, nous utiliserons un mod\xE8le appel\xE9 "),pt=l("a"),oa=a("DistilBERT"),dt=a(" qui peut \xEAtre entra\xEEn\xE9 beaucoup plus rapidement avec peu ou pas de perte de performance en aval. Ce mod\xE8le a \xE9t\xE9 entra\xEEn\xE9 \xE0 l\u2019aide d\u2019une technique sp\xE9ciale appel\xE9e "),Us=l("a"),Gs=l("em"),Ba=a("distillation de connaissances"),ra=a(", o\xF9 un grand mod\xE8le "),Ls=l("em"),ia=a("enseignant"),ct=a(" comme BERT est utilis\xE9 pour guider l\u2019entra\xEEnement d\u2019un mod\xE8le "),Mt=l("em"),Ct=a("\xE9tudiant"),Ka=a(" qui a beaucoup moins de param\xE8tres. Une explication des d\xE9tails de la distillation de connaissances nous m\xE8nerait trop loin dans cette section mais si vous \xEAtes int\xE9ress\xE9, vous pouvez lire tout cela dans le livre "),Vs=l("a"),c=l("em"),F=a("Natural Language Processing with Transformers"),Xn=a("."),Yt=m(),ks.c(),mt=m(),ft=l("p"),Zn=a("Avec environ 67 millions de param\xE8tres, DistilBERT est environ deux fois plus petit que le mod\xE8le de base de BERT, ce qui se traduit approximativement par une acc\xE9l\xE9ration de l\u2019entra\xEEnement d\u2019un facteur deux. Voyons maintenant quels types de "),Es=l("em"),el=a("tokens"),sl=a(" ce mod\xE8le pr\xE9dit comme \xE9tant les compl\xE9ments les plus probables d\u2019un petit \xE9chantillon de texte :"),Fa=m(),E(Ue.$$.fragment),Ia=m(),he=l("p"),tl=a("En tant qu\u2019\xEAtres humains, nous pouvons imaginer de nombreuses possibilit\xE9s pour le "),ua=l("em"),pa=a("token"),al=m(),js=l("code"),nl=a("[MASK]"),ll=a(", telles que \xAB jour \xBB, \xAB promenade \xBB ou \xAB peinture \xBB. Pour les mod\xE8les pr\xE9-entra\xEEn\xE9s, les pr\xE9dictions d\xE9pendent du corpus sur lequel le mod\xE8le a \xE9t\xE9 entra\xEEn\xE9 puisqu\u2019il apprend \xE0 d\xE9tecter les mod\xE8les statistiques pr\xE9sents dans les donn\xE9es. Comme BERT, DistilBERT a \xE9t\xE9 pr\xE9-entra\xEEn\xE9 sur les jeux de donn\xE9es "),Dt=l("a"),Pt=l("em"),ol=a("English Wikipedia"),da=a(" et "),At=l("a"),Tt=l("em"),rl=a("BookCorpus"),il=a(", nous nous attendons donc \xE0 ce que les pr\xE9dictions pour "),Ws=l("code"),ul=a("[MASK]"),pl=a(" refl\xE8tent ces domaines. Pour pr\xE9dire le masque, nous avons besoin du "),Js=l("em"),dl=a("tokenizer"),cl=a(" de DistilBERT pour produire les entr\xE9es du mod\xE8le, alors t\xE9l\xE9chargeons-le \xE9galement depuis le "),ca=l("em"),ml=a("Hub"),np=a(" :"),Zr=m(),E(Ha.$$.fragment),ei=m(),ma=l("p"),lp=a("Avec un "),eo=l("em"),op=a("tokenizer"),rp=a(" et un mod\xE8le, nous pouvons maintenant passer notre exemple de texte au mod\xE8le, extraire les logits, et afficher les 5 meilleurs candidats :"),si=m(),ht.c(),fl=m(),E(Ua.$$.fragment),ti=m(),_l=l("p"),ip=a("Nous pouvons voir dans les sorties que les pr\xE9dictions du mod\xE8le se r\xE9f\xE8rent \xE0 des termes de tous les jours, ce qui n\u2019est peut-\xEAtre pas surprenant \xE9tant donn\xE9 le fondement de Wikip\xE9dia. Voyons comment nous pouvons changer ce domaine pour quelque chose d\u2019un peu plus sp\xE9cialis\xE9 : des critiques de films !"),ai=m(),Qt=l("h2"),fa=l("a"),so=l("span"),E(Ga.$$.fragment),up=m(),to=l("span"),pp=a("Le jeu de donn\xE9es"),ni=m(),ss=l("p"),dp=a("Pour illustrer l\u2019adaptation au domaine, nous utiliserons le c\xE9l\xE8bre "),Va=l("a"),ao=l("em"),cp=a("Large Movie Review Dataset"),mp=a(" (ou IMDb en abr\xE9g\xE9), qui est un corpus de critiques de films souvent utilis\xE9 pour \xE9valuer les mod\xE8les d\u2019analyse de sentiments. En "),no=l("em"),fp=a("finetunant"),_p=a(" DistilBERT sur ce corpus, nous esp\xE9rons que le mod\xE8le de langage adaptera son vocabulaire des donn\xE9es factuelles de Wikip\xE9dia sur lesquelles il a \xE9t\xE9 pr\xE9-entra\xEEn\xE9 aux \xE9l\xE9ments plus subjectifs des critiques de films. Nous pouvons obtenir les donn\xE9es du "),lo=l("em"),hp=a("Hub"),vp=a(" avec la fonction "),oo=l("code"),gp=a("load_dataset()"),bp=a(" de \u{1F917} "),ro=l("em"),qp=a("Datasets"),$p=a(" :"),li=m(),E(Wa.$$.fragment),oi=m(),E(Ja.$$.fragment),ri=m(),ts=l("p"),kp=a("Nous pouvons voir que les parties "),io=l("code"),Ep=a("train"),jp=a(" et "),uo=l("code"),wp=a("test"),xp=a(" sont chacune compos\xE9es de 25 000 critiques, alors qu\u2019il y a une partie non \xE9tiquet\xE9e appel\xE9e "),po=l("code"),yp=a("unsupervised"),zp=a(" qui contient 50 000 critiques. Jetons un coup d\u2019\u0153il \xE0 quelques \xE9chantillons pour avoir une id\xE9e du type de texte auquel nous avons affaire. Comme nous l\u2019avons fait dans les chapitres pr\xE9c\xE9dents du cours, nous allons encha\xEEner les fonctions "),co=l("code"),Mp=a("Dataset.shuffle()"),Cp=a(" et "),mo=l("code"),Dp=a("Dataset.select()"),Pp=a(" pour cr\xE9er un \xE9chantillon al\xE9atoire :"),ii=m(),E(Ya.$$.fragment),ui=m(),E(Qa.$$.fragment),pi=m(),Nt=l("p"),Ap=a("Oui, ce sont bien des critiques de films, et si vous \xEAtes assez \xE2g\xE9s, vous pouvez m\xEAme comprendre le commentaire dans la derni\xE8re critique sur le fait de poss\xE9der une version VHS \u{1F61C} ! Bien que nous n\u2019ayons pas besoin des \xE9tiquettes pour la mod\xE9lisation du langage, nous pouvons d\xE9j\xE0 voir qu\u2019un "),fo=l("code"),Tp=a("0"),Np=a(" d\xE9note une critique n\xE9gative, tandis qu\u2019un "),_o=l("code"),Sp=a("1"),Op=a(" correspond \xE0 une critique positive."),di=m(),E(_a.$$.fragment),ci=m(),ha=l("p"),Lp=a("Maintenant que nous avons jet\xE9 un coup d\u2019\u0153il rapide aux donn\xE9es, plongeons dans leur pr\xE9paration pour la mod\xE9lisation du langage masqu\xE9. Comme nous allons le voir, il y a quelques \xE9tapes suppl\xE9mentaires \xE0 suivre par rapport aux t\xE2ches de classification de s\xE9quences que nous avons vues au "),hl=l("a"),Rp=a("chapitre 3"),Bp=a(". Allons-y !"),mi=m(),Xt=l("h2"),va=l("a"),ho=l("span"),E(Xa.$$.fragment),Kp=m(),vo=l("span"),Fp=a("Pr\xE9traitement des donn\xE9es"),fi=m(),E(Za.$$.fragment),_i=m(),ga=l("p"),Ip=a("Pour la mod\xE9lisation autor\xE9gressive et la mod\xE9lisation du langage masqu\xE9, une \xE9tape commune de pr\xE9traitement consiste \xE0 concat\xE9ner tous les exemples, puis \xE0 diviser le corpus entier en morceaux de taille \xE9gale. C\u2019est tr\xE8s diff\xE9rent de notre approche habituelle, o\xF9 nous nous contentons de "),go=l("em"),Hp=a("tokenizer"),Up=a(" les exemples individuels. Pourquoi tout concat\xE9ner ? La raison est que les exemples individuels peuvent \xEAtre tronqu\xE9s s\u2019ils sont trop longs, ce qui entra\xEEnerait la perte d\u2019informations qui pourraient \xEAtre utiles pour la t\xE2che de mod\xE9lisation du langage !"),hi=m(),Ae=l("p"),Gp=a("Donc pour commencer, nous allons d\u2019abord tokeniser notre corpus comme d\u2019habitude, mais "),bo=l("em"),Vp=a("sans"),Wp=a(" mettre l\u2019option "),qo=l("code"),Jp=a("truncation=True"),Yp=a(" dans notre "),$o=l("em"),Qp=a("tokenizer"),Xp=a(". Nous allons aussi r\xE9cup\xE9rer les identifiants des mots s\u2019ils sont disponibles (ce qui sera le cas si nous utilisons un "),ko=l("em"),Zp=a("tokenizer"),ed=a(" rapide, comme d\xE9crit dans le "),vl=l("a"),sd=a("chapitre 6"),td=a("), car nous en aurons besoin plus tard pour faire le masquage de mots entiers. Nous allons envelopper cela dans une simple fonction, et pendant que nous y sommes, nous allons supprimer les colonnes "),Eo=l("code"),ad=a("text"),nd=a(" et "),jo=l("code"),ld=a("label"),od=a(" puisque nous n\u2019en avons plus besoin :"),vi=m(),E(en.$$.fragment),gi=m(),E(sn.$$.fragment),bi=m(),Ys=l("p"),rd=a("Comme DistilBERT est un mod\xE8le de type BERT, nous pouvons voir que les textes encod\xE9s sont constitu\xE9s des "),wo=l("code"),id=a("input_ids"),ud=a(" et des "),xo=l("code"),pd=a("attention_mask"),dd=a(" que nous avons vus dans d\u2019autres chapitres, ainsi que des "),yo=l("code"),cd=a("word_ids"),md=a(" que nous avons ajout\xE9s."),qi=m(),Qs=l("p"),fd=a("Maintenant que nos critiques de films ont \xE9t\xE9 tokenis\xE9es, l\u2019\xE9tape suivante consiste \xE0 les regrouper et \xE0 diviser le r\xE9sultat en chunks. Mais quelle taille doivent avoir ces "),zo=l("em"),_d=a("chunks"),hd=a(" ? Cela sera finalement d\xE9termin\xE9 par la quantit\xE9 de m\xE9moire GPU dont vous disposez, mais un bon point de d\xE9part est de voir quelle est la taille maximale du contexte du mod\xE8le. Cela peut \xEAtre d\xE9duit en inspectant l\u2019attribut "),Mo=l("code"),vd=a("model_max_length"),gd=a(" du "),Co=l("em"),bd=a("tokenizer"),qd=a(" :"),$i=m(),E(tn.$$.fragment),ki=m(),E(an.$$.fragment),Ei=m(),Xs=l("p"),$d=a("Cette valeur est d\xE9riv\xE9e du fichier "),Do=l("em"),kd=a("tokenizer_config.json"),Ed=a(" associ\xE9 \xE0 un "),Po=l("em"),jd=a("checkpoint"),wd=a(". Dans ce cas, nous pouvons voir que la taille du contexte est de 512 "),Ao=l("em"),xd=a("tokens"),yd=a(", tout comme avec BERT."),ji=m(),E(ba.$$.fragment),wi=m(),gl=l("p"),zd=a("Ainsi, pour r\xE9aliser nos exp\xE9riences sur des GPUs comme ceux disponibles sur Google Colab, nous choisirons quelque chose d\u2019un peu plus petit qui peut tenir en m\xE9moire :"),xi=m(),E(nn.$$.fragment),yi=m(),E(qa.$$.fragment),zi=m(),$a=l("p"),Md=a("Maintenant vient la partie amusante. Pour montrer comment la concat\xE9nation fonctionne, prenons quelques commentaires de notre ensemble d\u2019entra\xEEnement et affichons le nombre de "),To=l("em"),Cd=a("tokens"),Dd=a(" par commentaire :"),Mi=m(),E(ln.$$.fragment),Ci=m(),E(on.$$.fragment),Di=m(),bl=l("p"),Pd=a("Nous pouvons ensuite concat\xE9ner tous ces exemples avec une simple compr\xE9hension du dictionnaire, comme suit :"),Pi=m(),E(rn.$$.fragment),Ai=m(),E(un.$$.fragment),Ti=m(),ws=l("p"),Ad=a("Super, la longueur totale est correcte. Donc maintenant, nous allons diviser les exemples concat\xE9n\xE9s en morceaux de la taille donn\xE9e par "),No=l("code"),Td=a("block_size"),Nd=a(". Pour ce faire, nous it\xE9rons sur les caract\xE9ristiques de "),So=l("code"),Sd=a("concatenated_examples"),Od=a(" et utilisons une compr\xE9hension de liste pour cr\xE9er des "),Oo=l("em"),Ld=a("chunks"),Rd=a(" de chaque caract\xE9ristique. Le r\xE9sultat est un dictionnaire de "),Lo=l("em"),Bd=a("chunks"),Kd=a(" pour chaque caract\xE9ristique :"),Ni=m(),E(pn.$$.fragment),Si=m(),E(dn.$$.fragment),Oi=m(),ka=l("p"),Fd=a("Comme vous pouvez le voir dans cet exemple, le dernier "),Ro=l("em"),Id=a("chunk"),Hd=a(" sera g\xE9n\xE9ralement plus petit que la taille maximale des morceaux. Il y a deux strat\xE9gies principales pour g\xE9rer cela :"),Li=m(),Ea=l("ul"),cn=l("li"),Ud=a("Abandonner le dernier morceau s\u2019il est plus petit que "),Bo=l("code"),Gd=a("chunk_size"),Vd=a("."),Wd=m(),mn=l("li"),Jd=a("Rembourrer le dernier morceau jusqu\u2019\xE0 ce que sa longueur soit \xE9gale \xE0 "),Ko=l("code"),Yd=a("chunk_size"),Qd=a("."),Ri=m(),ql=l("p"),Xd=a("Nous adopterons la premi\xE8re approche ici, donc nous allons envelopper toute la logique ci-dessus dans une seule fonction que nous pouvons appliquer \xE0 nos jeux de donn\xE9es tokenis\xE9s :"),Bi=m(),E(fn.$$.fragment),Ki=m(),as=l("p"),Zd=a("Notez que dans la derni\xE8re \xE9tape de "),Fo=l("code"),ec=a("group_texts()"),sc=a(" nous cr\xE9ons une nouvelle colonne "),Io=l("code"),tc=a("labels"),ac=a(" qui est une copie de la colonne "),Ho=l("code"),nc=a("input_ids"),lc=a(". Comme nous le verrons bient\xF4t, c\u2019est parce que dans la mod\xE9lisation du langage masqu\xE9, l\u2019objectif est de pr\xE9dire des "),Uo=l("em"),oc=a("tokens"),rc=a(" masqu\xE9s al\xE9atoirement dans le batch d\u2019entr\xE9e, et en cr\xE9ant une colonne "),Go=l("code"),ic=a("labels"),uc=a(", nous fournissons la v\xE9rit\xE9 de base pour notre mod\xE8le de langage \xE0 apprendre."),Fi=m(),St=l("p"),pc=a("Appliquons maintenant "),Vo=l("code"),dc=a("group_texts()"),cc=a(" \xE0 nos jeux de donn\xE9es tokenis\xE9s en utilisant notre fid\xE8le fonction "),Wo=l("code"),mc=a("Dataset.map()"),fc=a(" :"),Ii=m(),E(_n.$$.fragment),Hi=m(),E(hn.$$.fragment),Ui=m(),Te=l("p"),_c=a("Vous pouvez voir que le regroupement puis le d\xE9coupage des textes a produit beaucoup plus d\u2019exemples que nos 25 000 exemples initiaux pour les divisions "),Jo=l("code"),hc=a("train"),vc=a(" et "),Yo=l("code"),gc=a("test"),bc=a(". C\u2019est parce que nous avons maintenant des exemples impliquant des "),Qo=l("em"),qc=a("tokens"),$c=a(" contigus qui s\u2019\xE9tendent sur plusieurs exemples du corpus original. Vous pouvez le voir explicitement en cherchant les "),Xo=l("em"),kc=a("tokens"),Ec=a(" sp\xE9ciaux "),Zo=l("code"),jc=a("[SEP]"),wc=a(" et "),er=l("code"),xc=a("[CLS]"),yc=a(" dans l\u2019un des "),sr=l("em"),zc=a("chunks"),Mc=a(" :"),Gi=m(),E(vn.$$.fragment),Vi=m(),E(gn.$$.fragment),Wi=m(),$l=l("p"),Cc=a("Dans cet exemple, vous pouvez voir deux critiques de films qui se chevauchent, l\u2019une sur un film de lyc\xE9e et l\u2019autre sur les sans-abri. Voyons \xE9galement \xE0 quoi ressemblent les \xE9tiquettes pour la mod\xE9lisation du langage masqu\xE9 :"),Ji=m(),E(bn.$$.fragment),Yi=m(),E(qn.$$.fragment),Qi=m(),xs=l("p"),Dc=a("Comme pr\xE9vu par notre fonction "),tr=l("code"),Pc=a("group_texts()"),Ac=a(" ci-dessus, cela semble identique aux "),ar=l("code"),Tc=a("input_ids"),Nc=a(" d\xE9cod\xE9s. Mais alors comment notre mod\xE8le peut-il apprendre quoi que ce soit ? Il nous manque une \xE9tape cl\xE9 : ins\xE9rer des "),nr=l("em"),Sc=a("tokens"),Oc=a(" \xE0 des positions al\xE9atoires dans les entr\xE9es ! Voyons comment nous pouvons le faire \xE0 la vol\xE9e pendant le "),lr=l("em"),Lc=a("finetuning"),Rc=a(" en utilisant un collateur de donn\xE9es sp\xE9cial."),Xi=m(),Zt=l("h2"),ja=l("a"),or=l("span"),E($n.$$.fragment),Bc=m(),kn=l("span"),rr=l("i"),Kc=a("Finetuning"),Fc=a(" de DistilBERT avec l'API "),ir=l("code"),Ic=a("Trainer"),Zi=m(),fe=l("p"),Hc=a("Le "),ur=l("em"),Uc=a("finetuning"),Gc=a(" d\u2019un mod\xE8le de langage masqu\xE9 est presque identique au "),pr=l("em"),Vc=a("finetuning"),Wc=a(" d\u2019un mod\xE8le de classification de s\xE9quences, comme nous l\u2019avons fait dans le "),kl=l("a"),Jc=a("chapitre 3"),Yc=a(". La seule diff\xE9rence est que nous avons besoin d\u2019un collecteur de donn\xE9es sp\xE9cial qui peut masquer de mani\xE8re al\xE9atoire certains des "),dr=l("em"),Qc=a("tokens"),Xc=a(" dans chaque batch de textes. Heureusement, \u{1F917} "),cr=l("em"),Zc=a("Transformers"),em=a(" est livr\xE9 pr\xE9par\xE9 avec un "),mr=l("code"),sm=a("DataCollatorForLanguageModeling"),tm=a(" d\xE9di\xE9 \xE0 cette t\xE2che. Nous devons juste lui passer le "),fr=l("em"),am=a("tokenizer"),nm=a(" et un argument "),_r=l("code"),lm=a("mlm_probability"),om=a(" qui sp\xE9cifie quelle fraction des "),hr=l("em"),rm=a("tokens"),im=a(" \xE0 masquer. Nous choisirons 15%, qui est la quantit\xE9 utilis\xE9e pour BERT et un choix commun dans la litt\xE9rature :"),eu=m(),E(En.$$.fragment),su=m(),Zs=l("p"),um=a("Pour voir comment le masquage al\xE9atoire fonctionne, nous allons donner quelques exemples au collateur de donn\xE9es. Puisqu\u2019il s\u2019attend \xE0 une liste de "),vr=l("code"),pm=a("dict"),dm=a(" o\xF9 chaque "),gr=l("code"),cm=a("dict"),mm=a(" repr\xE9sente un seul morceau de texte contigu, nous it\xE9rons d\u2019abord sur le jeu de donn\xE9es avant de donner le batch au collateur. Nous supprimons la cl\xE9 "),br=l("code"),fm=a('"word_ids"'),_m=a(" pour ce collateur de donn\xE9es car il ne l\u2019attend pas :"),tu=m(),E(jn.$$.fragment),au=m(),E(wn.$$.fragment),nu=m(),ys=l("p"),hm=a("Super, \xE7a a march\xE9 ! Nous pouvons voir que le "),qr=l("em"),vm=a("token"),gm=m(),$r=l("code"),bm=a("[MASK]"),qm=a(" a \xE9t\xE9 ins\xE9r\xE9 de fa\xE7on al\xE9atoire \xE0 diff\xE9rents endroits dans notre texte. Ce seront les "),kr=l("em"),$m=a("tokens"),km=a(" que notre mod\xE8le devra pr\xE9dire pendant l\u2019entra\xEEnement. Et la beaut\xE9 du collecteur de donn\xE9es est qu\u2019il va rendre al\xE9atoire l\u2019insertion du "),Er=l("code"),Em=a("[MASK]"),jm=a(" \xE0 chaque batch !"),lu=m(),E(wa.$$.fragment),ou=m(),hs&&hs.c(),El=m(),zs=l("p"),wm=a("Lors de l\u2019entra\xEEnement des mod\xE8les pour la mod\xE9lisation du langage masqu\xE9, une technique qui peut \xEAtre utilis\xE9e est de masquer des mots entiers ensemble et pas seulement des "),jr=l("em"),xm=a("tokens"),ym=a(" individuels. Cette approche est appel\xE9e "),wr=l("em"),zm=a("masquage de mots entiers"),Mm=a(". Si nous voulons utiliser le masquage de mots entiers, nous devons construire nous-m\xEAmes un collateur de donn\xE9es. Un collateur de donn\xE9es est simplement une fonction qui prend une liste d\u2019\xE9chantillons et les convertit en un batch. Faisons-le ! Nous utiliserons les identifiants des mots calcul\xE9s plus t\xF4t pour faire une correspondance entre les indices des mots et les "),xr=l("em"),Cm=a("tokens"),Dm=a(", puis nous d\xE9ciderons al\xE9atoirement quels mots masquer et appliquerons ce masque sur les entr\xE9es. Notez que les \xE9tiquettes sont toutes "),yr=l("code"),Pm=a("-100"),Am=a(" sauf celles qui correspondent aux mots masqu\xE9s."),ru=m(),gt.c(),jl=m(),wl=l("p"),Tm=a("Ensuite, nous pouvons l\u2019essayer sur les m\xEAmes \xE9chantillons que pr\xE9c\xE9demment :"),iu=m(),E(xn.$$.fragment),uu=m(),E(yn.$$.fragment),pu=m(),E(xa.$$.fragment),du=m(),Ms=l("p"),Nm=a("Maintenant que nous avons deux collateurs de donn\xE9es, les \xE9tapes restantes du "),zr=l("em"),Sm=a("finetuning"),Om=a(" sont standards. L\u2019entra\xEEnement peut prendre un certain temps sur Google Colab si vous n\u2019avez pas la chance de tomber sur un mythique GPU P100 \u{1F62D}. Ainsi nous allons d\u2019abord r\xE9duire la taille du jeu d\u2019entra\xEEnement \xE0 quelques milliers d\u2019exemples. Ne vous inqui\xE9tez pas, nous obtiendrons quand m\xEAme un mod\xE8le de langage assez d\xE9cent ! Un moyen rapide de r\xE9duire la taille d\u2019un jeu de donn\xE9es dans \u{1F917} "),Mr=l("em"),Lm=a("Datasets"),Rm=a(" est la fonction "),Cr=l("code"),Bm=a("Dataset.train_test_split()"),Km=a(" que nous avons vue au "),xl=l("a"),Fm=a("chapitre 5"),Im=a(" :"),cu=m(),E(zn.$$.fragment),mu=m(),E(Mn.$$.fragment),fu=m(),Cs=l("p"),Hm=a("Cela a automatiquement cr\xE9\xE9 de nouvelles divisions "),Dr=l("code"),Um=a("train"),Gm=a(" et "),Pr=l("code"),Vm=a("test"),Wm=a(" avec la taille du jeu d\u2019entra\xEEnement fix\xE9e \xE0 10.000 exemples et la validation fix\xE9e \xE0 10% de cela. N\u2019h\xE9sitez pas \xE0 augmenter la taille si vous avez un GPU puissant ! La prochaine chose que nous devons faire est de nous connecter au "),Ar=l("em"),Jm=a("Hub"),Ym=a(". Si vous ex\xE9cutez ce code dans un "),Tr=l("em"),Qm=a("notebook"),Xm=a(", vous pouvez le faire avec la fonction suivante :"),_u=m(),E(Cn.$$.fragment),hu=m(),ya=l("p"),Zm=a("qui affichera un "),Nr=l("em"),ef=a("widget"),sf=a(" o\xF9 vous pourrez saisir vos informations d\u2019identification. Alternativement, vous pouvez ex\xE9cuter :"),vu=m(),E(Dn.$$.fragment),gu=m(),yl=l("p"),tf=a("dans votre terminal pr\xE9f\xE9r\xE9 et connectez-vous l\xE0."),bu=m(),qt.c(),zl=m(),ea=l("h3"),za=l("a"),Sr=l("span"),E(Pn.$$.fragment),af=m(),Or=l("span"),nf=a("Perplexit\xE9 pour les mod\xE8les de langage"),qu=m(),E(An.$$.fragment),$u=m(),Ml=l("p"),lf=a("Contrairement \xE0 d\u2019autres t\xE2ches, comme la classification de textes ou la r\xE9ponse \xE0 des questions, sur lesquelles nous disposons d\u2019un corpus \xE9tiquet\xE9 pour entra\xEEner, la mod\xE9lisation du langage ne s\u2019appuie sur aucune \xE9tiquette explicite. Alors comment d\xE9terminer ce qui fait un bon mod\xE8le de langage ? Comme pour la fonction de correction automatique de votre t\xE9l\xE9phone, un bon mod\xE8le de langage est celui qui attribue des probabilit\xE9s \xE9lev\xE9es aux phrases grammaticalement correctes et des probabilit\xE9s faibles aux phrases absurdes. Pour vous donner une meilleure id\xE9e de ce \xE0 quoi cela ressemble, vous pouvez trouver en ligne des s\xE9ries enti\xE8res de \xAB rat\xE9s d\u2019autocorrection \xBB o\xF9 le mod\xE8le d\u2019un t\xE9l\xE9phone produit des compl\xE9ments plut\xF4t amusants (et souvent inappropri\xE9s) !"),ku=m(),kt.c(),Cl=m(),E(Tn.$$.fragment),Eu=m(),Dl=l("p"),of=a("Un score de perplexit\xE9 faible signifie un meilleur mod\xE8le de langue. Nous pouvons voir ici que notre mod\xE8le de d\xE9part a une valeur assez \xE9lev\xE9e. Voyons si nous pouvons la r\xE9duire en l\u2019affinant ! Pour ce faire, nous commen\xE7ons par ex\xE9cuter la boucle d\u2019entra\xEEnement :"),ju=m(),jt.c(),Pl=m(),Al=l("p"),rf=a("et ensuite calculer la perplexit\xE9 r\xE9sultante sur l\u2019ensemble de test comme pr\xE9c\xE9demment :"),wu=m(),xt.c(),Tl=m(),E(Nn.$$.fragment),xu=m(),Nl=l("p"),uf=a("Joli. C\u2019est une r\xE9duction consid\xE9rable de la perplexit\xE9, ce qui nous indique que le mod\xE8le a appris quelque chose sur le domaine des critiques de films !"),yu=m(),Le&&Le.c(),Sl=m(),E(Ma.$$.fragment),zu=m(),Re&&Re.c(),Ol=m(),sa=l("h3"),Ca=l("a"),Lr=l("span"),E(Sn.$$.fragment),pf=m(),Ll=l("span"),df=a("Utilisation de notre mod\xE8le "),Rr=l("i"),cf=a("finetun\xE9"),Mu=m(),Ge=l("p"),mf=a("Vous pouvez interagir avec votre mod\xE8le "),Br=l("em"),ff=a("finetun\xE9"),_f=a(" soit en utilisant son "),Kr=l("em"),hf=a("widget"),vf=a(" sur le "),Fr=l("em"),gf=a("Hub"),bf=a(", soit localement avec le "),Ir=l("code"),qf=a("pipeline"),$f=a(" de \u{1F917} "),Hr=l("em"),kf=a("Transformers"),Ef=a(". Utilisons ce dernier pour t\xE9l\xE9charger notre mod\xE8le en utilisant le pipeline "),Ur=l("code"),jf=a("fill-mask"),wf=a(" :"),Cu=m(),E(On.$$.fragment),Du=m(),Rl=l("p"),xf=a("Nous pouvons ensuite donner au pipeline notre exemple de texte \xAB this is a great [MASK] \xBB et voir quelles sont les 5 premi\xE8res pr\xE9dictions :"),Pu=m(),E(Ln.$$.fragment),Au=m(),E(Rn.$$.fragment),Tu=m(),Bl=l("p"),yf=a("Notre mod\xE8le a clairement adapt\xE9 ses pond\xE9rations pour pr\xE9dire les mots qui sont plus fortement associ\xE9s aux films !"),Nu=m(),E(Bn.$$.fragment),Su=m(),Ot=l("p"),zf=a("Ceci conclut notre premi\xE8re exp\xE9rience d\u2019entra\xEEnement d\u2019un mod\xE8le de langage. Dans la "),Kl=l("a"),Mf=a("section 6"),Cf=a(", vous apprendrez comment entra\xEEner \xE0 partir de z\xE9ro un mod\xE8le autor\xE9gressif comme GPT-2. Allez-y si vous voulez voir comment vous pouvez pr\xE9-entra\xEEner votre propre "),Gr=l("em"),Df=a("transformer"),Pf=a(" !"),Ou=m(),E(Da.$$.fragment),this.h()},l(e){const u=Yv('[data-svelte="svelte-1phssyn"]',document.head);i=o(u,"META",{name:!0,content:!0}),u.forEach(t),h=f(e),j(d.$$.fragment,e),k=f(e),A=o(e,"H1",{class:!0});var Jn=r(A);$=o(Jn,"A",{id:!0,class:!0,href:!0});var Fl=r($);q=o(Fl,"SPAN",{});var Vr=r(q);j(z.$$.fragment,Vr),Vr.forEach(t),Fl.forEach(t),_=f(Jn),M=o(Jn,"SPAN",{});var Yn=r(M);O=o(Yn,"I",{});var Il=r(O);C=n(Il,"Finetuner"),Il.forEach(t),L=n(Yn," un mod\xE8le de langage masqu\xE9"),Yn.forEach(t),Jn.forEach(t),H=f(e),D.l(e),U=f(e),R=o(e,"P",{});var Rs=r(R);v=n(Rs,"Pour de nombreuses applications de NLP impliquant des "),S=o(Rs,"EM",{});var Wr=r(S);W=n(Wr,"transformers"),Wr.forEach(t),G=n(Rs,", vous pouvez simplement prendre un mod\xE8le pr\xE9-entra\xEEn\xE9 du "),J=o(Rs,"EM",{});var Jr=r(J);ee=n(Jr,"Hub"),Jr.forEach(t),re=n(Rs," et le "),te=o(Rs,"EM",{});var Yr=r(te);V=n(Yr,"finetuner"),Yr.forEach(t),B=n(Rs," directement sur vos donn\xE9es pour la t\xE2che \xE0 accomplir. Pour autant que le corpus utilis\xE9 pour le pr\xE9-entra\xEEnement ne soit pas trop diff\xE9rent du corpus utilis\xE9 pour le "),ie=o(Rs,"EM",{});var Hl=r(ie);Q=n(Hl,"finetuning"),Hl.forEach(t),se=n(Rs,". L\u2019apprentissage par transfert produira g\xE9n\xE9ralement de bons r\xE9sultats."),Rs.forEach(t),ue=f(e),Z=o(e,"P",{});var Bs=r(Z);ge=n(Bs,"Cependant, il existe quelques cas o\xF9 vous voudrez d\u2019abord "),ne=o(Bs,"EM",{});var Ul=r(ne);de=n(Ul,"finetuner"),Ul.forEach(t),rs=n(Bs," les mod\xE8les de langue sur vos donn\xE9es, avant d\u2019entra\xEEner une t\xEAte sp\xE9cifique \xE0 la t\xE2che. Par exemple, si votre jeu de donn\xE9es contient des contrats l\xE9gaux ou des articles scientifiques, un "),be=o(Bs,"EM",{});var Gl=r(be);qe=n(Gl,"transformer"),Gl.forEach(t),is=n(Bs," classique comme BERT traitera g\xE9n\xE9ralement les mots sp\xE9cifiques au domaine dans votre corpus comme des "),Ve=o(Bs,"EM",{});var Vl=r(Ve);$e=n(Vl,"tokens"),Vl.forEach(t),us=n(Bs," rares et les performances r\xE9sultantes peuvent \xEAtre moins que satisfaisantes. En "),We=o(Bs,"EM",{});var Wl=r(We);xe=n(Wl,"finetunant"),Wl.forEach(t),Se=n(Bs," le mod\xE8le de langage sur les donn\xE9es du domaine, vous pouvez am\xE9liorer les performances de nombreuses t\xE2ches en aval, ce qui signifie que vous ne devez g\xE9n\xE9ralement effectuer cette \xE9tape qu\u2019une seule fois !"),Bs.forEach(t),Je=f(e),X=o(e,"P",{});var vs=r(X);pe=n(vs,"Ce processus de "),ye=o(vs,"EM",{});var Qr=r(ye);ce=n(Qr,"finetuning"),Qr.forEach(t),ps=n(vs," d\u2019un mod\xE8le de langage pr\xE9-entra\xEEn\xE9 sur des donn\xE9es "),ze=o(vs,"EM",{});var Yf=r(ze);ke=n(Yf,"dans le domaine"),Yf.forEach(t),Xe=n(vs," est g\xE9n\xE9ralement appel\xE9 "),le=o(vs,"EM",{});var Qf=r(le);Ze=n(Qf,"adaptation au domaine"),Qf.forEach(t),Ee=n(vs,". Il a \xE9t\xE9 popularis\xE9 en 2018 par "),je=o(vs,"A",{href:!0,rel:!0});var Xf=r(je);K=n(Xf,"ULMFiT"),Xf.forEach(t),ae=n(vs," qui a \xE9t\xE9 l\u2019une des premi\xE8res architectures neuronales (bas\xE9es sur des LSTMs) \xE0 faire en sorte que l\u2019apprentissage par transfert fonctionne r\xE9ellement pour le NLP. Un exemple d\u2019adaptation de domaine avec ULMFiT est pr\xE9sent\xE9 dans l\u2019image ci-dessous. Dans cette section, nous ferons quelque chose de similaire mais avec un "),Be=o(vs,"EM",{});var Zf=r(Be);me=n(Zf,"transformer"),Zf.forEach(t),es=n(vs," au lieu d\u2019une LSTM !"),vs.forEach(t),Ye=f(e),Me=o(e,"DIV",{class:!0});var Ru=r(Me);Oe=o(Ru,"IMG",{class:!0,src:!0,alt:!0}),N=f(Ru),Y=o(Ru,"IMG",{class:!0,src:!0,alt:!0}),Ru.forEach(t),oe=f(e),Ce=o(e,"P",{});var Jl=r(Ce);Ps=n(Jl,"\xC0 la fin de cette section, vous aurez un "),Fe=o(Jl,"A",{href:!0,rel:!0});var e_=r(Fe);Qe=n(e_,"mod\xE8le de langage masqu\xE9"),e_.forEach(t),Ie=n(Jl," sur le "),De=o(Jl,"EM",{});var s_=r(De);_e=n(s_,"Hub"),s_.forEach(t),Fs=n(Jl," qui peut autocompl\xE9ter des phrases comme indiqu\xE9 ci-dessous :"),Jl.forEach(t),nt=f(e),Pe=o(e,"IFRAME",{src:!0,frameborder:!0,height:!0,title:!0,class:!0,allow:!0,sandbox:!0}),r(Pe).forEach(t),ds=f(e),we=o(e,"IFRAME",{src:!0,frameborder:!0,height:!0,title:!0,class:!0,allow:!0,sandbox:!0}),r(we).forEach(t),lt=f(e),cs=o(e,"P",{});var t_=r(cs);gs=n(t_,"Allons-y !"),t_.forEach(t),ot=f(e),j(ms.$$.fragment,e),Is=f(e),j(As.$$.fragment,e),rt=f(e),Ts=o(e,"H2",{class:!0});var Bu=r(Ts);Ns=o(Bu,"A",{id:!0,class:!0,href:!0});var a_=r(Ns);Ss=o(a_,"SPAN",{});var n_=r(Ss);j(Hs.$$.fragment,n_),n_.forEach(t),a_.forEach(t),bs=f(Bu),Gt=o(Bu,"SPAN",{});var l_=r(Gt);Vt=n(l_,"Choix d'un mod\xE8le pr\xE9-entra\xEEn\xE9 pour la mod\xE9lisation du langage masqu\xE9"),l_.forEach(t),Bu.forEach(t),ta=f(e),qs=o(e,"P",{});var Yl=r(qs);Wt=n(Yl,"Pour commencer, nous allons choisir un mod\xE8le pr\xE9-entra\xEEn\xE9 appropri\xE9 pour la mod\xE9lisation du langage masqu\xE9. Comme le montre la capture d\u2019\xE9cran suivante, vous pouvez trouver une liste de candidats en appliquant le filtre \xAB "),Jt=o(Yl,"EM",{});var o_=r(Jt);La=n(o_,"Fill-Mask"),o_.forEach(t),aa=n(Yl," \xBB sur le "),fs=o(Yl,"A",{href:!0,rel:!0});var r_=r(fs);zt=o(r_,"EM",{});var i_=r(zt);it=n(i_,"Hub"),i_.forEach(t),r_.forEach(t),na=n(Yl," :"),Yl.forEach(t),_s=f(e),ut=o(e,"DIV",{class:!0});var u_=r(ut);Os=o(u_,"IMG",{src:!0,alt:!0,width:!0}),u_.forEach(t),la=f(e),ve=o(e,"P",{});var et=r(ve);Ra=n(et,"Bien que les mod\xE8les de la famille BERT et RoBERTa soient les plus t\xE9l\xE9charg\xE9s, nous utiliserons un mod\xE8le appel\xE9 "),pt=o(et,"A",{href:!0,rel:!0});var p_=r(pt);oa=n(p_,"DistilBERT"),p_.forEach(t),dt=n(et," qui peut \xEAtre entra\xEEn\xE9 beaucoup plus rapidement avec peu ou pas de perte de performance en aval. Ce mod\xE8le a \xE9t\xE9 entra\xEEn\xE9 \xE0 l\u2019aide d\u2019une technique sp\xE9ciale appel\xE9e "),Us=o(et,"A",{href:!0,rel:!0});var d_=r(Us);Gs=o(d_,"EM",{});var c_=r(Gs);Ba=n(c_,"distillation de connaissances"),c_.forEach(t),d_.forEach(t),ra=n(et,", o\xF9 un grand mod\xE8le "),Ls=o(et,"EM",{});var m_=r(Ls);ia=n(m_,"enseignant"),m_.forEach(t),ct=n(et," comme BERT est utilis\xE9 pour guider l\u2019entra\xEEnement d\u2019un mod\xE8le "),Mt=o(et,"EM",{});var f_=r(Mt);Ct=n(f_,"\xE9tudiant"),f_.forEach(t),Ka=n(et," qui a beaucoup moins de param\xE8tres. Une explication des d\xE9tails de la distillation de connaissances nous m\xE8nerait trop loin dans cette section mais si vous \xEAtes int\xE9ress\xE9, vous pouvez lire tout cela dans le livre "),Vs=o(et,"A",{href:!0,rel:!0});var __=r(Vs);c=o(__,"EM",{});var h_=r(c);F=n(h_,"Natural Language Processing with Transformers"),h_.forEach(t),__.forEach(t),Xn=n(et,"."),et.forEach(t),Yt=f(e),ks.l(e),mt=f(e),ft=o(e,"P",{});var Ku=r(ft);Zn=n(Ku,"Avec environ 67 millions de param\xE8tres, DistilBERT est environ deux fois plus petit que le mod\xE8le de base de BERT, ce qui se traduit approximativement par une acc\xE9l\xE9ration de l\u2019entra\xEEnement d\u2019un facteur deux. Voyons maintenant quels types de "),Es=o(Ku,"EM",{});var v_=r(Es);el=n(v_,"tokens"),v_.forEach(t),sl=n(Ku," ce mod\xE8le pr\xE9dit comme \xE9tant les compl\xE9ments les plus probables d\u2019un petit \xE9chantillon de texte :"),Ku.forEach(t),Fa=f(e),j(Ue.$$.fragment,e),Ia=f(e),he=o(e,"P",{});var ns=r(he);tl=n(ns,"En tant qu\u2019\xEAtres humains, nous pouvons imaginer de nombreuses possibilit\xE9s pour le "),ua=o(ns,"EM",{});var g_=r(ua);pa=n(g_,"token"),g_.forEach(t),al=f(ns),js=o(ns,"CODE",{});var b_=r(js);nl=n(b_,"[MASK]"),b_.forEach(t),ll=n(ns,", telles que \xAB jour \xBB, \xAB promenade \xBB ou \xAB peinture \xBB. Pour les mod\xE8les pr\xE9-entra\xEEn\xE9s, les pr\xE9dictions d\xE9pendent du corpus sur lequel le mod\xE8le a \xE9t\xE9 entra\xEEn\xE9 puisqu\u2019il apprend \xE0 d\xE9tecter les mod\xE8les statistiques pr\xE9sents dans les donn\xE9es. Comme BERT, DistilBERT a \xE9t\xE9 pr\xE9-entra\xEEn\xE9 sur les jeux de donn\xE9es "),Dt=o(ns,"A",{href:!0,rel:!0});var q_=r(Dt);Pt=o(q_,"EM",{});var $_=r(Pt);ol=n($_,"English Wikipedia"),$_.forEach(t),q_.forEach(t),da=n(ns," et "),At=o(ns,"A",{href:!0,rel:!0});var k_=r(At);Tt=o(k_,"EM",{});var E_=r(Tt);rl=n(E_,"BookCorpus"),E_.forEach(t),k_.forEach(t),il=n(ns,", nous nous attendons donc \xE0 ce que les pr\xE9dictions pour "),Ws=o(ns,"CODE",{});var j_=r(Ws);ul=n(j_,"[MASK]"),j_.forEach(t),pl=n(ns," refl\xE8tent ces domaines. Pour pr\xE9dire le masque, nous avons besoin du "),Js=o(ns,"EM",{});var w_=r(Js);dl=n(w_,"tokenizer"),w_.forEach(t),cl=n(ns," de DistilBERT pour produire les entr\xE9es du mod\xE8le, alors t\xE9l\xE9chargeons-le \xE9galement depuis le "),ca=o(ns,"EM",{});var x_=r(ca);ml=n(x_,"Hub"),x_.forEach(t),np=n(ns," :"),ns.forEach(t),Zr=f(e),j(Ha.$$.fragment,e),ei=f(e),ma=o(e,"P",{});var Fu=r(ma);lp=n(Fu,"Avec un "),eo=o(Fu,"EM",{});var y_=r(eo);op=n(y_,"tokenizer"),y_.forEach(t),rp=n(Fu," et un mod\xE8le, nous pouvons maintenant passer notre exemple de texte au mod\xE8le, extraire les logits, et afficher les 5 meilleurs candidats :"),Fu.forEach(t),si=f(e),ht.l(e),fl=f(e),j(Ua.$$.fragment,e),ti=f(e),_l=o(e,"P",{});var z_=r(_l);ip=n(z_,"Nous pouvons voir dans les sorties que les pr\xE9dictions du mod\xE8le se r\xE9f\xE8rent \xE0 des termes de tous les jours, ce qui n\u2019est peut-\xEAtre pas surprenant \xE9tant donn\xE9 le fondement de Wikip\xE9dia. Voyons comment nous pouvons changer ce domaine pour quelque chose d\u2019un peu plus sp\xE9cialis\xE9 : des critiques de films !"),z_.forEach(t),ai=f(e),Qt=o(e,"H2",{class:!0});var Iu=r(Qt);fa=o(Iu,"A",{id:!0,class:!0,href:!0});var M_=r(fa);so=o(M_,"SPAN",{});var C_=r(so);j(Ga.$$.fragment,C_),C_.forEach(t),M_.forEach(t),up=f(Iu),to=o(Iu,"SPAN",{});var D_=r(to);pp=n(D_,"Le jeu de donn\xE9es"),D_.forEach(t),Iu.forEach(t),ni=f(e),ss=o(e,"P",{});var st=r(ss);dp=n(st,"Pour illustrer l\u2019adaptation au domaine, nous utiliserons le c\xE9l\xE8bre "),Va=o(st,"A",{href:!0,rel:!0});var P_=r(Va);ao=o(P_,"EM",{});var A_=r(ao);cp=n(A_,"Large Movie Review Dataset"),A_.forEach(t),P_.forEach(t),mp=n(st," (ou IMDb en abr\xE9g\xE9), qui est un corpus de critiques de films souvent utilis\xE9 pour \xE9valuer les mod\xE8les d\u2019analyse de sentiments. En "),no=o(st,"EM",{});var T_=r(no);fp=n(T_,"finetunant"),T_.forEach(t),_p=n(st," DistilBERT sur ce corpus, nous esp\xE9rons que le mod\xE8le de langage adaptera son vocabulaire des donn\xE9es factuelles de Wikip\xE9dia sur lesquelles il a \xE9t\xE9 pr\xE9-entra\xEEn\xE9 aux \xE9l\xE9ments plus subjectifs des critiques de films. Nous pouvons obtenir les donn\xE9es du "),lo=o(st,"EM",{});var N_=r(lo);hp=n(N_,"Hub"),N_.forEach(t),vp=n(st," avec la fonction "),oo=o(st,"CODE",{});var S_=r(oo);gp=n(S_,"load_dataset()"),S_.forEach(t),bp=n(st," de \u{1F917} "),ro=o(st,"EM",{});var O_=r(ro);qp=n(O_,"Datasets"),O_.forEach(t),$p=n(st," :"),st.forEach(t),li=f(e),j(Wa.$$.fragment,e),oi=f(e),j(Ja.$$.fragment,e),ri=f(e),ts=o(e,"P",{});var tt=r(ts);kp=n(tt,"Nous pouvons voir que les parties "),io=o(tt,"CODE",{});var L_=r(io);Ep=n(L_,"train"),L_.forEach(t),jp=n(tt," et "),uo=o(tt,"CODE",{});var R_=r(uo);wp=n(R_,"test"),R_.forEach(t),xp=n(tt," sont chacune compos\xE9es de 25 000 critiques, alors qu\u2019il y a une partie non \xE9tiquet\xE9e appel\xE9e "),po=o(tt,"CODE",{});var B_=r(po);yp=n(B_,"unsupervised"),B_.forEach(t),zp=n(tt," qui contient 50 000 critiques. Jetons un coup d\u2019\u0153il \xE0 quelques \xE9chantillons pour avoir une id\xE9e du type de texte auquel nous avons affaire. Comme nous l\u2019avons fait dans les chapitres pr\xE9c\xE9dents du cours, nous allons encha\xEEner les fonctions "),co=o(tt,"CODE",{});var K_=r(co);Mp=n(K_,"Dataset.shuffle()"),K_.forEach(t),Cp=n(tt," et "),mo=o(tt,"CODE",{});var F_=r(mo);Dp=n(F_,"Dataset.select()"),F_.forEach(t),Pp=n(tt," pour cr\xE9er un \xE9chantillon al\xE9atoire :"),tt.forEach(t),ii=f(e),j(Ya.$$.fragment,e),ui=f(e),j(Qa.$$.fragment,e),pi=f(e),Nt=o(e,"P",{});var Ql=r(Nt);Ap=n(Ql,"Oui, ce sont bien des critiques de films, et si vous \xEAtes assez \xE2g\xE9s, vous pouvez m\xEAme comprendre le commentaire dans la derni\xE8re critique sur le fait de poss\xE9der une version VHS \u{1F61C} ! Bien que nous n\u2019ayons pas besoin des \xE9tiquettes pour la mod\xE9lisation du langage, nous pouvons d\xE9j\xE0 voir qu\u2019un "),fo=o(Ql,"CODE",{});var I_=r(fo);Tp=n(I_,"0"),I_.forEach(t),Np=n(Ql," d\xE9note une critique n\xE9gative, tandis qu\u2019un "),_o=o(Ql,"CODE",{});var H_=r(_o);Sp=n(H_,"1"),H_.forEach(t),Op=n(Ql," correspond \xE0 une critique positive."),Ql.forEach(t),di=f(e),j(_a.$$.fragment,e),ci=f(e),ha=o(e,"P",{});var Hu=r(ha);Lp=n(Hu,"Maintenant que nous avons jet\xE9 un coup d\u2019\u0153il rapide aux donn\xE9es, plongeons dans leur pr\xE9paration pour la mod\xE9lisation du langage masqu\xE9. Comme nous allons le voir, il y a quelques \xE9tapes suppl\xE9mentaires \xE0 suivre par rapport aux t\xE2ches de classification de s\xE9quences que nous avons vues au "),hl=o(Hu,"A",{href:!0});var U_=r(hl);Rp=n(U_,"chapitre 3"),U_.forEach(t),Bp=n(Hu,". Allons-y !"),Hu.forEach(t),mi=f(e),Xt=o(e,"H2",{class:!0});var Uu=r(Xt);va=o(Uu,"A",{id:!0,class:!0,href:!0});var G_=r(va);ho=o(G_,"SPAN",{});var V_=r(ho);j(Xa.$$.fragment,V_),V_.forEach(t),G_.forEach(t),Kp=f(Uu),vo=o(Uu,"SPAN",{});var W_=r(vo);Fp=n(W_,"Pr\xE9traitement des donn\xE9es"),W_.forEach(t),Uu.forEach(t),fi=f(e),j(Za.$$.fragment,e),_i=f(e),ga=o(e,"P",{});var Gu=r(ga);Ip=n(Gu,"Pour la mod\xE9lisation autor\xE9gressive et la mod\xE9lisation du langage masqu\xE9, une \xE9tape commune de pr\xE9traitement consiste \xE0 concat\xE9ner tous les exemples, puis \xE0 diviser le corpus entier en morceaux de taille \xE9gale. C\u2019est tr\xE8s diff\xE9rent de notre approche habituelle, o\xF9 nous nous contentons de "),go=o(Gu,"EM",{});var J_=r(go);Hp=n(J_,"tokenizer"),J_.forEach(t),Up=n(Gu," les exemples individuels. Pourquoi tout concat\xE9ner ? La raison est que les exemples individuels peuvent \xEAtre tronqu\xE9s s\u2019ils sont trop longs, ce qui entra\xEEnerait la perte d\u2019informations qui pourraient \xEAtre utiles pour la t\xE2che de mod\xE9lisation du langage !"),Gu.forEach(t),hi=f(e),Ae=o(e,"P",{});var ls=r(Ae);Gp=n(ls,"Donc pour commencer, nous allons d\u2019abord tokeniser notre corpus comme d\u2019habitude, mais "),bo=o(ls,"EM",{});var Y_=r(bo);Vp=n(Y_,"sans"),Y_.forEach(t),Wp=n(ls," mettre l\u2019option "),qo=o(ls,"CODE",{});var Q_=r(qo);Jp=n(Q_,"truncation=True"),Q_.forEach(t),Yp=n(ls," dans notre "),$o=o(ls,"EM",{});var X_=r($o);Qp=n(X_,"tokenizer"),X_.forEach(t),Xp=n(ls,". Nous allons aussi r\xE9cup\xE9rer les identifiants des mots s\u2019ils sont disponibles (ce qui sera le cas si nous utilisons un "),ko=o(ls,"EM",{});var Z_=r(ko);Zp=n(Z_,"tokenizer"),Z_.forEach(t),ed=n(ls," rapide, comme d\xE9crit dans le "),vl=o(ls,"A",{href:!0});var eh=r(vl);sd=n(eh,"chapitre 6"),eh.forEach(t),td=n(ls,"), car nous en aurons besoin plus tard pour faire le masquage de mots entiers. Nous allons envelopper cela dans une simple fonction, et pendant que nous y sommes, nous allons supprimer les colonnes "),Eo=o(ls,"CODE",{});var sh=r(Eo);ad=n(sh,"text"),sh.forEach(t),nd=n(ls," et "),jo=o(ls,"CODE",{});var th=r(jo);ld=n(th,"label"),th.forEach(t),od=n(ls," puisque nous n\u2019en avons plus besoin :"),ls.forEach(t),vi=f(e),j(en.$$.fragment,e),gi=f(e),j(sn.$$.fragment,e),bi=f(e),Ys=o(e,"P",{});var Pa=r(Ys);rd=n(Pa,"Comme DistilBERT est un mod\xE8le de type BERT, nous pouvons voir que les textes encod\xE9s sont constitu\xE9s des "),wo=o(Pa,"CODE",{});var ah=r(wo);id=n(ah,"input_ids"),ah.forEach(t),ud=n(Pa," et des "),xo=o(Pa,"CODE",{});var nh=r(xo);pd=n(nh,"attention_mask"),nh.forEach(t),dd=n(Pa," que nous avons vus dans d\u2019autres chapitres, ainsi que des "),yo=o(Pa,"CODE",{});var lh=r(yo);cd=n(lh,"word_ids"),lh.forEach(t),md=n(Pa," que nous avons ajout\xE9s."),Pa.forEach(t),qi=f(e),Qs=o(e,"P",{});var Aa=r(Qs);fd=n(Aa,"Maintenant que nos critiques de films ont \xE9t\xE9 tokenis\xE9es, l\u2019\xE9tape suivante consiste \xE0 les regrouper et \xE0 diviser le r\xE9sultat en chunks. Mais quelle taille doivent avoir ces "),zo=o(Aa,"EM",{});var oh=r(zo);_d=n(oh,"chunks"),oh.forEach(t),hd=n(Aa," ? Cela sera finalement d\xE9termin\xE9 par la quantit\xE9 de m\xE9moire GPU dont vous disposez, mais un bon point de d\xE9part est de voir quelle est la taille maximale du contexte du mod\xE8le. Cela peut \xEAtre d\xE9duit en inspectant l\u2019attribut "),Mo=o(Aa,"CODE",{});var rh=r(Mo);vd=n(rh,"model_max_length"),rh.forEach(t),gd=n(Aa," du "),Co=o(Aa,"EM",{});var ih=r(Co);bd=n(ih,"tokenizer"),ih.forEach(t),qd=n(Aa," :"),Aa.forEach(t),$i=f(e),j(tn.$$.fragment,e),ki=f(e),j(an.$$.fragment,e),Ei=f(e),Xs=o(e,"P",{});var Ta=r(Xs);$d=n(Ta,"Cette valeur est d\xE9riv\xE9e du fichier "),Do=o(Ta,"EM",{});var uh=r(Do);kd=n(uh,"tokenizer_config.json"),uh.forEach(t),Ed=n(Ta," associ\xE9 \xE0 un "),Po=o(Ta,"EM",{});var ph=r(Po);jd=n(ph,"checkpoint"),ph.forEach(t),wd=n(Ta,". Dans ce cas, nous pouvons voir que la taille du contexte est de 512 "),Ao=o(Ta,"EM",{});var dh=r(Ao);xd=n(dh,"tokens"),dh.forEach(t),yd=n(Ta,", tout comme avec BERT."),Ta.forEach(t),ji=f(e),j(ba.$$.fragment,e),wi=f(e),gl=o(e,"P",{});var ch=r(gl);zd=n(ch,"Ainsi, pour r\xE9aliser nos exp\xE9riences sur des GPUs comme ceux disponibles sur Google Colab, nous choisirons quelque chose d\u2019un peu plus petit qui peut tenir en m\xE9moire :"),ch.forEach(t),xi=f(e),j(nn.$$.fragment,e),yi=f(e),j(qa.$$.fragment,e),zi=f(e),$a=o(e,"P",{});var Vu=r($a);Md=n(Vu,"Maintenant vient la partie amusante. Pour montrer comment la concat\xE9nation fonctionne, prenons quelques commentaires de notre ensemble d\u2019entra\xEEnement et affichons le nombre de "),To=o(Vu,"EM",{});var mh=r(To);Cd=n(mh,"tokens"),mh.forEach(t),Dd=n(Vu," par commentaire :"),Vu.forEach(t),Mi=f(e),j(ln.$$.fragment,e),Ci=f(e),j(on.$$.fragment,e),Di=f(e),bl=o(e,"P",{});var fh=r(bl);Pd=n(fh,"Nous pouvons ensuite concat\xE9ner tous ces exemples avec une simple compr\xE9hension du dictionnaire, comme suit :"),fh.forEach(t),Pi=f(e),j(rn.$$.fragment,e),Ai=f(e),j(un.$$.fragment,e),Ti=f(e),ws=o(e,"P",{});var Lt=r(ws);Ad=n(Lt,"Super, la longueur totale est correcte. Donc maintenant, nous allons diviser les exemples concat\xE9n\xE9s en morceaux de la taille donn\xE9e par "),No=o(Lt,"CODE",{});var _h=r(No);Td=n(_h,"block_size"),_h.forEach(t),Nd=n(Lt,". Pour ce faire, nous it\xE9rons sur les caract\xE9ristiques de "),So=o(Lt,"CODE",{});var hh=r(So);Sd=n(hh,"concatenated_examples"),hh.forEach(t),Od=n(Lt," et utilisons une compr\xE9hension de liste pour cr\xE9er des "),Oo=o(Lt,"EM",{});var vh=r(Oo);Ld=n(vh,"chunks"),vh.forEach(t),Rd=n(Lt," de chaque caract\xE9ristique. Le r\xE9sultat est un dictionnaire de "),Lo=o(Lt,"EM",{});var gh=r(Lo);Bd=n(gh,"chunks"),gh.forEach(t),Kd=n(Lt," pour chaque caract\xE9ristique :"),Lt.forEach(t),Ni=f(e),j(pn.$$.fragment,e),Si=f(e),j(dn.$$.fragment,e),Oi=f(e),ka=o(e,"P",{});var Wu=r(ka);Fd=n(Wu,"Comme vous pouvez le voir dans cet exemple, le dernier "),Ro=o(Wu,"EM",{});var bh=r(Ro);Id=n(bh,"chunk"),bh.forEach(t),Hd=n(Wu," sera g\xE9n\xE9ralement plus petit que la taille maximale des morceaux. Il y a deux strat\xE9gies principales pour g\xE9rer cela :"),Wu.forEach(t),Li=f(e),Ea=o(e,"UL",{});var Ju=r(Ea);cn=o(Ju,"LI",{});var Yu=r(cn);Ud=n(Yu,"Abandonner le dernier morceau s\u2019il est plus petit que "),Bo=o(Yu,"CODE",{});var qh=r(Bo);Gd=n(qh,"chunk_size"),qh.forEach(t),Vd=n(Yu,"."),Yu.forEach(t),Wd=f(Ju),mn=o(Ju,"LI",{});var Qu=r(mn);Jd=n(Qu,"Rembourrer le dernier morceau jusqu\u2019\xE0 ce que sa longueur soit \xE9gale \xE0 "),Ko=o(Qu,"CODE",{});var $h=r(Ko);Yd=n($h,"chunk_size"),$h.forEach(t),Qd=n(Qu,"."),Qu.forEach(t),Ju.forEach(t),Ri=f(e),ql=o(e,"P",{});var kh=r(ql);Xd=n(kh,"Nous adopterons la premi\xE8re approche ici, donc nous allons envelopper toute la logique ci-dessus dans une seule fonction que nous pouvons appliquer \xE0 nos jeux de donn\xE9es tokenis\xE9s :"),kh.forEach(t),Bi=f(e),j(fn.$$.fragment,e),Ki=f(e),as=o(e,"P",{});var at=r(as);Zd=n(at,"Notez que dans la derni\xE8re \xE9tape de "),Fo=o(at,"CODE",{});var Eh=r(Fo);ec=n(Eh,"group_texts()"),Eh.forEach(t),sc=n(at," nous cr\xE9ons une nouvelle colonne "),Io=o(at,"CODE",{});var jh=r(Io);tc=n(jh,"labels"),jh.forEach(t),ac=n(at," qui est une copie de la colonne "),Ho=o(at,"CODE",{});var wh=r(Ho);nc=n(wh,"input_ids"),wh.forEach(t),lc=n(at,". Comme nous le verrons bient\xF4t, c\u2019est parce que dans la mod\xE9lisation du langage masqu\xE9, l\u2019objectif est de pr\xE9dire des "),Uo=o(at,"EM",{});var xh=r(Uo);oc=n(xh,"tokens"),xh.forEach(t),rc=n(at," masqu\xE9s al\xE9atoirement dans le batch d\u2019entr\xE9e, et en cr\xE9ant une colonne "),Go=o(at,"CODE",{});var yh=r(Go);ic=n(yh,"labels"),yh.forEach(t),uc=n(at,", nous fournissons la v\xE9rit\xE9 de base pour notre mod\xE8le de langage \xE0 apprendre."),at.forEach(t),Fi=f(e),St=o(e,"P",{});var Xl=r(St);pc=n(Xl,"Appliquons maintenant "),Vo=o(Xl,"CODE",{});var zh=r(Vo);dc=n(zh,"group_texts()"),zh.forEach(t),cc=n(Xl," \xE0 nos jeux de donn\xE9es tokenis\xE9s en utilisant notre fid\xE8le fonction "),Wo=o(Xl,"CODE",{});var Mh=r(Wo);mc=n(Mh,"Dataset.map()"),Mh.forEach(t),fc=n(Xl," :"),Xl.forEach(t),Ii=f(e),j(_n.$$.fragment,e),Hi=f(e),j(hn.$$.fragment,e),Ui=f(e),Te=o(e,"P",{});var os=r(Te);_c=n(os,"Vous pouvez voir que le regroupement puis le d\xE9coupage des textes a produit beaucoup plus d\u2019exemples que nos 25 000 exemples initiaux pour les divisions "),Jo=o(os,"CODE",{});var Ch=r(Jo);hc=n(Ch,"train"),Ch.forEach(t),vc=n(os," et "),Yo=o(os,"CODE",{});var Dh=r(Yo);gc=n(Dh,"test"),Dh.forEach(t),bc=n(os,". C\u2019est parce que nous avons maintenant des exemples impliquant des "),Qo=o(os,"EM",{});var Ph=r(Qo);qc=n(Ph,"tokens"),Ph.forEach(t),$c=n(os," contigus qui s\u2019\xE9tendent sur plusieurs exemples du corpus original. Vous pouvez le voir explicitement en cherchant les "),Xo=o(os,"EM",{});var Ah=r(Xo);kc=n(Ah,"tokens"),Ah.forEach(t),Ec=n(os," sp\xE9ciaux "),Zo=o(os,"CODE",{});var Th=r(Zo);jc=n(Th,"[SEP]"),Th.forEach(t),wc=n(os," et "),er=o(os,"CODE",{});var Nh=r(er);xc=n(Nh,"[CLS]"),Nh.forEach(t),yc=n(os," dans l\u2019un des "),sr=o(os,"EM",{});var Sh=r(sr);zc=n(Sh,"chunks"),Sh.forEach(t),Mc=n(os," :"),os.forEach(t),Gi=f(e),j(vn.$$.fragment,e),Vi=f(e),j(gn.$$.fragment,e),Wi=f(e),$l=o(e,"P",{});var Oh=r($l);Cc=n(Oh,"Dans cet exemple, vous pouvez voir deux critiques de films qui se chevauchent, l\u2019une sur un film de lyc\xE9e et l\u2019autre sur les sans-abri. Voyons \xE9galement \xE0 quoi ressemblent les \xE9tiquettes pour la mod\xE9lisation du langage masqu\xE9 :"),Oh.forEach(t),Ji=f(e),j(bn.$$.fragment,e),Yi=f(e),j(qn.$$.fragment,e),Qi=f(e),xs=o(e,"P",{});var Rt=r(xs);Dc=n(Rt,"Comme pr\xE9vu par notre fonction "),tr=o(Rt,"CODE",{});var Lh=r(tr);Pc=n(Lh,"group_texts()"),Lh.forEach(t),Ac=n(Rt," ci-dessus, cela semble identique aux "),ar=o(Rt,"CODE",{});var Rh=r(ar);Tc=n(Rh,"input_ids"),Rh.forEach(t),Nc=n(Rt," d\xE9cod\xE9s. Mais alors comment notre mod\xE8le peut-il apprendre quoi que ce soit ? Il nous manque une \xE9tape cl\xE9 : ins\xE9rer des "),nr=o(Rt,"EM",{});var Bh=r(nr);Sc=n(Bh,"tokens"),Bh.forEach(t),Oc=n(Rt," \xE0 des positions al\xE9atoires dans les entr\xE9es ! Voyons comment nous pouvons le faire \xE0 la vol\xE9e pendant le "),lr=o(Rt,"EM",{});var Kh=r(lr);Lc=n(Kh,"finetuning"),Kh.forEach(t),Rc=n(Rt," en utilisant un collateur de donn\xE9es sp\xE9cial."),Rt.forEach(t),Xi=f(e),Zt=o(e,"H2",{class:!0});var Xu=r(Zt);ja=o(Xu,"A",{id:!0,class:!0,href:!0});var Fh=r(ja);or=o(Fh,"SPAN",{});var Ih=r(or);j($n.$$.fragment,Ih),Ih.forEach(t),Fh.forEach(t),Bc=f(Xu),kn=o(Xu,"SPAN",{});var Zu=r(kn);rr=o(Zu,"I",{});var Hh=r(rr);Kc=n(Hh,"Finetuning"),Hh.forEach(t),Fc=n(Zu," de DistilBERT avec l'API "),ir=o(Zu,"CODE",{});var Uh=r(ir);Ic=n(Uh,"Trainer"),Uh.forEach(t),Zu.forEach(t),Xu.forEach(t),Zi=f(e),fe=o(e,"P",{});var Ne=r(fe);Hc=n(Ne,"Le "),ur=o(Ne,"EM",{});var Gh=r(ur);Uc=n(Gh,"finetuning"),Gh.forEach(t),Gc=n(Ne," d\u2019un mod\xE8le de langage masqu\xE9 est presque identique au "),pr=o(Ne,"EM",{});var Vh=r(pr);Vc=n(Vh,"finetuning"),Vh.forEach(t),Wc=n(Ne," d\u2019un mod\xE8le de classification de s\xE9quences, comme nous l\u2019avons fait dans le "),kl=o(Ne,"A",{href:!0});var Wh=r(kl);Jc=n(Wh,"chapitre 3"),Wh.forEach(t),Yc=n(Ne,". La seule diff\xE9rence est que nous avons besoin d\u2019un collecteur de donn\xE9es sp\xE9cial qui peut masquer de mani\xE8re al\xE9atoire certains des "),dr=o(Ne,"EM",{});var Jh=r(dr);Qc=n(Jh,"tokens"),Jh.forEach(t),Xc=n(Ne," dans chaque batch de textes. Heureusement, \u{1F917} "),cr=o(Ne,"EM",{});var Yh=r(cr);Zc=n(Yh,"Transformers"),Yh.forEach(t),em=n(Ne," est livr\xE9 pr\xE9par\xE9 avec un "),mr=o(Ne,"CODE",{});var Qh=r(mr);sm=n(Qh,"DataCollatorForLanguageModeling"),Qh.forEach(t),tm=n(Ne," d\xE9di\xE9 \xE0 cette t\xE2che. Nous devons juste lui passer le "),fr=o(Ne,"EM",{});var Xh=r(fr);am=n(Xh,"tokenizer"),Xh.forEach(t),nm=n(Ne," et un argument "),_r=o(Ne,"CODE",{});var Zh=r(_r);lm=n(Zh,"mlm_probability"),Zh.forEach(t),om=n(Ne," qui sp\xE9cifie quelle fraction des "),hr=o(Ne,"EM",{});var ev=r(hr);rm=n(ev,"tokens"),ev.forEach(t),im=n(Ne," \xE0 masquer. Nous choisirons 15%, qui est la quantit\xE9 utilis\xE9e pour BERT et un choix commun dans la litt\xE9rature :"),Ne.forEach(t),eu=f(e),j(En.$$.fragment,e),su=f(e),Zs=o(e,"P",{});var Na=r(Zs);um=n(Na,"Pour voir comment le masquage al\xE9atoire fonctionne, nous allons donner quelques exemples au collateur de donn\xE9es. Puisqu\u2019il s\u2019attend \xE0 une liste de "),vr=o(Na,"CODE",{});var sv=r(vr);pm=n(sv,"dict"),sv.forEach(t),dm=n(Na," o\xF9 chaque "),gr=o(Na,"CODE",{});var tv=r(gr);cm=n(tv,"dict"),tv.forEach(t),mm=n(Na," repr\xE9sente un seul morceau de texte contigu, nous it\xE9rons d\u2019abord sur le jeu de donn\xE9es avant de donner le batch au collateur. Nous supprimons la cl\xE9 "),br=o(Na,"CODE",{});var av=r(br);fm=n(av,'"word_ids"'),av.forEach(t),_m=n(Na," pour ce collateur de donn\xE9es car il ne l\u2019attend pas :"),Na.forEach(t),tu=f(e),j(jn.$$.fragment,e),au=f(e),j(wn.$$.fragment,e),nu=f(e),ys=o(e,"P",{});var Bt=r(ys);hm=n(Bt,"Super, \xE7a a march\xE9 ! Nous pouvons voir que le "),qr=o(Bt,"EM",{});var nv=r(qr);vm=n(nv,"token"),nv.forEach(t),gm=f(Bt),$r=o(Bt,"CODE",{});var lv=r($r);bm=n(lv,"[MASK]"),lv.forEach(t),qm=n(Bt," a \xE9t\xE9 ins\xE9r\xE9 de fa\xE7on al\xE9atoire \xE0 diff\xE9rents endroits dans notre texte. Ce seront les "),kr=o(Bt,"EM",{});var ov=r(kr);$m=n(ov,"tokens"),ov.forEach(t),km=n(Bt," que notre mod\xE8le devra pr\xE9dire pendant l\u2019entra\xEEnement. Et la beaut\xE9 du collecteur de donn\xE9es est qu\u2019il va rendre al\xE9atoire l\u2019insertion du "),Er=o(Bt,"CODE",{});var rv=r(Er);Em=n(rv,"[MASK]"),rv.forEach(t),jm=n(Bt," \xE0 chaque batch !"),Bt.forEach(t),lu=f(e),j(wa.$$.fragment,e),ou=f(e),hs&&hs.l(e),El=f(e),zs=o(e,"P",{});var Kt=r(zs);wm=n(Kt,"Lors de l\u2019entra\xEEnement des mod\xE8les pour la mod\xE9lisation du langage masqu\xE9, une technique qui peut \xEAtre utilis\xE9e est de masquer des mots entiers ensemble et pas seulement des "),jr=o(Kt,"EM",{});var iv=r(jr);xm=n(iv,"tokens"),iv.forEach(t),ym=n(Kt," individuels. Cette approche est appel\xE9e "),wr=o(Kt,"EM",{});var uv=r(wr);zm=n(uv,"masquage de mots entiers"),uv.forEach(t),Mm=n(Kt,". Si nous voulons utiliser le masquage de mots entiers, nous devons construire nous-m\xEAmes un collateur de donn\xE9es. Un collateur de donn\xE9es est simplement une fonction qui prend une liste d\u2019\xE9chantillons et les convertit en un batch. Faisons-le ! Nous utiliserons les identifiants des mots calcul\xE9s plus t\xF4t pour faire une correspondance entre les indices des mots et les "),xr=o(Kt,"EM",{});var pv=r(xr);Cm=n(pv,"tokens"),pv.forEach(t),Dm=n(Kt,", puis nous d\xE9ciderons al\xE9atoirement quels mots masquer et appliquerons ce masque sur les entr\xE9es. Notez que les \xE9tiquettes sont toutes "),yr=o(Kt,"CODE",{});var dv=r(yr);Pm=n(dv,"-100"),dv.forEach(t),Am=n(Kt," sauf celles qui correspondent aux mots masqu\xE9s."),Kt.forEach(t),ru=f(e),gt.l(e),jl=f(e),wl=o(e,"P",{});var cv=r(wl);Tm=n(cv,"Ensuite, nous pouvons l\u2019essayer sur les m\xEAmes \xE9chantillons que pr\xE9c\xE9demment :"),cv.forEach(t),iu=f(e),j(xn.$$.fragment,e),uu=f(e),j(yn.$$.fragment,e),pu=f(e),j(xa.$$.fragment,e),du=f(e),Ms=o(e,"P",{});var Ft=r(Ms);Nm=n(Ft,"Maintenant que nous avons deux collateurs de donn\xE9es, les \xE9tapes restantes du "),zr=o(Ft,"EM",{});var mv=r(zr);Sm=n(mv,"finetuning"),mv.forEach(t),Om=n(Ft," sont standards. L\u2019entra\xEEnement peut prendre un certain temps sur Google Colab si vous n\u2019avez pas la chance de tomber sur un mythique GPU P100 \u{1F62D}. Ainsi nous allons d\u2019abord r\xE9duire la taille du jeu d\u2019entra\xEEnement \xE0 quelques milliers d\u2019exemples. Ne vous inqui\xE9tez pas, nous obtiendrons quand m\xEAme un mod\xE8le de langage assez d\xE9cent ! Un moyen rapide de r\xE9duire la taille d\u2019un jeu de donn\xE9es dans \u{1F917} "),Mr=o(Ft,"EM",{});var fv=r(Mr);Lm=n(fv,"Datasets"),fv.forEach(t),Rm=n(Ft," est la fonction "),Cr=o(Ft,"CODE",{});var _v=r(Cr);Bm=n(_v,"Dataset.train_test_split()"),_v.forEach(t),Km=n(Ft," que nous avons vue au "),xl=o(Ft,"A",{href:!0});var hv=r(xl);Fm=n(hv,"chapitre 5"),hv.forEach(t),Im=n(Ft," :"),Ft.forEach(t),cu=f(e),j(zn.$$.fragment,e),mu=f(e),j(Mn.$$.fragment,e),fu=f(e),Cs=o(e,"P",{});var It=r(Cs);Hm=n(It,"Cela a automatiquement cr\xE9\xE9 de nouvelles divisions "),Dr=o(It,"CODE",{});var vv=r(Dr);Um=n(vv,"train"),vv.forEach(t),Gm=n(It," et "),Pr=o(It,"CODE",{});var gv=r(Pr);Vm=n(gv,"test"),gv.forEach(t),Wm=n(It," avec la taille du jeu d\u2019entra\xEEnement fix\xE9e \xE0 10.000 exemples et la validation fix\xE9e \xE0 10% de cela. N\u2019h\xE9sitez pas \xE0 augmenter la taille si vous avez un GPU puissant ! La prochaine chose que nous devons faire est de nous connecter au "),Ar=o(It,"EM",{});var bv=r(Ar);Jm=n(bv,"Hub"),bv.forEach(t),Ym=n(It,". Si vous ex\xE9cutez ce code dans un "),Tr=o(It,"EM",{});var qv=r(Tr);Qm=n(qv,"notebook"),qv.forEach(t),Xm=n(It,", vous pouvez le faire avec la fonction suivante :"),It.forEach(t),_u=f(e),j(Cn.$$.fragment,e),hu=f(e),ya=o(e,"P",{});var ep=r(ya);Zm=n(ep,"qui affichera un "),Nr=o(ep,"EM",{});var $v=r(Nr);ef=n($v,"widget"),$v.forEach(t),sf=n(ep," o\xF9 vous pourrez saisir vos informations d\u2019identification. Alternativement, vous pouvez ex\xE9cuter :"),ep.forEach(t),vu=f(e),j(Dn.$$.fragment,e),gu=f(e),yl=o(e,"P",{});var kv=r(yl);tf=n(kv,"dans votre terminal pr\xE9f\xE9r\xE9 et connectez-vous l\xE0."),kv.forEach(t),bu=f(e),qt.l(e),zl=f(e),ea=o(e,"H3",{class:!0});var sp=r(ea);za=o(sp,"A",{id:!0,class:!0,href:!0});var Ev=r(za);Sr=o(Ev,"SPAN",{});var jv=r(Sr);j(Pn.$$.fragment,jv),jv.forEach(t),Ev.forEach(t),af=f(sp),Or=o(sp,"SPAN",{});var wv=r(Or);nf=n(wv,"Perplexit\xE9 pour les mod\xE8les de langage"),wv.forEach(t),sp.forEach(t),qu=f(e),j(An.$$.fragment,e),$u=f(e),Ml=o(e,"P",{});var xv=r(Ml);lf=n(xv,"Contrairement \xE0 d\u2019autres t\xE2ches, comme la classification de textes ou la r\xE9ponse \xE0 des questions, sur lesquelles nous disposons d\u2019un corpus \xE9tiquet\xE9 pour entra\xEEner, la mod\xE9lisation du langage ne s\u2019appuie sur aucune \xE9tiquette explicite. Alors comment d\xE9terminer ce qui fait un bon mod\xE8le de langage ? Comme pour la fonction de correction automatique de votre t\xE9l\xE9phone, un bon mod\xE8le de langage est celui qui attribue des probabilit\xE9s \xE9lev\xE9es aux phrases grammaticalement correctes et des probabilit\xE9s faibles aux phrases absurdes. Pour vous donner une meilleure id\xE9e de ce \xE0 quoi cela ressemble, vous pouvez trouver en ligne des s\xE9ries enti\xE8res de \xAB rat\xE9s d\u2019autocorrection \xBB o\xF9 le mod\xE8le d\u2019un t\xE9l\xE9phone produit des compl\xE9ments plut\xF4t amusants (et souvent inappropri\xE9s) !"),xv.forEach(t),ku=f(e),kt.l(e),Cl=f(e),j(Tn.$$.fragment,e),Eu=f(e),Dl=o(e,"P",{});var yv=r(Dl);of=n(yv,"Un score de perplexit\xE9 faible signifie un meilleur mod\xE8le de langue. Nous pouvons voir ici que notre mod\xE8le de d\xE9part a une valeur assez \xE9lev\xE9e. Voyons si nous pouvons la r\xE9duire en l\u2019affinant ! Pour ce faire, nous commen\xE7ons par ex\xE9cuter la boucle d\u2019entra\xEEnement :"),yv.forEach(t),ju=f(e),jt.l(e),Pl=f(e),Al=o(e,"P",{});var zv=r(Al);rf=n(zv,"et ensuite calculer la perplexit\xE9 r\xE9sultante sur l\u2019ensemble de test comme pr\xE9c\xE9demment :"),zv.forEach(t),wu=f(e),xt.l(e),Tl=f(e),j(Nn.$$.fragment,e),xu=f(e),Nl=o(e,"P",{});var Mv=r(Nl);uf=n(Mv,"Joli. C\u2019est une r\xE9duction consid\xE9rable de la perplexit\xE9, ce qui nous indique que le mod\xE8le a appris quelque chose sur le domaine des critiques de films !"),Mv.forEach(t),yu=f(e),Le&&Le.l(e),Sl=f(e),j(Ma.$$.fragment,e),zu=f(e),Re&&Re.l(e),Ol=f(e),sa=o(e,"H3",{class:!0});var tp=r(sa);Ca=o(tp,"A",{id:!0,class:!0,href:!0});var Cv=r(Ca);Lr=o(Cv,"SPAN",{});var Dv=r(Lr);j(Sn.$$.fragment,Dv),Dv.forEach(t),Cv.forEach(t),pf=f(tp),Ll=o(tp,"SPAN",{});var Af=r(Ll);df=n(Af,"Utilisation de notre mod\xE8le "),Rr=o(Af,"I",{});var Pv=r(Rr);cf=n(Pv,"finetun\xE9"),Pv.forEach(t),Af.forEach(t),tp.forEach(t),Mu=f(e),Ge=o(e,"P",{});var Ds=r(Ge);mf=n(Ds,"Vous pouvez interagir avec votre mod\xE8le "),Br=o(Ds,"EM",{});var Av=r(Br);ff=n(Av,"finetun\xE9"),Av.forEach(t),_f=n(Ds," soit en utilisant son "),Kr=o(Ds,"EM",{});var Tv=r(Kr);hf=n(Tv,"widget"),Tv.forEach(t),vf=n(Ds," sur le "),Fr=o(Ds,"EM",{});var Nv=r(Fr);gf=n(Nv,"Hub"),Nv.forEach(t),bf=n(Ds,", soit localement avec le "),Ir=o(Ds,"CODE",{});var Sv=r(Ir);qf=n(Sv,"pipeline"),Sv.forEach(t),$f=n(Ds," de \u{1F917} "),Hr=o(Ds,"EM",{});var Ov=r(Hr);kf=n(Ov,"Transformers"),Ov.forEach(t),Ef=n(Ds,". Utilisons ce dernier pour t\xE9l\xE9charger notre mod\xE8le en utilisant le pipeline "),Ur=o(Ds,"CODE",{});var Lv=r(Ur);jf=n(Lv,"fill-mask"),Lv.forEach(t),wf=n(Ds," :"),Ds.forEach(t),Cu=f(e),j(On.$$.fragment,e),Du=f(e),Rl=o(e,"P",{});var Rv=r(Rl);xf=n(Rv,"Nous pouvons ensuite donner au pipeline notre exemple de texte \xAB this is a great [MASK] \xBB et voir quelles sont les 5 premi\xE8res pr\xE9dictions :"),Rv.forEach(t),Pu=f(e),j(Ln.$$.fragment,e),Au=f(e),j(Rn.$$.fragment,e),Tu=f(e),Bl=o(e,"P",{});var Bv=r(Bl);yf=n(Bv,"Notre mod\xE8le a clairement adapt\xE9 ses pond\xE9rations pour pr\xE9dire les mots qui sont plus fortement associ\xE9s aux films !"),Bv.forEach(t),Nu=f(e),j(Bn.$$.fragment,e),Su=f(e),Ot=o(e,"P",{});var Zl=r(Ot);zf=n(Zl,"Ceci conclut notre premi\xE8re exp\xE9rience d\u2019entra\xEEnement d\u2019un mod\xE8le de langage. Dans la "),Kl=o(Zl,"A",{href:!0});var Kv=r(Kl);Mf=n(Kv,"section 6"),Kv.forEach(t),Cf=n(Zl,", vous apprendrez comment entra\xEEner \xE0 partir de z\xE9ro un mod\xE8le autor\xE9gressif comme GPT-2. Allez-y si vous voulez voir comment vous pouvez pr\xE9-entra\xEEner votre propre "),Gr=o(Zl,"EM",{});var Fv=r(Gr);Df=n(Fv,"transformer"),Fv.forEach(t),Pf=n(Zl," !"),Zl.forEach(t),Ou=f(e),j(Da.$$.fragment,e),this.h()},h(){y(i,"name","hf:doc:metadata"),y(i,"content",JSON.stringify(jg)),y($,"id","ifinetuneri-un-modle-de-langage-masqu"),y($,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),y($,"href","#ifinetuneri-un-modle-de-langage-masqu"),y(A,"class","relative group"),y(je,"href","https://arxiv.org/abs/1801.06146"),y(je,"rel","nofollow"),y(Oe,"class","block dark:hidden"),Xr(Oe.src,Ke="https://huggingface.co/datasets/huggingface-course/documentation-images/resolve/main/en/chapter7/ulmfit.svg")||y(Oe,"src",Ke),y(Oe,"alt","ULMFiT."),y(Y,"class","hidden dark:block"),Xr(Y.src,Ks="https://huggingface.co/datasets/huggingface-course/documentation-images/resolve/main/en/chapter7/ulmfit-dark.svg")||y(Y,"src",Ks),y(Y,"alt","ULMFiT."),y(Me,"class","flex justify-center"),y(Fe,"href","https://huggingface.co/huggingface-course/distilbert-base-uncased-finetuned-imdb?text=This+is+a+great+%5BMASK%5D."),y(Fe,"rel","nofollow"),Xr(Pe.src,yt="https://hf.space/gradioiframe/course-demos/distilbert-base-uncased-finetuned-imdb/+")||y(Pe,"src",yt),y(Pe,"frameborder","0"),y(Pe,"height","300"),y(Pe,"title","Gradio app"),y(Pe,"class","block dark:hidden container p-0 flex-grow space-iframe"),y(Pe,"allow","accelerometer; ambient-light-sensor; autoplay; battery; camera; document-domain; encrypted-media; fullscreen; geolocation; gyroscope; layout-animations; legacy-image-formats; magnetometer; microphone; midi; oversized-images; payment; picture-in-picture; publickey-credentials-get; sync-xhr; usb; vr ; wake-lock; xr-spatial-tracking"),y(Pe,"sandbox","allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-downloads"),Xr(we.src,He="https://hf.space/gradioiframe/course-demos/distilbert-base-uncased-finetuned-imdb-darkmode/+")||y(we,"src",He),y(we,"frameborder","0"),y(we,"height","300"),y(we,"title","Gradio app"),y(we,"class","hidden dark:block container p-0 flex-grow space-iframe"),y(we,"allow","accelerometer; ambient-light-sensor; autoplay; battery; camera; document-domain; encrypted-media; fullscreen; geolocation; gyroscope; layout-animations; legacy-image-formats; magnetometer; microphone; midi; oversized-images; payment; picture-in-picture; publickey-credentials-get; sync-xhr; usb; vr ; wake-lock; xr-spatial-tracking"),y(we,"sandbox","allow-forms allow-modals allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-downloads"),y(Ns,"id","choix-dun-modle-prentran-pour-la-modlisation-du-langage-masqu"),y(Ns,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),y(Ns,"href","#choix-dun-modle-prentran-pour-la-modlisation-du-langage-masqu"),y(Ts,"class","relative group"),y(fs,"href","https://huggingface.co/models?pipeline_tag=fill-mask&sort=downloads"),y(fs,"rel","nofollow"),Xr(Os.src,Qn="https://huggingface.co/datasets/huggingface-course/documentation-images/resolve/main/en/chapter7/mlm-models.png")||y(Os,"src",Qn),y(Os,"alt","Hub models."),y(Os,"width","80%"),y(ut,"class","flex justify-center"),y(pt,"href","https://huggingface.co/distilbert-base-uncased"),y(pt,"rel","nofollow"),y(Us,"href","https://en.wikipedia.org/wiki/Knowledge_distillation"),y(Us,"rel","nofollow"),y(Vs,"href","https://learning.oreilly.com/library/view/natural-language-processing/9781098103231/ch05.html"),y(Vs,"rel","nofollow"),y(Dt,"href","https://huggingface.co/datasets/wikipedia"),y(Dt,"rel","nofollow"),y(At,"href","https://huggingface.co/datasets/bookcorpus"),y(At,"rel","nofollow"),y(fa,"id","le-jeu-de-donnes"),y(fa,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),y(fa,"href","#le-jeu-de-donnes"),y(Qt,"class","relative group"),y(Va,"href","https://huggingface.co/datasets/imdb"),y(Va,"rel","nofollow"),y(hl,"href","/course/fr/chapter3"),y(va,"id","prtraitement-des-donnes"),y(va,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),y(va,"href","#prtraitement-des-donnes"),y(Xt,"class","relative group"),y(vl,"href","/course/fr/chapter6/3"),y(ja,"id","ifinetuningi-de-distilbert-avec-lapi-trainer"),y(ja,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),y(ja,"href","#ifinetuningi-de-distilbert-avec-lapi-trainer"),y(Zt,"class","relative group"),y(kl,"href","/course/fr/chapter3"),y(xl,"href","/course/fr/chapter5"),y(za,"id","perplexit-pour-les-modles-de-langage"),y(za,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),y(za,"href","#perplexit-pour-les-modles-de-langage"),y(ea,"class","relative group"),y(Ca,"id","utilisation-de-notre-modle-ifinetuni"),y(Ca,"class","header-link block pr-1.5 text-lg no-hover:hidden with-hover:absolute with-hover:p-1.5 with-hover:opacity-0 with-hover:group-hover:opacity-100 with-hover:right-full"),y(Ca,"href","#utilisation-de-notre-modle-ifinetuni"),y(sa,"class","relative group"),y(Kl,"href","/course/fr/chapter7/section6")},m(e,u){s(document.head,i),p(e,h,u),w(d,e,u),p(e,k,u),p(e,A,u),s(A,$),s($,q),w(z,q,null),s(A,_),s(A,M),s(M,O),s(O,C),s(M,L),p(e,H,u),Kn[P].m(e,u),p(e,U,u),p(e,R,u),s(R,v),s(R,S),s(S,W),s(R,G),s(R,J),s(J,ee),s(R,re),s(R,te),s(te,V),s(R,B),s(R,ie),s(ie,Q),s(R,se),p(e,ue,u),p(e,Z,u),s(Z,ge),s(Z,ne),s(ne,de),s(Z,rs),s(Z,be),s(be,qe),s(Z,is),s(Z,Ve),s(Ve,$e),s(Z,us),s(Z,We),s(We,xe),s(Z,Se),p(e,Je,u),p(e,X,u),s(X,pe),s(X,ye),s(ye,ce),s(X,ps),s(X,ze),s(ze,ke),s(X,Xe),s(X,le),s(le,Ze),s(X,Ee),s(X,je),s(je,K),s(X,ae),s(X,Be),s(Be,me),s(X,es),p(e,Ye,u),p(e,Me,u),s(Me,Oe),s(Me,N),s(Me,Y),p(e,oe,u),p(e,Ce,u),s(Ce,Ps),s(Ce,Fe),s(Fe,Qe),s(Ce,Ie),s(Ce,De),s(De,_e),s(Ce,Fs),p(e,nt,u),p(e,Pe,u),p(e,ds,u),p(e,we,u),p(e,lt,u),p(e,cs,u),s(cs,gs),p(e,ot,u),w(ms,e,u),p(e,Is,u),w(As,e,u),p(e,rt,u),p(e,Ts,u),s(Ts,Ns),s(Ns,Ss),w(Hs,Ss,null),s(Ts,bs),s(Ts,Gt),s(Gt,Vt),p(e,ta,u),p(e,qs,u),s(qs,Wt),s(qs,Jt),s(Jt,La),s(qs,aa),s(qs,fs),s(fs,zt),s(zt,it),s(qs,na),p(e,_s,u),p(e,ut,u),s(ut,Os),p(e,la,u),p(e,ve,u),s(ve,Ra),s(ve,pt),s(pt,oa),s(ve,dt),s(ve,Us),s(Us,Gs),s(Gs,Ba),s(ve,ra),s(ve,Ls),s(Ls,ia),s(ve,ct),s(ve,Mt),s(Mt,Ct),s(ve,Ka),s(ve,Vs),s(Vs,c),s(c,F),s(ve,Xn),p(e,Yt,u),Fn[$s].m(e,u),p(e,mt,u),p(e,ft,u),s(ft,Zn),s(ft,Es),s(Es,el),s(ft,sl),p(e,Fa,u),w(Ue,e,u),p(e,Ia,u),p(e,he,u),s(he,tl),s(he,ua),s(ua,pa),s(he,al),s(he,js),s(js,nl),s(he,ll),s(he,Dt),s(Dt,Pt),s(Pt,ol),s(he,da),s(he,At),s(At,Tt),s(Tt,rl),s(he,il),s(he,Ws),s(Ws,ul),s(he,pl),s(he,Js),s(Js,dl),s(he,cl),s(he,ca),s(ca,ml),s(he,np),p(e,Zr,u),w(Ha,e,u),p(e,ei,u),p(e,ma,u),s(ma,lp),s(ma,eo),s(eo,op),s(ma,rp),p(e,si,u),In[_t].m(e,u),p(e,fl,u),w(Ua,e,u),p(e,ti,u),p(e,_l,u),s(_l,ip),p(e,ai,u),p(e,Qt,u),s(Qt,fa),s(fa,so),w(Ga,so,null),s(Qt,up),s(Qt,to),s(to,pp),p(e,ni,u),p(e,ss,u),s(ss,dp),s(ss,Va),s(Va,ao),s(ao,cp),s(ss,mp),s(ss,no),s(no,fp),s(ss,_p),s(ss,lo),s(lo,hp),s(ss,vp),s(ss,oo),s(oo,gp),s(ss,bp),s(ss,ro),s(ro,qp),s(ss,$p),p(e,li,u),w(Wa,e,u),p(e,oi,u),w(Ja,e,u),p(e,ri,u),p(e,ts,u),s(ts,kp),s(ts,io),s(io,Ep),s(ts,jp),s(ts,uo),s(uo,wp),s(ts,xp),s(ts,po),s(po,yp),s(ts,zp),s(ts,co),s(co,Mp),s(ts,Cp),s(ts,mo),s(mo,Dp),s(ts,Pp),p(e,ii,u),w(Ya,e,u),p(e,ui,u),w(Qa,e,u),p(e,pi,u),p(e,Nt,u),s(Nt,Ap),s(Nt,fo),s(fo,Tp),s(Nt,Np),s(Nt,_o),s(_o,Sp),s(Nt,Op),p(e,di,u),w(_a,e,u),p(e,ci,u),p(e,ha,u),s(ha,Lp),s(ha,hl),s(hl,Rp),s(ha,Bp),p(e,mi,u),p(e,Xt,u),s(Xt,va),s(va,ho),w(Xa,ho,null),s(Xt,Kp),s(Xt,vo),s(vo,Fp),p(e,fi,u),w(Za,e,u),p(e,_i,u),p(e,ga,u),s(ga,Ip),s(ga,go),s(go,Hp),s(ga,Up),p(e,hi,u),p(e,Ae,u),s(Ae,Gp),s(Ae,bo),s(bo,Vp),s(Ae,Wp),s(Ae,qo),s(qo,Jp),s(Ae,Yp),s(Ae,$o),s($o,Qp),s(Ae,Xp),s(Ae,ko),s(ko,Zp),s(Ae,ed),s(Ae,vl),s(vl,sd),s(Ae,td),s(Ae,Eo),s(Eo,ad),s(Ae,nd),s(Ae,jo),s(jo,ld),s(Ae,od),p(e,vi,u),w(en,e,u),p(e,gi,u),w(sn,e,u),p(e,bi,u),p(e,Ys,u),s(Ys,rd),s(Ys,wo),s(wo,id),s(Ys,ud),s(Ys,xo),s(xo,pd),s(Ys,dd),s(Ys,yo),s(yo,cd),s(Ys,md),p(e,qi,u),p(e,Qs,u),s(Qs,fd),s(Qs,zo),s(zo,_d),s(Qs,hd),s(Qs,Mo),s(Mo,vd),s(Qs,gd),s(Qs,Co),s(Co,bd),s(Qs,qd),p(e,$i,u),w(tn,e,u),p(e,ki,u),w(an,e,u),p(e,Ei,u),p(e,Xs,u),s(Xs,$d),s(Xs,Do),s(Do,kd),s(Xs,Ed),s(Xs,Po),s(Po,jd),s(Xs,wd),s(Xs,Ao),s(Ao,xd),s(Xs,yd),p(e,ji,u),w(ba,e,u),p(e,wi,u),p(e,gl,u),s(gl,zd),p(e,xi,u),w(nn,e,u),p(e,yi,u),w(qa,e,u),p(e,zi,u),p(e,$a,u),s($a,Md),s($a,To),s(To,Cd),s($a,Dd),p(e,Mi,u),w(ln,e,u),p(e,Ci,u),w(on,e,u),p(e,Di,u),p(e,bl,u),s(bl,Pd),p(e,Pi,u),w(rn,e,u),p(e,Ai,u),w(un,e,u),p(e,Ti,u),p(e,ws,u),s(ws,Ad),s(ws,No),s(No,Td),s(ws,Nd),s(ws,So),s(So,Sd),s(ws,Od),s(ws,Oo),s(Oo,Ld),s(ws,Rd),s(ws,Lo),s(Lo,Bd),s(ws,Kd),p(e,Ni,u),w(pn,e,u),p(e,Si,u),w(dn,e,u),p(e,Oi,u),p(e,ka,u),s(ka,Fd),s(ka,Ro),s(Ro,Id),s(ka,Hd),p(e,Li,u),p(e,Ea,u),s(Ea,cn),s(cn,Ud),s(cn,Bo),s(Bo,Gd),s(cn,Vd),s(Ea,Wd),s(Ea,mn),s(mn,Jd),s(mn,Ko),s(Ko,Yd),s(mn,Qd),p(e,Ri,u),p(e,ql,u),s(ql,Xd),p(e,Bi,u),w(fn,e,u),p(e,Ki,u),p(e,as,u),s(as,Zd),s(as,Fo),s(Fo,ec),s(as,sc),s(as,Io),s(Io,tc),s(as,ac),s(as,Ho),s(Ho,nc),s(as,lc),s(as,Uo),s(Uo,oc),s(as,rc),s(as,Go),s(Go,ic),s(as,uc),p(e,Fi,u),p(e,St,u),s(St,pc),s(St,Vo),s(Vo,dc),s(St,cc),s(St,Wo),s(Wo,mc),s(St,fc),p(e,Ii,u),w(_n,e,u),p(e,Hi,u),w(hn,e,u),p(e,Ui,u),p(e,Te,u),s(Te,_c),s(Te,Jo),s(Jo,hc),s(Te,vc),s(Te,Yo),s(Yo,gc),s(Te,bc),s(Te,Qo),s(Qo,qc),s(Te,$c),s(Te,Xo),s(Xo,kc),s(Te,Ec),s(Te,Zo),s(Zo,jc),s(Te,wc),s(Te,er),s(er,xc),s(Te,yc),s(Te,sr),s(sr,zc),s(Te,Mc),p(e,Gi,u),w(vn,e,u),p(e,Vi,u),w(gn,e,u),p(e,Wi,u),p(e,$l,u),s($l,Cc),p(e,Ji,u),w(bn,e,u),p(e,Yi,u),w(qn,e,u),p(e,Qi,u),p(e,xs,u),s(xs,Dc),s(xs,tr),s(tr,Pc),s(xs,Ac),s(xs,ar),s(ar,Tc),s(xs,Nc),s(xs,nr),s(nr,Sc),s(xs,Oc),s(xs,lr),s(lr,Lc),s(xs,Rc),p(e,Xi,u),p(e,Zt,u),s(Zt,ja),s(ja,or),w($n,or,null),s(Zt,Bc),s(Zt,kn),s(kn,rr),s(rr,Kc),s(kn,Fc),s(kn,ir),s(ir,Ic),p(e,Zi,u),p(e,fe,u),s(fe,Hc),s(fe,ur),s(ur,Uc),s(fe,Gc),s(fe,pr),s(pr,Vc),s(fe,Wc),s(fe,kl),s(kl,Jc),s(fe,Yc),s(fe,dr),s(dr,Qc),s(fe,Xc),s(fe,cr),s(cr,Zc),s(fe,em),s(fe,mr),s(mr,sm),s(fe,tm),s(fe,fr),s(fr,am),s(fe,nm),s(fe,_r),s(_r,lm),s(fe,om),s(fe,hr),s(hr,rm),s(fe,im),p(e,eu,u),w(En,e,u),p(e,su,u),p(e,Zs,u),s(Zs,um),s(Zs,vr),s(vr,pm),s(Zs,dm),s(Zs,gr),s(gr,cm),s(Zs,mm),s(Zs,br),s(br,fm),s(Zs,_m),p(e,tu,u),w(jn,e,u),p(e,au,u),w(wn,e,u),p(e,nu,u),p(e,ys,u),s(ys,hm),s(ys,qr),s(qr,vm),s(ys,gm),s(ys,$r),s($r,bm),s(ys,qm),s(ys,kr),s(kr,$m),s(ys,km),s(ys,Er),s(Er,Em),s(ys,jm),p(e,lu,u),w(wa,e,u),p(e,ou,u),hs&&hs.m(e,u),p(e,El,u),p(e,zs,u),s(zs,wm),s(zs,jr),s(jr,xm),s(zs,ym),s(zs,wr),s(wr,zm),s(zs,Mm),s(zs,xr),s(xr,Cm),s(zs,Dm),s(zs,yr),s(yr,Pm),s(zs,Am),p(e,ru,u),Hn[vt].m(e,u),p(e,jl,u),p(e,wl,u),s(wl,Tm),p(e,iu,u),w(xn,e,u),p(e,uu,u),w(yn,e,u),p(e,pu,u),w(xa,e,u),p(e,du,u),p(e,Ms,u),s(Ms,Nm),s(Ms,zr),s(zr,Sm),s(Ms,Om),s(Ms,Mr),s(Mr,Lm),s(Ms,Rm),s(Ms,Cr),s(Cr,Bm),s(Ms,Km),s(Ms,xl),s(xl,Fm),s(Ms,Im),p(e,cu,u),w(zn,e,u),p(e,mu,u),w(Mn,e,u),p(e,fu,u),p(e,Cs,u),s(Cs,Hm),s(Cs,Dr),s(Dr,Um),s(Cs,Gm),s(Cs,Pr),s(Pr,Vm),s(Cs,Wm),s(Cs,Ar),s(Ar,Jm),s(Cs,Ym),s(Cs,Tr),s(Tr,Qm),s(Cs,Xm),p(e,_u,u),w(Cn,e,u),p(e,hu,u),p(e,ya,u),s(ya,Zm),s(ya,Nr),s(Nr,ef),s(ya,sf),p(e,vu,u),w(Dn,e,u),p(e,gu,u),p(e,yl,u),s(yl,tf),p(e,bu,u),Un[bt].m(e,u),p(e,zl,u),p(e,ea,u),s(ea,za),s(za,Sr),w(Pn,Sr,null),s(ea,af),s(ea,Or),s(Or,nf),p(e,qu,u),w(An,e,u),p(e,$u,u),p(e,Ml,u),s(Ml,lf),p(e,ku,u),Gn[$t].m(e,u),p(e,Cl,u),w(Tn,e,u),p(e,Eu,u),p(e,Dl,u),s(Dl,of),p(e,ju,u),Vn[Et].m(e,u),p(e,Pl,u),p(e,Al,u),s(Al,rf),p(e,wu,u),Wn[wt].m(e,u),p(e,Tl,u),w(Nn,e,u),p(e,xu,u),p(e,Nl,u),s(Nl,uf),p(e,yu,u),Le&&Le.m(e,u),p(e,Sl,u),w(Ma,e,u),p(e,zu,u),Re&&Re.m(e,u),p(e,Ol,u),p(e,sa,u),s(sa,Ca),s(Ca,Lr),w(Sn,Lr,null),s(sa,pf),s(sa,Ll),s(Ll,df),s(Ll,Rr),s(Rr,cf),p(e,Mu,u),p(e,Ge,u),s(Ge,mf),s(Ge,Br),s(Br,ff),s(Ge,_f),s(Ge,Kr),s(Kr,hf),s(Ge,vf),s(Ge,Fr),s(Fr,gf),s(Ge,bf),s(Ge,Ir),s(Ir,qf),s(Ge,$f),s(Ge,Hr),s(Hr,kf),s(Ge,Ef),s(Ge,Ur),s(Ur,jf),s(Ge,wf),p(e,Cu,u),w(On,e,u),p(e,Du,u),p(e,Rl,u),s(Rl,xf),p(e,Pu,u),w(Ln,e,u),p(e,Au,u),w(Rn,e,u),p(e,Tu,u),p(e,Bl,u),s(Bl,yf),p(e,Nu,u),w(Bn,e,u),p(e,Su,u),p(e,Ot,u),s(Ot,zf),s(Ot,Kl),s(Kl,Mf),s(Ot,Cf),s(Ot,Gr),s(Gr,Df),s(Ot,Pf),p(e,Ou,u),w(Da,e,u),Lu=!0},p(e,[u]){const Jn={};u&1&&(Jn.fw=e[0]),d.$set(Jn);let Fl=P;P=Nf(e),P!==Fl&&(Ut(),b(Kn[Fl],1,1,()=>{Kn[Fl]=null}),Ht(),D=Kn[P],D||(D=Kn[P]=Tf[P](e),D.c()),g(D,1),D.m(U.parentNode,U));const Vr={};u&2&&(Vr.$$scope={dirty:u,ctx:e}),As.$set(Vr);let Yn=$s;$s=Of(e),$s!==Yn&&(Ut(),b(Fn[Yn],1,1,()=>{Fn[Yn]=null}),Ht(),ks=Fn[$s],ks||(ks=Fn[$s]=Sf[$s](e),ks.c()),g(ks,1),ks.m(mt.parentNode,mt));let Il=_t;_t=Rf(e),_t!==Il&&(Ut(),b(In[Il],1,1,()=>{In[Il]=null}),Ht(),ht=In[_t],ht||(ht=In[_t]=Lf[_t](e),ht.c()),g(ht,1),ht.m(fl.parentNode,fl));const Rs={};u&2&&(Rs.$$scope={dirty:u,ctx:e}),_a.$set(Rs);const Wr={};u&2&&(Wr.$$scope={dirty:u,ctx:e}),ba.$set(Wr);const Jr={};u&2&&(Jr.$$scope={dirty:u,ctx:e}),qa.$set(Jr);const Yr={};u&2&&(Yr.$$scope={dirty:u,ctx:e}),wa.$set(Yr),e[0]==="pt"?hs||(hs=Iv(),hs.c(),hs.m(El.parentNode,El)):hs&&(hs.d(1),hs=null);let Hl=vt;vt=Kf(e),vt!==Hl&&(Ut(),b(Hn[Hl],1,1,()=>{Hn[Hl]=null}),Ht(),gt=Hn[vt],gt||(gt=Hn[vt]=Bf[vt](e),gt.c()),g(gt,1),gt.m(jl.parentNode,jl));const Bs={};u&2&&(Bs.$$scope={dirty:u,ctx:e}),xa.$set(Bs);let Ul=bt;bt=If(e),bt!==Ul&&(Ut(),b(Un[Ul],1,1,()=>{Un[Ul]=null}),Ht(),qt=Un[bt],qt||(qt=Un[bt]=Ff[bt](e),qt.c()),g(qt,1),qt.m(zl.parentNode,zl));let Gl=$t;$t=Uf(e),$t!==Gl&&(Ut(),b(Gn[Gl],1,1,()=>{Gn[Gl]=null}),Ht(),kt=Gn[$t],kt||(kt=Gn[$t]=Hf[$t](e),kt.c()),g(kt,1),kt.m(Cl.parentNode,Cl));let Vl=Et;Et=Vf(e),Et!==Vl&&(Ut(),b(Vn[Vl],1,1,()=>{Vn[Vl]=null}),Ht(),jt=Vn[Et],jt||(jt=Vn[Et]=Gf[Et](e),jt.c()),g(jt,1),jt.m(Pl.parentNode,Pl));let Wl=wt;wt=Jf(e),wt!==Wl&&(Ut(),b(Wn[Wl],1,1,()=>{Wn[Wl]=null}),Ht(),xt=Wn[wt],xt||(xt=Wn[wt]=Wf[wt](e),xt.c()),g(xt,1),xt.m(Tl.parentNode,Tl)),e[0]==="pt"?Le?u&1&&g(Le,1):(Le=Hv(),Le.c(),g(Le,1),Le.m(Sl.parentNode,Sl)):Le&&(Ut(),b(Le,1,1,()=>{Le=null}),Ht());const vs={};u&2&&(vs.$$scope={dirty:u,ctx:e}),Ma.$set(vs),e[0]==="pt"?Re?u&1&&g(Re,1):(Re=Uv(),Re.c(),g(Re,1),Re.m(Ol.parentNode,Ol)):Re&&(Ut(),b(Re,1,1,()=>{Re=null}),Ht());const Qr={};u&2&&(Qr.$$scope={dirty:u,ctx:e}),Da.$set(Qr)},i(e){Lu||(g(d.$$.fragment,e),g(z.$$.fragment,e),g(D),g(ms.$$.fragment,e),g(As.$$.fragment,e),g(Hs.$$.fragment,e),g(ks),g(Ue.$$.fragment,e),g(Ha.$$.fragment,e),g(ht),g(Ua.$$.fragment,e),g(Ga.$$.fragment,e),g(Wa.$$.fragment,e),g(Ja.$$.fragment,e),g(Ya.$$.fragment,e),g(Qa.$$.fragment,e),g(_a.$$.fragment,e),g(Xa.$$.fragment,e),g(Za.$$.fragment,e),g(en.$$.fragment,e),g(sn.$$.fragment,e),g(tn.$$.fragment,e),g(an.$$.fragment,e),g(ba.$$.fragment,e),g(nn.$$.fragment,e),g(qa.$$.fragment,e),g(ln.$$.fragment,e),g(on.$$.fragment,e),g(rn.$$.fragment,e),g(un.$$.fragment,e),g(pn.$$.fragment,e),g(dn.$$.fragment,e),g(fn.$$.fragment,e),g(_n.$$.fragment,e),g(hn.$$.fragment,e),g(vn.$$.fragment,e),g(gn.$$.fragment,e),g(bn.$$.fragment,e),g(qn.$$.fragment,e),g($n.$$.fragment,e),g(En.$$.fragment,e),g(jn.$$.fragment,e),g(wn.$$.fragment,e),g(wa.$$.fragment,e),g(gt),g(xn.$$.fragment,e),g(yn.$$.fragment,e),g(xa.$$.fragment,e),g(zn.$$.fragment,e),g(Mn.$$.fragment,e),g(Cn.$$.fragment,e),g(Dn.$$.fragment,e),g(qt),g(Pn.$$.fragment,e),g(An.$$.fragment,e),g(kt),g(Tn.$$.fragment,e),g(jt),g(xt),g(Nn.$$.fragment,e),g(Le),g(Ma.$$.fragment,e),g(Re),g(Sn.$$.fragment,e),g(On.$$.fragment,e),g(Ln.$$.fragment,e),g(Rn.$$.fragment,e),g(Bn.$$.fragment,e),g(Da.$$.fragment,e),Lu=!0)},o(e){b(d.$$.fragment,e),b(z.$$.fragment,e),b(D),b(ms.$$.fragment,e),b(As.$$.fragment,e),b(Hs.$$.fragment,e),b(ks),b(Ue.$$.fragment,e),b(Ha.$$.fragment,e),b(ht),b(Ua.$$.fragment,e),b(Ga.$$.fragment,e),b(Wa.$$.fragment,e),b(Ja.$$.fragment,e),b(Ya.$$.fragment,e),b(Qa.$$.fragment,e),b(_a.$$.fragment,e),b(Xa.$$.fragment,e),b(Za.$$.fragment,e),b(en.$$.fragment,e),b(sn.$$.fragment,e),b(tn.$$.fragment,e),b(an.$$.fragment,e),b(ba.$$.fragment,e),b(nn.$$.fragment,e),b(qa.$$.fragment,e),b(ln.$$.fragment,e),b(on.$$.fragment,e),b(rn.$$.fragment,e),b(un.$$.fragment,e),b(pn.$$.fragment,e),b(dn.$$.fragment,e),b(fn.$$.fragment,e),b(_n.$$.fragment,e),b(hn.$$.fragment,e),b(vn.$$.fragment,e),b(gn.$$.fragment,e),b(bn.$$.fragment,e),b(qn.$$.fragment,e),b($n.$$.fragment,e),b(En.$$.fragment,e),b(jn.$$.fragment,e),b(wn.$$.fragment,e),b(wa.$$.fragment,e),b(gt),b(xn.$$.fragment,e),b(yn.$$.fragment,e),b(xa.$$.fragment,e),b(zn.$$.fragment,e),b(Mn.$$.fragment,e),b(Cn.$$.fragment,e),b(Dn.$$.fragment,e),b(qt),b(Pn.$$.fragment,e),b(An.$$.fragment,e),b(kt),b(Tn.$$.fragment,e),b(jt),b(xt),b(Nn.$$.fragment,e),b(Le),b(Ma.$$.fragment,e),b(Re),b(Sn.$$.fragment,e),b(On.$$.fragment,e),b(Ln.$$.fragment,e),b(Rn.$$.fragment,e),b(Bn.$$.fragment,e),b(Da.$$.fragment,e),Lu=!1},d(e){t(i),e&&t(h),x(d,e),e&&t(k),e&&t(A),x(z),e&&t(H),Kn[P].d(e),e&&t(U),e&&t(R),e&&t(ue),e&&t(Z),e&&t(Je),e&&t(X),e&&t(Ye),e&&t(Me),e&&t(oe),e&&t(Ce),e&&t(nt),e&&t(Pe),e&&t(ds),e&&t(we),e&&t(lt),e&&t(cs),e&&t(ot),x(ms,e),e&&t(Is),x(As,e),e&&t(rt),e&&t(Ts),x(Hs),e&&t(ta),e&&t(qs),e&&t(_s),e&&t(ut),e&&t(la),e&&t(ve),e&&t(Yt),Fn[$s].d(e),e&&t(mt),e&&t(ft),e&&t(Fa),x(Ue,e),e&&t(Ia),e&&t(he),e&&t(Zr),x(Ha,e),e&&t(ei),e&&t(ma),e&&t(si),In[_t].d(e),e&&t(fl),x(Ua,e),e&&t(ti),e&&t(_l),e&&t(ai),e&&t(Qt),x(Ga),e&&t(ni),e&&t(ss),e&&t(li),x(Wa,e),e&&t(oi),x(Ja,e),e&&t(ri),e&&t(ts),e&&t(ii),x(Ya,e),e&&t(ui),x(Qa,e),e&&t(pi),e&&t(Nt),e&&t(di),x(_a,e),e&&t(ci),e&&t(ha),e&&t(mi),e&&t(Xt),x(Xa),e&&t(fi),x(Za,e),e&&t(_i),e&&t(ga),e&&t(hi),e&&t(Ae),e&&t(vi),x(en,e),e&&t(gi),x(sn,e),e&&t(bi),e&&t(Ys),e&&t(qi),e&&t(Qs),e&&t($i),x(tn,e),e&&t(ki),x(an,e),e&&t(Ei),e&&t(Xs),e&&t(ji),x(ba,e),e&&t(wi),e&&t(gl),e&&t(xi),x(nn,e),e&&t(yi),x(qa,e),e&&t(zi),e&&t($a),e&&t(Mi),x(ln,e),e&&t(Ci),x(on,e),e&&t(Di),e&&t(bl),e&&t(Pi),x(rn,e),e&&t(Ai),x(un,e),e&&t(Ti),e&&t(ws),e&&t(Ni),x(pn,e),e&&t(Si),x(dn,e),e&&t(Oi),e&&t(ka),e&&t(Li),e&&t(Ea),e&&t(Ri),e&&t(ql),e&&t(Bi),x(fn,e),e&&t(Ki),e&&t(as),e&&t(Fi),e&&t(St),e&&t(Ii),x(_n,e),e&&t(Hi),x(hn,e),e&&t(Ui),e&&t(Te),e&&t(Gi),x(vn,e),e&&t(Vi),x(gn,e),e&&t(Wi),e&&t($l),e&&t(Ji),x(bn,e),e&&t(Yi),x(qn,e),e&&t(Qi),e&&t(xs),e&&t(Xi),e&&t(Zt),x($n),e&&t(Zi),e&&t(fe),e&&t(eu),x(En,e),e&&t(su),e&&t(Zs),e&&t(tu),x(jn,e),e&&t(au),x(wn,e),e&&t(nu),e&&t(ys),e&&t(lu),x(wa,e),e&&t(ou),hs&&hs.d(e),e&&t(El),e&&t(zs),e&&t(ru),Hn[vt].d(e),e&&t(jl),e&&t(wl),e&&t(iu),x(xn,e),e&&t(uu),x(yn,e),e&&t(pu),x(xa,e),e&&t(du),e&&t(Ms),e&&t(cu),x(zn,e),e&&t(mu),x(Mn,e),e&&t(fu),e&&t(Cs),e&&t(_u),x(Cn,e),e&&t(hu),e&&t(ya),e&&t(vu),x(Dn,e),e&&t(gu),e&&t(yl),e&&t(bu),Un[bt].d(e),e&&t(zl),e&&t(ea),x(Pn),e&&t(qu),x(An,e),e&&t($u),e&&t(Ml),e&&t(ku),Gn[$t].d(e),e&&t(Cl),x(Tn,e),e&&t(Eu),e&&t(Dl),e&&t(ju),Vn[Et].d(e),e&&t(Pl),e&&t(Al),e&&t(wu),Wn[wt].d(e),e&&t(Tl),x(Nn,e),e&&t(xu),e&&t(Nl),e&&t(yu),Le&&Le.d(e),e&&t(Sl),x(Ma,e),e&&t(zu),Re&&Re.d(e),e&&t(Ol),e&&t(sa),x(Sn),e&&t(Mu),e&&t(Ge),e&&t(Cu),x(On,e),e&&t(Du),e&&t(Rl),e&&t(Pu),x(Ln,e),e&&t(Au),x(Rn,e),e&&t(Tu),e&&t(Bl),e&&t(Nu),x(Bn,e),e&&t(Su),e&&t(Ot),e&&t(Ou),x(Da,e)}}}const jg={local:"ifinetuneri-un-modle-de-langage-masqu",sections:[{local:"choix-dun-modle-prentran-pour-la-modlisation-du-langage-masqu",title:"Choix d'un mod\xE8le pr\xE9-entra\xEEn\xE9 pour la mod\xE9lisation du langage masqu\xE9"},{local:"le-jeu-de-donnes",title:"Le jeu de donn\xE9es"},{local:"prtraitement-des-donnes",title:"Pr\xE9traitement des donn\xE9es"},{local:"ifinetuningi-de-distilbert-avec-lapi-trainer",sections:[{local:"perplexit-pour-les-modles-de-langage",title:"Perplexit\xE9 pour les mod\xE8les de langage"}],title:"<i>Finetuning</i> de DistilBERT avec l'API `Trainer`"},{local:"ifinetuningi-de-distilbert-avec-iacceleratei",sections:[{local:"utilisation-de-notre-modle-ifinetuni",title:"Utilisation de notre mod\xE8le <i>finetun\xE9</i>"}],title:"<i>Finetuning</i> de DistilBERT avec \u{1F917} <i>Accelerate</i>"}],title:"<i>Finetuner</i> un mod\xE8le de langage masqu\xE9"};function wg(I,i,h){let d="pt";return Qv(()=>{const k=new URLSearchParams(window.location.search);h(0,d=k.get("fw")||"pt")}),[d]}class Ag extends Vv{constructor(i){super();Wv(this,i,wg,Eg,Jv,{})}}export{Ag as default,jg as metadata};
