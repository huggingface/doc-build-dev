---
local: optimization
sections:
- local: optimum.onnxruntime.ORTOptimizer
  title: ORTOptimizer
title: Optimization
---
<script lang="ts">
import {onMount} from "svelte";
import Tip from "$lib/Tip.svelte";
import Youtube from "$lib/Youtube.svelte";
import Docstring from "$lib/Docstring.svelte";
import CodeBlock from "$lib/CodeBlock.svelte";
import CodeBlockFw from "$lib/CodeBlockFw.svelte";
import DocNotebookDropdown from "$lib/DocNotebookDropdown.svelte";
import IconCopyLink from "$lib/IconCopyLink.svelte";
import FrameworkContent from "$lib/FrameworkContent.svelte";
import Markdown from "$lib/Markdown.svelte";
import Question from "$lib/Question.svelte";
import FrameworkSwitchCourse from "$lib/FrameworkSwitchCourse.svelte";
import InferenceApi from "$lib/InferenceApi.svelte";
import TokenizersLanguageContent from "$lib/TokenizersLanguageContent.svelte";
import ExampleCodeBlock from "$lib/ExampleCodeBlock.svelte";
let fw: "pt" | "tf" = "pt";
onMount(() => {
    const urlParams = new URLSearchParams(window.location.search);
    fw = urlParams.get("fw") || "pt";
});
</script>
<svelte:head>
  <meta name="hf:doc:metadata" content={JSON.stringify(metadata)} >
</svelte:head>
<!--Copyright 2022 The HuggingFace Team. All rights reserved.

Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with
the License. You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on
an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the
specific language governing permissions and limitations under the License.
-->

<h1 id="optimization">Optimization</h1>

ðŸ¤— Optimum provides an `optimum.onnxruntime` package that enables you to apply graph optimization on many model hosted on the ðŸ¤— hub using the [ONNX Runtime](https://github.com/microsoft/onnxruntime/tree/master/onnxruntime/python/tools/transformers) model optimization tool.

<h2 id="optimum.onnxruntime.ORTOptimizer">ORTOptimizer</h2>

<div class="docstring border-l-2 border-t-2 pl-4 pt-3.5 border-gray-100 rounded-tl-xl mb-6 mt-8">

<docstring><name>class optimum.onnxruntime.ORTOptimizer</name><anchor>optimum.onnxruntime.ORTOptimizer</anchor><source>https://github.com/huggingface/optimum/blob/vr_299/src/optimum/onnxruntime/optimization.py#L36</source><parameters>[{"name": "preprocessor", "val": ": typing.Union[transformers.models.auto.feature_extraction_auto.AutoFeatureExtractor, transformers.models.auto.processing_auto.AutoProcessor, transformers.models.auto.tokenization_auto.AutoTokenizer]"}, {"name": "model", "val": ": PreTrainedModel"}, {"name": "feature", "val": ": str = 'default'"}, {"name": "opset", "val": ": typing.Optional[int] = None"}]</parameters></docstring>

Handles the ONNX Runtime optimization process for models shared on huggingface.co/models.



<div class="docstring border-l-2 border-t-2 pl-4 pt-3.5 border-gray-100 rounded-tl-xl mb-6 mt-8">
<docstring><name>export</name><anchor>optimum.onnxruntime.ORTOptimizer.export</anchor><source>https://github.com/huggingface/optimum/blob/vr_299/src/optimum/onnxruntime/optimization.py#L92</source><parameters>[{"name": "onnx_model_path", "val": ": typing.Union[str, os.PathLike]"}, {"name": "onnx_optimized_model_output_path", "val": ": typing.Union[str, os.PathLike]"}, {"name": "optimization_config", "val": ": OptimizationConfig"}, {"name": "use_external_data_format", "val": ": bool = False"}]</parameters><paramsdesc>- **onnx_model_path** (`Union[str, os.PathLike]`) --
  The path used to save the model exported to an ONNX Intermediate Representation (IR).
- **onnx_optimized_model_output_path** (`Union[str, os.PathLike]`) --
  The path used to save the optimized model exported to an ONNX Intermediate Representation (IR).
- **optimization_config** (`OptimizationConfig`) --
  The configuration containing the parameters related to optimization.
- **use_external_data_format** (`bool`, defaults to `False`) --
  Whether uto se external data format to store model which size is >= 2Gb.</paramsdesc><paramgroups>0</paramgroups><retdesc>The path of the resulting optimized model.</retdesc></docstring>

Optimize a model given the optimization specifications defined in `optimization_config`.






</div>
<div class="docstring border-l-2 border-t-2 pl-4 pt-3.5 border-gray-100 rounded-tl-xl mb-6 mt-8">
<docstring><name>from_pretrained</name><anchor>optimum.onnxruntime.ORTOptimizer.from_pretrained</anchor><source>https://github.com/huggingface/optimum/blob/vr_299/src/optimum/onnxruntime/optimization.py#L41</source><parameters>[{"name": "model_name_or_path", "val": ": typing.Union[str, os.PathLike]"}, {"name": "feature", "val": ": str"}, {"name": "opset", "val": ": typing.Optional[int] = None"}]</parameters><paramsdesc>- **model_name_or_path** (`Union[str, os.PathLike]`) --
  Repository name in the Hugging Face Hub or path to a local directory hosting the model.
- **feature** (`str`) --
  Feature to use when exporting the model.
- **opset** (`int`, *optional*) --
  ONNX opset version to export the model with.</paramsdesc><paramgroups>0</paramgroups><retdesc>An instance of `ORTOptimizer`.</retdesc></docstring>

Instantiate a `ORTOptimizer` from a pretrained pytorch model and preprocessor.






</div>
<div class="docstring border-l-2 border-t-2 pl-4 pt-3.5 border-gray-100 rounded-tl-xl mb-6 mt-8">
<docstring><name>get_fused_operators</name><anchor>optimum.onnxruntime.ORTOptimizer.get_fused_operators</anchor><source>https://github.com/huggingface/optimum/blob/vr_299/src/optimum/onnxruntime/optimization.py#L162</source><parameters>[{"name": "onnx_model_path", "val": ": typing.Union[str, os.PathLike]"}]</parameters><paramsdesc>- **onnx_model_path** (`Union[str, os.PathLike]`) --
  Path of the ONNX model.</paramsdesc><paramgroups>0</paramgroups><retdesc>The dictionary mapping the name of the fused operators to their number of apparition in the model.</retdesc></docstring>

Compute the dictionary mapping the name of the fused operators to their number of apparition in the model.






</div>
<div class="docstring border-l-2 border-t-2 pl-4 pt-3.5 border-gray-100 rounded-tl-xl mb-6 mt-8">
<docstring><name>get_nodes_number_difference</name><anchor>optimum.onnxruntime.ORTOptimizer.get_nodes_number_difference</anchor><source>https://github.com/huggingface/optimum/blob/vr_299/src/optimum/onnxruntime/optimization.py#L181</source><parameters>[{"name": "onnx_model_path", "val": ": typing.Union[str, os.PathLike]"}, {"name": "onnx_optimized_model_path", "val": ": typing.Union[str, os.PathLike]"}]</parameters><paramsdesc>- **onnx_model_path** (`Union[str, os.PathLike]`) --
  Path of the ONNX model.
- **onnx_optimized_model_path** (`Union[str, os.PathLike]`) --
  Path of the optimized ONNX model.</paramsdesc><paramgroups>0</paramgroups><retdesc>The difference in the number of nodes between the original and the optimized model.</retdesc></docstring>

Compute the difference in the number of nodes between the original and the optimized model.






</div>
<div class="docstring border-l-2 border-t-2 pl-4 pt-3.5 border-gray-100 rounded-tl-xl mb-6 mt-8">
<docstring><name>get_operators_difference</name><anchor>optimum.onnxruntime.ORTOptimizer.get_operators_difference</anchor><source>https://github.com/huggingface/optimum/blob/vr_299/src/optimum/onnxruntime/optimization.py#L210</source><parameters>[{"name": "onnx_model_path", "val": ": typing.Union[str, os.PathLike]"}, {"name": "onnx_optimized_model_path", "val": ": typing.Union[str, os.PathLike]"}]</parameters><paramsdesc>- **onnx_model_path** (`Union[str, os.PathLike]`) --
  Path of the ONNX model.
- **onnx_optimized_model_path** (`Union[str, os.PathLike]`) --
  Path of the optimized ONNX model.</paramsdesc><paramgroups>0</paramgroups><retdesc>The dictionary mapping the operators name to the difference in the number of corresponding nodes between the
original and the optimized model.</retdesc></docstring>

Compute the dictionary mapping the operators name to the difference in the number of corresponding nodes between
the original and the optimized model.






</div></div>
